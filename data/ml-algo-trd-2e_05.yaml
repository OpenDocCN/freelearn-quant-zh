- en: '5'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '5'
- en: Portfolio Optimization and Performance Evaluation
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 组合优化和绩效评估
- en: Alpha factors generate signals that an algorithmic strategy translates into
    trades, which, in turn, produce long and short positions. The returns and risk
    of the resulting portfolio determine the success of the strategy.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 阿尔法因子产生信号，算法策略将其转化为交易，进而产生多头和空头仓位。由此产生的投资组合的回报和风险决定了策略的成功。
- en: To test a strategy prior to implementation under market conditions, we need
    to simulate the trades that the algorithm would make and verify their performance.
    Strategy evaluation includes backtesting against historical data to optimize the
    strategy's parameters and forward-testing to validate the in-sample performance
    against new, out-of-sample data. The goal is to avoid false discoveries from tailoring
    a strategy to specific past circumstances.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 在市场条件下测试策略之前，我们需要模拟算法将进行的交易并验证其绩效。策略评估包括针对历史数据进行反向测试以优化策略的参数，并进行向前测试以验证样本内绩效与新的样本外数据。目标是避免从针对特定过去情况量身定制策略中发现虚假结果。
- en: In a portfolio context, positive asset returns can offset negative price movements.
    Positive price changes for one asset are more likely to offset losses on another,
    the lower the correlation between the two positions is. Based on how portfolio
    risk depends on the positions' covariance, Harry Markowitz developed the theory
    behind modern portfolio management based on diversification in 1952\. The result
    is mean-variance optimization, which selects weights for a given set of assets
    to minimize risk, measured as the standard deviation of returns for a given expected
    return.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在组合环境中，正资产回报可以抵消负价格波动。一个资产的正价格变动更有可能抵消另一个资产的损失，这两个仓位之间的相关性越低。基于仓位协方差对组合风险的影响，哈里·马科维茨于1952年开发了现代投资组合管理背后的理论，该理论基于多样化。结果是均值-方差优化，它为给定的资产集合选择权重以最小化风险，风险用预期收益的标准差来衡量。
- en: The **capital asset pricing model** (**CAPM**) introduces a risk premium, measured
    as the expected return in excess of a risk-free investment, as an equilibrium
    reward for holding an asset. This reward compensates for the exposure to a single
    risk factor—the market—that is systematic as opposed to idiosyncratic to the asset
    and thus cannot be diversified away.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: '**资本资产定价模型**(**CAPM**)引入了一个风险溢价，该溢价以超过无风险投资的预期收益来衡量，作为持有资产的平衡报酬。这种奖励是对持有资产暴露于一个系统性风险因素——市场的补偿，与特定资产特有的非系统性风险相对，因此无法通过分散化消除。'
- en: Risk management has evolved to become more sophisticated as additional risk
    factors and more granular choices for exposure have emerged. The Kelly criterion
    is a popular approach to dynamic portfolio optimization, which is the choice of
    a sequence of positions over time; it was famously adapted from its original application
    in gambling to the stock market by Edward Thorp in 1968.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 风险管理随着额外的风险因素和更精细的暴露选择的出现而变得更加复杂。凯利准则是动态组合优化的一种流行方法，即选择一系列随时间变化的仓位；它最初被爱德华·索普在1968年从赌博中著名地改编到股票市场中。
- en: As a result, there are several approaches to optimize portfolios, including
    the application of **machine learning** (**ML**) to learn hierarchical relationships
    among assets, and to treat their holdings as complements or substitutes with respect
    to the portfolio risk profile.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，有几种优化投资组合的方法，包括将**机器学习**(**ML**)应用于学习资产之间的层次关系，并将它们的持仓视为相互补充或替代品，以满足组合风险概况。
- en: 'In this chapter, we will cover the following topics:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将涵盖以下主题：
- en: How to measure portfolio risk and return
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何衡量组合风险和回报
- en: Managing portfolio weights using mean-variance optimization and alternatives
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用均值-方差优化和替代方法管理组合权重
- en: Using machine learning to optimize asset allocation in a portfolio context
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在组合环境中使用机器学习来优化资产配置
- en: Simulating trades and create a portfolio based on alpha factors using Zipline
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用Zipline模拟交易并基于阿尔法因子创建投资组合
- en: How to evaluate portfolio performance using pyfolio
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何使用pyfolio评估组合绩效
- en: You can find the code samples for this chapter and links to additional resources
    in the corresponding directory of the GitHub repository. The notebooks include
    color versions of the images..
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在GitHub存储库的相应目录中找到本章的代码示例和其他资源的链接。笔记本包括图像的彩色版本。
- en: How to measure portfolio performance
  id: totrans-15
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何衡量组合绩效
- en: To evaluate and compare different strategies or to improve an existing strategy,
    we need metrics that reflect their performance with respect to our objectives.
    In investment and trading, the most common objectives are the return and the risk
    of the investment portfolio.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 为了评估和比较不同的策略或改进现有策略，我们需要反映它们相对于我们目标的表现的指标。在投资和交易中，最常见的目标是投资组合的回报和风险。
- en: Typically, these metrics are compared to a benchmark that represents alternative
    investment opportunities, such as a summary of the investment universe like the
    S&P 500 for US equities or the risk-free interest rate for fixed income assets.
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，这些指标与代表替代投资机会的基准进行比较，例如作为美国股票的摘要的投资宇宙的标准普尔 500 或固定收益资产的无风险利率。
- en: There are several metrics to evaluate these objectives. In this section, we
    will review the most common measures for comparing portfolio results. These measures
    will be useful when we look at different approaches to optimize portfolio performance,
    simulate the interaction of a strategy with the market using Zipline, and compute
    relevant performance metrics using the pyfolio library in later sections.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 有几种指标可用于评估这些目标。在本节中，我们将回顾比较投资组合结果最常见的度量标准。当我们研究不同的方法来优化投资组合绩效，使用 Zipline 模拟策略与市场的交互，并在后续章节中使用
    pyfolio 库计算相关绩效指标时，这些措施将会很有用。
- en: 'We''ll use some simple notation: let *R* be the time series of one-period simple
    portfolio returns, *R*=(*r*[1], ..., *r*[T]), from dates 1 to *T*, and *R*^f =(*r*^f[1],
    ..., *r*^f[T]) be the matching time series of risk-free rates, so that *R*[e]=*R*-*R*[f]
    =(*r*[1]-*r*^f[1],..., *r*[T]-*r*^f[T]) is the excess return.'
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用一些简单的符号：设 *R* 为单期简单投资组合回报的时间序列，*R*=(*r*[1], ..., *r*[T])，从日期 1 到 *T*，并且
    *R*^f =(*r*^f[1], ..., *r*^f[T]) 为相匹配的无风险利率的时间序列，因此 *R*[e]=*R*-*R*[f] =(*r*[1]-*r*^f[1],...,
    *r*[T]-*r*^f[T]) 是超额回报。
- en: Capturing risk-return trade-offs in a single number
  id: totrans-20
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 用一个数字捕捉风险-回报权衡关系
- en: 'The return and risk objectives imply a trade-off: taking more risk may yield
    higher returns in some circumstances, but also implies greater downside. To compare
    how different strategies navigate this trade-off, ratios that compute a measure
    of return per unit of risk are very popular. We''ll discuss the Sharpe ratio and
    the information ratio in turn.'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 回报和风险目标暗示着一种权衡关系：在某些情况下，承担更多风险可能会带来更高的回报，但也意味着更大的下行风险。为了比较不同策略如何权衡这一权衡关系，非常流行的是计算单位风险回报率的比率。我们将依次讨论夏普比率和信息比率。
- en: The Sharpe ratio
  id: totrans-22
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 夏普比率
- en: 'The ex ante **Sharpe ratio** (**SR**) compares the portfolio''s expected excess
    return to the volatility of this excess return, measured by its standard deviation.
    It measures the compensation as the average excess return per unit of risk taken:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: '**夏普比率**（**SR**）前瞻性地比较了投资组合的预期超额回报与该超额回报的波动性，由其标准偏差测量。它衡量了作为单位风险承担的平均超额回报作为补偿：'
- en: '![](img/B15439_05_001.png)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_001.png)'
- en: 'Expected returns and volatilities are not observable, but can be estimated
    as follows from historical data:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 预期回报和波动性不可观察，但可以根据历史数据如下估算：
- en: '![](img/B15439_05_002.png)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_002.png)'
- en: Unless the risk-free rate is volatile (as in emerging markets), the standard
    deviation of excess and raw returns will be similar.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 除非无风险利率波动较大（如新兴市场），超额回报和原始回报的标准偏差将相似。
- en: For **independently and identically distributed** (**IID**) returns, the distribution
    of the SR estimator for tests of statistical significance follows from the application
    of the **central limit theorem** (**CLT**), according to large-sample statistical
    theory, to ![](img/B15439_05_003.png) and ![](img/B15439_05_004.png). The CLT
    implies that sums of IID random variables like ![](img/B15439_05_003.png) and
    ![](img/B15439_05_006.png) converge to the normal distribution.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 对于**独立同分布**（**IID**）的回报，用于统计显著性检验的 SR 估计量的分布，根据大样本统计理论，可以从**中心极限定理**（**CLT**）的应用得出，这意味着像
    ![](img/B15439_05_003.png) 和 ![](img/B15439_05_004.png) 这样的 IID 随机变量的和收敛于正态分布。
- en: When you need to compare SR for different frequencies, say for monthly and annual
    data, you can multiply the higher frequency SR by the square root of the number
    of the corresponding period contained in the lower frequency. To convert a monthly
    SR into an annual SR, multiply by ![](img/B15439_05_007.png), and from daily to
    monthly multiply by ![](img/B15439_05_007.png).
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '当您需要比较不同频率的夏普比率时，例如月度和年度数据，您可以将更高频率的夏普比率乘以包含在更低频率中的对应时期的平方根。要将月度夏普比率转换为年度夏普比率，请乘以![](img/B15439_05_007.png)，要将日度转换为月度，请乘以![](img/B15439_05_007.png)。 '
- en: However, financial returns often violate the IID assumption. Andrew Lo has derived
    the necessary adjustments to the distribution and the time aggregation for returns
    that are stationary but autocorrelated. This is important because the time-series
    properties of investment strategies (for example, mean reversion, momentum, and
    other forms of serial correlation) can have a non-trivial impact on the SR estimator
    itself, especially when annualizing the SR from higher-frequency data (Lo, 2002).
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，金融回报往往违反独立同分布假设。安德鲁·罗已经推导出了对分布和时间聚合进行必要调整的公式，以适应平稳但自相关的回报。这很重要，因为投资策略的时间序列特性（例如，均值回归，动量和其他形式的序列相关性）可能对夏普比率估计本身产生非平凡的影响，特别是当从高频数据年化夏普比率时（Lo，2002）。
- en: The information ratio
  id: totrans-31
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 信息比率
- en: The **information ratio** (**IR**) is similar to the Sharpe ratio but uses a
    benchmark rather than the risk-free rate. The benchmark is usually chosen to represent
    the available investment universe such as the S&P 500 for a portfolio on large-cap
    US equities.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '**信息比率**（**IR**）类似于夏普比率，但使用的是基准而不是无风险利率。基准通常被选为代表可用投资领域的投资组合，如标普500指数用于大型美国股票投资组合。'
- en: 'Hence, the IR measures the excess return of the portfolio, also called alpha,
    relative to the tracking error, which is the deviation of the portfolio returns
    from the benchmark returns, that is:'
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，信息比率（IR）衡量的是投资组合的超额回报，也称为阿尔法，相对于跟踪误差，即投资组合回报与基准回报之间的偏差，即：
- en: '![](img/B15439_05_009.png)'
  id: totrans-34
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_009.png)'
- en: The IR has also been used to explain how excess returns depend on a manager's
    skill and the nature of her strategy, as we will see next.
  id: totrans-35
  prefs: []
  type: TYPE_NORMAL
  zh: IR还被用来解释超额回报如何取决于管理者的技能和她的策略的性质，我们将在下文中看到。
- en: The fundamental law of active management
  id: totrans-36
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 主动管理的基本定律
- en: '"Diversification is protection against ignorance. It makes little sense if
    you know what you are doing."'
  id: totrans-37
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: “分散化是对无知的防护。如果你知道你在做什么，那就没多大意义。”
- en: ''
  id: totrans-38
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: – Warren Buffet
  id: totrans-39
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
  zh: – 沃伦·巴菲特
- en: It's a curious fact that **Renaissance Technologies** (**RenTec**), the top-performing
    quant fund founded by Jim Simons, which we mentioned in *Chapter 1*, *Machine
    Learning for Trading – From Idea to Execution*, has produced similar returns as
    Warren Buffet, despite extremely different approaches. Warren Buffet's investment
    firm Berkshire Hathaway holds some 100-150 stocks for fairly long periods, whereas
    RenTec may execute 100,000 trades per day. How can we compare these distinct strategies?
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 一个好奇的事实是，**文艺复兴技术**（**RenTec**），由吉姆·西蒙斯创立的表现最佳的量化基金，在*第1章*，*交易的机器学习-从构想到执行*中提到过，尽管采取了极其不同的方法，却产生了与沃伦·巴菲特相似的回报。沃伦·巴菲特的投资公司伯克希尔·哈撒韦持有大约100-150只股票，持有时间相当长，而RenTec可能每天执行10万笔交易。我们如何比较这些不同的策略？
- en: 'A high IR reflects an attractive out-performance of the benchmark relative
    to the additional risk taken. The **Fundamental Law of Active Management** explains
    how such a result can be achieved: it approximates the IR as the product of the
    **information coefficient** (**IC**) and the breadth of the strategy.'
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 高IR反映了相对于承担的额外风险而言，基准的吸引人的超额表现。**主动管理的基本定律**解释了如何实现这样的结果：它将IR近似为**信息系数**（**IC**）和策略的广度的乘积。
- en: As discussed in the previous chapter, the IC measures the rank correlation between
    return forecasts, like those implied by an alpha factor, and the actual forward
    returns. Hence, it is a measure of the forecasting skill of the manager. The breadth
    of the strategy is measured by the independent number of bets (that is, trades)
    an investor makes in a given time period, and thus represents the ability to apply
    the forecasting skills.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 正如前一章所讨论的，IC衡量了回报预测之间的等级相关性，例如由阿尔法因子暗示的预期回报与实际未来回报之间的相关性。因此，它是管理者的预测技能的一种度量。策略的广度由投资者在给定时间段内进行的独立下注数（即交易数）来衡量，从而代表了应用预测技能的能力。
- en: 'The Fundamental Law states that the IR, also known as the **appraisal risk**
    (Treynor and Black), is the product of both values. In other words, it summarizes
    the importance to play both often (high breadth) and to play well (high IC):'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 基本法律规定，IR，也称为**评估风险**（特雷纳和布莱克），是两个值的乘积。换句话说，它总结了频繁（高广度）和出色表现（高IC）的重要性：
- en: '![](img/B15439_05_010.png)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_010.png)'
- en: 'This framework has been extended to include the **transfer coefficient** (**TC**)
    to reflect portfolio constraints as an additional factor (for example, on short-selling)
    that may limit the information ratio below a level otherwise achievable given
    IC or strategy breadth. The TC proxies the efficiency with which the manager translates
    insights into portfolio bets: if there are no constraints, the TC would simply
    equal one; but if the manager does not short stocks even though forecasts suggests
    they should, the TC will be less than one and reduce the IC (Clarke et al., 2002).'
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 这个框架已经扩展到包括**转移系数**（**TC**）来反映投资组合约束作为一个额外因素（例如，对做空的限制），这可能会限制信息比率在否则可达到的水平以下的因素。
    TC代表了管理者将见解转化为投资组合投注的效率：如果没有约束，TC将简单地等于一；但是如果管理者尽管预测表明他们应该这样做而不做空股票，TC将小于一，并减少IC（Clarke等人，2002）。
- en: 'The Fundamental Law is important because it highlights the key drivers of outperformance:
    both accurate predictions and the ability to make independent forecasts and act
    on these forecasts matter.'
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 基本法律之所以重要，是因为它突出了超额表现的关键驱动因素：准确预测和能够进行独立预测并在这些预测上采取行动都很重要。
- en: 'In practice, managers with a broad set of investment decisions can achieve
    significant risk-adjusted excess returns with information coefficients between
    0.05 and 0.15, as illustrated by the following simulation:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 在实践中，拥有广泛投资决策的管理人员可以通过信息系数在0.05至0.15之间实现显著的风险调整超额回报，如下模拟所示：
- en: '![](img/B15439_05_01.png)'
  id: totrans-48
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_01.png)'
- en: 'Figure 5.1: Information ratios for different values of breadth and information
    coefficient'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.1：不同广度和信息系数值的信息比率
- en: In practice, estimating the breadth of a strategy is difficult, given the cross-sectional
    and time-series correlation among forecasts. You should view the Fundamental Law
    and its extensions as a useful analytical framework for thinking about how to
    improve your risk-adjusted portfolio performance. We'll look at techniques for
    doing so in practice next.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 在实践中，鉴于预测之间的横截面和时间序列相关性，估计策略的广度是困难的。您应该将基本法律及其扩展视为一个有用的分析框架，用于思考如何改善您的风险调整后的投资组合绩效。接下来我们将看一些实践中做到这一点的技术。
- en: How to manage portfolio risk and return
  id: totrans-51
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何管理投资组合风险和回报
- en: Portfolio management aims to pick and size positions in financial instruments
    that achieve the desired risk-return trade-off regarding a benchmark. As a portfolio
    manager, in each period, you select positions that optimize diversification to
    reduce risks while achieving a target return. Across periods, these positions
    may require rebalancing to account for changes in weights resulting from price
    movements to achieve or maintain a target risk profile.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 投资组合管理旨在挑选和规模化金融工具中的头寸，以实现与基准相关的期望风险回报权衡。作为投资组合经理，在每个时期，您选择优化多样化的头寸，以降低风险并实现目标回报。在不同时期，这些头寸可能需要重新平衡，以考虑价格波动导致的权重变化，以实现或维持目标风险配置。
- en: The evolution of modern portfolio management
  id: totrans-53
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 现代投资组合管理的演变
- en: Diversification permits us to reduce risks for a given expected return by exploiting
    how imperfect correlation allows for one asset's gains to make up for another
    asset's losses. Harry Markowitz invented **modern portfolio theory** (**MPT**)
    in 1952 and provided the mathematical tools to optimize diversification by choosing
    appropriate portfolio weights.
  id: totrans-54
  prefs: []
  type: TYPE_NORMAL
  zh: 多样化使我们能够通过利用不完美的相关性，使一个资产的收益弥补另一个资产的损失，以降低给定预期回报的风险。哈里·马科维茨于1952年发明了**现代投资组合理论**（**MPT**），并提供了通过选择适当的投资组合权重来优化多样化的数学工具。
- en: Markowitz showed how portfolio risk, measured as the standard deviation of portfolio
    returns, depends on the covariance among the returns of all assets and their relative
    weights. This relationship implies the existence of an **efficient frontier**
    of portfolios that maximizes portfolio returns given a maximal level of portfolio
    risk.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 马科维茨展示了投资组合风险，以投资组合收益的标准偏差衡量，如何取决于所有资产收益之间的协方差以及它们的相对权重。这种关系意味着存在一组投资组合的**有效前沿**，其最大化了在给定最大化投资组合风险水平的情况下的投资组合回报。
- en: However, mean-variance frontiers are highly sensitive to the estimates of the
    inputs required for their calculation, namely expected returns, volatilities,
    and correlations. In practice, mean-variance portfolios that constrain these inputs
    to reduce sampling errors have performed much better. These constrained special
    cases include equal-weighted, minimum-variance, and risk-parity portfolios.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，均值-方差前沿对于其计算所需的输入的估计非常敏感，这些输入包括预期回报、波动率和相关性。在实践中，将这些输入约束在一定范围内以减少抽样误差的均值-方差组合投资组合表现更好。这些受限制的特殊情况包括等权重、最小方差和风险平价投资组合。
- en: The **capital asset pricing model** (**CAPM**) is an asset valuation model that
    builds on the MPT risk-return relationship. It introduces the concept of a risk
    premium that an investor can expect in market equilibrium for holding a risky
    asset; the premium compensates for the time value of money and the exposure to
    overall market risk that cannot be eliminated through diversification (as opposed
    to the idiosyncratic risk of specific assets).
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: '**资本资产定价模型**（**CAPM**）是建立在MPT风险-回报关系基础上的资产估值模型。它引入了一个概念，即投资者在市场均衡状态下持有风险资产时可以期望的风险溢价；该溢价补偿了货币时间价值和无法通过分散化消除的整体市场风险暴露（与特定资产的特殊风险相对）。'
- en: 'The economic rationale for **non-diversifiable risk** includes, for example,
    macro drivers of the business risks affecting all equity returns or bond defaults.
    Hence, an asset''s expected return, *E*[*r*[i]], is the sum of the risk-free interest
    rate, *r*[f], and a risk premium proportional to the asset''s exposure to the
    expected excess return of the market portfolio, *r*[m], over the risk-free rate:'
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '**不可分散风险**的经济基础包括，例如，影响所有股票回报或债券违约的业务风险的宏观驱动因素。因此，资产的预期回报*E*[*r*[i]]是无风险利率*r*[f]和与资产暴露于市场组合预期超额回报*r*[m]的风险溢价的乘积的总和：'
- en: '![](img/B15439_05_011.png)'
  id: totrans-59
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_011.png)'
- en: In theory, the **market portfolio** contains all investable assets and, in equilibrium,
    will be held by all rational investors. In practice, a broad value-weighted index
    approximates the market, for example, the S&P 500 for US equity investments.
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 理论上，**市场组合**包含所有可投资资产，并且在均衡状态下，将由所有理性投资者持有。在实践中，一个广义的价值加权指数近似于市场，例如，对于美国股票投资来说是标准普尔500指数（S&P
    500）。
- en: '![](img/B15439_05_012.png) measures the exposure of asset, *i*, to the excess
    returns of the market portfolio. If the CAPM is valid, the intercept component,
    ![](img/B15439_05_013.png), should be zero. In reality, the CAPM assumptions are
    often not met, and alpha captures the returns left unexplained by exposure to
    the broad market.'
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: '![](img/B15439_05_012.png)测量了资产*i*对市场组合超额回报的暴露。如果CAPM有效，则截距部分![](img/B15439_05_013.png)应为零。实际上，CAPM的假设通常未得到满足，而α捕捉了通过暴露于广泛市场而未解释的回报。'
- en: As discussed in the previous chapter, over time, research uncovered **non-traditional
    sources of risk premiums**, such as the momentum or the equity value effects that
    explained some of the original alpha. Economic rationales, such as behavioral
    biases of under- or overreaction by investors to new information, justify risk
    premiums for exposure to these alternative risk factors.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 正如前一章所讨论的，随着时间的推移，研究揭示了**非传统风险溢价**，例如动量或股票价值效应，这些溢价解释了一些原始α。经济原理，如投资者对新信息的欠反应或过度反应的行为偏差，为暴露于这些替代风险因素的风险溢价提供了合理解释。
- en: These factors evolved into investment styles designed to capture these **alternative
    betas** that became tradable in the form of specialized index funds. Similarly,
    risk management now aims to control the exposure of numerous sources of risk beyond
    the market portfolio.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 这些因素演变成了旨在捕捉这些**替代贝塔**的投资风格，这些替代贝塔可以通过专门的指数基金进行交易。同样，风险管理现在旨在控制除市场组合以外的多种风险来源的暴露。
- en: After isolating contributions from these alternative risk premiums, true alpha
    becomes limited to idiosyncratic asset returns and the manager's ability to time
    risk exposures.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 在分离这些替代风险溢价的贡献后，真正的α仅限于特定资产回报和管理者调整风险暴露的能力。
- en: The **efficient market hypothesis** (**EMH**) has been refined over the past
    several decades to rectify many of the original shortcomings of the CAPM, including
    imperfect information and the costs associated with transactions, financing, and
    agency. Many behavioral biases have the same effect, and some frictions are modeled
    as behavioral biases.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: '**有效市场假说**（**EMH**）在过去几十年中得到了完善，以纠正 CAPM 的许多原始缺陷，包括信息不完全以及与交易、融资和代理相关的成本。许多行为偏见具有相同的效果，一些摩擦被建模为行为偏见。'
- en: 'Modern portfolio theory and practice have evolved significantly over the last
    several decades. We will introduce several approaches:'
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 过去几十年来，现代投资组合理论和实践发生了重大变化。我们将介绍几种方法：
- en: Mean-variance optimization, and its shortcomings
  id: totrans-67
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 均值-方差优化及其缺点
- en: Alternatives such as minimum-risk and 1/*n* allocation
  id: totrans-68
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 最小风险和 1/*n* 分配等替代方案
- en: Risk parity approaches
  id: totrans-69
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 风险平价方法
- en: Risk factor approaches
  id: totrans-70
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 风险因子方法
- en: Mean-variance optimization
  id: totrans-71
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 均值-方差优化
- en: Modern portfolio theory solves for the optimal portfolio weights to minimize
    volatility for a given expected return or maximize returns for a given level of
    volatility. The key requisite inputs are expected asset returns, standard deviations,
    and the covariance matrix.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 现代投资组合理论解决了为最小化给定预期收益的波动性或为给定波动性水平最大化收益的最优投资组合权重。关键的先决条件输入是预期资产收益率、标准偏差和协方差矩阵。
- en: How it works
  id: totrans-73
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 它的工作原理
- en: Diversification works because the variance of portfolio returns depends on the
    covariance of the assets. It can be reduced below the weighted average of the
    asset variances by including assets with less than perfect correlation.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 多样化的作用是因为投资组合收益的方差取决于资产的协方差。通过包含相关性不完全的资产，可以将其降低到资产方差的加权平均值以下。
- en: 'In particular, given a vector, ![](img/B15439_05_014.png), of portfolio weights
    and the covariance matrix, ![](img/B15439_04_009.png), the portfolio variance,
    ![](img/B15439_05_016.png), is defined as:'
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 特别是，给定投资组合权重向量 ![](img/B15439_05_014.png) 和协方差矩阵 ![](img/B15439_04_009.png)，投资组合方差
    ![](img/B15439_05_016.png) 定义为：
- en: '![](img/B15439_05_017.png)'
  id: totrans-76
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_017.png)'
- en: 'Markowitz showed that the problem of maximizing the expected portfolio return
    subject to a target risk has an equivalent dual representation of minimizing portfolio
    risk, subject to a target expected return level, ![](img/B15439_05_018.png). Hence,
    the optimization problem becomes:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 马科维茨表明，最大化预期投资组合收益的问题，在目标风险约束下具有等效的最小化投资组合风险的对偶表示，主要是在目标预期收益水平下，![](img/B15439_05_018.png)。因此，优化问题变为：
- en: '![](img/B15439_05_019.png)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_019.png)'
- en: Finding the efficient frontier in Python
  id: totrans-79
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 在 Python 中找到有效边界
- en: 'We can calculate an efficient frontier using `scipy.optimize.minimize` and
    the historical estimates for asset returns, standard deviations, and the covariance
    matrix. SciPy ''s `minimize` function implements a range of constrained and unconstrained
    optimization algorithms for scalar functions that output a single number from
    one or more input variables (see the SciPy documentation for more details). The
    code can be found in the `strategy_evaluation` subfolder of the repository for
    this chapter and implements the following sequence of steps:'
  id: totrans-80
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用 `scipy.optimize.minimize` 和资产收益率、标准偏差以及协方差矩阵的历史估计来计算有效边界。 SciPy 的 `minimize`
    函数实现了一系列标量函数的受约束和无约束优化算法，这些函数从一个或多个输入变量中输出一个单一数字（详见 SciPy 文档以获取更多详情）。代码可以在本章的存储库的
    `strategy_evaluation` 子文件夹中找到，并实现以下步骤序列：
- en: 'First, the simulation generates random weights using the Dirichlet distribution
    and computes the mean, standard deviation, and SR for each sample portfolio using
    the historical return data:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，模拟使用狄利克雷分布生成随机权重，并使用历史回报数据计算每个样本投资组合的均值、标准偏差和 SR：
- en: '[PRE0]'
  id: totrans-82
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Next, we set up the quadratic optimization problem to solve for the minimum
    standard deviation for a given return or the maximum SR. To this end, we define
    the functions that measure the key performance metrics:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们设置二次优化问题，以解决给定收益的最小标准偏差或最大 SR。为此，我们定义了测量关键绩效指标的函数：
- en: '[PRE1]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Next, we define a target function that represents the negative SR for scipy''s
    `minimize` function to optimize, given the constraints that the weights are bounded
    by, [0, 1], and sum to one in absolute terms:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们定义一个目标函数，表示 scipy 的 `minimize` 函数要优化的负 SR，考虑到权重受到的约束为 [0, 1]，并且绝对值总和为一：
- en: '[PRE2]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Then, we compute the efficient frontier by iterating over a range of target
    returns and solving for the corresponding minimum variance portfolios. To this
    end, we formulate the optimization problem using the constraints on portfolio
    risk and return as a function of the weights, as follows:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们通过迭代一系列目标回报并解决相应的最小方差组合来计算有效前沿。为此，我们使用对投资组合风险和回报的约束作为权重的函数来制定优化问题，如下所示：
- en: '[PRE3]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The solution requires iterating over ranges of acceptable values to identify
    optimal risk-return combinations:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 解决方案需要迭代在可接受值范围内的范围，以确定最佳的风险-回报组合：
- en: '[PRE4]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The simulation yields a subset of the feasible portfolios, and the efficient
    frontier identifies the optimal in-sample return-risk combinations that were achievable
    given historic data.
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 模拟产生了一部分可行的投资组合，有效前沿确定了样本内可实现的最佳回报-风险组合，给定历史数据。
- en: '*Figure 5.2* shows the result, including the minimum variance portfolio, the
    portfolio that maximizes the SR, and several portfolios produced by alternative
    optimization strategies that we''ll discuss in the following sections:'
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
  zh: '*图5.2*显示了结果，包括最小方差组合、最大化SR的组合，以及几个由替代优化策略产生的组合，我们将在接下来的章节中讨论：'
- en: '![](img/B15439_05_02.png)'
  id: totrans-93
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_02.png)'
- en: 'Figure 5.2: The efficient frontier and different optimized portfolios'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.2：有效前沿和不同的优化组合
- en: The portfolio optimization can be run at every evaluation step of the trading
    strategy to optimize the positions.
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 投资组合优化可以在交易策略的每个评估步骤中运行，以优化仓位。
- en: Challenges and shortcomings
  id: totrans-96
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 挑战和缺点
- en: The preceding mean-variance frontier estimation illustrates **in-sample**, that
    is, **backward-looking** optimization. In practice, portfolio optimization requires
    forward-looking inputs and outputs. However, expected returns are notoriously
    difficult to estimate accurately. It is best viewed as a starting point and benchmark
    for numerous improvements.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 前面的均值方差边界估计说明了**样本内**，也就是**向后看**优化。在实践中，投资组合优化需要前瞻性的输入和输出。然而，预期收益的准确估计是非常困难的。最好将其视为众多改进的起点和基准。
- en: 'The covariance matrix can be estimated somewhat more reliably, which has given
    rise to several alternative approaches. However, covariance matrices with correlated
    assets pose computational challenges since the optimization problem requires inverting
    the matrix. The high condition number induces numerical instability, which in
    turn gives rise to the **Markovitz curse**: the more diversification is required
    (by correlated investment opportunities), the more unreliable the weights produced
    by the algorithm.'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 协方差矩阵的估计可能会更可靠一些，这导致了几种替代方法的出现。然而，具有相关资产的协方差矩阵会带来计算上的挑战，因为优化问题需要矩阵求逆。高条件数会导致数值不稳定性，从而产生**马尔可夫茨诅咒**：需要更多分散（通过相关的投资机会）时，算法产生的权重就越不可靠。
- en: Many investors prefer to use portfolio-optimization techniques with less onerous
    input requirements. We will now introduce several alternatives that aim to address
    these shortcomings, including a more recent approach based on machine learning.
  id: totrans-99
  prefs: []
  type: TYPE_NORMAL
  zh: 许多投资者更喜欢使用具有较少繁琐输入要求的投资组合优化技术。我们现在将介绍几种旨在解决这些缺点的替代方法，包括一种基于机器学习的较新方法。
- en: Alternatives to mean-variance optimization
  id: totrans-100
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 均值方差优化的替代方案
- en: The challenges with accurate inputs for the mean-variance optimization problem
    have led to the adoption of several practical alternatives that constrain the
    mean, the variance, or both, or omit return estimates that are more challenging,
    such as the risk parity approach, which we'll discuss later in this section.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 对均值方差优化问题的准确输入的挑战已经导致了几种实用的替代方案的采用，这些方案限制了均值、方差或两者，或者省略了更具挑战性的回报估计，例如风险平价方法，我们将在本节后面讨论。
- en: The 1/N portfolio
  id: totrans-102
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 1/N投资组合
- en: Simple portfolios provide useful benchmarks to gauge the added value of complex
    models that generate the risk of overfitting. The simplest strategy—an **equally-weighted
    portfolio**—has been shown to be one of the best performers.
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 简单的投资组合提供了用于衡量生成过拟合风险的复杂模型的增值的有用基准。最简单的策略——**等权重投资组合**——已被证明是最佳表现之一。
- en: Famously, de Miguel, Garlappi, and Uppal (2009) compared the out-of-sample performance
    of portfolios produced by various mean-variance optimizers, including robust Bayesian
    estimators, portfolio constraints, and optimal combinations of portfolios, to
    the simple 1/N rule. They found that the 1/N portfolio produced a higher Sharpe
    ratio than the alternatives on various datasets, explained by the high cost of
    estimation errors that often outweighs the benefits of sophisticated optimization
    out of sample.
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 闻名的 de Miguel、Garlappi 和 Uppal（2009）比较了由各种均值-方差优化器产生的投资组合在样本外的表现，包括健壮的贝叶斯估计器、投资组合约束和投资组合的最优组合，与简单的
    1/N 规则。他们发现，1/N 投资组合在各种数据集上产生了比替代方案更高的夏普比率，这可以解释为估计误差的高成本通常超过了样本外复杂优化的好处。
- en: More specifically, they found that the estimation window required for the sample-based
    mean-variance strategy and its extensions to outperform the 1/N benchmark is around
    3,000 months for a portfolio with 25 assets and about 6,000 months for a portfolio
    with 50 assets.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 更具体地说，他们发现，对于具有 25 个资产的投资组合，样本为基础的均值-方差策略及其延伸优于 1/N 基准所需的估计窗口约为 3,000 个月，而对于具有
    50 个资产的投资组合约为 6,000 个月。
- en: The 1/N portfolio is also included in *Figure 5.2* in the previous section.
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在前一节的*图 5.2*中还包括了 1/N 投资组合。
- en: The minimum-variance portfolio
  id: totrans-107
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 最小方差投资组合
- en: 'Another alternative is the **global minimum-variance** (**GMV**) portfolio,
    which prioritizes the minimization of risk. It is shown in *Figure 5.2* and can
    be calculated, as follows, by minimizing the portfolio standard deviation using
    the mean-variance framework:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种选择是**全局最小方差**（**GMV**）投资组合，它优先考虑风险的最小化。它在*图 5.2*中显示，并可以通过使用均值-方差框架，如下所示，通过最小化投资组合标准偏差来计算：
- en: '[PRE5]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: The corresponding minimum volatility portfolio lies on the efficient frontier,
    as shown previously in *Figure 5.2*.
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 相应的最小波动率投资组合位于有效前沿上，正如之前在*图 5.2*中所示。
- en: Global Portfolio Optimization – the Black-Litterman approach
  id: totrans-111
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 全球投资组合优化 – Black-Litterman 方法
- en: The **Global Portfolio Optimization** approach of Black and Litterman (1992)
    combines economic models with statistical learning. It is popular because it generates
    estimates of expected returns that are plausible in many situations.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: Black 和 Litterman（1992）的**全球投资组合优化**方法将经济模型与统计学习相结合。它很受欢迎，因为它能够在许多情况下生成合理的预期收益估计。
- en: The technique assumes that the market is a mean-variance portfolio, as implied
    by the CAPM equilibrium model. It builds on the fact that the observed market
    capitalization can be considered as optimal weights assigned to each security
    by the market. Market weights reflect market prices that, in turn, embody the
    market's expectations of future returns.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 该技术假定市场是一个均值-方差投资组合，正如 CAPM 平衡模型所暗示的那样。它建立在这样一个事实上，即观察到的市场资本化可以被视为市场对每个证券分配的最佳权重。市场权重反映了市场价格，而市场价格反过来又体现了市场对未来收益的预期。
- en: The approach can thus reverse-engineer the unobservable future expected returns
    from the assumption that the market is close enough to equilibrium, as defined
    by the CAPM. Investors can adjust these estimates to their own beliefs using a
    shrinkage estimator. The model can be interpreted as a Bayesian approach to portfolio
    optimization. We will introduce Bayesian methods in *Chapter 10*, *Bayesian ML
    – Dynamic Sharpe Ratios and Pairs Trading Strategies*.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 该方法因此可以从市场足够接近 CAPM 定义的均衡的假设中逆向推导出不可观察的未来预期收益。投资者可以使用缩小估计器将这些估计值调整到自己的信念。该模型可以被解释为投资组合优化的贝叶斯方法。我们将在*第
    10 章*，*贝叶斯 ML – 动态夏普比率和配对交易策略*中介绍贝叶斯方法。
- en: How to size your bets – the Kelly criterion
  id: totrans-115
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 如何确定你的赌注大小 – 凯利准则
- en: The **Kelly criterion** has a long history in gambling because it provides guidance
    on how much to stake on each bet in an (infinite) sequence of bets with varying
    (but favorable) odds to maximize terminal wealth. It was published in a 1956 paper,
    *A New Interpretation of the Information Rate*, by John Kelly, who was a colleague
    of Claude Shannon's at Bell Labs. He was intrigued by bets placed on candidates
    at the new quiz show "The $64,000 Question," where a viewer on the west coast
    used the three-hour delay to obtain insider information about the winners.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: '**凯利准则**在赌博界有着悠久的历史，因为它提供了在具有不同（但有利）赔率的（无限）一系列赌注中如何押注以最大化期末财富的指导。它是由 John Kelly
    在 1956 年的论文*信息速率的新解释*中发表的，他是 Claude Shannon 在贝尔实验室的同事。他对在新的问答节目“$64,000 问题”上对候选人的投注感兴趣，其中一位西海岸的观众利用三小时的延迟获取内幕信息来获取胜利者。'
- en: Kelly drew a connection to Shannon's information theory to solve for the bet
    that is optimal for long-term capital growth when the odds are favorable, but
    uncertainty remains. His rule maximizes logarithmic wealth as a function of the
    odds of success of each game and includes implicit bankruptcy protection since
    *log(0)* is negative infinity so that a Kelly gambler would naturally avoid losing
    everything.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 凯利将与香农的信息论联系起来，以解决在赔率有利但不确定性仍然存在时，长期资本增长的最佳赌注。他的准则最大化对每个游戏成功概率的对数财富，并包括隐含的破产保护，因为*log(0)*为负无穷，因此凯利赌徒自然会避免失去一切。
- en: The optimal size of a bet
  id: totrans-118
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 投注的最佳大小
- en: 'Kelly began by analyzing games with a binary win-lose outcome. The key variables
    are:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 凯利从分析具有二元赢输结果的游戏开始。关键变量包括：
- en: '*b*: The odds defining the amount won for a $1 bet. Odds = 5/1 implies a $5
    gain if the bet wins, plus recovery of the $1 capital.'
  id: totrans-120
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*b*：定义了每次赌注赢得的金额的赔率。赔率= 5/1意味着如果赌注获胜，则获得5美元，加上1美元的资本返还。'
- en: '*p*: The probability defining the likelihood of a favorable outcome.'
  id: totrans-121
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*p*：定义有利结果可能性的概率。'
- en: '*f*: The share of the current capital to bet.'
  id: totrans-122
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*f*：要下注的当前资本份额。'
- en: '*V*: The value of the capital as a result of betting.'
  id: totrans-123
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*V*：由于赌注而产生的资本价值。'
- en: 'The Kelly criterion aims to maximize the value''s growth rate, *G*, of infinitely
    repeated bets:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 凯利准则旨在最大化无限重复赌注的价值增长率*G*：
- en: '![](img/B15439_05_020.png)'
  id: totrans-125
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_020.png)'
- en: 'When *W* and *L* are the numbers of wins and losses, then:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 当*W*和*L*分别为赢得和输掉的次数时，则：
- en: '![](img/B15439_05_021.png)'
  id: totrans-127
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_021.png)'
- en: 'We can maximize the rate of growth *G* by maximizing *G* with respect to *f*,
    as illustrated using SymPy, as follows (you can find this in the `kelly_rule`
    notebook):'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过最大化*G*关于*f*的变化来最大化增长率*G*，使用SymPy进行说明，如下所示（您可以在`kelly_rule`笔记本中找到此内容）：
- en: '[PRE6]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'We arrive at the optimal share of capital to bet:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 我们得出了要下注的资本的最佳份额：
- en: '![](img/B15439_05_022.png)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_022.png)'
- en: Optimal investment – single asset
  id: totrans-132
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 最佳投资 - 单资产
- en: In a financial market context, both outcomes and alternatives are more complex,
    but the Kelly criterion logic does still apply. It was made popular by Ed Thorp,
    who first applied it profitably to gambling (described in the book *Beat the Dealer*)
    and later started the successful hedge fund Princeton/Newport Partners.
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
  zh: 在金融市场背景下，结果和替代方案都更加复杂，但凯利准则的逻辑仍然适用。它由Ed Thorp流行起来，他首先将其成功地应用于赌博（在书籍*Beat the
    Dealer*中描述），后来成立了成功的对冲基金Princeton/Newport Partners。
- en: 'With continuous outcomes, the growth rate of capital is defined by an integrate
    over the probability distribution of the different returns that can be optimized
    numerically:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 对于连续的结果，资本的增长率由对可能的不同回报的概率分布的积分来定义，可以通过数值优化来优化：
- en: '![](img/B15439_05_023.png)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_023.png)'
- en: 'We can solve this expression for the optimal *f** using the `scipy.optimize`
    module. The `quad` function computes the value of a definite integral between
    two values *a* and *b* using FORTRAN''s QUADPACK library (hence its name). It
    returns the value of the integral and an error estimate:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用`scipy.optimize`模块解决此表达式以得出最优的*f**。`quad`函数使用FORTRAN的QUADPACK库计算在两个值*a*和*b*之间的定积分值（因此得名）。它返回积分值和误差估计：
- en: '[PRE7]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: Optimal investment – multiple assets
  id: totrans-138
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 最佳投资 - 多个资产
- en: We will use an example with various equities. E. Chan (2008) illustrates how
    to arrive at a multi-asset application of the Kelly criterion, and that the result
    is equivalent to the (potentially levered) maximum Sharpe ratio portfolio from
    the mean-variance optimization.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用一个包含各种权益的示例。E. Chan（2008）说明了如何得出凯利准则的多资产应用，结果等同于（可能是杠杆的）从均值-方差优化中得出的最大夏普比率投资组合。
- en: 'The computation involves the dot product of the precision matrix, which is
    the inverse of the covariance matrix, and the return matrix:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 计算涉及精度矩阵（协方差矩阵的逆）与回报矩阵的点积：
- en: '[PRE8]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: The Kelly portfolio is also shown in the previous efficient frontier diagram
    (after normalization so that the sum of the absolute weights equals one). Many
    investors prefer to reduce the Kelly weights to reduce the strategy's volatility,
    and Half-Kelly has become particularly popular.
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: 凯利投资组合也显示在之前的有效边界图中（标准化以使绝对权重之和等于一）。许多投资者更喜欢减少凯利权重以降低该策略的波动性，而半凯利则变得特别受欢迎。
- en: Risk parity
  id: totrans-143
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 风险平价
- en: The fact that the previous 15 years have been characterized by two major crises
    in the global equity markets, a consistently upwardly sloping yield curve, and
    a general decline in interest rates, made risk parity look like a particularly
    compelling option. Many institutions carved out strategic allocations to risk
    parity to further diversify their portfolios.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 过去 15 年的两次全球股票市场危机、一直呈上升趋势的收益率曲线以及利率的普遍下降，使得风险平价看起来成为一种特别引人注目的选择。许多机构将战略性配置给了风险平价以进一步实现投资组合的多样化。
- en: 'A simple implementation of risk parity allocates assets according to the inverse
    of their variances, ignoring correlations and, in particular, return forecasts:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 风险平价的简单实现根据它们的方差的倒数分配资产，忽略了相关性，尤其是回报预测：
- en: '[PRE9]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: The risk parity portfolio is also shown in the efficient frontier diagram at
    the beginning of this section.
  id: totrans-147
  prefs: []
  type: TYPE_NORMAL
  zh: 风险平价投资组合也显示在本节开头的有效边界图中。
- en: Risk factor investment
  id: totrans-148
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 风险因子投资
- en: An alternative framework for estimating input is to work down to the underlying
    determinants, or factors, that drive the risk and returns of assets. If we understand
    how the factors influence returns, and we understand the factors, we will be able
    to construct more robust portfolios.
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 估算输入的另一种替代框架是向下工作到驱动资产风险和回报的基础决定因素或因子。如果我们了解这些因素如何影响回报，我们又了解这些因素，我们将能够构建更健壮的投资组合。
- en: The concept of factor investing looks beyond asset class labels. It looks to
    the underlying factor risks that we discussed in the previous chapter on alpha
    factors to maximize the benefits of diversification. Rather than distinguishing
    investment vehicles by labels such as hedge funds or private equity, factor investing
    aims to identify distinct risk-return profiles based on differences in exposure
    to fundamental risk factors (Ang 2014).
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 因子投资的概念超越了资产类别标签。它着眼于我们在上一章关于 alpha 因子中讨论过的基础因子风险，以最大程度地实现分散化的利益。因子投资不是通过诸如对冲基金或私募股权之类的标签来区分投资工具，而是旨在根据暴露于基本风险因子的差异来识别不同的风险-回报配置（Ang
    2014）。
- en: The naive approach to mean-variance investing plugs (artificial) groupings as
    distinct asset classes into a mean-variance optimizer. Factor investing recognizes
    that such groupings share many of the same factor risks as traditional asset classes.
    Diversification benefits can be overstated, as investors discovered during the
    2008 crisis when correlations among risky asset classes increased due to exposure
    to the same underlying factor risks.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
  zh: 对于均值-方差投资的天真方法将（人为的）分组视为不同的资产类别并纳入均值-方差优化器中。因子投资认识到这些分组与传统资产类别共享许多相同的因子风险。分散化的好处可能被夸大，正如投资者在
    2008 年危机期间发现的那样，当风险资产类别之间的相关性增加时，由于暴露于相同的基础因子风险，相关性增加。
- en: In *Chapter 7*, *Linear Models – From Risk Factors to Return Forecasts*, we
    will show how to measure the exposure of a portfolio to various risk factors so
    that you can either adjust the positions to tune your factor exposure, or hedge
    accordingly.
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 在*第七章*，*线性模型-从风险因素到收益预测*中，我们将展示如何测量投资组合对各种风险因素的暴露，以便您可以调整头寸以调整您的因子敞口，或者相应地进行对冲。
- en: Hierarchical risk parity
  id: totrans-153
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 分层风险平价
- en: 'Mean-variance optimization is very sensitive to the estimates of expected returns
    and the covariance of these returns. The covariance matrix inversion also becomes
    more challenging and less accurate when returns are highly correlated, as is often
    the case in practice. The result has been called the Markowitz curse: when diversification
    is more important because investments are correlated, conventional portfolio optimizers
    will likely produce an unstable solution. The benefits of diversification can
    be more than offset by mistaken estimates. As discussed, even naive, equally weighted
    portfolios can beat mean-variance and risk-based optimization out of sample.'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 均值-方差优化对预期收益的估计和这些收益的协方差非常敏感。当收益高度相关时，协方差矩阵的求逆也变得更具挑战性和不太准确，这在实践中经常是情况。结果被称为马科维茨诅咒：当分散化更为重要因为投资相关时，传统的投资组合优化器可能会产生不稳定的解决方案。分散化的好处可能会被错误的估计抵消。正如讨论的那样，甚至是天真的、等权重的投资组合都可以在样本外击败均值-方差和基于风险的优化。
- en: More robust approaches have incorporated additional constraints (Clarke et al.,
    2002) or Bayesian priors (Black and Litterman, 1992), or used shrinkage estimators
    to make the precision matrix more numerically stable (Ledoit and Wolf, 2003),
    available in scikit-learn ([http://scikit-learn.org/stable/modules/generated/sklearn.covariance.LedoitWolf.html](http://scikit-learn.org/stable/modules/generated/sklearn.covariance.LedoitWolf.html)).
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 更健壮的方法已经合并了额外的约束 (Clarke et al., 2002) 或贝叶斯先验 (Black and Litterman, 1992)，或者使用收缩估计量使精度矩阵更加数值稳定
    (Ledoit and Wolf, 2003)，这在 scikit-learn 中可用 ([http://scikit-learn.org/stable/modules/generated/sklearn.covariance.LedoitWolf.html](http://scikit-learn.org/stable/modules/generated/sklearn.covariance.LedoitWolf.html))。
- en: '**Hierarchical risk parity** (**HRP**), in contrast, leverages unsupervised
    machine learning to achieve superior out-of-sample portfolio allocations. A recent
    innovation in portfolio optimization leverages graph theory and hierarchical clustering
    to construct a portfolio in three steps (Lopez de Prado, 2015):'
  id: totrans-156
  prefs: []
  type: TYPE_NORMAL
  zh: '**分层风险平价** (**HRP**) 相比之下，利用无监督机器学习来实现出色的样本外投资组合分配。 最近在投资组合优化方面的创新利用图论和层次聚类来构建投资组合分为三个步骤
    (Lopez de Prado, 2015)：'
- en: Define a distance metric so that correlated assets are close to each other,
    and apply single-linkage clustering to identify hierarchical relationships.
  id: totrans-157
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义一个距离度量，使相关资产彼此接近，并应用单链接聚类来识别层次关系。
- en: Use the hierarchical correlation structure to quasi-diagonalize the covariance
    matrix.
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 利用层次相关结构对协方差矩阵进行准对角化。
- en: Apply top-down inverse-variance weighting using a recursive bisectional search
    to treat clustered assets as complements, rather than substitutes, in portfolio
    construction and to reduce the number of degrees of freedom.
  id: totrans-159
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 应用自顶向下的逆方差加权使用递归二分搜索将集群资产视为投资组合构建中的补充而不是替代品，并减少自由度数量。
- en: A related method to construct **hierarchical clustering portfolios** (**HCP**)
    was presented by Raffinot (2016). Conceptually, complex systems such as financial
    markets tend to have a structure and are often organized in a hierarchical way,
    while the interaction among elements in the hierarchy shapes the dynamics of the
    system. Correlation matrices also lack the notion of hierarchy, which allows weights
    to vary freely and in potentially unintended ways.
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
  zh: 构建**分层聚类投资组合** (**HCP**) 的一种相关方法由 Raffinot (2016) 提出。 从概念上讲，诸如金融市场之类的复杂系统倾向于具有结构，并且通常以分层方式组织，而层次结构中元素之间的相互作用塑造了系统的动态。
    相关矩阵也缺乏层次结构的概念，这使得权重可以自由变化并且可能以意想不到的方式变化。
- en: Both HRP and HCP have been tested by JP Morgan (2012) on various equity universes.
    The HRP, in particular, produced equal or superior risk-adjusted returns and Sharpe
    ratios compared to naive diversification, the maximum-diversified portfolios,
    or GMV portfolios.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: JP Morgan (2012) 对各种股票投资组合进行了 HRP 和 HCP 的测试。 其中，HRP 尤其产生了与天真分散、最大分散投资组合或 GMV
    投资组合相比相等或更优的风险调整后回报和夏普比率。
- en: We will present the Python implementation in *Chapter 13*, *Data-Driven Risk
    Factors and Asset Allocation with Unsupervised Learning*.
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在*第 13 章*，*使用无监督学习的数据驱动风险因素和资产配置*中介绍 Python 实现。
- en: Trading and managing portfolios with Zipline
  id: totrans-163
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 Zipline 进行交易和管理投资组合
- en: In the previous chapter, we introduced Zipline to simulate the computation of
    alpha factors from trailing market, fundamental, and alternative data for a cross-section
    of stocks. In this section, we will start acting on the signals emitted by alpha
    factors. We'll do this by submitting buy and sell orders so we can enter long
    and short positions or rebalance the portfolio to adjust our holdings to the most
    recent trade signals.
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一章中，我们介绍了 Zipline 来模拟对一系列股票的市场、基本和替代数据的 alpha 因子的计算。 在本节中，我们将开始根据 alpha 因子发出的信号行动起来。
    我们将通过提交买入和卖出订单来做到这一点，以便我们可以建立多头和空头头寸或者重新平衡投资组合，以将我们的持仓调整到最新的交易信号。
- en: We will postpone optimizing the portfolio weights until later in this chapter
    and, for now, just assign positions of equal value to each holding. As mentioned
    in the previous chapter, an in-depth introduction to the testing and evaluation
    of strategies that include ML models will follow in *Chapter 6*, *The Machine
    Learning Process*.
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将推迟优化投资组合权重至本章后面，并且，目前，只是为每个持仓分配相同价值的仓位。 正如前一章中所述，对包括 ML 模型的策略进行测试和评估的深入介绍将在*第
    6 章*，*机器学习流程*中进行。
- en: Scheduling signal generation and trade execution
  id: totrans-166
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 安排信号生成和交易执行
- en: We will use the custom `MeanReversion` factor developed in the previous chapter
    (see the implementation in `01_backtest_with_trades.ipynb`).
  id: totrans-167
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将使用前一章开发的自定义`MeanReversion`因子（请参见`01_backtest_with_trades.ipynb`中的实现）。
- en: 'The `Pipeline` created by the `compute_factors()` method returns a table with
    columns containing the 50 longs and shorts. It selects the equities according
    to the largest negative and positive deviations, respectively, of their last monthly
    return from the annual average, normalized by the standard deviation:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 由`compute_factors()`方法创建的`Pipeline`返回一个包含50个多头和空头的列的表格。它根据其上个月回报率与年均值的最大负偏差和最大正偏差选择股票，标准差归一化：
- en: '[PRE10]'
  id: totrans-169
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'It also limited the universe to the 1,000 stocks with the highest average trading
    volume over the last 30 trading days. `before_trading_start()` ensures the daily
    execution of the `Pipeline` and the recording of the results, including the current
    prices:'
  id: totrans-170
  prefs: []
  type: TYPE_NORMAL
  zh: 它还将宇宙限制为过去30个交易日交易量最高的1,000只股票。`before_trading_start()`确保每日执行`Pipeline`和记录结果，包括当前价格：
- en: '[PRE11]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'The new `rebalance()` method submits trade orders to the `exec_trades()` method
    for the assets flagged for long and short positions by the `Pipeline` with equal
    positive and negative weights. It also divests any current holdings that are no
    longer included in the factor signals:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
  zh: 新的`rebalance()`方法向由`Pipeline`标记为多头和空头头寸的资产提交交易订单，权重相等并且为正负值。它还剥离任何当前持仓，这些持仓不再包含在因子信号中：
- en: '[PRE12]'
  id: totrans-173
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: The `rebalance()` method runs according to `date_rules` and `time_rules` set
    by the `schedule_function()` utility at the beginning of the week, right after
    `market_open`, as stipulated by the built-in `US_EQUITIES` calendar (see the Zipline
    documentation for details on rules).
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: '`rebalance()`方法根据`schedule_function()`工具在周初开始，紧接着`market_open`运行，正如内置的`US_EQUITIES`日历所规定的那样（有关规则的详细信息，请参阅Zipline文档）。'
- en: 'You can also specify a trade commission both in relative terms and as a minimum
    amount. There is also an option to define slippage, which is the cost of an adverse
    change in price between trade decision and execution:'
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 您还可以指定交易佣金，既以相对比例，又以最小金额。还有一种定义滑点的选项，即交易决策与执行之间价格不利变化的成本：
- en: '[PRE13]'
  id: totrans-176
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: The algorithm continues to execute after calling the `run_algorithm()` function
    and returns the same backtest performance `DataFrame` that we saw in the previous
    chapter.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 调用`run_algorithm()`函数后，算法继续执行，并返回我们在前一章中看到的相同的回测性能`DataFrame`。
- en: Implementing mean-variance portfolio optimization
  id: totrans-178
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 实施均值方差投资组合优化
- en: We demonstrated in the previous section how to find the efficient frontier using
    `scipy.optimize`. In this section, we will leverage the PyPortfolioOpt library,
    which offers portfolio optimization (using SciPy under the hood), including efficient
    frontier techniques and more recent shrinkage approaches that regularize the covariance
    matrix (see *Chapter 7*, *Linear Models – From Risk Factors to Return Forecasts*,
    on shrinkage for linear regression). The code example lives in `02_backtest_with_pf_optimization.ipynb`.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在上一节中演示了如何使用`scipy.optimize`找到有效前沿。在本节中，我们将利用PyPortfolioOpt库，该库提供投资组合优化（使用SciPy作为内部支持），包括有效前沿技术和更近期的收缩方法，用于正则化协方差矩阵（请参见*第7章*，*线性模型
    - 从风险因素到收益预测*，关于线性回归的收缩）。代码示例位于`02_backtest_with_pf_optimization.ipynb`中。
- en: 'We''ll use the same setup with 50 long and short positions derived from the
    `MeanReversion` factor ranking. The `rebalance()` function receives the suggested
    long and short positions and passes each subset on to a new `optimize_weights()`
    function to obtain dictionaries with `asset: target_percent` pairs:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: '我们将使用从`MeanReversion`因子排名派生的50个多头和空头头寸相同的设置。`rebalance()`函数接收建议的多头和空头头寸，并将每个子集传递给新的`optimize_weights()`函数以获得`asset:
    target_percent`对的字典：'
- en: '[PRE14]'
  id: totrans-181
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'The `optimize_weights()` function uses the `EfficientFrontier` object, provided
    by PyPortfolioOpt, to find the weights that maximize the Sharpe ratio based on
    the last year of returns and the covariance matrix, both of which the library
    also computes:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: '`optimize_weights()`函数使用`PyPortfolioOpt`提供的`EfficientFrontier`对象，找到基于最近一年的收益和协方差矩阵的最大夏普比率的权重，库也计算这两个值：'
- en: '[PRE15]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: It returns normalized weights that sum to 1, set to negative values for the
    short positions.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 它返回归一化的权重，总和为1，对于空头头寸设置为负值。
- en: '*Figure 5.3* shows that, for this particular set of strategies and time frame,
    the mean-variance optimized portfolio performs significantly better:'
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: '*图5.3* 表明，对于这个特定的策略和时间范围，均值方差优化的投资组合表现明显更好：'
- en: '![](img/B15439_05_03.png)'
  id: totrans-186
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_03.png)'
- en: 'Figure 5.3: Mean-variance vs equal-weighted portfolio performance'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: '图5.3: 均值方差 vs 等权重投资组合表现'
- en: PyPortfolioOpt also finds the minimum volatility portfolio. More generally speaking,
    this example illustrates how you can add logic to tweak portfolio weights using
    the methods presented in the previous section, or any other of your choosing.
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: PyPortfolioOpt 还可以找到最小波动率的投资组合。更普遍地说，这个例子说明了如何使用前一节介绍的方法，或者您选择的任何其他方法，添加逻辑来调整投资组合权重。
- en: We will now turn to common measures of portfolio return and risk, and how to
    compute them using the pyfolio library.
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 我们现在将转向投资组合回报和风险的常见衡量标准，以及如何使用 pyfolio 库来计算它们。
- en: Measuring backtest performance with pyfolio
  id: totrans-190
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 pyfolio 测量回测性能
- en: Pyfolio facilitates the analysis of portfolio performance, both in and out of
    sample using a rich set of metrics and visualizations. It produces tear sheets
    that cover the analysis of returns, positions, and transactions, as well as event
    risk during periods of market stress using several built-in scenarios. It also
    includes Bayesian out-of-sample performance analysis.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: Pyfolio 便利地分析了投资组合性能，在和样本外都使用了丰富的指标和可视化。它生成了覆盖回报、仓位和交易分析的泪水表，以及在市场压力期间使用几种内置场景进行事件风险分析。它还包括贝叶斯样本外性能分析。
- en: Pyfolio relies on portfolio returns and position data and can also take into
    account the transaction costs and slippage losses of trading activity. It uses
    the empyrical library, which can also be used on a standalone basis to compute
    performance metrics.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: Pyfolio 依赖于投资组合回报和仓位数据，还可以考虑交易活动的交易成本和滑点损失。它使用 empyrical 库，该库也可以独立用于计算性能指标。
- en: Creating the returns and benchmark inputs
  id: totrans-193
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 创建回报和基准输入
- en: The library is part of the Quantopian ecosystem and is compatible with Zipline
    and Alphalens. We will first demonstrate how to generate the requisite inputs
    from Alphalens and then show how to extract them from a Zipline backtest performance
    `DataFrame`. The code samples for this section are in the notebook `03_pyfolio_demo.ipynb`.
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 该库是 Quantopian 生态系统的一部分，并与 Zipline 和 Alphalens 兼容。我们首先将演示如何从 Alphalens 生成所需的输入，然后展示如何从
    Zipline 回测性能的 `DataFrame` 中提取它们。本节的代码示例在笔记本 `03_pyfolio_demo.ipynb` 中。
- en: Getting pyfolio input from Alphalens
  id: totrans-195
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 从 Alphalens 获取 pyfolio 输入
- en: 'Pyfolio also integrates with Alphalens directly and permits the creation of
    pyfolio input data using `create_pyfolio_input`:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: Pyfolio 还直接集成了 Alphalens，并允许使用 `create_pyfolio_input` 创建 pyfolio 输入数据：
- en: '[PRE16]'
  id: totrans-197
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'There are two options to specify how portfolio weights will be generated:'
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 有两个选项可以指定如何生成投资组合权重：
- en: '`long_short`: If `False`, weights will correspond to factor values divided
    by their absolute value so that negative factor values generate short positions.
    If `True`, factor values are first demeaned so that long and short positions cancel
    each other out, and the portfolio is market neutral.'
  id: totrans-199
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`long_short`: 如果为 `False`，权重将对应于因子值除以它们的绝对值，以便负因子值生成空头头寸。如果为 `True`，则因子值首先被减去，以便多头和空头头寸相互抵消，投资组合是市场中性的。'
- en: '`equal_weight`: If `True` and `long_short` is `True`, assets will be split
    into two equal-sized groups, with the top/bottom half making up long/short positions.'
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`equal_weight`: 如果`True`并且 `long_short` 为 `True`，资产将分成两个等大小的组，顶部/底部一半组成多头/空头头寸。'
- en: Long-short portfolios can also be created for groups if `factor_data` includes,
    for example, sector information for each asset.
  id: totrans-201
  prefs: []
  type: TYPE_NORMAL
  zh: 如果`factor_data` 包括每个资产的部门信息，还可以为组创建多头-空头投资组合，例如。
- en: Getting pyfolio input from a Zipline backtest
  id: totrans-202
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 从 Zipline 回测获取 pyfolio 输入
- en: 'The result of a Zipline backtest can also be converted into the required pyfolio
    input using `extract_rets_pos_txn_from_zipline`:'
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 还可以使用 `extract_rets_pos_txn_from_zipline` 将 Zipline 回测的结果转换为所需的 pyfolio 输入：
- en: '[PRE17]'
  id: totrans-204
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: Walk-forward testing – out-of-sample returns
  id: totrans-205
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 步行前测试 - 样本外回报
- en: Testing a trading strategy involves back- and forward testing. The former involves
    historical data and often refers to the sample period used to fine-tune alpha
    factor parameters. Forward-testing simulates the strategy on new market data to
    validate that it performs well out of sample and is not too closely tailored to
    specific historical circumstances.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: '测试交易策略涉及回测和前瞻性测试。前者涉及历史数据，并且通常指的是用于微调 alpha 因子参数的样本期间。前瞻性测试在新市场数据上模拟策略，以验证其在样本外的表现，并且不会过于贴近特定的历史情况。 '
- en: Pyfolio allows for the designation of an out-of-sample period to simulate walk-forward
    testing. There are numerous aspects to take into account when testing a strategy
    to obtain statistically reliable results. We will address this in more detail
    in *Chapter 8*, *The ML4T Workflow – From Model to Strategy Backtesting*.
  id: totrans-207
  prefs: []
  type: TYPE_NORMAL
  zh: Pyfolio 允许指定一个样本外期间来模拟前瞻性测试。测试策略以获得统计上可靠的结果时，有许多方面需要考虑。我们将在第 8 章 *ML4T 工作流程
    – 从模型到策略回测* 中更详细地讨论这一点。
- en: 'The `plot_rolling_returns` function displays cumulative in- and out-of-sample
    returns against a user-defined benchmark (we are using the S&P 500). Pyfolio computes
    cumulative returns as the product of simple returns after adding 1 to each:'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 函数 `plot_rolling_returns` 显示样本内和样本外累积回报与用户定义的基准（我们使用标准普尔 500）的对比。Pyfolio 将累积回报计算为每个回报加
    1 后的简单回报的乘积：
- en: '[PRE18]'
  id: totrans-209
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'The plot in *Figure 5.4* includes a cone that shows expanding confidence intervals
    to indicate when out-of-sample returns appear unlikely, given random-walk assumptions.
    Here, our toy strategy did not perform particularly well against the S&P 500 benchmark
    during the simulated 2016 out-of-sample period:'
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 5.4* 中的图表包括一个锥体，显示扩展的置信区间，以指示在随机行走假设下，样本外回报何时似乎不太可能。在这里，我们的玩具策略在模拟的 2016
    年样本外期间表现不佳，相对于标准普尔 500 指数：'
- en: '![](img/B15439_05_04.png)'
  id: totrans-211
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_04.png)'
- en: 'Figure 5.4: Pyfolio cumulative performance plot'
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.4：Pyfolio 累积表现图
- en: Summary performance statistics
  id: totrans-213
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 摘要性能统计
- en: Pyfolio offers several analytic functions and plots. The `perf_stats` summary
    displays the annual and cumulative returns, volatility, skew, and kurtosis of
    returns and the SR.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: Pyfolio 提供了几个分析函数和图表。`perf_stats` 摘要显示了年度和累积回报、波动率、偏度和峰度以及 SR。
- en: 'The following additional metrics (which can also be calculated individually)
    are most important:'
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 以下附加指标（也可以单独计算）最为重要：
- en: '**Max drawdown**: Highest percentage loss from the previous peak'
  id: totrans-216
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**最大回撤**：相对于前一峰值的最大百分比损失'
- en: '**Calmar ratio**: Annual portfolio return relative to maximal drawdown'
  id: totrans-217
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**卡尔玛比率**：年度组合回报与最大回撤的相对值'
- en: '**Omega ratio**: Probability-weighted ratio of gains versus losses for a return
    target, zero per default'
  id: totrans-218
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**欧米伽比率**：对于回报目标的基于概率加权的增益与损失比率，默认为零'
- en: '**Sortino ratio**: Excess return relative to downside standard deviation'
  id: totrans-219
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**索蒂诺比率**：相对于下行标准差的超额回报'
- en: '**Tail ratio**: Size of the right tail (gains, the absolute value of the 95th
    percentile) relative to the size of the left tail (losses, absolute value of the
    5th percentile)'
  id: totrans-220
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**尾部比率**：右尾部的大小（增益，第 95 百分位的绝对值）相对于左尾部的大小（损失，第 5 百分位的绝对值）'
- en: '**Daily value at risk (VaR)**: Loss corresponding to a return two standard
    deviations below the daily mean'
  id: totrans-221
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**每日风险价值（VaR）**：对应于每日均值下两个标准偏差的损失'
- en: '**Alpha**: Portfolio return unexplained by the benchmark return'
  id: totrans-222
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**阿尔法**：未被基准回报解释的投资组合回报'
- en: '**Beta**: Exposure to the benchmark'
  id: totrans-223
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**贝塔**：与基准的暴露'
- en: 'The `plot_perf_stats` function bootstraps estimates of parameter variability
    and displays the result as a box plot:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 函数 `plot_perf_stats` 通过自助法估计参数变异性，并将结果显示为箱线图：
- en: '![](img/B15439_05_05.png)'
  id: totrans-225
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_05.png)'
- en: 'Figure 5.5: Pyfolio performance statistic plot'
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
  zh: 图 5.5：Pyfolio 表现统计图
- en: 'The `show_perf_stats` function computes numerous metrics for the entire period,
    as well as separately, for in- and out-of-sample periods:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 函数 `show_perf_stats` 计算整个期间以及样本内和样本外期间的多个指标：
- en: '[PRE19]'
  id: totrans-228
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'For the simulated long-short portfolio derived from the `MeanReversion` factor,
    we obtain the following performance statistics:'
  id: totrans-229
  prefs: []
  type: TYPE_NORMAL
  zh: 对于从 `MeanReversion` 因子派生的模拟多空投资组合，我们得到以下表现统计：
- en: '| Metric | All | In-sample | Out-of-sample |'
  id: totrans-230
  prefs: []
  type: TYPE_TB
  zh: '| 指标 | 全部 | 样本内 | 样本外 |'
- en: '| Annual return | 2.80% | 2.10% | 4.70% |'
  id: totrans-231
  prefs: []
  type: TYPE_TB
  zh: '| 年度回报 | 2.80% | 2.10% | 4.70% |'
- en: '| Cumulative returns | 11.60% | 6.60% | 4.70% |'
  id: totrans-232
  prefs: []
  type: TYPE_TB
  zh: '| 累积回报 | 11.60% | 6.60% | 4.70% |'
- en: '| Annual volatility | 8.50% | 8.80% | 7.60% |'
  id: totrans-233
  prefs: []
  type: TYPE_TB
  zh: '| 年度波动率 | 8.50% | 8.80% | 7.60% |'
- en: '| Sharpe ratio | 0.37 | 0.29 | 0.64 |'
  id: totrans-234
  prefs: []
  type: TYPE_TB
  zh: '| 夏普比率 | 0.37 | 0.29 | 0.64 |'
- en: '| Calmar ratio | 0.21 | 0.16 | 0.57 |'
  id: totrans-235
  prefs: []
  type: TYPE_TB
  zh: '| 卡尔马比率 | 0.21 | 0.16 | 0.57 |'
- en: '| Stability | 0.26 | 0.01 | 0.67 |'
  id: totrans-236
  prefs: []
  type: TYPE_TB
  zh: '| 稳定性 | 0.26 | 0.01 | 0.67 |'
- en: '| Max drawdown | -13.10% | -13.10% | -8.30% |'
  id: totrans-237
  prefs: []
  type: TYPE_TB
  zh: '| 最大回撤 | -13.10% | -13.10% | -8.30% |'
- en: '| Omega ratio | 1.07 | 1.06 | 1.11 |'
  id: totrans-238
  prefs: []
  type: TYPE_TB
  zh: '| 欧米伽比率 | 1.07 | 1.06 | 1.11 |'
- en: '| Sortino ratio | 0.54 | 0.42 | 0.96 |'
  id: totrans-239
  prefs: []
  type: TYPE_TB
  zh: '| 索提诺比率 | 0.54 | 0.42 | 0.96 |'
- en: '| Skew | 0.33 | 0.35 | 0.25 |'
  id: totrans-240
  prefs: []
  type: TYPE_TB
  zh: '| 偏度 | 0.33 | 0.35 | 0.25 |'
- en: '| Kurtosis | 7.2 | 8.04 | 2 |'
  id: totrans-241
  prefs: []
  type: TYPE_TB
  zh: '| 峰度 | 7.2 | 8.04 | 2 |'
- en: '| Tail ratio | 1.04 | 1.06 | 1.01 |'
  id: totrans-242
  prefs: []
  type: TYPE_TB
  zh: '| 尾部比率 | 1.04 | 1.06 | 1.01 |'
- en: '| Daily value at risk | -1.10% | -1.10% | -0.90% |'
  id: totrans-243
  prefs: []
  type: TYPE_TB
  zh: '| 日风险价值 | -1.10% | -1.10% | -0.90% |'
- en: '| Gross leverage | 0.69 | 0.68 | 0.72 |'
  id: totrans-244
  prefs: []
  type: TYPE_TB
  zh: '| 总杠杆 | 0.69 | 0.68 | 0.72 |'
- en: '| Daily turnover | 8.10% | 8.00% | 8.40% |'
  id: totrans-245
  prefs: []
  type: TYPE_TB
  zh: '| 日换手率 | 8.10% | 8.00% | 8.40% |'
- en: '| Alpha | 0 | -0.01 | 0.03 |'
  id: totrans-246
  prefs: []
  type: TYPE_TB
  zh: '| Alpha | 0 | -0.01 | 0.03 |'
- en: '| Beta | 0.25 | 0.27 | 0.17 |'
  id: totrans-247
  prefs: []
  type: TYPE_TB
  zh: '| Beta | 0.25 | 0.27 | 0.17 |'
- en: See the appendix for details on the calculation and interpretation of portfolio
    risk and return metrics.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 请参阅附录以获取有关投资组合风险和回报度量的计算和解释详细信息。
- en: Drawdown periods and factor exposure
  id: totrans-249
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 跌幅期和因素暴露
- en: 'The `plot_drawdown_periods(returns)` function plots the principal drawdown
    periods for the portfolio, and several other plotting functions show the rolling
    SR and rolling factor exposures to the market beta or the Fama-French size, growth,
    and momentum factors:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 函数`plot_drawdown_periods(returns)`绘制投资组合的主要跌幅期，并且还有几个绘图函数显示滚动的SR和滚动因子暴露于市场beta或Fama-French尺寸、增长和动量因子：
- en: '[PRE20]'
  id: totrans-251
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'The plots in *Figure 5.6*, which highlights a subset of the visualization contained
    in the various tear sheets, illustrate how pyfolio allows us to drill down into
    the performance characteristics and gives us exposure to fundamental drivers of
    risk and returns:'
  id: totrans-252
  prefs: []
  type: TYPE_NORMAL
  zh: '图5.6中的图表突出显示了各种撕裂表中包含的可视化子集，说明了pyfolio如何让我们深入了解绩效特征并让我们接触到风险和回报的基本驱动因素：  '
- en: '![](img/B15439_05_06.png)'
  id: totrans-253
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_06.png)'
- en: 'Figure 5.6: Various pyfolio plots of performance over time'
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.6：随时间变化的各种pyfolio绘图
- en: Modeling event risk
  id: totrans-255
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 建模事件风险
- en: 'Pyfolio also includes timelines for various events that you can use to compare
    the performance of a portfolio to a benchmark during this period. Pyfolio uses
    the S&P 500 by default, but you can also provide benchmark returns of your choice.
    The following example compares the performance to the S&P 500 during the fall
    2015 selloff, following the Brexit vote:'
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: Pyfolio还包括各种事件的时间表，您可以使用它来比较投资组合在此期间与基准的表现。 Pyfolio默认使用标准普尔500指数，但您也可以提供您选择的基准回报。以下示例将绩效与2015年秋季的标准普尔500指数相比，该指数跌至英国脱欧后的情况：
- en: '[PRE21]'
  id: totrans-257
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: '*Figure 5.7* shows the resulting plot:'
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: '*图5.7*显示了结果图：'
- en: '![](img/B15439_05_07.png)'
  id: totrans-259
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_05_07.png)'
- en: 'Figure 5.7: Pyfolio event risk analysis'
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 图5.7：Pyfolio事件风险分析
- en: Summary
  id: totrans-261
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 摘要
- en: In this chapter, we covered the important topic of portfolio management, which
    involves the combination of investment positions with the objective of managing
    risk-return trade-offs. We introduced pyfolio to compute and visualize key risk
    and return metrics, as well as to compare the performance of various algorithms.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们涵盖了投资组合管理的重要主题，这涉及将投资头寸组合起来以管理风险和回报的权衡目标。我们介绍了pyfolio来计算和可视化关键的风险和回报指标，并比较各种算法的性能。
- en: We saw how important accurate predictions are for optimizing portfolio weights
    and maximizing diversification benefits. We also explored how machine learning
    can facilitate more effective portfolio construction by learning hierarchical
    relationships from the asset-returns covariance matrix.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 我们看到准确的预测对于优化投资组合权重和最大化多样化效益至关重要。我们还探讨了机器学习如何通过从资产收益协方差矩阵中学习分层关系，促进更有效的投资组合构建。
- en: We will now move on to the second part of this book, which focuses on the use
    of machine learning models. These models will produce more accurate predictions
    by making more effective use of more diverse information. They do this to capture
    more complex patterns than the simpler alpha factors that were most prominent
    so far.
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们将转向本书的第二部分，重点介绍机器学习模型的使用。这些模型将通过更有效地利用更多样化的信息来产生更准确的预测。他们这样做是为了捕捉比迄今为止最突出的简单的alpha因子更复杂的模式。
- en: We will begin by training, testing, and tuning linear models for regression
    and classification using cross-validation to achieve robust out-of-sample performance.
    We will also embed these models within the framework for defining and backtesting
    algorithmic trading strategies, which we covered in the previous two chapters.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将首先通过交叉验证来训练、测试和调整用于回归和分类的线性模型，以实现强健的样本外表现。我们还将把这些模型嵌入到定义和回测算法交易策略的框架中，这是我们在前两章中介绍过的。

- en: Chapter 2. Factor Models
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 第二章：因素模型
- en: 'In most of the cases in finance, valuation of financial assets is based on
    the discounted cash flow method; hence, the present value is calculated as the
    discounted value of the expected future cash flows. Therefore, in order to be
    able to value assets, we need to know the appropriate rate of return that reflects
    the time value of money and also the risk of the given asset. There are two main
    approaches to determine expected returns: the **capital asset pricing model (CAPM)**
    and the **arbitrage pricing theory (APT)**. CAPM is an equilibrium model, while
    APT builds on the no-arbitrage principle; thus, these approaches have quite different
    starting points and inner logic. However, the final pricing formula we get can
    be quite similar, depending on the market factors we use. For the comparison of
    CAPM and APT, see *Bodie-Kane-Marcus (2008)*. When we test any of these theoretical
    models on real-world data, we perform linear regressions. This chapter focuses
    on APT, since we have discussed CAPM in more detail in *Daróczi et al. (2013)*.'
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 在金融领域，大多数情况下，金融资产的估值是基于折现现金流法；因此，现值是预计未来现金流的折现值。因此，为了能够对资产进行估值，我们需要知道反映时间价值和给定资产风险的适当回报率。有两种主要方法来确定预期回报：**资本资产定价模型（CAPM）**和**套利定价理论（APT）**。CAPM是一个均衡模型，而APT则基于无套利原理；因此，这些方法的出发点和内在逻辑差异很大。然而，根据我们使用的市场因素，最终得到的定价公式可能非常相似。有关CAPM和APT的比较，参见*Bodie-Kane-Marcus
    (2008)*。当我们在现实世界数据上测试这些理论模型时，我们会进行线性回归。本章重点讨论APT，因为我们在*Daróczi et al. (2013)*中已更详细地讨论了CAPM。
- en: This chapter is divided into two parts. In the first part, we introduce the
    theory of APT in general, and then we present a special three-factor model published
    in a seminal paper of *Fama and French*. In the second part, we show how to use
    R for data selection and how to estimate the pricing coefficients from real market
    data, and finally we re-examine the famous Fama-French model on a more recent
    sample.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 本章分为两部分。在第一部分，我们一般性地介绍APT理论，然后展示*Fama和French*在一篇开创性论文中提出的特殊三因素模型。在第二部分，我们展示如何使用R进行数据选择，以及如何从实际市场数据中估算定价系数，最后我们将对一个更新的样本重新审视著名的Fama-French模型。
- en: Arbitrage pricing theory
  id: totrans-3
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 套利定价理论
- en: 'APT relies on the assumption that asset returns in the market are determined
    by macroeconomic and firm-specific factors, and asset returns are generated by
    the following linear factor model:'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: APT假设市场上资产的回报由宏观经济因素和公司特定因素决定，资产回报由以下线性因素模型生成：
- en: '![Arbitrage pricing theory](img/2078OT_02_01.jpg)'
  id: totrans-5
  prefs: []
  type: TYPE_IMG
  zh: '![套利定价理论](img/2078OT_02_01.jpg)'
- en: Equation 1
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 方程式 1
- en: 'Here, *E(r[i])* is the expected return of asset *i*, *F[j]* stands for the
    unexpected change of the *j*th factor, and β*[ij]* shows the *i*th security''s
    sensitivity for that factor, while *e[i]* is the return caused by unexpected firm-specific
    events. So ![Arbitrage pricing theory](img/2078OT_02_02.jpg) represents the random
    systemic effect, and *e[i]* represents the non-systemic (that is idiosyncratic)
    effect, which is not captured by the market factors. Being unexpected, both ![Arbitrage
    pricing theory](img/2078OT_02_02.jpg) and *e[i]* have a zero mean. In this model,
    factors are independent of each other and the firm-specific risk. Thus, asset
    returns are derived from two sources: the systemic risk of the factors that affect
    all assets in the market and the non-systematic risk that impacts only that special
    firm. A non-systemic risk can be diversified by holding more assets in the portfolio.
    In contrast, a systemic risk cannot be diversified, as it is caused by economy-wide
    sources of risks that affect the overall stock market (*Brealey-Myers, 2005*).'
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
  zh: 其中，*E(r[i])*是资产*i*的预期回报，*F[j]*代表第*j*个因素的意外变化，β*[ij]*表示第*i*只证券对该因素的敏感度，而*e[i]*是由公司特定事件引起的回报。因此，![套利定价理论](img/2078OT_02_02.jpg)表示随机的系统性效应，*e[i]*表示非系统性（即特有的）效应，这是市场因素无法捕捉到的。由于是意外的，![套利定价理论](img/2078OT_02_02.jpg)和*e[i]*的均值都为零。在此模型中，因素彼此独立，并且与公司特定风险无关。因此，资产回报来源于两个方面：影响市场上所有资产的因素所带来的系统性风险和仅影响特定公司的非系统性风险。非系统性风险可以通过持有更多资产来进行多样化投资。相比之下，系统性风险无法通过多样化来分散，因为它是由影响整个股市的经济范围内的风险源引起的(*Brealey-Myers,
    2005*)。
- en: As a consequence of the model, the realized return of an asset is the linear
    combination of multiple random factors *(Wilmott, 2007)*.
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
  zh: 根据该模型，资产的实际回报是多个随机因素的线性组合*(Wilmott, 2007)*。
- en: 'Other important assumptions of APT are as follows:'
  id: totrans-9
  prefs: []
  type: TYPE_NORMAL
  zh: APT的其他重要假设如下：
- en: There are a finite number of investors on the market who optimize their portfolio
    for the next period. They are equally informed and have no market power.
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 市场上有有限数量的投资者，他们优化下一时期的投资组合。这些投资者信息对称，且没有市场影响力。
- en: There is a riskless asset and an infinite number of risky assets traded continuously;
    thus, firm-specific risks can be totally eliminated by diversification. A portfolio
    that has zero firm-specific risks is called a well-diversified portfolio.
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存在一种无风险资产和无限数量的不断交易的风险资产；因此，可以通过多样化完全消除公司特定风险。具有零公司特定风险的投资组合被称为良好多样化的投资组合。
- en: Investors are rational in the sense that if an arbitrage opportunity occurs
    (financial assets are mispriced relative to each other), then investors immediately
    buy the underpriced security/securities and sell the overpriced one(s), and they
    will take an infinitely large position in order to earn as much riskless profit
    as possible. Consequently, any mispricing will disappear on the spot.
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 投资者是理性的，即如果出现套利机会（金融资产相对定价错误），投资者会立即购买被低估的证券/证券，并卖出被高估的证券，并会采取无限大的仓位以赚取尽可能多的无风险利润。因此，任何定价错误都会立即消失。
- en: Factor portfolios exist, and they are continuously tradable. A factor portfolio
    is a well-diversified portfolio that reacts only to one of the factors; specifically,
    it has a beta of 1 for that specified factor and a beta of 0 for all other factors.
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 存在因子投资组合，并且它们可以不断交易。因子投资组合是一个良好多样化的投资组合，仅对某一因子有反应；具体来说，它对该指定因子的贝塔值为1，对所有其他因子的贝塔值为0。
- en: 'From the preceding assumptions, it can be shown that any portfolio''s risk
    premium equals the weighted sum of the factor portfolios'' risk premium *(Medvegyev-Száz,
    2010)*. The following pricing formula can be derived in the case of a two-factor
    model:'
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 根据前述假设，可以证明任何投资组合的风险溢价等于因子投资组合风险溢价的加权总和*(Medvegyev-Száz, 2010)*。在双因子模型的情况下，可以推导出以下定价公式：
- en: '![Arbitrage pricing theory](img/2078OT_02_03.jpg)'
  id: totrans-15
  prefs: []
  type: TYPE_IMG
  zh: '![套利定价理论](img/2078OT_02_03.jpg)'
- en: Equation 2
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 方程 2
- en: Here, *r[i]* is the return of the *i*th asset, *r[f]* is the risk-free return,
    β*[i1]* is the sensitivity of the *i*th stock's risk premium to the first systemic
    factor, and (*r[1]-r[f]*) is the risk premium of this factor. Similarly, β*[i2]*
    is the sensitivity of the *i*th stock's risk premium to the second factor's excess
    return (*r[2]-r[f]*).
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，*r[i]* 是第*i*个资产的回报，*r[f]* 是无风险回报，β*[i1]* 是第*i*个股票的风险溢价对第一个系统性因子的敏感度，（*r[1]-r[f]*）是该因子的风险溢价。类似地，β*[i2]*
    是第*i*个股票的风险溢价对第二个因子的超额回报（*r[2]-r[f]*）的敏感度。
- en: 'When we implement APT, we perform a linear regression in the following form:'
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 当我们实施APT时，我们会执行以下形式的线性回归：
- en: '![Arbitrage pricing theory](img/2078OT_02_04.jpg)'
  id: totrans-19
  prefs: []
  type: TYPE_IMG
  zh: '![套利定价理论](img/2078OT_02_04.jpg)'
- en: Equation 3
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 方程 3
- en: Here, *α[i]* stands for a constant and *ε[i]* is the asset's non-systemic, firm-specific
    risk. All other variables are the same as mentioned previously.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 其中，*α[i]* 表示常数，*ε[i]* 是资产的非系统性、公司特定风险。所有其他变量与之前提到的一致。
- en: 'If there is only one factor in the model, and it is the return of the market
    portfolio, the pricing equation of the CAPM model and APT model will coincide:'
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 如果模型中只有一个因子，且它是市场投资组合的回报，则CAPM模型和APT模型的定价方程将完全一致：
- en: '![Arbitrage pricing theory](img/2078OT_02_05.jpg)'
  id: totrans-23
  prefs: []
  type: TYPE_IMG
  zh: '![套利定价理论](img/2078OT_02_05.jpg)'
- en: Equation 4
  id: totrans-24
  prefs: []
  type: TYPE_NORMAL
  zh: 方程 4
- en: 'In this case, the formula to be tested on real market data is as follows:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下，需在真实市场数据上测试的公式如下：
- en: '![Arbitrage pricing theory](img/2078OT_02_06.jpg)'
  id: totrans-26
  prefs: []
  type: TYPE_IMG
  zh: '![套利定价理论](img/2078OT_02_06.jpg)'
- en: Equation 5
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 方程 5
- en: Here, ![Arbitrage pricing theory](img/2078OT_02_07.jpg) is the return of a market
    portfolio represented by a market index (like the S&P 500). This is why we call
    Equation (5) the index model.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，![套利定价理论](img/2078OT_02_07.jpg) 是由市场指数（如S&P 500）代表的市场投资组合的回报。这就是为什么我们称方程（5）为指数模型的原因。
- en: Implementation of APT
  id: totrans-29
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: APT的实现
- en: 'The implementation of APT can be split into four steps: identifying the factors,
    estimating the factor coefficient, estimating the factor premiums, and pricing
    with APT (*Bodie et al. 2008*):'
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: APT的实现可以分为四个步骤：识别因子、估算因子系数、估算因子溢价以及使用APT进行定价(*Bodie等, 2008*)：
- en: '**Identifying the factors**: As APT mentions nothing about the factors, they
    have to be identified empirically. These factors are usually macroeconomic factors,
    like stock market return, inflation, business cycle, and so on. The main problem
    in using macroeconomic factors is that factors are usually not independent of
    each other. The identification of the factors is often carried out by factor analysis.
    However, factors identified by factor analysis cannot necessarily be interpreted
    in an economically meaningful way.'
  id: totrans-31
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**识别因素**：由于APT没有提到任何因素，因此这些因素必须通过经验方法来识别。这些因素通常是宏观经济因素，如股市回报、通货膨胀、商业周期等。使用宏观经济因素的主要问题是，这些因素通常不是相互独立的。因素的识别通常通过因子分析来进行。然而，通过因子分析识别出的因素不一定能以经济学有意义的方式进行解释。'
- en: '**Estimating factor coefficients**: In order to estimate the coefficients in
    a multivariate linear regression model, a general version of Equation (3) is used.'
  id: totrans-32
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**估算因子系数**：为了估算多元线性回归模型中的系数，使用方程（3）的一个通用版本。'
- en: '**Estimating the factor premiums**: The estimation of the factor premiums is
    based on historical data, taking the average of the historical time-series data
    of the premiums of the factor portfolios.'
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**估算因子溢价**：因子溢价的估算基于历史数据，通过取因子组合的历史时间序列数据的平均值来进行。'
- en: '**Pricing with APT**: Equation (2) is used for calculating the expected return
    of any asset by substituting the appropriate variables into the equation.'
  id: totrans-34
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '**使用APT定价**：方程（2）用于通过将适当的变量代入方程来计算任何资产的预期回报。'
- en: Fama-French three-factor model
  id: totrans-35
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 法马-弗兰奇三因子模型
- en: Fama and French proposed a multifactor model in 1996, in which they used corporate
    indicators as factors instead of macroeconomic factors, since they found that
    these factors better describe the systemic risk of assets. Fama and French (1996)
    extended the index model by adding the firm size and the book-to-market ratio
    as return-generating factors to the market portfolio returns (*Fama and French,
    1996*).
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 法马和弗兰奇在1996年提出了一个多因子模型，在该模型中，他们使用了公司指标作为因子，而不是宏观经济因子，因为他们发现这些因子能更好地描述资产的系统性风险。法马和弗兰奇（1996）通过添加公司规模和账面市值比作为回报生成因子，扩展了指数模型，以便与市场投资组合的回报相结合（*法马和弗兰奇，1996*）。
- en: The firm size factor was constructed by taking the difference between the returns
    of small and large firms (*r[SMB]*). The name of the variable was SMB, which is
    derived from "small minus big". The book-to-market factor was calculated by taking
    the difference between firms' returns that have a high and low book-to-market
    ratio (*r[HML]*). The name of the variable was HML, which is derived from "high
    minus low".
  id: totrans-37
  prefs: []
  type: TYPE_NORMAL
  zh: 公司规模因子是通过计算小型和大型公司回报的差异（*r[SMB]*）来构建的。该变量的名称为SMB，来源于“small minus big”（小减大）。账面市值比因子是通过计算回报差异来计算的，比较的是账面市值比高和低的公司（*r[HML]*）。该变量的名称为HML，来源于“high
    minus low”（高减低）。
- en: 'Their model was the following:'
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 他们的模型如下：
- en: '![Fama-French three-factor model](img/2078OT_02_08.jpg)'
  id: totrans-39
  prefs: []
  type: TYPE_IMG
  zh: '![法马-弗兰奇三因子模型](img/2078OT_02_08.jpg)'
- en: Equation 6
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 方程 6
- en: Here, *α[i]* is a constant, which shows the abnormal rate of return, *r[f]*
    is the risk-free return, and β*[iHML]* is the *i*th asset's sensitivity to the
    book-to-market factor, while β*[iSMB]* is the *i*th asset's sensitivity to the
    factor of size, β*[iM]* is the sensitivity of the *i*th stock's risk premium to
    the market index factor, (*r[M]-r[f]*) is the risk premium of this factor, and
    *e[i]* is the asset's non-systemic, firm-specific risk with zero mean.
  id: totrans-41
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，*α[i]*是一个常数，表示异常回报率，*r[f]*是无风险回报，β*[iHML]*是第*i*资产对账面市值比因子的敏感度，β*[iSMB]*是第*i*资产对规模因子的敏感度，β*[iM]*是第*i*股票的风险溢价对市场指数因子的敏感度，(*r[M]-r[f]*)是该因子的风险溢价，而*e[i]*是该资产的非系统性、公司特定的风险，其均值为零。
- en: Modeling in R
  id: totrans-42
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 在R中建模
- en: In the following section, we will learn the implementation of the previously
    described models with the help of R.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 在接下来的章节中，我们将学习如何借助R实现前述模型。
- en: Data selection
  id: totrans-44
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 数据选择
- en: In [Chapter 4](ch04.html "Chapter 4. Big Data – Advanced Analytics"), *Big Data
    – Advanced Analytics*, we will discuss in detail the aspects and methods of getting
    data from open sources and working with them efficiently. Here, we only present
    how the time series of stock prices and other relevant information can be acquired
    and used for the factor model's estimations.
  id: totrans-45
  prefs: []
  type: TYPE_NORMAL
  zh: 在[第4章](ch04.html "第4章 大数据 - 高级分析")中，*大数据 - 高级分析*，我们将详细讨论如何从开放数据源获取数据并高效使用它们的方法。在这里，我们仅展示如何获取股票价格和其他相关信息的时间序列，并用于因子模型的估算。
- en: We used the `quantmod` package to collect the database.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 我们使用了`quantmod`包来收集数据库。
- en: 'Here is how it works in R:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 下面是如何在R中实现的：
- en: '[PRE0]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'As a result, we need to wait for a few seconds while data is fetched, and then
    we can see the output:'
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 结果是，我们需要等待几秒钟才能获取数据，然后就可以看到输出：
- en: '[PRE1]'
  id: totrans-50
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Now, we have a data frame R object that contains about 6,500 stocks that are
    traded on different exchanges such as AMEX, NASDAQ, or NYSE. In order to see the
    variables that the dataset contains, we can use the `str` command:'
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们有一个包含约6,500只在不同交易所（如AMEX、NASDAQ或NYSE）交易的股票的数据框R对象。为了查看数据集包含的变量，我们可以使用`str`命令：
- en: '[PRE2]'
  id: totrans-52
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'We can drop the variables that we don''t really need and include the information
    about market capitalization and the book value of the company coming from a different
    database as new variables since we will need them to estimate the Fama-French
    model:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以删除不需要的变量，并将来自其他数据库的公司市值和账面价值作为新变量加入，因为我们将在估算Fama-French模型时需要它们：
- en: '[PRE3]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'We will also need the time series of the risk-free return, which will be quantified
    in this calculation by the one-month USD LIBOR rate:'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还需要无风险回报的时间序列，这将在此计算中通过一个月的美元LIBOR利率来量化：
- en: '[PRE4]'
  id: totrans-56
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: We can ignore the warning messages as data is still assigned to the LIBOR variable.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以忽略警告信息，因为数据仍然已分配给LIBOR变量。
- en: The `Quandl` package, the `tseries` package, and other packages that collect
    data are discussed in [Chapter 4](ch04.html "Chapter 4. Big Data – Advanced Analytics"),
    *Big Data – Advanced Analytics*, in more detail.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '`Quandl`包、`tseries`包以及其他收集数据的包在[第4章](ch04.html "第4章 大数据 – 高级分析")中有更详细的讨论，*大数据
    – 高级分析*。'
- en: This can also be used to get the prices of stocks, and the S&P 500 index can
    be used as the market portfolio.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 这也可以用来获取股票价格，标准普尔500指数可以作为市场投资组合使用。
- en: 'We have a table with stock prices (a time series of approximately 5,000 stock
    prices between June 1, 2010 to June 1, 2014). The first and last few columns look
    like this:'
  id: totrans-60
  prefs: []
  type: TYPE_NORMAL
  zh: 我们有一张股票价格表（大约5,000只股票在2010年6月1日到2014年6月1日之间的时间序列）。前几列和最后几列看起来是这样的：
- en: '[PRE5]'
  id: totrans-61
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: If we have the data saved on our hard drive, we can simply read it with the
    `read.table` function. In [Chapter 4](ch04.html "Chapter 4. Big Data – Advanced
    Analytics"), *Big Data – Advanced Analytics*, we will discuss how to collect data
    directly from the Internet.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们将数据保存在硬盘上，可以使用`read.table`函数直接读取它。在[第4章](ch04.html "第4章 大数据 – 高级分析")中，我们将讨论如何直接从互联网收集数据。
- en: 'Now, we have all the data we need: the market portfolio (S&P 500), the price
    of stocks, and the risk-free rates (one-month LIBOR).'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们拥有了所有需要的数据：市场投资组合（标准普尔500指数）、股票价格和无风险利率（一个月LIBOR利率）。
- en: 'We have chosen to delete the variables with missing values and 0 or negative
    prices, in order to clean the database. The easiest way to do this is the following:'
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 我们选择删除缺失值和价格为0或负值的变量，以便清理数据库。最简单的做法如下：
- en: '[PRE6]'
  id: totrans-65
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: To use the `colMins` function, we apply the `matrixStats` package. Now, we can
    start working with the data.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 要使用`colMins`函数，我们需要应用`matrixStats`包。现在，我们可以开始处理数据了。
- en: Estimation of APT with principal component analysis
  id: totrans-67
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用主成分分析估算APT
- en: In practice, it is not easy to carry out a factor analysis, because identifying
    the macro variables that have an effect on the securities' return is difficult
    (*Medvegyev – Száz, 2010, pp. 42*). In many cases, the latent factors that drive
    the returns are searched by principal component analysis.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: 实际上，进行因子分析并不容易，因为确定对证券回报有影响的宏观变量是困难的（*Medvegyev – Száz, 2010, 第42页*）。在许多情况下，驱动回报的潜在因子是通过主成分分析（PCA）来寻找的。
- en: From the originally downloaded 6,500 stocks, we can use the data of 4,015 stocks;
    the rest were excluded because of missing values or 0 prices. Now, we omit the
    first two columns because we do not need the dates in this section, and the S&P
    500 is considered as a separate factor in itself; hence, we do not include it
    in the principal component analysis (PCA). After this, the log returns are computed.
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 从最初下载的6,500只股票中，我们可以使用4,015只股票的数据；其余的由于缺失值或价格为0而被排除。现在，我们省略了前两列，因为我们在这一部分不需要日期，且标准普尔500指数被视为一个独立的因子，因此我们不将其包括在主成分分析（PCA）中。完成这些后，我们计算对数回报。
- en: '[PRE7]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: There exists another way to calculate the log returns of a given asset, that
    is, by using `return.calculate(data, method="log")` with the `PerformanceAnalytics`
    library.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 还有另一种计算给定资产对数回报的方法，那就是使用`return.calculate(data, method="log")`，该方法来自`PerformanceAnalytics`库。
- en: 'As we have too many stocks, in order to carry out PCA, either we have to have
    data of at least 25 years, or we need to reduce the number of stocks. It''s hopeless
    for factor models to remain stable for decades; hence, for illustration purposes,
    we choose to select 10 percent of the stocks randomly and compute the model for
    this sample:'
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 由于股票数量过多，为了进行主成分分析（PCA），我们要么需要至少25年的数据，要么需要减少股票的数量。因子模型在数十年内保持稳定几乎不可能；因此，为了说明问题，我们选择随机选取10%的股票并对该样本计算模型：
- en: '[PRE8]'
  id: totrans-73
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: '`runif(nrow(r)) < 0.1` is a 4,013 dimension 0-1 vector, which chooses approximately
    10 percent of the columns (in our case, 393) from the table. We can also use the
    following sample function for this, on which you can find further details at [http://stat.ethz.ch/R-manual/R-devel/library/base/html/sample.html](http://stat.ethz.ch/R-manual/R-devel/library/base/html/sample.html):'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: '`runif(nrow(r)) < 0.1` 是一个维度为4,013的0-1向量，它大约从表格中选择10%的列（在我们的案例中是393列）。我们也可以使用以下示例函数来实现这一点，更多细节可以参考[http://stat.ethz.ch/R-manual/R-devel/library/base/html/sample.html](http://stat.ethz.ch/R-manual/R-devel/library/base/html/sample.html)：'
- en: '[PRE9]'
  id: totrans-75
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: As a result, we receive a `princomp` class object, which has eight attributes,
    of which the most important ones are the loading matrix and the `sdev` attributes,
    which contain the standard deviations of the components. The first principal component
    is the vector on which the data set has the maximum variance.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 结果是，我们得到了一个`princomp`类对象，包含八个属性，其中最重要的属性是载荷矩阵和`sdev`属性，后者包含各个成分的标准差。第一主成分是数据集具有最大方差的向量。
- en: 'Let''s check the standard deviations of the principal component:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们检查主成分的标准差：
- en: '[PRE10]'
  id: totrans-78
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'The result is as follows:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 结果如下：
- en: '![Estimation of APT with principal component analysis](img/2078OT_02_09.jpg)'
  id: totrans-80
  prefs: []
  type: TYPE_IMG
  zh: '![主成分分析下APT估计](img/2078OT_02_09.jpg)'
- en: We can see that the first five components are separated; consequently, five
    factors should be chosen, but other factors also have significant standard deviations,
    so the market cannot be explained by a few factors.
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到，前五个成分已被分开，因此应选择五个因子，但其他因子的标准差也很显著，所以市场不能仅由少数几个因子来解释。
- en: 'We can confirm this result by calling the `factanal` function, which estimates
    the factor model with five factors:'
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过调用`factanal`函数来确认这一结果，该函数使用五个因子估计因子模型：
- en: '[PRE11]'
  id: totrans-83
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'We notice that it takes much more time to perform this computation. Factor
    analysis is related to PCA, but is a little more complicated from a mathematical
    aspect. As a result, we get an object of class `factanal`, which has many attributes,
    but now, we are only interested in the following part of the output:'
  id: totrans-84
  prefs: []
  type: TYPE_NORMAL
  zh: 我们注意到，进行此计算时需要更多的时间。因子分析与PCA有关，但在数学上稍微复杂一些。结果是，我们得到了一个`factanal`类的对象，包含多个属性，但此时我们只对以下部分输出感兴趣：
- en: '[PRE12]'
  id: totrans-85
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: This output shows that the factor model with five factors fits, but the explained
    variance is only approximately 30 percent, which means that the model should be
    extended with other factors as well.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: 该输出显示五因子模型拟合效果较好，但解释方差仅为约30%，这意味着该模型需要扩展，加入其他因子。
- en: Estimation of the Fama-French model
  id: totrans-87
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Fama-French模型的估计
- en: We have a data frame with prices of the 4,015 stocks for five years, and the
    LIBOR data frame with the LIBOR time series. First, we need to compute the returns
    and combine them with the LIBOR rate.
  id: totrans-88
  prefs: []
  type: TYPE_NORMAL
  zh: 我们有一个包含4,015只股票价格的五年期数据框，以及一个包含LIBOR时间序列的LIBOR数据框。首先，我们需要计算收益率并将其与LIBOR利率合并。
- en: 'As a first step, we omit the dates that are not for mathematical computations,
    and then we compute the log returns for each of the remaining columns:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 第一步，我们省略那些不用于数学计算的日期，然后计算剩余列的对数收益率：
- en: '[PRE13]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'After calculating the log returns, we put back the dates to the returns, and
    then, as a last step, we combine the two data sets:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 在计算对数收益率后，我们将日期与收益率重新合并，最后一步，我们将两个数据集结合起来：
- en: '[PRE14]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: It is worth mentioning that the `merge` function operates on data frames equivalent
    to the (inner) join SQL statement.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 值得注意的是，`merge`函数操作的数据框等同于SQL中的（内连接）语句。
- en: 'The result is as follows:'
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
  zh: 结果如下：
- en: '[PRE15]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'We adjust the LIBOR rate to the daily returns:'
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将LIBOR利率调整为日收益率：
- en: '[PRE16]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'As the LIBOR rates are quoted on a money-market basis - (actual/360) day-count
    convention - and the time series contain the rates in percentage, we divided the
    LIBOR by 36,000\. Now, we need to compute the three variables of the Fama-French
    model. As described in the *Data selection* section, we have the stocks'' data
    frame:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 由于LIBOR利率是基于货币市场报价的（实际/360）天数计算法，且时间序列中包含了百分比形式的利率，因此我们将LIBOR除以36,000。现在，我们需要计算法马-法兰奇模型的三个变量。如在*数据选择*部分所述，我们有股票的数据框：
- en: '[PRE17]'
  id: totrans-99
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'We have to drop the stocks for which we do not have price data:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 我们必须删除那些没有价格数据的股票：
- en: '[PRE18]'
  id: totrans-101
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'We have the market cap as a variable; we still need to compute the book-to-market
    ratio for each:'
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 我们有市场资本作为一个变量；我们仍然需要为每个公司计算账面市值比：
- en: '[PRE19]'
  id: totrans-103
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'Now, we need to compute the SMB and HML factors. For simplification, we will
    define companies as `BIG` if they are bigger than the average. The same principle
    is applied for the book-to-market ratio:'
  id: totrans-104
  prefs: []
  type: TYPE_NORMAL
  zh: 现在，我们需要计算SMB和HML因子。为了简化，我们将公司定义为`BIG`，如果它们的市值大于平均值。对于账面市值比，也应用相同的原则：
- en: '[PRE20]'
  id: totrans-105
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'These arrays contain the symbols of the `BIG` and `SMALL` companies. Now, we
    can define the SMB factor:'
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 这些数组包含了`BIG`和`SMALL`公司的符号。现在，我们可以定义SMB因子：
- en: '[PRE21]'
  id: totrans-107
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'We define the HML factor as follows:'
  id: totrans-108
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将HML因子定义如下：
- en: '[PRE22]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'The third factor is calculated:'
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 计算第三个因子：
- en: '[PRE23]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'After defining the three factors, we test it on the stock of Citigroup Inc.
    (Citi) and on Exelixis, Inc. (EXEL):'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 在定义了三个因子后，我们在花旗集团（Citi）和Exelixis公司（EXEL）的股票上进行了测试：
- en: '[PRE24]'
  id: totrans-113
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'The **GLM (general linear model)** function works as follows: it takes the
    data and formula as arguments. The formula is a string in the form of response
    ~ terms, where the response is a variable name in the data frame and terms specify
    the predictors in the model, so it consists of variable names in the data set
    separated by `+` operators. This function can also be used for logistic regression,
    but the default is linear.'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: '**GLM（广义线性模型）**函数的工作原理如下：它将数据和公式作为参数。公式是一个响应~项的字符串，其中响应是数据框中的变量名称，项指定模型中的预测变量，因此它由数据集中的变量名称组成，并用`+`运算符分隔。该函数也可以用于逻辑回归，但默认是线性回归。'
- en: 'The output of the model is as follows:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 模型的输出如下：
- en: '[PRE25]'
  id: totrans-116
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'The output of the model summary is as follows:'
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 模型总结的输出如下：
- en: '[PRE26]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: The results show that the only significant factor is the market premium, which
    means that the stock return of Citigroup seems to moves together with the whole
    market itself.
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: 结果显示，唯一显著的因子是市场溢价，这意味着花旗的股票回报似乎与整个市场的表现同步。
- en: 'To plot the results, this command should be used:'
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 要绘制结果，应使用以下命令：
- en: '[PRE27]'
  id: totrans-121
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'The following screenshot shows an estimated risk premium of the Fama-French
    model for Citigroup:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: 以下截图显示了法马-法兰奇模型对花旗的估算风险溢价：
- en: '![Estimation of the Fama-French model](img/2078OT_02_10.jpg)'
  id: totrans-123
  prefs: []
  type: TYPE_IMG
  zh: '![法马-法兰奇模型估算](img/2078OT_02_10.jpg)'
- en: If we have a look at the graph we can see that we have an outlier in the returns.
    Let’s see what happens if we get rid of it, by replacing it with 0.
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们看一下图表，可以看到回报中存在异常值。让我们看看如果我们将其替换为0会发生什么。
- en: '[PRE28]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'If we run the same code again to create the model, and calculate the estimated
    and observed returns again we get the following results:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 如果我们再次运行相同的代码来创建模型，并重新计算估算和实际回报，我们将得到以下结果：
- en: '[PRE29]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: According to the results, the all the three factors are significant.
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 根据结果，所有三个因子都是显著的。
- en: The GLM function does not return R². For linear regression, the lm function
    can be used exactly the same way, and we can get from model summary r.squared
    = 0.6446.
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: GLM函数不会返回R²。对于线性回归，可以完全相同地使用lm函数，并且可以从模型总结中得到r.squared = 0.6446。
- en: 'This result indicates that the variables explain more than 64 percent of the
    variance of the risk-premium of Citi. Let’s plot the new results:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 这个结果表明，这些变量解释了花旗银行风险溢价方差的64%以上。让我们绘制新的结果：
- en: '[PRE30]'
  id: totrans-131
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'The output in this case is the following:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 在这种情况下的输出如下：
- en: '![Estimation of the Fama-French model](img/2078OT_02_12.jpg)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
  zh: '![法马-法兰奇模型估算](img/2078OT_02_12.jpg)'
- en: 'We test the model on another stock, EXEL, as well:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 我们还在另一只股票EXEL上测试该模型：
- en: '[PRE31]'
  id: totrans-135
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'The output for the model summary is as follows:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 模型总结的输出如下：
- en: '[PRE32]'
  id: totrans-137
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: According to the results, all of the three factors are significant.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 根据结果，所有三个因子都是显著的。
- en: The `GLM` function does not contain R². For linear regression, the lm function
    can be used exactly the same way, and we get `r.squared = 0.2723` from model summary.
    Based on the results, the variables explain more than 27 percent of the variance
    of the risk premium of EXEL.
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: '`GLM` 函数不包含 R²。对于线性回归，可以使用 lm 函数，使用方式完全相同，并且我们从模型摘要中得到 `r.squared = 0.2723`。根据结果，变量解释了
    EXEL 风险溢价方差的27%以上。'
- en: 'To plot the results, the following command can be used:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 为了绘制结果，可以使用以下命令：
- en: '[PRE33]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: '![Estimation of the Fama-French model](img/2078OT_02_11.jpg)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![法马-法兰奇模型的估算](img/2078OT_02_11.jpg)'
- en: Summary
  id: totrans-143
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we saw how a multifactor model can be built and implemented.
    As a result of a principal component analysis, we identified five independent
    factors that explained asset returns, but they seemed to be insufficient, given
    that they explained only 30 percent of the variance. For illustration, we also
    reproduced the famous Fama-French model on real market data, where, apart from
    the market factor, two additional firm-specific factors (SMB and HML) were also
    used. We used built-in functions for principal component analysis and factor analysis,
    and we have shown how to use a general linear model for regression analysis.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们展示了如何构建和实施多因子模型。通过主成分分析，我们识别出了五个独立因子来解释资产回报，但它们似乎不足以全面解释，因为它们仅解释了30%的方差。为了说明这一点，我们还在真实市场数据上重现了著名的法马-法兰奇模型，其中，除了市场因子外，还使用了两个额外的公司特定因子（SMB
    和 HML）。我们使用了内置的主成分分析和因子分析函数，并展示了如何使用一般线性模型进行回归分析。
- en: We found that the three factors were significant. Hence, we can conclude that
    on a more recent sample, the Fama-French factors have explanatory power. We encourage
    you to develop and test new multifactor pricing formulas that work as the classical
    ones, or even better.
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 我们发现这三个因子具有显著性。因此，我们可以得出结论，在更近期的样本中，法马-法兰奇因子具有解释能力。我们鼓励你开发和测试新的多因子定价公式，这些公式可以像经典模型一样有效，甚至更好。
- en: References
  id: totrans-146
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 参考文献
- en: E.F. Fama, and K.R. French (1996), Multifactor Explanations of asset Pricing
    Anomalies, Journal of Finance 51, pp. 55-84
  id: totrans-147
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: E.F. Fama 和 K.R. French（1996），《资产定价异常的多因子解释》，《金融学杂志》51期，第55-84页
- en: Z. Bodie, A. Kane, and A. Marcus (2008), Essentials of Investment, Edition 7,
    McGraw-Hill Irwin
  id: totrans-148
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Z. Bodie, A. Kane 和 A. Marcus（2008），《投资要素》，第7版，麦格劳-希尔国际
- en: P. Medvegyev, and J. Száz (2010), A meglepetések jellege a pénzügyi piacokon,
    Bankárképző, Budapest
  id: totrans-149
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: P. Medvegyev 和 J. Száz（2010），《金融市场中的意外特征》，Bankárképző，布达佩斯
- en: P. Wilmott (2007), Paul Wilmott Introduces Quantitative Finance, Edition 2,
    John Wiley & Sons Ltd, West Sussex
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: P. Wilmott（2007），《Paul Wilmott 介绍量化金融》，第二版，约翰·威利父子公司，西萨塞克斯
- en: G. Daróczi, M. Puhle, E. Berlinger, P. Csóka, D. Havran, M, Michaletzky, Zs.
    Tulassay, K. Váradi and A. Vidovics-Dancs (2013), Introduction to R for Quantitative
    Finance, Packt Publishing, Birmingham-Mumbai
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: G. Daróczi, M. Puhle, E. Berlinger, P. Csóka, D. Havran, M. Michaletzky, Zs.
    Tulassay, K. Váradi 和 A. Vidovics-Dancs（2013），《量化金融中的R入门》，Packt出版，伯明翰-孟买
- en: 'S.A. Ross (1976), Return, Risk and Arbitrage: in: Risk and Return in Finance,
    Cambridge, Mass, Ballinger'
  id: totrans-152
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: S.A. Ross（1976），《回报、风险与套利：在《金融中的风险与回报》一书中》，剑桥，马萨诸塞州，Ballinger
- en: Gy .Walter, E. Berlinger (1999), Faktormodellek az értékpapírpiacokon (Factormodels
    on securities' markets), Bankszemle, 43(4), pp. 34-43\. ISSN 0133-0519
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Gy. Walter, E. Berlinger（1999），《证券市场中的因子模型》（Factormodels on securities' markets），《银行评论》43(4)，第34-43页。ISSN
    0133-0519

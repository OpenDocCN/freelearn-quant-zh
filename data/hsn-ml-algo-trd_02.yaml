- en: Market and Fundamental Data
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 市场和基本数据
- en: Data has always been an essential driver of trading, and traders have long made
    efforts to gain an advantage by having access to superior information. These efforts
    date back at least to the rumors that the House Rothschild benefited handsomely
    from bond purchases upon advance news about the British victory at Waterloo carried
    by pigeons across the channel.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
  zh: 数据一直是交易的重要驱动因素，交易员长期以来一直在努力通过获取优越信息来获取优势。这些努力至少可以追溯到有关罗斯柴尔德家族利用鸽子跨越海峡携带的关于滑铁卢战役英军胜利的提前消息进行债券购买的传闻。
- en: Today, investments in faster data access take the shape of the Go West consortium
    of leading **high-frequency trading** (**HFT**) firms that connects the **Chicago
    Mercantile Exchange** (**CME**) with Tokyo. The round-trip latency between the
    CME and the BATS exchange in New York has dropped to close to the theoretical
    limit of eight milliseconds as traders compete to exploit arbitrage opportunities.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 如今，对更快数据访问的投资采取了由领先的**高频交易**（**HFT**）公司组成的 Go West 联盟的形式，该联盟将**芝加哥商品交易所**（**CME**）与东京连接起来。在
    CME 和纽约 BATS 交易所之间的往返延迟已降至接近理论极限的 8 毫秒，因为交易员竞相利用套利机会。
- en: Traditionally, investment strategies mostly relied on publicly available data,
    with limited efforts to create or acquire private datasets. In the case of equities,
    fundamental strategies used financial models built on reported financials, possibly
    combined with industry or macro data. Strategies motivated by technical analysis
    extract signals from market data, such as prices and volumes.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 传统上，投资策略主要依赖于公开可用的数据，有限地努力创建或获取私有数据集。在股票的情况下，基本策略使用基于报告的财务数据构建的金融模型，可能结合行业或宏观数据。由技术分析驱动的策略从市场数据中提取信号，例如价格和成交量。
- en: '**Machine learning** (**ML**) algorithms can exploit market and fundamental
    data more efficiently, in particular when combined with alternative data, which
    is the topic of the next chapter. We will address several techniques that focus
    on market and fundamental data in later chapters, such as classic and modern time-series
    techniques, including **recurrent neural networks** (**RNNs**).'
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: '**机器学习**（**ML**）算法可以更有效地利用市场和基本数据，特别是当与替代数据结合使用时，这是下一章的主题。我们将在后续章节中介绍几种侧重于市场和基本数据的技术，例如经典和现代时间序列技术，包括**循环神经网络**（**RNNs**）。'
- en: This chapter introduces market and fundamental data sources and the environment
    in which they are created. Familiarity with various types of orders and the trading
    infrastructure matters because they affect backtest simulations of a trading strategy.
    We also illustrate how to use Python to access and work with trading and financial
    statement data.
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 本章介绍市场和基本数据源以及它们被创建的环境。熟悉各种订单类型和交易基础设施很重要，因为它们影响交易策略的回测模拟。我们还说明了如何使用 Python
    访问和处理交易和财务报表数据。
- en: 'In particular, this chapter will cover the following topics:'
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
  zh: 特别是，本章将涵盖以下主题：
- en: How market microstructure shapes market data
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 市场微观结构如何塑造市场数据
- en: How to reconstruct the order book from tick data using Nasdaq ITCH
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何利用 Nasdaq ITCH 从 tick 数据重建订单簿
- en: How to summarize tick data using various types of bars
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何使用各种类型的条形图总结 tick 数据
- en: How to work with **eXtensible Business Reporting Language** (**XBRL**)-encoded
    electronic filings
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何处理**可扩展业务报告语言**（**XBRL**）编码的电子申报
- en: How to parse and combine market and fundamental data to create a P/E series
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何解析和结合市场和基本数据以创建 P/E 序列
- en: How to access various market and fundamental data sources using Python
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何使用 Python 访问各种市场和基本数据源
- en: How to work with market data
  id: totrans-13
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何处理市场数据
- en: Market data results from the placement and processing of buy and sell orders
    in the course of the trading of financial instruments on the many marketplaces.
    The data reflects the institutional environment of trading venues, including the
    rules and regulations that govern orders, trade execution, and price formation.
  id: totrans-14
  prefs: []
  type: TYPE_NORMAL
  zh: 市场数据是在众多市场交易中买卖订单的提交和处理过程中产生的。这些数据反映了交易场所的机构环境，包括管理订单、交易执行和价格形成的规则和法规。
- en: Algorithmic traders use ML algorithms to analyze the flow of buy and sell orders
    and the resulting volume and price statistics to extract trade signals or features
    that capture insights into, for example, demand-supply dynamics or the behavior
    of certain market participants.
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 算法交易员使用机器学习算法分析买卖订单的流动以及由此产生的成交量和价格统计数据，提取能捕捉到例如需求-供给动态或某些市场参与者行为的交易信号或特征。
- en: We will first review institutional features that impact the simulation of a
    trading strategy during a backtest. Then, we will take a look at how tick data
    can be reconstructed from the order book source. Next, we will highlight several
    methods that regularize tick data and aim to maximize the information content.
    Finally, we will illustrate how to access various market data provider interfaces
    and highlight several providers.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将首先审查影响在回测期间模拟交易策略的机构特征。然后，我们将介绍如何从订单簿来源重建 Tick 数据。接下来，我们将重点介绍几种规范化 Tick 数据的方法，并旨在最大化信息内容。最后，我们将说明如何访问各种市场数据提供商接口，并突出几个提供商。
- en: Market microstructure
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 市场微观结构
- en: Market microstructure is the branch of financial economics that investigates
    the trading process and the organization of related markets. The institutional
    details are quite complex and diverse across asset classes and their derivatives,
    trading venues, and geographies. We will only give a brief overview of key concepts
    before we dive into the data generated by trading. The references on GitHub link
    to several sources that treat this subject in great detail.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 市场微观结构是金融经济学的一个分支，它研究交易过程以及相关市场的组织。机构细节在不同资产类别及其衍生品、交易场所和地理位置上相当复杂和多样化。在我们深入研究交易产生的数据之前，我们将对关键概念进行简要概述。GitHub
    上的参考链接指向了几个对这一主题进行了详细处理的来源。
- en: Marketplaces
  id: totrans-19
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 市场场所
- en: Trading in financial instruments occurs in organized, mostly electronic exchanges,
    and over the counter. An exchange is a central marketplace where buyers and sellers
    meet, and buyers compete with each other for the highest bid while sellers compete
    for the lowest offer.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 金融工具的交易发生在有组织的、主要是电子交易所和场外市场上。交易所是买方和卖方相遇的中央市场，在这里买方竞相出价，而卖方竞相报出最低的报价。
- en: 'There are many exchanges and alternative trading venues across the US and abroad.
    The following table lists some of the larger global exchanges and the trading
    volumes for the 12 months concluded 03/2018 in various asset classes, including
    derivatives. Typically, a minority of financial instruments accounts for most
    trading:'
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 在美国和国外有许多交易所和替代交易场所。以下表格列出了一些较大的全球交易所以及截至 2018 年 03 月各种资产类别（包括衍生品）的 12 个月交易量。通常，少数金融工具占据了大部分交易量：
- en: '|  | **Stocks** |'
  id: totrans-22
  prefs: []
  type: TYPE_TB
  zh: '|  | **股票** |'
- en: '| **Exchange** | **Market Cap (USD mn)** | **# Listed Companies** | **Volume
    / Day (USD mn)** | **# Shares / Day (''000)** | **# Options / Day (''000)** |'
  id: totrans-23
  prefs: []
  type: TYPE_TB
  zh: '| **交易所** | **市值（美元百万）** | **上市公司数量** | **每日成交量（美元百万）** | **每日股票交易量（''000）**
    | **每日期权交易量（''000）** |'
- en: '| NYSE | 23,138,626 | 2,294 | 78,410 | 6,122 | 1,546 |  |'
  id: totrans-24
  prefs: []
  type: TYPE_TB
  zh: '| 纽约证券交易所 | 23,138,626 | 2,294 | 78,410 | 6,122 | 1,546 |  |'
- en: '| Nasdaq-US | 10,375,718 | 2,968 | 65,026 | 7,131 | 2,609 |  |'
  id: totrans-25
  prefs: []
  type: TYPE_TB
  zh: '| 纳斯达克-美国 | 10,375,718 | 2,968 | 65,026 | 7,131 | 2,609 |  |'
- en: '| Japan Exchange Group Inc. | 6,287,739 | 3,618 | 28,397 | 3,361 | 1 |  |'
  id: totrans-26
  prefs: []
  type: TYPE_TB
  zh: '| 日本交易所集团 | 6,287,739 | 3,618 | 28,397 | 3,361 | 1 |  |'
- en: '| Shanghai Stock Exchange | 5,022,691 | 1,421 | 34,736 | 9,801 |  |  |'
  id: totrans-27
  prefs: []
  type: TYPE_TB
  zh: '| 上海证券交易所 | 5,022,691 | 1,421 | 34,736 | 9,801 |  |  |'
- en: '| Euronext | 4,649,073 | 1,240 | 9,410 | 836 | 304 |  |'
  id: totrans-28
  prefs: []
  type: TYPE_TB
  zh: '| 欧洲交易所 | 4,649,073 | 1,240 | 9,410 | 836 | 304 |  |'
- en: '| Hong Kong Exchanges and Clearing | 4,443,082 | 2,186 | 12,031 | 1,174 | 516
    |  |'
  id: totrans-29
  prefs: []
  type: TYPE_TB
  zh: '| 香港交易及结算所 | 4,443,082 | 2,186 | 12,031 | 1,174 | 516 |  |'
- en: '| LSE Group | 3,986,413 | 2,622 | 10,398 | 1,011 |  |  |'
  id: totrans-30
  prefs: []
  type: TYPE_TB
  zh: '| 伦敦证券交易所集团 | 3,986,413 | 2,622 | 10,398 | 1,011 |  |  |'
- en: '| Shenzhen Stock Exchange | 3,547,312 | 2,110 | 40,244 | 14,443 |  |  |'
  id: totrans-31
  prefs: []
  type: TYPE_TB
  zh: '| 深圳证券交易所 | 3,547,312 | 2,110 | 40,244 | 14,443 |  |  |'
- en: '| Deutsche Boerse AG | 2,339,092 | 506 | 7,825 | 475 |  |  |'
  id: totrans-32
  prefs: []
  type: TYPE_TB
  zh: '| 德国交易所 | 2,339,092 | 506 | 7,825 | 475 |  |  |'
- en: '| BSE India Limited | 2,298,179 | 5,439 | 602 | 1,105 |  |  |'
  id: totrans-33
  prefs: []
  type: TYPE_TB
  zh: '| 印度孟买证券交易所有限公司 | 2,298,179 | 5,439 | 602 | 1,105 |  |  |'
- en: '| National Stock Exchange of India Limited | 2,273,286 | 1,952 | 5,092 | 10,355
    |  |  |'
  id: totrans-34
  prefs: []
  type: TYPE_TB
  zh: '| 印度国家证券交易所有限公司 | 2,273,286 | 1,952 | 5,092 | 10,355 |  |  |'
- en: '| BATS Global Markets – US |  |  |  |  | 1,243 |  |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
  zh: '| BATS 全球市场 - 美国 |  |  |  |  | 1,243 |  |'
- en: '| Chicago Board Options Exchange |  |  |  |  | 1,811 |  |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '| 芝加哥期权交易所 |  |  |  |  | 1,811 |  |'
- en: '| International Securities Exchange |  |  |  |  | 1,204 |  |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '| 国际证券交易所 |  |  |  |  | 1,204 |  |'
- en: Exchanges may rely on bilateral trading or order-driven systems, where buy and
    sell orders are matched according to certain rules. Price formation may occur
    through auctions, such as in the **New York Stock Exchange** (**NYSE**), where
    the highest bid and lowest offer are matched, or through dealers who buy from
    sellers and sell to buyers.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 交易所可能依赖双边交易或以订单为驱动的系统，根据某些规则匹配买入和卖出订单。价格形成可能通过拍卖进行，例如在纽约证券交易所（NYSE）中，最高出价和最低报价被匹配，或通过买家从卖家购买然后卖给买家的交易商进行。
- en: Many exchanges use intermediaries that provide liquidity, that is, the ability
    to trade, by making markets in certain securities. The NYSE, for example, usually
    has a single designated market maker who ensures orderly trading for each security,
    while the **National Association of Securities Dealers Automated Quotations**
    (**Nasdaq**) has several. Intermediaries can act as dealers that trade as principals
    on their own behalf, or brokers that trade as agents on behalf of others.
  id: totrans-39
  prefs: []
  type: TYPE_NORMAL
  zh: 许多交易所使用提供流动性的中间人，即通过在某些证券中做市来进行交易的能力。例如，纽约证券交易所通常有一个指定的市场主持人，他确保每个证券的交易有序进行，而**全国证券交易商自动报价系统**（**Nasdaq**）有几个。中间人可以充当作为自己代理人交易的交易商，也可以充当作为他人代理人交易的经纪人。
- en: Exchanges used to be member-owned but have often moved to corporate ownership
    as market reforms have increased competition. The NYSE dates back to 1792, whereas
    the Nasdaq started 1971 as the world's first electronic stock market and took
    over most stock trades that had been executed OTC. In US equity markets alone,
    trading is fragmented across 13 exchanges and over 40 alternative trading venues,
    each reporting trades to the consolidated tape, but at different latencies.
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 交易所过去是成员所有的，但随着市场改革的加剧，它们经常转为公司所有。纽约证券交易所可以追溯到1792年，而纳斯达克于1971年开始，是世界上第一个电子股票交易市场，并接管了大多数曾在场外交易的股票交易。仅在美国股票市场，交易分散在13个交易所和40多个另类交易场所，每个都向综合带报告交易，但延迟不同。
- en: Types of orders
  id: totrans-41
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 订单类型
- en: Traders can place various types of buy or sell orders. Some orders guarantee
    immediate execution, while others may state a price threshold or other conditions
    that trigger execution. Orders are typically valid for the same trading day unless
    specified otherwise.
  id: totrans-42
  prefs: []
  type: TYPE_NORMAL
  zh: 交易员可以提交各种类型的买入或卖出订单。一些订单保证立即执行，而另一些可能规定价格阈值或其他触发执行的条件。订单通常仅在同一交易日有效，除非另有规定。
- en: A market order guarantees immediate execution of the order upon arrival to the
    trading venue, at the price that prevails at that moment. In contrast, a limit
    order only executes if the market price is higher (lower) than the limit for a
    sell (buy) limit order. A stop order, in turn, only becomes active when the market
    price rises above (falls below) a specified price for a buy (sell) stop order.
    A buy stop order can be used to limit losses of short sales. Stop orders may also
    have limits.
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 市场订单保证在到达交易场所时立即执行订单，以那一刻的价格为准。相比之下，限价订单仅在市场价格高于（低于）卖出（买入）限价订单的限价时执行。转而停止订单仅在市场价格上升到（下跌到）买入（卖出）停止订单的指定价格时才变为活动状态。购买停止订单可用于限制空头交易的损失。停止订单也可能有限制。
- en: Numerous other conditions can be attached to orders—all or none orders prevent
    partial execution and are only filled if a specified number of shares is available,
    and can be valid for the day or longer. They require special handling and are
    not visible to market participants. Fill or kill orders also prevent partial execution
    but cancel if not executed immediately. Immediate or cancel orders immediately
    buy or sell the number of shares that are available and cancel the remainder.
    Not-held orders allow the broker to decide on the time and price of execution.
    Finally, the market on open/close orders executes on or near the opening or closing
    of the market. Partial executions are allowed.
  id: totrans-44
  prefs: []
  type: TYPE_NORMAL
  zh: 订单可能附加有许多其他条件——全或无订单防止部分执行，仅在指定数量的股票可用时才会被填充，并且可以在当天或更长时间内有效。它们需要特殊处理，对市场参与者不可见。立即成交或取消订单也防止部分执行，但如果未立即执行则取消。立即取消订单立即买入或卖出可用的股票数量并取消剩余部分。不持有订单允许经纪人决定执行的时间和价格。最后，市场开盘/收盘订单在市场开盘或收盘时或附近执行。允许部分执行。
- en: Working with order book data
  id: totrans-45
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 处理订单簿数据
- en: The primary source of market data is the order book, which is continuously updated
    in real-time throughout the day to reflect all trading activity. Exchanges typically
    offer this data as a real-time service and may provide some historical data for
    free.
  id: totrans-46
  prefs: []
  type: TYPE_NORMAL
  zh: 市场数据的主要来源是订单簿，它在整天实时不断更新以反映所有交易活动。 交易所通常将此数据作为实时服务提供，并可能免费提供一些历史数据。
- en: The trading activity is reflected in numerous messages about trade orders sent
    by market participants. These messages typically conform to the electronic **Financial
    Information eXchange** (**FIX**) communications protocol for real-time exchange
    of securities transactions and market data or a native exchange protocol.
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 交易活动体现在市场参与者发送的大量有关交易订单的消息中。 这些消息通常符合用于实时交换证券交易和市场数据的电子**金融信息交换**（**FIX**）通信协议或本地交换协议的语法。
- en: The FIX protocol
  id: totrans-48
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: FIX协议
- en: Just like SWIFT is the message protocol for back-office (example, for trade-settlement)
    messaging, the FIX protocol is the de facto messaging standard for communication
    before and during, trade execution between exchanges, banks, brokers, clearing
    firms, and other market participants. Fidelity Investments and Salomon Brothers
    introduced FIX in 1992 to facilitate electronic communication between broker-dealers
    and institutional clients who by then exchanged information over the phone.
  id: totrans-49
  prefs: []
  type: TYPE_NORMAL
  zh: 就像SWIFT是后台（例如，用于交易结算）消息传递的消息协议一样，FIX协议是交易执行之前和之间的默认消息标准，在交易所、银行、经纪商、结算公司和其他市场参与者之间的通信中。
    富达投资和所罗门兄弟公司于1992年引入了FIX，以促进经纪商和机构客户之间的电子通信，当时他们通过电话交换信息。
- en: It became popular in global equity markets before expanding into foreign exchange,
    fixed income and derivatives markets, and further into post-trade to support straight-through
    processing. Exchanges provide access to FIX messages as a real-time data feed
    that is parsed by algorithmic traders to track market activity and, for example,
    identify the footprint of market participants and anticipate their next move.
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 它在全球股票市场上变得流行，然后扩展到外汇、固定收益和衍生品市场，进一步扩展到后交易以支持直通处理。 交易所提供对FIX消息的访问作为实时数据提要，由算法交易员解析以跟踪市场活动，并且例如识别市场参与者的踪迹并预测其下一步行动。
- en: The sequence of messages allows for the reconstruction of the order book. The
    scale of transactions across numerous exchanges creates a large amount (~10 TB)
    of unstructured data that is challenging to process and, hence, can be a source
    of competitive advantage.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 消息序列允许重建订单簿。 跨多个交易所的交易规模产生了大量（~10 TB）难以处理的非结构化数据，因此可以成为竞争优势的来源。
- en: The FIX protocol, currently at version 5.0, is a free and open standard with
    a large community of affiliated industry professionals. It is self-describing
    like the more recent XML, and a FIX session is supported by the underlying **Transmission
    Control Protocol** (**TCP**) layer. The community continually adds new functionality.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: FIX协议目前版本为5.0，是一个具有庞大相关行业专业人士社区的免费开放标准。 它像更近期的XML一样是自描述的，FIX会话由底层的**传输控制协议**（**TCP**）层支持。
    社区不断添加新功能。
- en: 'The protocol supports pipe-separated key-value pairs, as well as a tag-based
    FIXML syntax. A sample message that requests a server login would look as follows:'
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 该协议支持管道分隔的键值对，以及基于标签的FIXML语法。 请求服务器登录的示例消息如下所示：
- en: '[PRE0]'
  id: totrans-54
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: There are a few open source FIX implementations in python that can be used to
    formulate and parse FIX messages. Interactive Brokers offer a FIX-based **computer-to-computer
    interface** (**CTCI**) for automated trading (see the resources section for this
    chapter in the GitHub repo).
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 有一些用于制定和解析FIX消息的Python开源FIX实现可以使用。 交互经纪商提供了用于自动交易的基于FIX的**计算机对计算机接口**（**CTCI**）（请参见GitHub存储库中本章的资源部分）。
- en: Nasdaq TotalView-ITCH Order Book data
  id: totrans-56
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 纳斯达克TotalView-ITCH订单簿数据
- en: While FIX has a dominant large market share, exchanges also offer native protocols. The
    Nasdaq offers a TotalView ITCH direct data-feed protocol that allows subscribers
    to track individual orders for equity instruments from placement to execution
    or cancellation.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然FIX具有主导的大市场份额，但交易所也提供本地协议。 纳斯达克提供了一种TotalView ITCH直接数据提要协议，允许订阅者跟踪股票工具的单个订单，从下单到执行或取消。
- en: As a result, it allows for the reconstruction of the order book that keeps track
    of the list of active-limit buy and sell orders for a specific security or financial
    instrument. The order book reveals the market depth throughout the day by listing
    the number of shares being bid or offered at each price point. It may also identify
    the market participant responsible for specific buy and sell orders unless it
    is placed anonymously. Market depth is a key indicator of liquidity and the potential
    price impact of sizable market orders.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，它允许重建订单簿，跟踪特定证券或金融工具的活跃限价买入和卖出订单列表。订单簿通过列出每个价格点上投标或报价的股份数量来显示全天市场深度。它还可能识别特定买入和卖出订单的市场参与者，除非它是匿名下达的。市场深度是流动性的关键指标，以及大额市场订单的潜在价格影响。
- en: In addition to matching market and limit orders, the Nasdaq also operates auctions
    or crosses that execute a large number of trades at market opening and closing.
    Crosses are becoming more important as passive investing continues to grow and
    traders look for opportunities to execute larger blocks of stock. TotalView also
    disseminates the **Net Order Imbalance Indicator **(**NOII**) for the Nasdaq opening
    and closing crosses and Nasdaq IPO/Halt cross.
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 除了匹配市价和限价订单，纳斯达克还进行市场开盘和闭市时执行大量交易的拍卖或交叉交易。随着被动投资继续增长，交叉交易变得越来越重要，交易员寻找执行更大块的股票的机会。TotalView
    还发布了纳斯达克开市和闭市以及纳斯达克 IPO/停牌交叉交易的**净订单失衡指示器**（NOII）。
- en: Parsing binary ITCH messages
  id: totrans-60
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 解析二进制 ITCH 消息
- en: The ITCH v5.0 specification declares over 20 message types related to system
    events, stock characteristics, the placement and modification of limit orders,
    and trade execution. It also contains information about the net order imbalance
    before the open and closing cross.
  id: totrans-61
  prefs: []
  type: TYPE_NORMAL
  zh: ITCH v5.0 规范声明了与系统事件、股票特征、限价订单的下达和修改以及交易执行相关的 20 多种消息类型。它还包含有关开市和闭市前净订单失衡的信息。
- en: The Nasdaq offers samples of daily binary files for several months. The GitHub
    repository for this chapter contains a notebook, `build_order_book.ipynb` that
    illustrates how to parse a sample file of ITCH messages and reconstruct both the
    executed trades and the order book for any given tick.
  id: totrans-62
  prefs: []
  type: TYPE_NORMAL
  zh: 纳斯达克提供了数月的每日二进制文件样本。本章的 GitHub 存储库包含一个名为 `build_order_book.ipynb` 的笔记本，演示了如何解析
    ITCH 消息的示例文件，并重建任何给定 tick 的执行交易和订单簿。
- en: 'The following table shows the frequency of the most common message types for
    the sample file date March 29, 2018:'
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 以下表格显示了样本文件日期为 2018 年 3 月 29 日时最常见消息类型的频率：
- en: '| **Message type** | **Order book impact** | **Number of messages** |'
  id: totrans-64
  prefs: []
  type: TYPE_TB
  zh: '| **消息类型** | **订单簿影响** | **消息数量** |'
- en: '| `A` | New unattributed limit order | 136,522,761 |'
  id: totrans-65
  prefs: []
  type: TYPE_TB
  zh: '| `A` | 新的未归属限价订单 | 136,522,761 |'
- en: '| `D` | Order canceled | 133,811,007 |'
  id: totrans-66
  prefs: []
  type: TYPE_TB
  zh: '| `D` | 订单取消 | 133,811,007 |'
- en: '| `U` | Order canceled and replaced | 21,941,015 |'
  id: totrans-67
  prefs: []
  type: TYPE_TB
  zh: '| `U` | 订单取消并替换 | 21,941,015 |'
- en: '| `E` | Full or partial execution; possibly multiple messages for the same
    original order | 6,687,379 |'
  id: totrans-68
  prefs: []
  type: TYPE_TB
  zh: '| `E` | 完全或部分执行；可能有多条针对同一原始订单的消息 | 6,687,379 |'
- en: '| `X` | Modified after partial cancellation | 5,088,959 |'
  id: totrans-69
  prefs: []
  type: TYPE_TB
  zh: '| `X` | 部分取消后修改 | 5,088,959 |'
- en: '| `F` | Add attributed order | 2,718,602 |'
  id: totrans-70
  prefs: []
  type: TYPE_TB
  zh: '| `F` | 添加归属订单 | 2,718,602 |'
- en: '| `P` | Trade Message (non-cross) | 1,120,861 |'
  id: totrans-71
  prefs: []
  type: TYPE_TB
  zh: '| `P` | 交易消息（非交叉） | 1,120,861 |'
- en: '| `C` | Executed in whole or in part at a price different from the initial
    display price | 157,442 |'
  id: totrans-72
  prefs: []
  type: TYPE_TB
  zh: '| `C` | 在不同于初始显示价格的价格上全部或部分执行 | 157,442 |'
- en: '| `Q` | Cross Trade Message | 17,233 |'
  id: totrans-73
  prefs: []
  type: TYPE_TB
  zh: '| `Q` | 交叉交易消息 | 17,233 |'
- en: 'For each message, the specification lays out the components and their respective
    length and data types:'
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 对于每条消息，规范列出了组件及其相应的长度和数据类型：
- en: '| **Name** | **Offset** | **Length** | **Value** | **Notes** |'
  id: totrans-75
  prefs: []
  type: TYPE_TB
  zh: '| **名称** | **偏移量** | **长度** | **值** | **注释** |'
- en: '| Message type | 0 | 1 | F | Add Order MPID attribution message |'
  id: totrans-76
  prefs: []
  type: TYPE_TB
  zh: '| 消息类型 | 0 | 1 | F | 添加订单 MPID 归属消息 |'
- en: '| Stock locate | 1 | 2 | Integer | Locate code identifying the security |'
  id: totrans-77
  prefs: []
  type: TYPE_TB
  zh: '| 股票定位 | 1 | 2 | 整数 | 标识证券的定位代码 |'
- en: '| Tracking number | 3 | 2 | Integer | Nasdaq internal tracking number |'
  id: totrans-78
  prefs: []
  type: TYPE_TB
  zh: '| 跟踪编号 | 3 | 2 | 整数 | 纳斯达克内部跟踪编号 |'
- en: '| Timestamp | 5 | 6 | Integer | Nanoseconds since midnight |'
  id: totrans-79
  prefs: []
  type: TYPE_TB
  zh: '| 时间戳 | 5 | 6 | 整数 | 自午夜以来的纳秒数 |'
- en: '| Order reference number | 11 | 8 | Integer | Unique reference number of the
    new order |'
  id: totrans-80
  prefs: []
  type: TYPE_TB
  zh: '| 订单参考编号 | 11 | 8 | 整数 | 新订单的唯一参考编号 |'
- en: '| Buy/sell indicator  | 19 | 1 | Alpha | The type of order: B = Buy Order,
    S = Sell Order |'
  id: totrans-81
  prefs: []
  type: TYPE_TB
  zh: '| 买卖指示符  | 19 | 1 | 字母 | 订单类型：B = 买入订单，S = 卖出订单 |'
- en: '| Shares | 20 | 4 | Integer | Number of shares for the order being added to
    the book |'
  id: totrans-82
  prefs: []
  type: TYPE_TB
  zh: '| 股票 | 20 | 4 | 整数 | 添加到订单簿的订单股票数量 |'
- en: '| Stock | 24 | 8 | Alpha | Stock symbol, right-padded with spaces |'
  id: totrans-83
  prefs: []
  type: TYPE_TB
  zh: '| 股票 | 24 | 8 | Alpha | 股票符号，右侧填充空格 |'
- en: '| Price | 32 | 4 | Price (4) | The display price of the new order |'
  id: totrans-84
  prefs: []
  type: TYPE_TB
  zh: '| 价格 | 32 | 4 | 价格（4）| 新订单的显示价格 |'
- en: '| Attribution | 36 | 4 | Alpha | Nasdaq Market participant identifier associated
    with the order |'
  id: totrans-85
  prefs: []
  type: TYPE_TB
  zh: '| 归属 | 36 | 4 | Alpha | 与订单相关联的纳斯达克市场参与者标识符 |'
- en: Python provides the `struct` module to parse binary data using format strings
    that identify the message elements by indicating length and type of the various
    components of the byte string as laid out in the specification.
  id: totrans-86
  prefs: []
  type: TYPE_NORMAL
  zh: Python 提供了 `struct` 模块，通过格式字符串来解析二进制数据，该格式字符串通过指定字节字符串的各个组件的长度和类型来标识消息元素，按照规范中的排列方式。
- en: 'Let''s walk through the critical steps to parse the trading messages and reconstruct
    the order book:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们逐步解析交易消息并重建订单簿的关键步骤：
- en: 'The ITCH parser relies on the message specifications provided as a `.csv` file
    (created by `create_message_spec.py`) and assembles format strings according to
    the `formats` dictionary:'
  id: totrans-88
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ITCH 解析器依赖于作为`.csv`文件提供的消息规范（由`create_message_spec.py`创建），并根据`formats`字典组装格式字符串：
- en: '[PRE1]'
  id: totrans-89
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The parser translates the message specs into format strings and `namedtuples`
    that capture the message content:'
  id: totrans-90
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 解析器将消息规范转换为格式字符串和捕获消息内容的`namedtuples`：
- en: '[PRE2]'
  id: totrans-91
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Fields of the `alpha` type require post-processing as defined in the `format_alpha` function:'
  id: totrans-92
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`alpha` 类型的字段需要按照`format_alpha`函数中定义的进行后处理：'
- en: '[PRE3]'
  id: totrans-93
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'The binary file for a single day contains over 300,000,000 messages worth over
    9 GB. The script appends the parsed result iteratively to a file in the fast `HDF5` format
    to avoid memory constraints (see last section in this chapter for more on this
    format). The following (simplified) code processes the binary file and produces
    the parsed orders stored by message type:'
  id: totrans-94
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 单日的二进制文件包含超过 3 亿条消息，总计超过 9 GB。该脚本会将解析的结果迭代地附加到以快速的 `HDF5` 格式存储的文件中，以避免内存限制（有关此格式的更多信息，请参阅本章的最后一节）。以下（简化的）代码处理二进制文件，并生成按消息类型存储的解析订单：
- en: '[PRE4]'
  id: totrans-95
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'As expected, a small number of the over 8,500 equity securities traded on this
    day account for most trades:'
  id: totrans-96
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 预料之中，这一天交易的 8500 多只股票中的一小部分占了大部分交易：
- en: '[PRE5]'
  id: totrans-97
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'We get the following plot for the graph:'
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 我们得到了以下图形的绘制：
- en: '![](img/8c45c4c9-a8f7-4de6-a016-5477c54496ff.png)'
  id: totrans-99
  prefs: []
  type: TYPE_IMG
  zh: '![](img/8c45c4c9-a8f7-4de6-a016-5477c54496ff.png)'
- en: Reconstructing trades and the order book
  id: totrans-100
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 重建交易和订单簿
- en: The parsed messages allow us to rebuild the order flow for the given day. The
    `'R'` message type contains a listing of all stocks traded during a given day,
    including information about **initial public offerings** (**IPOs**) and trading
    restrictions.
  id: totrans-101
  prefs: []
  type: TYPE_NORMAL
  zh: 解析的消息允许我们重建给定日期的订单流。`'R'` 消息类型包含在给定日期内交易的所有股票列表，包括有关**首次公开募股**（**IPOs**）和交易限制的信息。
- en: Throughout the day, new orders are added, and orders that are executed and canceled
    are removed from the order book. The proper accounting for messages that reference
    orders placed on a prior date would require tracking the order book over multiple
    days, but we are ignoring this aspect here.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: 在一天的交易过程中，会添加新订单，并删除执行和取消的订单。对于引用前一日期放置的订单的消息，进行适当的会计处理需要跟踪多天的订单簿，但我们在此忽略了此方面的内容。
- en: 'The `get_messages()` function illustrates how to collect the orders for a single
    stock that affects trading (refer to the ITCH specification for details about
    each message, slightly simplified, see notebook):'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: '`get_messages()` 函数说明了如何收集影响交易的单一股票的订单（有关每个消息的详细信息，请参阅 ITCH 规范，略有简化，请参阅笔记本）：'
- en: '[PRE6]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Reconstructing successful trades, that is, orders that are executed as opposed
    to those that were canceled from trade-related message types, `C`, `E`, `P`, and
    `Q`, is relatively straightforward:'
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 重建成功的交易，即作为与被取消的订单相对的订单的交易相关消息，`C`、`E`、`P` 和 `Q`，相对比较简单：
- en: '[PRE7]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The order book keeps track of limit orders, and the various price levels for
    buy and sell orders constitute the depth of the order book. To reconstruct the
    order book for a given level of depth requires the following steps:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 订单簿跟踪限价订单，并且买入和卖出订单的各种价格水平构成了订单簿的深度。要重建给定深度级别的订单簿，需要以下步骤：
- en: 'The `add_orders()` function accumulates sell orders in ascending, and buy orders
    in descending order for a given timestamp up to the desired level of depth:'
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: '`add_orders()` 函数累积卖单按升序排列，买单按降序排列，以给定时间戳为基础直至达到所需的深度级别：'
- en: '[PRE8]'
  id: totrans-109
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'We iterate over all ITCH messages and process orders and their replacements
    as required by the specification:'
  id: totrans-110
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 我们遍历所有ITCH消息，并根据规范要求处理订单及其替换：
- en: '[PRE9]'
  id: totrans-111
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'The number of orders at different price levels, highlighted in the following
    screenshot using different intensities for buy and sell orders, visualizes the
    depth of liquidity at any given point in time. The left panel shows how the distribution
    of limit order prices was weighted toward buy orders at higher prices. The right
    panel plots the evolution of limit orders and prices throughout the trading day:
    the dark line tracks the prices for executed trades during market hours, whereas
    the red and blue dots indicate individual limit orders on a per-minute basis (see
    notebook for details):'
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 不同价格水平上的订单数量，在以下截图中使用不同强度的颜色突出显示买入和卖出订单的深度流动性。左侧面板显示了限价订单价格分布偏向于更高价格的买单。右侧面板绘制了交易日内限价订单和价格的演变：深色线跟踪了市场交易小时内的执行交易价格，而红色和蓝色点表示每分钟的限价订单（详见笔记本）：
- en: '![](img/2f64334a-4a92-4902-bf8d-d5a61104c0a5.png)'
  id: totrans-113
  prefs: []
  type: TYPE_IMG
  zh: '![](img/2f64334a-4a92-4902-bf8d-d5a61104c0a5.png)'
- en: Regularizing tick data
  id: totrans-114
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 规范化tick数据
- en: The trade data is indexed by nanoseconds and is very noisy. The bid-ask bounce,
    for instance, causes the price to oscillate between the bid and ask prices when
    trade initiation alternates between buy and sell market orders. To improve the
    noise-signal ratio and improve the statistical properties, we need to resample
    and regularize the tick data by aggregating the trading activity.
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
  zh: 交易数据按纳秒索引，噪音很大。例如，出现买卖市价订单交替引发的买卖跳动，导致价格在买入和卖出价格之间波动。为了提高噪声-信号比并改善统计性能，我们需要重新采样和规范化tick数据，通过聚合交易活动来实现。
- en: We typically collect the open (first), low, high, and closing (last) price for
    the aggregated period, alongside the **volume-weighted average price** (**VWAP**),
    the number of shares traded, and the timestamp associated with the data.
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，我们收集聚合期间的开盘（第一个）、最低、最高和收盘（最后）价格，以及**成交量加权平均价格**（**VWAP**）、交易的股数和与数据相关的时间戳。
- en: See the `normalize_tick_data.ipynb` notebook in the folder for this chapter
    on GitHub for additional detail.
  id: totrans-117
  prefs: []
  type: TYPE_NORMAL
  zh: 在此章节的 GitHub 文件夹中查看名为`normalize_tick_data.ipynb`的笔记本，以获取额外的细节。
- en: Tick bars
  id: totrans-118
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Tick柱状图
- en: 'A plot of the raw tick price and volume data for `AAPL` looks as follows:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
  zh: '`AAPL`的原始tick价格和成交量数据的图表如下：'
- en: '[PRE10]'
  id: totrans-120
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'We get the following plot for the preceding code:'
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 我们得到了前述代码的下列图表：
- en: '![](img/5a63ce51-4fad-4eba-b448-ae98df632403.png)'
  id: totrans-122
  prefs: []
  type: TYPE_IMG
  zh: '![](img/5a63ce51-4fad-4eba-b448-ae98df632403.png)'
- en: 'The tick returns are far from normally distributed, as evidenced by the low
    p-value of `scipy.stats.normaltest`:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
  zh: 由于`scipy.stats.normaltest`的p值较低，可以看出tick返回远非正态分布：
- en: '[PRE11]'
  id: totrans-124
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Time bars
  id: totrans-125
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 时间柱状图
- en: 'Time bars involve trade aggregation by period:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 时间柱状图涉及按周期聚合交易：
- en: '[PRE12]'
  id: totrans-127
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'We can display the result as a price-volume chart:'
  id: totrans-128
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以将结果显示为价格-成交量图：
- en: '[PRE13]'
  id: totrans-129
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'We get the following plot for the preceding code:'
  id: totrans-130
  prefs: []
  type: TYPE_NORMAL
  zh: 我们得到了前述代码的下列图表：
- en: '![](img/cdd1c52c-efd5-4cb4-b3bd-ccb428d1d8a3.png)'
  id: totrans-131
  prefs: []
  type: TYPE_IMG
  zh: '![](img/cdd1c52c-efd5-4cb4-b3bd-ccb428d1d8a3.png)'
- en: 'Or as a candlestick chart using the `bokeh` plotting library:'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 或者使用`bokeh`绘图库绘制蜡烛图：
- en: '[PRE14]'
  id: totrans-133
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Take a look at the following screenshot:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 请看以下截图：
- en: '![](img/4bf657de-4968-44c5-a739-513ba1196957.png)'
  id: totrans-135
  prefs: []
  type: TYPE_IMG
  zh: '![](img/4bf657de-4968-44c5-a739-513ba1196957.png)'
- en: Plotting AAPL Candlestick
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 绘制AAPL蜡烛图
- en: Volume bars
  id: totrans-137
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 成交量柱状图
- en: Time bars smooth some of the noise contained in the raw tick data but may fail
    to account for the fragmentation of orders. Execution-focused algorithmic trading
    may aim to match the **volume weighted average price** (**VWAP**) over a given
    period, and will divide a single order into multiple trades and place orders according
    to historical patterns. Time bars would treat the same order differently, even
    though no new information has arrived in the market.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 时间柱状图平滑了原始tick数据中的一些噪音，但可能未能解决订单碎片化的问题。以执行为中心的算法交易可能旨在在给定期间内匹配**成交量加权平均价格**（**VWAP**），并将单个订单分成多个交易，并根据历史模式下订单。时间柱状图会对相同的订单进行不同处理，即使市场没有新的信息到达。
- en: 'Volume bars offer an alternative by aggregating trade data according to volume.
    We can accomplish this as follows:'
  id: totrans-139
  prefs: []
  type: TYPE_NORMAL
  zh: 成交量柱状图提供了一种根据成交量聚合交易数据的替代方法。我们可以按以下方式实现：
- en: '[PRE15]'
  id: totrans-140
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'We get the following plot for the preceding code:'
  id: totrans-141
  prefs: []
  type: TYPE_NORMAL
  zh: 我们得到了前述代码的下列图表：
- en: '![](img/3c287a33-d849-40bb-baa5-2fa25aafb781.png)'
  id: totrans-142
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3c287a33-d849-40bb-baa5-2fa25aafb781.png)'
- en: Dollar bars
  id: totrans-143
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 美元柱状图
- en: When asset prices change significantly or after stock splits, the value of a
    given amount of shares changes. Volume bars do not correctly reflect this and
    can hamper the comparison of trading behavior for different periods that reflect
    such changes. In these cases, the volume bar method should be adjusted to utilize
    the product of shares and price to produce dollar bars.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 当资产价格发生显着变化或股票拆分后，给定数量股票的价值也会发生变化。 Volume bars 不会正确反映这一点，并且可能妨碍对反映这些变化的不同期间的交易行为进行比较。
    在这些情况下，应调整 volume bar 方法，以利用股票和价格的乘积来生成美元 bars。
- en: API access to market data
  id: totrans-145
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 市场数据的 API 访问
- en: There are several options to access market data via API using Python. We first
    present a few sources built into the `pandas` library. Then we briefly introduce
    the trading platform Quantopian, the data provider Quandl and the backtesting
    library that we will use later in the book, and list several additional options
    to access various types of market data. The folder directory `data_providers` on
    GitHub contains several notebooks that illustrate the usage of these options.
  id: totrans-146
  prefs: []
  type: TYPE_NORMAL
  zh: 有几种选项可以使用 Python 通过 API 访问市场数据。 我们首先介绍了内置于 `pandas` 库中的几个数据源。 然后，我们简要介绍了交易平台
    Quantopian，数据提供商 Quandl 以及本书稍后将使用的回测库，并列出了访问各种类型市场数据的几种其他选项。 在 GitHub 上的文件夹目录
    `data_providers` 包含了几个示例笔记本，演示了这些选项的使用方法。
- en: Remote data access using pandas
  id: totrans-147
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 pandas 进行远程数据访问
- en: The `pandas` library enables access to data displayed on websites using the **`read_html`** function
    and access to the API endpoints of various data providers through the related `pandas-datareader` library.
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: '`pandas` 库使用 **`read_html`** 函数访问网站上显示的数据，并通过相关的 `pandas-datareader` 库访问各种数据提供商的
    API 端点。'
- en: Reading html tables
  id: totrans-149
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 阅读 HTML 表格
- en: 'The download of the content of one or more `html` tables works as follows,
    for instance for the constituents of the `S&P500` index from Wikipedia:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 下载一个或多个 `html` 表格的内容的方法如下，例如从 Wikipedia 获取 `S&P500` 指数的成分：
- en: '[PRE16]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: pandas-datareader for market data
  id: totrans-152
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 用于市场数据的 pandas-datareader
- en: 'pandas used to facilitate access to data providers'' APIs directly, but this
    functionality has moved to the related `pandas-datareader` library. The stability
    of the APIs varies with provider policies, and as of June 2o18 at version 0.7,
    the following sources are available:'
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
  zh: '`pandas` 曾用于直接便捷访问数据提供商的 API，但该功能已迁移到相关的 `pandas-datareader` 库。 API 的稳定性因提供商政策而异，在
    2018 年 6 月的版本 0.7 中，以下数据源可用：'
- en: '| **Source** | **Scope** | **Comment** |'
  id: totrans-154
  prefs: []
  type: TYPE_TB
  zh: '| **来源** | **范围** | **注释** |'
- en: '| Yahoo! Finance | EOD price, dividends, split data for stock and FX pairs
    | Unstable |'
  id: totrans-155
  prefs: []
  type: TYPE_TB
  zh: '| Yahoo! Finance | 股票和外汇对的 EOD 价格、分红、拆分数据 | 不稳定 |'
- en: '| Tiingo | EOD prices on equities, mutual funds, and ETFs | Free registration
    required |'
  id: totrans-156
  prefs: []
  type: TYPE_TB
  zh: '| Tiingo | 股票、共同基金和交易所交易基金的 EOD 价格 | 需要免费注册 |'
- en: '| The **Investors Exchange** (**IEX**) | Historical stock prices, order-book
    data | Limited to five years |'
  id: totrans-157
  prefs: []
  type: TYPE_TB
  zh: '| **投资者交易所**（**IEX**） | 历史股票价格，订单簿数据 | 限制为五年 |'
- en: '| Robinhood | EOD equity prices | Limited to one year |'
  id: totrans-158
  prefs: []
  type: TYPE_TB
  zh: '| Robinhood | EOD 股票价格 | 限制为一年 |'
- en: '| Quandl | Marketplace for a broad range of asset prices | Premium data require
    a subscription |'
  id: totrans-159
  prefs: []
  type: TYPE_TB
  zh: '| Quandl | 各种资产价格的市场 | 高级数据需要订阅 |'
- en: '| Nasdaq | Latest ticker symbols traded on Nasdaq with some additional info
    |  |'
  id: totrans-160
  prefs: []
  type: TYPE_TB
  zh: '| 纳斯达克 | 最新在纳斯达克交易的股票代码以及一些额外信息 |  |'
- en: '| Stooq | Some stock market index data |  |'
  id: totrans-161
  prefs: []
  type: TYPE_TB
  zh: '| Stooq | 一些股票市场指数数据 |  |'
- en: '| MOEX | Moscow Stock Exchange Data |  |'
  id: totrans-162
  prefs: []
  type: TYPE_TB
  zh: '| MOEX | 莫斯科证券交易所数据 |  |'
- en: '| Alpha Vantage | EOD stock prices and FX pairs |  |'
  id: totrans-163
  prefs: []
  type: TYPE_TB
  zh: '| Alpha Vantage | EOD 股票价格和外汇对 |  |'
- en: '| Fama/French | Factor returns and research portfolios from the FF Data Library
    |  |'
  id: totrans-164
  prefs: []
  type: TYPE_TB
  zh: '| Fama/French | 来自 FF 数据库的因子收益和研究组合 |  |'
- en: 'Access and retrieval of data follow a similar API for all sources, as illustrated
    for Yahoo! Finance:'
  id: totrans-165
  prefs: []
  type: TYPE_NORMAL
  zh: 访问和检索数据的方式对所有数据源都是相似的，如 Yahoo! Finance 所示：
- en: '[PRE17]'
  id: totrans-166
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: The Investor Exchange
  id: totrans-167
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 投资者交易所
- en: IEX is an alternative exchange started in response to the HFT controversy and
    portrayed in Michael Lewis' controversial Flash Boys. It aims to slow down the
    speed of trading to create a more level playing field and has been growing rapidly
    since launch in 2016 while still small with a market share of around 2.5% in June
    2018.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: IEX 是作为对高频交易争议的回应而启动的另一种交易所，出现在迈克尔·刘易斯有争议的《闪 Boys》中。 它旨在减缓交易速度，创造一个更公平的竞争环境，并自
    2016 年推出以来一直在迅速增长，但在 2018 年 6 月仍然很小，市场份额约为 2.5％。
- en: 'In addition to historical EOD price and volume data, IEX provides real-time
    depth of book quotations that offer an aggregated size of orders by price and
    side. This service also includes last trade price and size information:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 除了历史结束日价格和成交量数据外，IEX还提供实时的订单簿深度报价，通过价格和方向聚合订单的规模。该服务还包括最后成交价和规模信息：
- en: '[PRE18]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: See additional examples in the `datareader.ipynb` notebook.
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 在`datareader.ipynb`笔记本中查看更多示例。
- en: Quantopian
  id: totrans-172
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Quantopian
- en: Quantopian is an investment firm that offers a research platform to crowd-source
    trading algorithms. Upon free registration, it enables members to research trading
    ideas using a broad variety of data sources. It also offers an environment to
    backtest the algorithm against historical data, as well forward-test it out-of-sample
    with live data. It awards investment allocations for top-performing algorithms
    whose authors are entitled to a 10% (at time of writing) profit share.
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: Quantopian是一家投资公司，提供一个研究平台来集体开发交易算法。免费注册后，它使会员能够使用各种数据源研究交易想法。它还提供了一个环境，用于对算法进行历史数据的回测，以及使用实时数据进行样本外测试。对于表现最佳的算法，它授予投资额度，其作者有权获得10%的利润份额（在撰写本文时）。
- en: The Quantopian research platform consists of a Jupyter Notebook environment
    for research and development for alpha factor research and performance analysis.
    There is also an **Interactive Development Environment** (**IDE**) for coding
    algorithmic strategies and backtesting the result using historical data since
    2002 with minute-bar frequency.
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: Quantopian研究平台包括用于Alpha因子研究和绩效分析的Jupyter Notebook环境。还有一个用于编写算法策略和使用自2002年以来带有分钟柱频率的历史数据回测结果的**交互式开发环境**（**IDE**）。
- en: Users can also simulate algorithms with live data, which is known as paper trading.
    Quantopian provides various market datasets, including US equity and futures price
    and volume data at a one-minute frequency, as well as US equity corporate fundamentals,
    and integrates numerous alternative datasets.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: 用户还可以使用实时数据模拟算法，这称为纸上交易。Quantopian提供各种市场数据集，包括美国股票和期货价格和成交量数据，频率为一分钟，以及美国股票公司基本面数据，并集成了众多替代数据集。
- en: We will dive into the Quantopian platform in much more detail in [Chapter 4](31520630-da72-4cf6-8d84-6a74b7f4f259.xhtml),
    *Alpha Factor Research* and rely on its functionality throughout the book, so
    feel free to open an account right away (see GitHub repo for more details).
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在[第4章](31520630-da72-4cf6-8d84-6a74b7f4f259.xhtml)中更详细地介绍Quantopian平台，*Alpha因子研究*并且在整本书中依赖其功能，所以随时打开一个账户（有关更多详细信息，请参阅GitHub
    repo）。
- en: Zipline
  id: totrans-177
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Zipline
- en: Zipline is the algorithmic trading library that powers the Quantopian backtesting
    and live-trading platform. It is also available offline to develop a strategy
    using a limited number of free data bundles that can be ingested and used to test
    the performance of trading ideas before porting the result to the online Quantopian
    platform for paper and live trading.
  id: totrans-178
  prefs: []
  type: TYPE_NORMAL
  zh: Zipline是算法交易库，为Quantopian回测和实时交易平台提供支持。它也可以离线使用，使用有限数量的免费数据包来开发策略，这些数据包可以被摄取并用于测试交易想法的表现，然后将结果转移到在线Quantopian平台进行纸上和实时交易。
- en: The following code illustrates how `zipline` permits us to access daily stock
    data for a range of companies. You can run `zipline` scripts in the Jupyter Notebook
    using the magic function of the same name.
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码说明了`zipline`允许我们访问一系列公司的每日股票数据。您可以在Jupyter Notebook中使用相同名称的魔术函数运行`zipline`脚本。
- en: 'First, you need to initialize the context with the desired security symbols.
    We''ll also use a counter variable. Then `zipline` calls `handle_data`, where
    we use the `data.history()` method to look back a single period and append the
    data for the last day to a `.csv` file:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，您需要使用所需的安全符号初始化上下文。我们还将使用一个计数器变量。然后`zipline`调用`handle_data`，在其中我们使用`data.history()`方法回顾一个单一周期，并将上一天的数据附加到`.csv`文件中：
- en: '[PRE19]'
  id: totrans-181
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'We get the following plot for the preceding code:'
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 我们得到了上述代码的下列图表：
- en: '![](img/fc41a6c3-48e4-4e02-818c-4bf3ceb90750.png)'
  id: totrans-183
  prefs: []
  type: TYPE_IMG
  zh: '![](img/fc41a6c3-48e4-4e02-818c-4bf3ceb90750.png)'
- en: We will explore the capabilities of `zipline`, and, in particular, the online
    Quantopian platform, in more detail in the coming chapters.
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在接下来的章节中更详细地探讨`zipline`的功能，特别是在线Quantopian平台。
- en: Quandl
  id: totrans-185
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: Quandl
- en: Quandl provides a broad range of data sources, both free and as a subscription,
    using a Python API. Register and obtain a free API key to make more than 50 calls/day.
    Quandl data covers multiple asset classes beyond equities and includes FX, fixed
    income, indexes, futures and options, and commodities.
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: Quandl提供广泛的数据来源，包括免费和订阅，使用Python API。注册并获取免费API密钥，以进行50次以上的调用。Quandl数据涵盖除股票外的多种资产类别，包括外汇、固定收益、指数、期货和期权以及商品。
- en: 'API usage is straightforward, well-documented, and flexible, with numerous
    methods beyond single-series downloads, for example, including bulk downloads
    or metadata searches. The following call obtains the oil prices since 1986 as
    quoted by the US Department of Energy:'
  id: totrans-187
  prefs: []
  type: TYPE_NORMAL
  zh: API的使用简单直观，文档完善，灵活性强，除了单个数据系列下载外，还有许多其他方法，例如批量下载或元数据搜索。以下调用获取了自1986年以来由美国能源部报价的石油价格：
- en: '[PRE20]'
  id: totrans-188
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'We get this plot for the preceding code:'
  id: totrans-189
  prefs: []
  type: TYPE_NORMAL
  zh: 我们通过前述代码得到了这个图表：
- en: '![](img/bc18e907-1a35-4d69-8643-befccabbdba2.png)'
  id: totrans-190
  prefs: []
  type: TYPE_IMG
  zh: '![](img/bc18e907-1a35-4d69-8643-befccabbdba2.png)'
- en: Other market-data providers
  id: totrans-191
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 其他市场数据提供商
- en: 'A broad variety of providers offer market data for various asset classes. Examples
    in relevant categories include:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 各种各样的提供商为各种资产类别提供市场数据。相关类别中的示例包括：
- en: Exchanges derive a growing share of their revenues from an ever broader range
    of data services, typically using subscription.
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 交易所从数据服务中获得越来越广泛的收入，通常使用订阅方式。
- en: Bloomberg and Thomson Reuters have long been the leading data aggregators with
    a combined share of over 55% in the $28.5 billion financial data market. Smaller
    rivals, such as FactSet, are growing, or emerging, such as money.net and Quandl
    as well as Trading Economics or Barchart[.](https://www.barchart.com/)
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 彭博和汤姆森路透一直是领先的数据聚合商，在285亿美元的金融数据市场中占有超过55%的份额。较小的竞争对手，如FactSet，正在增长，或者新兴的，如money.net和Quandl以及Trading
    Economics或Barchart[.](https://www.barchart.com/)
- en: Specialist data providers abound. One example is LOBSTER, which aggregates Nasdaq
    order-book data in real-time.
  id: totrans-195
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 专业数据提供商层出不穷。LOBSTER就是一个例子，它实时聚合纳斯达克订单簿数据。
- en: Free data providers include Alpha Vantage that offers Python APIs for real-time
    equity, FX, and crypto-currency market data, as well as technical indicators.
  id: totrans-196
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 免费数据提供商包括Alpha Vantage，该公司提供Python API用于实时股票、外汇和加密货币市场数据，以及技术指标。
- en: Crowd-sourced investment firms that provide research platforms with data access
    include, in addition to Quantopian, the Alpha Trading Labs, launched in March
    2018, which provide HFT infrastructure and data.
  id: totrans-197
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提供数据访问的众包投资公司包括Quantopian以及于2018年3月推出的Alpha Trading Labs，它们提供HFT基础设施和数据。
- en: How to work with fundamental data
  id: totrans-198
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何处理基本数据
- en: 'Fundamental data pertains to the economic drivers that determine the value
    of securities. The nature of the data depends on the asset class:'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 基本数据涉及确定证券价值的经济驱动因素。数据的性质取决于资产类别：
- en: For equities and corporate credit, it includes corporate financials as well
    as industry and economy-wide data.
  id: totrans-200
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于股票和公司信用，它包括公司财务数据以及行业和全球范围的数据。
- en: For government bonds, it includes international macro-data and foreign exchange.
  id: totrans-201
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于政府债券，它包括国际宏观数据和外汇。
- en: For commodities, it includes asset-specific supply-and-demand determinants,
    such as weather data for crops.
  id: totrans-202
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于商品，它包括特定资产的供需决定因素，例如作物的天气数据。
- en: We will focus on equity fundamentals for the US, where data is easier to access.
    There are some 13,000+ public companies worldwide that generate 2 million pages
    of annual reports and 30,000+ hours of earnings calls. In algorithmic trading,
    fundamental data and features engineered from this data may be used to derive
    trading signals directly, for example as value indicators, and are an essential
    input for predictive models, including machine learning models.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将重点关注美国的股票基本面，因为数据更容易获取。全球有约13,000多家上市公司，每年产生2百万页的年度报告和3万多小时的收益电话。在算法交易中，基本数据和从这些数据中衍生的特征可能被直接用于推导交易信号，例如作为价值指标，并且是预测模型（包括机器学习模型）的重要输入。
- en: Financial statement data
  id: totrans-204
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 财务报表数据
- en: The **Securities and Exchange Commission** (**SEC**) requires US issuers, that
    is, listed companies and securities, including mutual funds to file three quarterly financial
    statements (Form 10-Q) and one annual report (Form 10-K), in addition to various
    other regulatory filing requirements.
  id: totrans-205
  prefs: []
  type: TYPE_NORMAL
  zh: '**证券交易委员会**（**SEC**）要求美国发行人，即上市公司和证券，包括共同基金，提交三份季度财务报表（表格10-Q）和一份年度报告（表格10-K），以及其他各种监管文件要求。'
- en: Since the early 1990s, the SEC made these filings available through its **Electronic
    Data Gathering, Analysis, and Retrieval** (**EDGAR**) system. They constitute
    the primary data source for the fundamental analysis of equity and other securities,
    such as corporate credit, where the value depends on the business prospects and
    financial health of the issuer.
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: 自20世纪90年代初，美国证券交易委员会通过其**电子数据收集、分析和检索**（**EDGAR**）系统提供这些报告。它们构成了股权和其他证券基本分析的主要数据来源，例如企业信用，其价值取决于发行者的业务前景和财务状况。
- en: Automated processing – XBRL
  id: totrans-207
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 自动处理 – XBRL
- en: Automated analysis of regulatory filings has become much easier since the SEC
    introduced the XBRL, a free, open, and global standard for the electronic representation
    and exchange of business reports. XBRL is based on XML; it relies on **taxonomies**
    that define the meaning of the elements of a report and map to tags that highlight
    the corresponding information in the electronic version of the report. One such
    taxonomy represents the US **Generally Accepted Accounting Principles** (**GAAP**).
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 自从SEC引入了XBRL以来，对监管提交的自动分析变得更加容易，XBRL是一种免费、开放和全球标准，用于电子报告的表示和交换。XBRL基于XML；它依赖于定义报告元素含义的分类法，并映射到在报告的电子版本中突出显示相应信息的标签。其中一种分类法代表了美国**普遍公认的会计准则**（**GAAP**）。
- en: The SEC introduced voluntary XBRL filings in 2005 in response to accounting
    scandals before requiring this format for all filers since 2009 and continues
    to expand the mandatory coverage to other regulatory filings. The SEC maintains
    a website that lists the current taxonomies that shape the content of different
    filings and can be used to extract specific items.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: 为了应对会计丑闻，SEC于2005年引入了自愿的XBRL提交，之后从2009年开始要求所有提交者使用此格式，并继续将强制覆盖范围扩展到其他监管提交。SEC维护一个网站，列出了塑造不同提交内容的当前分类法，并可用于提取特定项目。
- en: The following datasets provide information extracted from EX-101 attachments
    submitted to the Commission in a flattened data format to assist users in consuming
    the data for analysis. The data reflects selected information from the XBRL-tagged
    financial statements. It currently includes numeric data from the quarterly and
    annual financial statements, as well as certain additional fields (for example,
    **Standard Industrial Classification** (**SIC**)).
  id: totrans-210
  prefs: []
  type: TYPE_NORMAL
  zh: 以下数据集提供了从提交给委员会的EX-101附件中提取的信息，以扁平化数据格式提供，以帮助用户消化数据进行分析。数据反映了XBRL标记的财务报表的选定信息。目前，它包括季度和年度财务报表的数字数据，以及某些额外字段（例如**标准工业分类**（**SIC**））。
- en: 'There are several avenues to track and access fundamental data reported to
    the SEC:'
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 有几种途径可跟踪和访问向SEC报告的基本数据：
- en: As part of the EDGAR **Public** **Dissemination Service** (**PDS**), electronic
    feeds of accepted filings are available for a fee.
  id: totrans-212
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 作为EDGAR **公共** **传播服务**（**PDS**）的一部分，接受的提交的电子订阅需要付费。
- en: The SEC updates **RSS** feeds every 10 minutes, which list structured disclosure
    submissions.
  id: totrans-213
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SEC每10分钟更新一次**RSS**订阅，其中列出了结构化披露提交。
- en: There are public index files for the retrieval of all filings through FTP for
    automated processing.
  id: totrans-214
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有用于通过FTP检索所有提交的公共索引文件，以进行自动处理。
- en: The financial statement (and notes) datasets contain parsed XBRL data from all
    financial statements and the accompanying notes.
  id: totrans-215
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 财务报表（和附注）数据集包含了来自所有财务报表和相关附注的解析XBRL数据。
- en: The SEC also publishes log files containing the internet search traffic for
    EDGAR filings through SEC.gov, albeit with a six-month delay.
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: SEC还发布了包含通过SEC.gov提交的EDGAR提交的互联网搜索流量的日志文件，尽管有六个月的延迟。
- en: Building a fundamental data time series
  id: totrans-217
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 建立基本数据时间序列
- en: The scope of the data in the financial statement and notes datasets consists
    of numeric data extracted from the primary financial statements (Balance sheet,
    income statement, cash flows, changes in equity, and comprehensive income) and
    footnotes on those statements. The data is available as early as 2009.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 财务报表和附注数据集中的数据范围包括从主要财务报表（资产负债表、利润表、现金流量表、权益变动表和全面收益表）和这些报表的附注中提取的数字数据。该数据最早可追溯至2009年。
- en: Extracting the financial statements and notes dataset
  id: totrans-219
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 提取财务报表和附注数据集
- en: 'The following code downloads and extracts all historical filings contained
    in the **Financial Statement and Notes** (**FSN**) datasets for the given range
    of quarters (see `edgar_xbrl.ipynb` for addition details):'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码下载并提取了给定季度范围内**财务报表和附注**（**FSN**）数据集中包含的所有历史提交（有关更多详细信息，请参阅`edgar_xbrl.ipynb`）：
- en: '[PRE21]'
  id: totrans-221
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'The data is fairly large and to enable faster access than the original text
    files permit, it is better to convert the text files to binary, columnar parquet
    format (see *Efficient data storage with pandas* section in this chapter for a
    performance comparison of various data-storage options compatible with pandas
    `DataFrames`):'
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 数据相当庞大，为了实现比原始文本文件更快的访问，最好将文本文件转换为二进制、列式parquet格式（请参见本章中关于与pandas `DataFrames`兼容的各种数据存储选项的性能比较的*使用pandas进行高效数据存储*一节）：
- en: '[PRE22]'
  id: totrans-223
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'For each quarter, the FSN data is organized into eight file sets that contain
    information about submissions, numbers, taxonomy tags, presentation, and more.
    Each dataset consists of rows and fields and is provided as a tab-delimited text
    file:'
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 对于每个季度，FSN数据组织成包含有关提交、数字、税项标签、演示等信息的八个文件集。每个数据集由行和字段组成，并以制表符分隔的文本文件形式提供：
- en: '| **File** | **Dataset** | **Description** |'
  id: totrans-225
  prefs: []
  type: TYPE_TB
  zh: '| **文件** | **数据集** | **描述** |'
- en: '| `SUB` | Submission | Identifies each XBRL submission by company, form, date,
    and so on |'
  id: totrans-226
  prefs: []
  type: TYPE_TB
  zh: '| `SUB` | 提交 | 根据公司、表格、日期等识别每个XBRL提交 |'
- en: '| `TAG` | Tag | Defines and explains each taxonomy tag |'
  id: totrans-227
  prefs: []
  type: TYPE_TB
  zh: '| `TAG` | 标签 | 定义和解释每个税项标签 |'
- en: '| `DIM` | Dimension | Adds detail to numeric and plain text data |'
  id: totrans-228
  prefs: []
  type: TYPE_TB
  zh: '| `DIM` | 尺寸 | 对数字和纯文本数据进行详细描述 |'
- en: '| `NUM` | Numeric | One row for each distinct data point in filing |'
  id: totrans-229
  prefs: []
  type: TYPE_TB
  zh: '| `NUM` | 数字 | 每个备案中每个不同数据点的一行 |'
- en: '| `TXT` | Plain text | Contains all non-numeric XBRL fields |'
  id: totrans-230
  prefs: []
  type: TYPE_TB
  zh: '| `TXT` | 纯文本 | 包含所有非数字XBRL字段 |'
- en: '| `REN` | Rendering | Information for rendering on SEC website |'
  id: totrans-231
  prefs: []
  type: TYPE_TB
  zh: '| `REN` | 渲染 | 在SEC网站上呈现的信息 |'
- en: '| `PRE` | Presentation | Detail on the tag and number presentation in primary
    statements |'
  id: totrans-232
  prefs: []
  type: TYPE_TB
  zh: '| `PRE` | 展示 | 主要报表中标签和数字展示的详细信息 |'
- en: '| `CAL` | Calculation | Shows arithmetic relationships among tags |'
  id: totrans-233
  prefs: []
  type: TYPE_TB
  zh: '| `CAL` | 计算 | 显示标签之间的算术关系 |'
- en: Retrieving all quarterly Apple filings
  id: totrans-234
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 检索所有季度苹果备案
- en: 'The submission dataset contains the unique identifiers required to retrieve
    the filings: the **Central Index Key** (**CIK**) and the Accession Number (`adsh`).
    The following shows some of the information about Apple''s 2018Q1 10-Q filing:'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 提交数据集包含检索备案所需的唯一标识符：**中央索引键**（**CIK**）和接入号（`adsh`）。以下显示了有关苹果2018Q1 10-Q备案的一些信息：
- en: '[PRE23]'
  id: totrans-236
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Using the central index key, we can identify all historical quarterly filings
    available for `Apple`, and combine this information to obtain 26 Forms `10-Q`
    and nine annual Forms `10-K`:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
  zh: 使用中央索引键，我们可以识别出适用于`Apple`的所有历史季度备案，并将此信息结合起来获得26份`10-Q`表格和9份年度`10-K`表格：
- en: '[PRE24]'
  id: totrans-238
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: With the Accession Number for each filing, we can now rely on the taxonomies
    to select the appropriate XBRL tags (listed in the `TAG` file) from the `NUM`
    and `TXT` files to obtain the numerical or textual/footnote data points of interest.
  id: totrans-239
  prefs: []
  type: TYPE_NORMAL
  zh: 有了每个备案的接入号，我们现在可以依靠税项分类来从`NUM`和`TXT`文件中选择适当的XBRL标签（在`TAG`文件中列出）以获取感兴趣的数字或文本/脚注数据点。
- en: 'First, let''s extract all numerical data available from the 19 Apple filings:'
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，让我们从19份苹果备案中提取所有可用的数字数据：
- en: '[PRE25]'
  id: totrans-241
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: Building a price/earnings time series
  id: totrans-242
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 建立一个价格/收益时间序列
- en: In total, the nine years of filing history provide us with over 28,000 numerical
    values. We can select a useful field, such as **Earnings per Diluted Share** (**EPS**),
    that we can combine with market data to calculate the popular **Price/Earnings**
    (**P/E**) valuation ratio.
  id: totrans-243
  prefs: []
  type: TYPE_NORMAL
  zh: 总共，九年的备案历史为我们提供了超过28,000个数字值。我们可以选择一个有用的字段，例如**每股稀释收益**（**EPS**），将其与市场数据结合起来计算流行的**市盈率**（**P/E**）估值比率。
- en: 'We do need to take into account, however, that Apple split its stock 7:1 on
    June 4, 2014, and Adjusted Earnings per Share before the split to make earnings
    comparable, as illustrated in the following code block:'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 但是，我们需要考虑到，苹果于2014年6月4日进行了7:1的股票分割，并且调整了分割前的每股收益，以使收益可比，如下图所示：
- en: '[PRE26]'
  id: totrans-245
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'We can use Quandl to obtain Apple stock price data since 2009:'
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用Quandl来获取自2009年以来的苹果股价数据：
- en: '[PRE27]'
  id: totrans-247
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Now we have the data to compute the trailing 12-month P/E ratio for the entire
    period:'
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们有了数据来计算整个期间的滚动12个月P/E比率：
- en: '[PRE28]'
  id: totrans-249
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'We get the following plot for the preceding code:'
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 对于前述代码，我们得到了以下的绘图：
- en: '![](img/3b81fa31-f1c9-4f16-8993-2375846844d6.png)'
  id: totrans-251
  prefs: []
  type: TYPE_IMG
  zh: '![](img/3b81fa31-f1c9-4f16-8993-2375846844d6.png)'
- en: Other fundamental data sources
  id: totrans-252
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 其他基本数据来源
- en: There are numerous other sources for fundamental data. Many are accessible using
    the `pandas_datareader` module introduced earlier. Additional data is available
    from certain organizations directly, such as the IMF, World Bank, or major national
    statistical agencies around the world (see references on GitHub).
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: 还有许多其他的基础数据来源。许多可通过早期介绍的`pandas_datareader`模块访问。还有其他数据可以直接从某些组织获得，例如IMF、世界银行或世界各地的主要国家统计机构（请参阅GitHub上的参考文献）。
- en: pandas_datareader – macro and industry data
  id: totrans-254
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: pandas_datareader – 宏观和行业数据
- en: 'The `pandas_datareader` library facilitates access according to the conventions
    introduced at the end of the preceding section on market data. It covers APIs
    for numerous global fundamental macro and industry-data sources, including the
    following:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: '`pandas_datareader`库根据上一节市场数据末尾介绍的约定简化了访问。它覆盖了许多全球基础宏观和行业数据源的API，包括以下内容：'
- en: '**Kenneth French''s data library**: Market data on portfolios capturing size,
    value, and momentum factors, disaggregated industry'
  id: totrans-256
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**肯尼斯·弗伦奇的数据库**：捕捉规模、价值和动量因素、分解行业的投资组合的市场数据'
- en: '**St.Louis FED (FRED)**: Federal Reserve data on the US economy and financial
    markets'
  id: totrans-257
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**圣路易斯联邦储备银行（FRED）**：美国经济和金融市场的联邦储备数据'
- en: '**World Bank**: Global database on long-term, lower-frequency economic and
    social development and demographics'
  id: totrans-258
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**世界银行**：长期、低频经济和社会发展以及人口统计数据库'
- en: '**OECD**: Similar for OECD countries'
  id: totrans-259
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**经济合作与发展组织（OECD）**：类似于OECD国家'
- en: '**Enigma**: Various datasets, including alternative sources'
  id: totrans-260
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Enigma**：各种数据集，包括替代来源'
- en: '**Eurostat**: EU-focused economics, social and demographic data'
  id: totrans-261
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Eurostat**：欧盟经济、社会和人口统计数据'
- en: Efficient data storage with pandas
  id: totrans-262
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 用pandas进行高效的数据存储
- en: 'We''ll be using many different data sets in this book, and it''s worth comparing
    the main formats for efficiency and performance. In particular, we compare the
    following:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书中我们将使用许多不同的数据集，值得比较主要格式的效率和性能。特别是，我们比较以下内容：
- en: '**CSV**: Comma-separated, standard flat text file format.'
  id: totrans-264
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**CSV**: 逗号分隔，标准的纯文本文件格式。'
- en: '**HDF5**: Hierarchical data format, developed initially at the National Center
    for Supercomputing, is a fast and scalable storage format for numerical data,
    available in pandas using the `PyTables` library.'
  id: totrans-265
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**HDF5**：分层数据格式，最初在国家超级计算中心开发，是一种用于数值数据的快速可扩展的存储格式，可以使用`PyTables`库在pandas中使用。'
- en: '**Parquet**: A binary, columnar storage format, part of the Apache Hadoop ecosystem,
    that provides efficient data compression and encoding and has been developed by
    Cloudera and Twitter. It is available for pandas through the `pyarrow` library,
    led by Wes McKinney, the original author of pandas.'
  id: totrans-266
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Parquet**: 二进制的，列式存储格式，是Apache Hadoop生态系统的一部分，提供了高效的数据压缩和编码，并由Cloudera和Twitter开发。通过由pandas的原始作者Wes
    McKinney领导的`pyarrow`库可用于pandas。'
- en: The `storage_benchmark.ipynb` notebook compares the performance of the preceding
    libraries using a test `DataFrame` that can be configured to contain numerical
    or text data, or both. For the `HDF5` library, we test both the `fixed` and `table`
    format. The `table` format allows for queries and can be appended to.
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: '`storage_benchmark.ipynb`笔记本使用一个可配置为包含数值数据、文本数据或两者的测试`DataFrame`来比较上述库的性能。对于`HDF5`库，我们测试`fixed`和`table`格式。`table`格式允许查询并且可以追加。'
- en: 'The following charts illustrate the read and write performance for 100,000
    rows with either 1,000 columns of random floats and 1,000 columns of a random
    10-character string, or just 2,000 float columns:'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图表说明了具有随机浮点数的100,000行和1000个随机10个字符字符串列或仅有2,000个浮点列的100,000行的读写性能：
- en: For purely numerical data, the HDF5 format performs best, and the table format
    also shares with CSV the smallest memory footprint at 1.6 GB. The fixed format
    uses twice as much space, and the parquet format uses 2 GB.
  id: totrans-269
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于纯数值数据，HDF5格式性能最佳，并且表格式与CSV共享1.6 GB的最小内存占用。固定格式使用了两倍的空间，parquet格式使用了2 GB。
- en: 'For a mix of numerical and text data, `parquet` is significantly faster, and
    HDF5 uses its advantage on reading relative to CSV (which has very low write performance
    in both cases):'
  id: totrans-270
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于数字和文本数据的混合，`parquet`显着更快，而HDF5则利用其相对于CSV的读取优势（在两种情况下写入性能都很低）：
- en: '![](img/c1d319d3-a4fd-405f-9495-63e9eb2db4a8.png)'
  id: totrans-271
  prefs: []
  type: TYPE_IMG
  zh: '![](img/c1d319d3-a4fd-405f-9495-63e9eb2db4a8.png)'
- en: The notebook illustrates how to configure, test, and collect the timing using
    the `%%timeit` cell magic, and at the same time demonstrates the usage of the
    related pandas commands required to use these storage formats.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 该笔记本演示了如何使用`%%timeit`单元格魔法配置、测试和收集时间，并同时演示了使用相关的pandas命令来使用这些存储格式所需的用法。
- en: Summary
  id: totrans-273
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: This chapter introduced the market and fundamental data sources that form the
    backbone of most trading strategies. You learned about numerous ways to access
    this data, and how to preprocess the raw information so that you can begin extracting
    trading signals using the machine learning techniques that we will be introducing
    shortly.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 本章介绍了构成大多数交易策略骨干的市场和基本数据来源。您了解了访问这些数据的多种方式，以及如何预处理原始信息，以便您可以开始使用我们即将介绍的机器学习技术提取交易信号。
- en: Before we move onto the design and evaluation of trading strategies and the
    use of ML models, we need to cover alternative datasets that have emerged in recent
    years and have been a significant driver of the popularity of ML for algorithmic
    trading.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们进入交易策略的设计和评估以及使用ML模型之前，我们需要涵盖近年来出现的替代数据集，这些数据集对算法交易的ML流行程度有着重要推动作用。

# 前言

我们坚信，任何一位雄心勃勃的金融专业学生都应该学习至少一门计算机语言。基本原因是我们已经进入了所谓的大数据时代。在金融领域，我们有大量的数据，并且大部分数据是公开的，可以免费获得。为了高效利用这些丰富的数据源，我们需要一个工具。在众多潜在的候选工具中，Python 是最佳选择之一。

# 关于第二版的几点话

对于第二版，我们重新组织了本书的结构，增加了更多与金融相关的章节。这是对众多读者反馈的认可和回应。第二版的前两章专门介绍 Python，之后的所有章节都与金融相关。再次强调，本书中的 Python 主要作为工具，帮助读者更好地学习和理解金融理论。为了满足各种量化程序、商业分析程序和金融工程程序对各类数据的使用需求，我们新增了第四章，*数据来源*。由于这种结构调整，本版更加适合如定量金融、使用 Python 进行金融分析和商业分析等为期一个学期的课程。宾州州立大学的 Premal P. Vora 教授和西敏大学的 Sheng Xiao 教授已经将第一版作为他们的教材。希望更多的金融、会计学教授会发现第二版更适合他们的学生，特别是金融工程、商业分析和其他定量领域的学生。

# 为什么选择 Python？

使用 Python 有多种理由。首先，Python 是免费的，无需授权费用。Python 可在所有主要操作系统上运行，如 Windows、Linux/Unix、OS/2、Mac 和 Amiga 等。免费这一点有很多好处。当学生毕业后，他们可以将学到的知识应用到任何地方，金融领域也是如此。相比之下，SAS 和 MATLAB 并非如此。其次，Python 功能强大、灵活且易学。它几乎能够解决我们所有的金融和经济估算问题。第三，Python 可应用于大数据。Dasgupta（2013）认为，R 和 Python 是两种最受欢迎的开源数据分析编程语言。第四，Python 中有许多有用的模块，每个模块都是为特定目的开发的。本书中，我们重点介绍了 NumPy、SciPy、Matplotlib、Statsmodels 和 Pandas 模块。

# 一本由金融教授编写的编程书籍

毫无疑问，大多数编程书籍都是由计算机科学的教授编写的。由一位金融学教授编写编程书籍似乎有些奇怪。可以理解的是，重点会有所不同。如果是计算机科学的讲师在编写这本书，自然重点会放在 Python 上，而真正的重点应该是金融。书名*《Python 金融应用》*应该可以让人一目了然。此书旨在改变目前许多服务于金融界的编程书籍过于注重编程语言本身，而忽视了金融内容的现状。书中的另一个独特之处是，它使用了大量与经济学、金融和会计相关的公共数据，详见第四章，*数据来源*部分。

# 本书内容简介

第一章，*Python 基础*，提供了简短的介绍，并解释了如何安装 Python、如何启动和退出 Python、变量赋值、向量、矩阵和元组、调用嵌入式函数、编写自己的函数、从输入文件读取数据、简单的数据处理、输出数据和结果，以及生成一个带有 pickle 扩展的 Python 数据集。

第二章，*Python 模块介绍*，讨论了模块的含义、如何导入模块、显示导入模块中包含的所有函数、为导入的模块取一个简短的别名、对比 import math 和 from math import、删除已导入的模块、仅导入模块中的某些函数、NumPy、SciPy、matplotlib、statsmodels、pandas 和 Pandas_reader 的介绍，如何查找所有内置模块及所有可用的（预安装的）模块，以及如何查找特定的未安装模块。

第三章，*货币的时间价值*，介绍并讨论了与金融相关的各种基本概念和公式，如单一未来现金流的现值、（增长型）永续年金的现值、年金的现值和未来值、永续年金与即付永续年金的区别、年金与即付年金的区别、SciPy 和 numpy.lib.financial 子模块中的相关函数、一个用 Python 编写的免费的金融计算器、净现值（NPV）的定义及其相关规则、内部收益率（IRR）的定义及其相关规则、时间价值的 Python 图形展示，以及 NPV 曲线。

第四章，*数据来源*，讨论了如何从各种公共来源获取数据，如 Yahoo!Finance、Google finance、FRED（美联储经济数据图书馆）、French 教授的数据图书馆、BLS（美国劳工统计局）和人口普查局。此外，还会讨论各种输入数据的方法，例如 csv、txt、pkl、Matlab、SAS 或 Excel 格式的文件。

第五章, *债券与股票估值*，介绍了利率及其相关概念，如年利率（APR）、有效年利率（EAR）、复利频率，如何将一种有效利率转换为另一种，利率期限结构，如何估算普通债券的售价，如何使用所谓的折现股息模型来估算股票价格等。

第六章, *资本资产定价模型*，展示了如何从 Yahoo!Finance 下载数据以运行 CAPM 的线性回归，滚动 beta，几个 Python 程序来估算多只股票的 beta、调整 beta 和投资组合 beta 估算，Scholes 和 Williams（1977）Dimson（1979）提出的两种 beta 调整方法。

第七章, *多因子模型与业绩衡量*，展示了如何将第六章中描述的单因子模型，*资本资产定价模型*，扩展到多因子和复杂模型，如 Fama-French 三因子模型、Fama-French-Carhart 四因子模型、Fama-French 五因子模型，以及业绩衡量指标，如 Sharpe 比率、Treynor 比率、Sortino 比率和 Jensen's alpha。

第八章, *时间序列分析*，展示了如何设计良好的日期变量，通过该日期变量合并数据集，正态分布、正态性检验、利率期限结构、52 周高低交易策略、收益估算、将日收益转换为月度或年度收益、T 检验、F 检验、Durbin-Watson 自相关检验、Fama-MacBeth 回归、Roll（1984）价差、Amihud（2002）流动性测量、Pastor 和 Stambaugh（2003）流动性指标、1 月效应、星期效应、从 Google Finance 和 Hasbrouck 教授的 TORQ 数据库（交易、订单、报告和报价）中检索高频数据，以及介绍 CRSP（证券价格研究中心）数据库。

第九章, *投资组合理论*，讨论了 2 只股票投资组合、N 只股票投资组合的均值和风险估算，相关性与多样化效应，如何生成收益矩阵，基于 Sharpe 比率、Treynor 比率和 Sortino 比率生成最佳投资组合；如何构建有效前沿；Modigliani 和 Modigliani 业绩衡量（M2 衡量）；以及如何使用市值加权和等权重方法估算投资组合收益。

第十章，*期权与期货*，讨论了看涨期权和看跌期权的收益和盈亏函数及其图示表示，欧洲期权与美式期权；正态分布；标准正态分布；累积正态分布；著名的布莱克-斯科尔斯-莫顿期权模型（有无红利）；各种交易策略及其可视化表示，如备兑看涨、跨式期权、蝶式期权和日历差价期权；希腊字母；看跌-看涨平价及其图形表示；单步和两步二项树模型的图形表示；如何使用二项树方法定价欧洲期权和美式期权；以及隐含波动率、波动率微笑和波动率偏斜。

第十一章，*风险价值*，首先回顾了正态分布的密度函数和累积分布函数，然后讨论了基于正态性假设估算 VaR 的第一种方法，如何从 1 天风险转换为 n 天风险，从 1 天 VaR 转换为 n 天 VaR，正态性检验，偏度和峰度的影响，如何通过包括偏度和峰度来修正 VaR 度量，基于历史收益的第二种 VaR 估算方法，如何通过蒙特卡洛模拟将两种方法链接起来，回测和压力测试。

第十二章，*蒙特卡洛模拟*，讨论了如何通过蒙特卡洛模拟估算π值；使用对数正态分布模拟股票价格波动；构建有效的投资组合和有效前沿；通过模拟复制布莱克-斯科尔斯-莫顿期权模型；定价多种奇异期权，如浮动行权价的回顾期权；有放回/无放回的自助法；长期预期收益预测及其相关效率，准蒙特卡洛模拟和索博尔序列。

第十三章，*信用风险分析*，讨论了穆迪、标准普尔和惠誉的信用评级、信用利差、1 年和 5 年迁移矩阵、利率期限结构、阿尔特曼 Z 分数用于预测企业破产、KMV 模型用于估算总资产及其波动性、违约概率和违约距离，以及信用违约掉期。

第十四章，*奇异期权*，首先比较了我们在第九章，*投资组合理论* 中学到的欧洲期权和美式期权与伯穆达期权，然后讨论了定价简单选择期权、喊叫期权、彩虹期权和二元期权的方法；平均价格期权；障碍期权，如向上进场期权和向上退场期权；以及障碍期权，如向下进场和向下退场期权。

第十五章，*波动率、隐含波动率、ARCH 与 GARCH*，重点讨论两个问题：波动率度量和 ARCH/GARCH 模型。

# 面向小程序

根据作者在七所学校的教学经验，包括加拿大的麦吉尔大学和威尔弗里德·劳里大学、新加坡的南洋理工大学，以及美国的洛约拉大学、马里兰大学大学城分校、霍夫斯特拉大学和卡尼修斯学院，再加上他在沃顿商学院的八年咨询经验，他知道许多金融学生喜欢解决单一特定任务的小程序。大多数编程书籍仅提供几个完整且复杂的程序，程序的数量远远不足。采取这种方法有两个副作用。首先，金融学生会被编程细节淹没，感到畏惧，最终失去学习计算机语言的兴趣。其次，他们没有学会如何应用所学的知识，例如运行资本资产定价模型（CAPM）来估算 1990 年到 2013 年间 IBM 的贝塔值。本书提供了约 300 个完整的 Python 程序，涵盖许多金融话题。

# 使用真实数据

大多数编程书籍的另一个缺点是它们使用假设数据。而在本书中，我们使用真实世界的数据来探讨各类金融话题。例如，我没有仅仅展示如何运行 CAPM 来估算贝塔（市场风险），而是向你展示如何估算 IBM、苹果或沃尔玛的贝塔。与仅呈现公式来估算投资组合的收益和风险不同，本书提供了 Python 程序来下载真实数据、构建各种投资组合，然后估算它们的收益和风险，包括风险价值（VaR）。当我还是一名博士生时，我学到了波动率微笑的基本概念。然而，直到写这本书时，我才有机会下载真实世界的数据来绘制 IBM 的波动率微笑。

# 本书所需内容

在这里，我们通过几个具体的例子来展示读者在认真阅读本书后能够取得的成就。

首先，在阅读完前两章后，读者/学生应该能够使用 Python 计算现值、未来值、年金现值、内部收益率（IRR）以及许多其他金融公式。换句话说，我们可以将 Python 作为一个免费的普通计算器来解决许多金融问题。其次，在完成前三章后，读者/学生或金融教师能够构建一个免费的金融计算器，即将数十个小的 Python 程序组合成一个大的 Python 程序。这个大程序的表现就像是任何其他人编写的模块。第三，读者将学习如何编写 Python 程序，下载并处理来自各种公共数据源的金融数据，例如 Yahoo! Finance、Google Finance、美国联邦储备数据库和法国教授的数据库。

第四，读者将理解与模块相关的基本概念，模块是专家、其他用户或我们为特定目的编写的包。第五，理解了 Matplotlib 模块后，读者可以生成各种图表。例如，读者可以通过结合基础股票和期权，使用图表展示基于不同交易策略的收益/利润结果。第六，读者将能够从 Yahoo! Finance 下载 IBM 的每日价格、标准普尔 500 指数价格，并通过应用资本资产定价模型（CAPM）来估算其市场风险（贝塔系数）。他们还将能够形成包含不同证券的投资组合，例如无风险资产、债券和股票。然后，他们可以通过应用 Markowitz 的均值-方差模型来优化他们的投资组合。此外，读者将知道如何估算其投资组合的风险价值（VaR）。

第七，读者应该能够通过应用 Black-Scholes-Merton 期权模型（仅适用于欧洲期权）和蒙特卡罗模拟（适用于欧洲期权和美国期权）来定价欧洲期权和美国期权。最后但同样重要的是，读者将学习几种衡量波动率的方法。特别是，他们将学习如何使用自回归条件异方差（ARCH）模型和广义自回归条件异方差（GARCH）模型。

# 本书适合谁阅读

如果你是金融专业的研究生，特别是学习计算金融、金融建模、金融工程或商业分析的学生，那么本书将对你大有裨益。这里有两个例子：宾夕法尼亚州立大学的 Premal P. Vora 教授在他的课程 *数据科学与金融* 中使用了本书，而西敏寺学院的 Sheng Xiao 教授则在他的课程 *金融分析* 中使用了本书。如果你是专业人士，你可以学习 Python 并将其应用于许多金融项目。如果你是个人投资者，阅读本书同样也会让你受益。

# 约定

本书中，你将发现几种文本样式，用于区分不同类型的信息。以下是这些样式的一些示例，并解释它们的含义。

文本中的代码字、数据库表名、文件夹名称、文件名、文件扩展名、路径名、虚拟网址、用户输入以及 Twitter 用户名通常显示如下：“`sqrt()` 函数，平方根，包含在 `math` 模块中。”

一段代码如下所示：

```py
>>>sqrt(2)
NameError: name 'sqrt' is not defined
>>> Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
math.sqrt(2)
1.4142135623730951
>>>
```

任何命令行输入或输出如下所示：

```py
help(pv_f)

```

**新术语**和**重要词汇**以粗体显示。在屏幕上看到的单词，例如菜单或对话框中的单词，将以这种形式出现在文本中：“要编写 Python 程序，我们点击 **文件**，然后点击 **新建文件**。”

### 注意

警告或重要说明会显示在像这样的框中。

### 提示

提示和技巧如下所示。

# 读者反馈

我们总是欢迎读者的反馈。告诉我们你对这本书的看法——你喜欢或可能不喜欢的部分。读者的反馈对我们开发出让你真正受益的书籍至关重要。

若要向我们发送一般反馈，只需发送电子邮件至`<feedback@packtpub.com>`，并在邮件主题中提到书籍标题。

如果你在某个领域有专长，并且有兴趣为书籍撰写或贡献内容，请查看我们的作者指南：[www.packtpub.com/authors](http://www.packtpub.com/authors)。

# 客户支持

现在，你已经是一本 Packt 书籍的骄傲拥有者，我们提供了许多资源帮助你从购买中获得最大价值。

## 下载示例代码

你可以从你的账户中下载本书的示例代码文件，访问：[`www.packtpub.com`](http://www.packtpub.com)。如果你从其他地方购买了这本书，可以访问：[`www.packtpub.com/support`](http://www.packtpub.com/support)，并注册后直接将文件通过电子邮件发送给你。

你可以按照以下步骤下载代码文件：

1.  你可以按照以下步骤下载代码文件：

1.  使用你的电子邮件地址和密码登录或注册我们的网站。

1.  将鼠标指针悬停在顶部的**SUPPORT**标签上。

1.  点击**Code Downloads & Errata**。

1.  在**Search**框中输入书名。

1.  选择你想要下载代码文件的书籍。

1.  从下拉菜单中选择你购买此书的地方。

1.  点击**Code Download**。

下载文件后，请确保使用以下最新版本解压或提取文件夹：

+   WinRAR / 7-Zip for Windows

+   Zipeg / iZip / UnRarX for Mac

+   7-Zip / PeaZip for Linux

本书的代码包也托管在 GitHub 上，地址为：[`github.com/PacktPublishing/Python-for-Finance-Second-Edition`](https://github.com/PacktPublishing/Python-for-Finance-Second-Edition)。我们还提供来自我们丰富书籍和视频目录的其他代码包，地址为：[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)。快去看看吧！

## 勘误表

尽管我们已经尽一切努力确保内容的准确性，但错误还是可能发生。如果您在我们的一本书中发现错误——无论是文本错误还是代码错误——我们将非常感激您能报告给我们。这样，您可以帮助其他读者避免困扰，并帮助我们改进书籍的后续版本。如果您发现任何勘误，请通过访问 [`www.packtpub.com/submit-errata`](http://www.packtpub.com/submit-errata) 提交，选择您的书籍，点击 **勘误** **提交** **表单** 链接，并填写勘误的详细信息。一旦您的勘误被验证，您的提交将被接受，勘误将在我们的网站上上传，或加入到该书籍现有的勘误列表中，位于该书籍的勘误部分。您可以通过访问 [`www.packtpub.com/support`](http://www.packtpub.com/support) 来查看任何现有的勘误。

## 盗版

网络上侵犯版权的盗版问题在所有媒体中持续存在。在 Packt，我们非常重视版权和许可证的保护。如果您在互联网上发现任何非法的我们作品的复制品，无论其形式如何，请立即向我们提供位置地址或网站名称，以便我们采取相应措施。

请通过 `<copyright@packtpub.com>` 联系我们，并提供涉嫌盗版材料的链接。

感谢您的帮助，帮助我们保护作者，并支持我们为您提供有价值的内容。

## 问题

如果您在书籍的任何方面遇到问题，可以通过 `<questions@packtpub.com>` 联系我们，我们会尽力解决。

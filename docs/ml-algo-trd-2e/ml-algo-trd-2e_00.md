# 序言

如果你正在阅读这篇文章，你可能已经意识到**机器学习**（**ML**）**已经成为许多行业的战略能力**，包括投资行业。与 ML 的兴起密切相关的数字数据的爆炸对投资产生了特别强大的影响，而投资已经有了使用复杂模型处理信息的悠久历史。这些趋势正在促成**量化投资的新方法**，并增加了将数据科学应用于自主和算法交易策略的需求。

**跨资产类别的交易范围**非常广泛，因为它涵盖了从股票和政府债券到商品和房地产的范围。这意味着一个非常广泛的新型替代数据源可能与过去大多数分析工作的核心市场和基本数据相关。

你可能也已经了解到，成功应用 ML 或数据科学需要个人或团队层面的**统计知识、计算技能和领域专业知识的整合**。换句话说，关键是提出正确的问题，识别和理解可能提供答案的数据，使用广泛的工具来获取结果，并以导致正确决策的方式解释它们。

因此，本书提供了关于将 ML 应用于投资和交易领域的综合视角。在本序言中，我们概述了你应该期望什么，我们如何组织内容以便实现我们的目标，以及你需要什么来实现目标并在过程中享受乐趣。

# 预期

本书旨在为您提供战略视角、概念理解和实用工具，以在将 ML 应用于交易和投资过程中增加价值。为此，我们将 ML 视为过程的关键要素，而不是一个独立的练习。最重要的是，我们介绍了一个**端到端 ML 交易（ML4T）工作流程**，我们将其应用于许多具有相关数据和代码示例的用例。

ML4T 的工作流程始于生成想法和获取数据，然后继续提取特征，调整 ML 模型，并设计能够根据模型预测信号行动的交易策略。它还包括使用回测引擎在历史数据上模拟策略，并评估其性能。

首先，本书演示了如何从各种数据源中提取信号，并使用广泛的**监督、无监督和强化学习算法**为不同资产类别设计交易策略。此外，它提供了相关的数学和统计背景，以便调整算法和解释结果。最后，它包括金融背景，使您能够处理市场和基本数据，提取有信息量的特征，并管理交易策略的性能。

本书强调，投资者可以从第三方数据中获得至少与其他行业同等的价值。因此，它不仅涵盖了如何处理市场和基本数据，还涵盖了如何获取、评估、处理和建模**替代数据源**，如非结构化文本和图像数据。

毫不奇怪，**这本书不提供投资建议**或现成的交易算法。相反，它意在传达机器学习在交易领域面临许多额外挑战，从信号内容较低到时间序列较短，这些往往使得获得稳健结果更加困难。事实上，我们包含了一些例子，这些例子并没有取得很好的结果，以避免夸大机器学习的好处或低估获取好主意、获得正确数据、构建巧妙特征和设计有效策略（可能具有吸引力回报）所需的努力。

相反，您应该将本书视为一个利用关键机器学习算法指导交易策略的指南。为此，我们提出了一个**框架，指导您完成以下 ML4T 过程**：

1.  为任何投资目标获取、评估和组合数据

1.  设计和调整从数据中提取预测信号的 ML 模型

1.  基于结果开发和评估交易策略

阅读本书后，您将能够开始设计和评估自己基于机器学习的策略，并可能考虑参加比赛或连接到在线经纪人的 API 并开始在真实世界中交易。

# 第二版的新内容

本次更新的重点在于端到端的 ML4T 工作流程，反映在一个新的章节上，即战略回测（*第八章*，*ML4T 工作流程 - 从模型到策略回测*），一个描述了超过 100 种不同的 alpha 因子的新附录，以及许多新的实际应用。我们还重写了大部分现有内容，以提高清晰度和可读性。

应用现在使用了更广泛的数据源，包括日常美国股票价格之外的国际股票和 ETF，以及分钟级频率的股票数据，以展示日内交易策略。此外，现在还有更广泛的替代数据源涵盖范围，包括用于情感分析和回报预测的 SEC 文件，以及用于分类土地用途的卫星图像。

此外，本书复制了几篇最近发表的学术论文中的应用。*第十八章*，*用于金融时间序列和卫星图像的卷积神经网络*，演示了如何将卷积神经网络应用于转换为图像格式的时间序列，用于回报预测。*第二十章*，*用于条件风险因素和资产定价的自编码器*，展示了如何使用自编码器提取以股票特征为条件的风险因素，用于资产定价。*第二十一章*，*用于合成时间序列数据的生成对抗网络*，研究了如何使用生成对抗网络创建合成训练数据。

所有应用现在都使用最新可用的软件版本（写作时），如 pandas 1.0 和 TensorFlow 2.2。还有一个定制版本的 Zipline，可以在设计交易策略时轻松包含机器学习模型的预测。

# 谁应该阅读这本书

如果你是**分析师、数据科学家或机器学习工程师**，对金融市场有一定的了解并对交易策略感兴趣，那么你应该会觉得这本书很有启发。如果你是一名投资专业人士，希望利用机器学习做出更好的决策，你也会发现其中的价值。

如果你的背景是软件和机器学习，你可能可以只浏览或跳过一些本领域的介绍性材料。同样，如果你的专业是投资，你可能已经熟悉我们为不同背景的人提供的一些或全部金融背景。

本书假设你想继续学习这个非常动态的领域。为此，它包括了许多章末的学术参考文献，以及伴随 GitHub 仓库中每章的 `README` 文件中链接的其他资源。

你应该能够熟练使用 Python 3 和科学计算库，如 NumPy、pandas 或 SciPy，并期待在学习过程中掌握更多其他技能。一些机器学习和 scikit-learn 的经验会有所帮助，但我们会简要介绍基本的工作流程，并引用各种资源来填补空白或深入了解。同样，基本的金融和投资知识会让一些术语更容易理解。

# 本书涵盖了什么

本书全面介绍了机器学习如何为交易策略的设计和执行增加价值。它分为四个部分，涵盖了数据获取和策略开发过程的不同方面，以及解决各种机器学习挑战的不同解决方案。

## 第一部分 - 数据、Alpha 因子和投资组合

第一部分涵盖了在利用机器学习的交易策略中相关的基本方面。它专注于驱动本书讨论的 ML 算法和策略的数据，概述了如何构建捕捉数据信号内容的特征，并解释了如何优化和评估投资组合的绩效。

*第一章*，*交易的机器学习 - 从构想到执行*，总结了 ML 如何以及为什么对于交易变得重要，描述了投资过程，并概述了 ML 如何增加价值。

*第二章*，*市场和基本数据 - 来源和技术*，涵盖了如何获取和处理市场数据，包括交易所提供的 tick 数据和报告的财务数据。它还演示了许多**开源数据提供商**的访问，这些提供商在本书中将是我们依赖的。

*第三章*，*金融替代数据 - 类别和用例*，解释了评估爆炸式增长的**来源和提供商**的类别和标准。它还演示了如何通过网页抓取创建替代数据集，例如，收集用于与**自然语言处理**（**NLP**）和情感分析一起使用的收益电话转录，在本书的第二部分中我们将介绍。

*第四章*，*金融特征工程 - 如何研究阿尔法因子*，介绍了创建和评估捕捉预测信号的数据转换过程，并展示了如何衡量因子绩效。它还总结了对旨在解释被认为是高效的金融市场中阿尔法的风险因素研究的见解。此外，它演示了如何使用 Python 库离线**工程阿尔法因子**，并介绍了**Zipline**和**Alphalens**库来回测因子并评估其预测能力。

*第五章*，*投资组合优化与绩效评估*，介绍了如何管理、优化和评估由策略执行产生的投资组合。它提供了风险度量标准，并展示了如何使用 Zipline 和**pyfolio**库应用它们。它还介绍了从投资组合风险角度**优化策略的方法**。

## 第二部分 - 用于交易的 ML - 基础知识

第二部分阐明了在端到端工作流程背景下，基本的监督和无监督学习算法如何指导交易策略。

*第六章*，*机器学习过程*，通过概述如何系统地制定、训练、调整和评估 ML 模型的预测性能，为舞台设置了背景。它还解决了**特定领域的问题**，例如使用与金融时间序列交叉验证以在备选 ML 模型中进行选择。

*第七章*，*线性模型 - 从风险因子到收益预测*，展示了如何使用**线性和 logistic 回归**进行推断和预测，以及如何使用正则化来管理过拟合的风险。它演示了如何**预测美国股票的收益**或其未来走势的方向，并使用 Alphalens 评估这些预测的信号内容。

*第八章*，*ML4T 工作流程 - 从模型到策略回测*，将迄今为止单独讨论过的 ML4T 工作流程的各个组成部分集成在一起。它从端到端的视角展示了设计、模拟和评估由 ML 算法驱动的交易策略的过程。为此，它演示了如何使用 Python 库 backtrader 和 Zipline 在历史市场环境中进行 **回测 ML 驱动的策略**。

*第九章*，*用于波动率预测和统计套利的时间序列模型*，涵盖了单变量和多变量时间序列诊断和模型，包括向量自回归模型以及用于波动率预测的 ARCH/GARCH 模型。它还介绍了协整，并演示了如何使用它进行 **使用各种交易所交易基金 (ETFs) 的配对交易策略**。

*第十章*，*贝叶斯 ML - 动态夏普比率和配对交易*，介绍了概率模型以及如何使用 **马尔可夫链蒙特卡洛** (**MCMC**) 采样和变分贝叶斯进行近似推断。它还说明了如何使用 **PyMC3** 进行概率编程，以更深入地了解 **参数和模型不确定性**，例如在评估 **投资组合绩效** 时。

*第十一章*，*随机森林 - 用于日本股票的多头-空头策略*，展示了如何构建、训练和调整非线性基于树的模型进行洞察和预测。它介绍了基于树的集成，并展示了随机森林如何使用自助聚合来克服决策树的一些弱点。然后，我们继续开发和回测 **用于日本股票的多头-空头策略**。

*第十二章*，*提升您的交易策略*，介绍了梯度提升，并演示了如何使用库 XGBoost、LightBGM 和 CatBoost 进行高性能训练和预测。它回顾了如何调整众多超参数并解释模型使用 **SHapley Additive exPlanation** (**SHAP**) 值之前，基于 LightGBM 收益预测构建和评估交易美国股票的策略。

*第十三章*，*基于数据驱动的风险因子和无监督学习的资产配置*，展示了如何使用降维和聚类进行算法交易。它使用主成分和独立成分分析提取数据驱动的风险因子并生成 **特征组合**。它介绍了几种聚类技术，并演示了使用分层聚类进行 **资产配置**。

## 第三部分 - 自然语言处理

第三部分专注于文本数据，并介绍了从这一关键替代数据源提取高质量信号的最新无监督学习技术。

*第十四章*，*用于交易的文本数据 - 情绪分析*，演示了如何将文本数据转换为数字格式，并将第二部分的分类算法应用于大型数据集的情绪分析。

*第十五章*，*主题建模 - 摘要财经新闻*，使用无监督学习来提取总结大量文档的主题，并提供更有效地探索文本数据或将主题用作分类模型特征的方法。它演示了如何将这种技术应用于第三章中获取的收益电话转录和提交给**美国证券交易委员会**（**SEC**）的年度报告。

*第十六章*，*用于收益电话和 SEC 提交文件的词嵌入*，使用神经网络学习最先进的语言特征，以词向量的形式捕捉语义上下文，比传统文本特征更好地表示，并且代表从文本数据中提取交易信号的一个非常有前途的途径。

## 第四部分 - 深度学习和强化学习

第四部分介绍了深度学习和强化学习。

*第十七章*，*交易的深度学习*，介绍了 TensorFlow 2 和 PyTorch，这两个最流行的深度学习框架，我们将在第四部分中使用。它提供了训练和调整的技巧，包括正则化。它还构建并评估了一种**美国股票的交易策略**。

*第十八章*，*用于金融时间序列和卫星图像的卷积神经网络*，涵盖了非常适用于大规模非结构化数据分类任务的**卷积神经网络**（**CNNs**）。我们将介绍成功的架构设计，训练一个 CNN 模型来处理卫星数据（例如，预测经济活动），并使用迁移学习加速训练。我们还将复制一个最近的想法，**将金融时间序列转换为二维图像格式**，以利用 CNNs 的内置假设。

*第十九章*，*用于多变量时间序列和情感分析的循环神经网络*，展示了**循环神经网络**（**RNNs**）在序列到序列建模中的用处，包括用于预测的单变量和多变量时间序列。它演示了如何使用第十六章介绍的词嵌入来捕捉长期内的非线性模式，以**根据 SEC 提交的文件中表达的情绪来预测回报**。

*第二十章*，*用于条件风险因素和资产定价的自编码器*，涵盖了用于高维数据的非线性压缩的自编码器。它实现了一篇最近的论文，该论文使用深度自编码器从数据中学习风险因素回报和因子加载，同时将后者条件化为资产特征。我们将创建一个包含元数据的大型美国股票数据集，并生成预测信号。

*第二十一章*，*用于合成时间序列数据的生成对抗网络*，介绍了深度学习中最激动人心的进展之一。**生成对抗网络**（**GANs**）能够学习生成目标数据类型的合成副本，例如名人的图像。除了图像外，GANs 还被应用于时间序列数据。本章复制了一种生成合成股价数据的新方法，这些数据可用于训练 ML 模型或回测策略，并评估其质量。

*第二十二章*，*深度强化学习 - 构建交易代理*，介绍了**强化学习**（**RL**）如何允许设计和训练代理程序，这些程序会随着时间的推移而学会如何在环境变化中优化决策。您将看到如何创建自定义交易环境，并使用 OpenAI Gym 构建一个根据市场信号做出响应的代理。

*第二十三章*，*总结与下一步*，总结了所学到的教训，并概述了您可以采取的几个步骤，继续学习并构建自己的交易策略。

*附录*，*Alpha 因子库*，列出了近 200 个流行的金融特征，解释了它们的基本原理，并展示了如何计算它们。它还评估并比较了它们在预测每日股票收益方面的表现。

# 获取本书最大的收益

除了前一节总结的内容外，本书的实践性质还包括托管在 GitHub 上的超过 160 个 Jupyter 笔记本，演示了如何在广泛的数据源上将 ML 用于实践交易。本节描述了如何使用 GitHub 存储库，获取许多示例中使用的数据，并设置运行代码的环境。

## GitHub 存储库

本书围绕将 ML 算法应用于交易展开。实践方面在 Jupyter 笔记本中进行，这些笔记本托管在 GitHub 上，详细说明了许多概念和模型。虽然各章节旨在是独立的，但代码示例和结果通常需要太多空间才能完整地包含在其中。因此，在阅读每章时，查看包含重要额外内容的笔记本非常重要，即使您不打算自己运行代码。

存储库组织良好，每个章节都有自己的目录，其中包含相关的笔记本和一个包含必要的单独说明的 `README` 文件，以及与该章节内容相关的参考和资源。在必要时，会在每章节中标识出相关的笔记本。存储库还包含有关如何安装必需库和获取数据的说明。

您可以在以下地址找到代码文件：[`github.com/PacktPublishing/Machine-Learning-for-Algorithmic-Trading-Second-Edition`](https://github.com/PacktPublishing/Machine-Learning-for-Algorithmic-Trading-Second-Edition)。

## 数据来源

我们将使用来自市场、基本和替代来源的免费可用历史数据。*第二章* 和 *第三章* 讨论了这些数据源的特点和访问方式，并介绍了本书中将使用的一些主要提供者。刚才描述的配套 GitHub 仓库包含了获取或创建本书中将使用的一些数据集的说明，其中包括一些较小的数据集。

我们将要使用的一些样本数据源包括但不限于：

+   纳斯达克 ITCH 挂单数据

+   电子数据获取、分析和检索 (EDGAR) 美国证监会文件

+   来自 Seeking Alpha 的收益电话转录

+   Quandl 每日价格和其他超过 3,000 家美国公司的数据点

+   来自 Stooq 的国际股票数据，并使用 yfinance 库

+   来自美国联邦储备系统的各种宏观基本和基准数据

+   大型 Yelp 商家评论和 Twitter 数据集

+   EUROSAT 卫星图像数据

一些数据很大（几个吉字节），例如纳斯达克和美国证监会文件。笔记本会在这种情况下指出。

请查看 GitHub 仓库根目录中的数据目录以获取说明。

## Anaconda 和 Docker 镜像

本书要求使用 Python 3.7 或更高版本，并使用 Anaconda 发行版。本书使用各种 conda 环境来覆盖四个部分，涵盖了广泛的库，同时限制了依赖关系和冲突。

GitHub 仓库中的安装目录包含了详细的说明。您可以使用提供的 Docker 镜像创建具有所需环境的容器，也可以使用 `.yml` 文件在本地创建。

## 下载示例代码文件

您可以从您在[`www.packtpub.com`](http://www.packtpub.com)上的账户下载本书的示例代码文件。如果您在其他地方购买了本书，您可以访问[`www.packtpub.com/support`](http://www.packtpub.com/support)，注册后文件将直接发送至您的邮箱。

您可以按照以下步骤下载代码文件：

1.  在[`www.packtpub.com`](http://www.packtpub.com)上登录或注册。

1.  选择**SUPPORT**选项卡。

1.  点击**代码下载和勘误**。

1.  在**搜索**框中输入书名，然后按照屏幕上的说明操作。

下载文件后，请确保使用您首选的最新版本的压缩工具解压缩或提取文件夹：

+   Windows 上的 WinRAR 或 7-Zip

+   Mac 上的 Zipeg、iZip 或 UnRarX

+   Linux 上的 7-Zip 或 PeaZip

本书的代码捆绑包也托管在 GitHub 上，网址为[`github.com/PacktPublishing/Machine-Learning-for-Algorithmic-Trading-Second-Edition`](https://github.com/PacktPublishing/Machine-Learning-for-Algorithmic-Trading-Second-Edition)。我们的丰富书籍和视频目录中还有其他代码捆绑包，可以在[`github.com/PacktPublishing/`](https://github.com/PacktPublishing/)上找到。欢迎查看！

## 下载彩色图片

我们还提供了一个 PDF 文件，其中包含本书中使用的屏幕截图/图表的彩色图像。您可以在此处下载：[`static.packt-cdn.com/downloads/9781839217715_ColorImages.pdf`](https://static.packt-cdn.com/downloads/9781839217715_ColorImages.pdf)。

## 使用的约定

本书中使用了许多文本约定。

`CodeInText`：表示文本中的代码词，数据库表名，文件夹名，文件名，文件扩展名，路径名，虚拟 URL，用户输入和 Twitter 句柄。例如，“`compute_factors()` 方法创建一个 `MeanReversion` 因子实例，并创建长、短和排名管道列。”

代码块设置如下：

```py
from pykalman import KalmanFilter
kf = KalmanFilter(transition_matrices = [1],
                  observation_matrices = [1],
                  initial_state_mean = 0,
                  initial_state_covariance = 1,
                  observation_covariance=1,
                  transition_covariance=.01) 
```

**粗体**：表示一个新术语，一个重要单词，或者您在屏幕上看到的单词，例如菜单或对话框中的单词，也会出现在文本中。例如，“**Python Algorithmic Trading Library** (**PyAlgoTrade**) 专注于回测，并支持模拟交易和实盘交易。”

信息提示以这种方式出现。

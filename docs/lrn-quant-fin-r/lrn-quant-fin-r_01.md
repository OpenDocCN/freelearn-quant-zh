# 第一章：R 介绍

本章将讨论 R 的基本概念。这将为后续章节提供背景知识。我们不会对 R 中的每个概念进行详细讨论。本章面向那些没有 R 语言基础知识的人，或者是希望从事量化金融职业或希望使用 R 进行量化金融分析的初学者。本章将帮助你入门学习如何编写 R 程序，对于编写复杂程序，你可以参考其他书籍。

本章涵盖以下主题：

+   R 的需求

+   如何下载/安装 R

+   如何安装包

+   数据类型

+   不同数据类型的导入与导出

+   如何编写代码表达式

+   函数

+   如何执行 R 程序

+   循环（for, while, if, 和 if...else）

# R 的需求

有许多统计包可以用于解决量化金融中的问题。但 R 并不是一个统计包，而是一种语言。R 是一种灵活且强大的语言，用于实现高质量的分析。

使用 R 并不需要成为程序员或计算机领域的专家。虽然掌握基本的编程知识确实有助于学习 R，但这并不是开始使用 R 的前提条件。

R 的一大优势是其包系统。它非常庞大。如果某个统计概念存在，那么很有可能 R 中已经有了相应的包。R 内置了许多用于统计学和量化金融的功能。

R 是可扩展的，并提供丰富的功能，鼓励量化金融开发者编写自己的工具或方法来解决分析问题。

R 中的图形和绘图功能无与伦比。R 与学术界有着紧密的关系。随着新研究的发布，由于其开源特性，通常会有与新研究相关的包被添加，这使得 R 能够随时跟进量化金融领域中新兴的概念。

R 是为处理数据而设计的，但在 R 出现时，大数据并未成为焦点。处理大数据时面临的额外挑战包括数据的多样性（如文本数据、度量数据等）、数据安全性、内存、CPU I/O 和 RSC 要求、多台机器等。为应对大数据挑战，R 采用了诸如映射-归约、内存处理、流数据处理、下采样、分块等技术。

此外，R 是免费的软件。其开发社区非常出色且易于接触，他们始终对开发新包以支持新概念感兴趣。互联网上有大量关于 R 各种包的文档可供参考。

因此，R 是一种成本效益高、易于学习的工具。它具有非常好的数据处理、图形和绘图能力。它是一款前沿工具，因为由于其开放性，金融领域的新概念通常伴随着新的 R 包出现。对于追求定量金融职业的人来说，学习 R 是时代的需求。

# 如何下载/安装 R

在这一部分，我们将讨论如何为各种平台（Windows、Linux 和 Mac）下载和安装 R。

打开你的浏览器并访问以下链接：[`cran.rstudio.com/`](https://cran.rstudio.com/)。

从给定的链接中，你可以根据可用的操作系统下载所需的版本。

对于 Windows 版本，点击**下载 R for Windows**，然后选择基础版本并下载**Download R 3.3.1 for Windows**，点击后选择你喜欢的语言选项。接下来，点击安装程序并按步骤完成，它会带你选择一些选项，例如以下内容：

1.  设置向导。

1.  许可协议。

1.  选择你希望安装的文件夹位置。

1.  选择组件。根据系统配置选择选项；如果你不知道系统配置，则选择所有选项。

1.  如果你想自定义安装，选择该选项。

1.  根据你的需求选择 R 启动选项和桌面快捷方式选项。

Windows 上的 R 下载和安装完成。

类似地，你点击 Linux 和 Mac 的安装程序，它将带你完成各种安装选项。

# 如何安装包

R 包是 R 函数、编译代码和示例数据的组合，其存储目录被称为库。默认情况下，安装 R 时会安装一组包，其他的包则需要在需要时添加。

这里给出了一个命令列表，可以检查系统中有哪些包：

```py
>.libPaths()

```

上述命令用于获取或设置 R 知道的库树。它会给出如下结果：

```py
"C:/Program Files/R/R-3.3.1/library"

```

完成后，执行以下命令，它将列出所有可用的包：

```py
>library()

```

有两种方式来安装新包。

## 从 CRAN 直接安装

CRAN 代表**综合 R 存档网络**。它是一个全球范围的 FTP 服务器网络，用于存储 R 的相同、最新版本的代码和文档。

以下命令用于直接从 CRAN 网页安装包。你需要选择合适的镜像：

```py
>install.packages("Package")

```

例如，如果你需要为 R 安装`ggplot2`或`forecast`包，命令如下：

```py
>install.packages("ggplot2")
>install.packages("forecast")

```

## 手动安装包

手动下载所需的 R 包并将 ZIP 版本保存在你指定的位置（例如 `/DATA/RPACKAGES/`）。

例如，如果我们想安装 `ggplot2`，可以运行以下命令来安装并加载到当前的 R 环境中。类似地，其他包也可以被安装：

```py
>install.packages("ggplot2", lib="/data/Rpackages/")
>library(ggplot2, lib.loc="/data/Rpackages/")

```

# 数据类型

在任何编程语言中，都需要使用各种变量存储不同的信息。变量是用于存储值的保留内存位置。因此，通过创建一个变量，你实际上是在保留内存中的一部分空间。你可能想要存储各种数据类型，例如字符、浮动点数、布尔值等。根据数据类型，操作系统会分配内存并决定可以在保留的内存中存储什么内容。

在 R 中，你遇到的所有事物都被称为对象。

R 有五种基本对象类型，也称为原子对象，其他所有对象都是基于这些原子对象构建的。现在，我们将为所有基本对象提供示例并验证它们的类型：

+   字符：

    我们为一个变量分配一个字符值并验证它的类型：

    ```py
     >a <- "hello"
     >print(class(a))

    ```

    产生的结果如下：

    ```py
     [1] "character"

    ```

+   数值：

    我们为一个变量分配一个数值并验证它的类型：

    ```py
     >a <- 2.5
     >print(class(a))

    ```

    产生的结果如下：

    ```py
     [1] "numeric"

    ```

+   整数：

    我们为一个变量分配一个整数值并验证它的类型：

    ```py
     >a <- 6L
     >print(class(a))

    ```

    产生的结果如下：

    ```py
     [1] "integer"

    ```

+   复数：

    我们为一个变量分配一个整数值并验证它的类型：

    ```py
     >a <- 1 + 2i
     >print(class(a))

    ```

    产生的结果如下：

    ```py
     [1] "complex"

    ```

+   逻辑值（`True`/`false`）：

    我们为一个变量分配一个整数值并验证它的类型：

    ```py
     >a <- TRUE
    >print(class(a))

    ```

    然后，产生的结果如下：

    ```py
    [1] "logical"

    ```

R 中的基本对象类型被称为**向量**，它们由相同类型的对象组成。它们不能同时包含两种不同类型的对象，例如既包含字符类型又包含数值类型的向量。

但列表是一个例外，它可以同时包含多种类型的对象。因此，一个列表可以同时包含字符、数值和另一个列表。

现在我们将讨论 R 中常见的数据类型，并为每种数据类型提供至少一个示例。

## 向量

向量已经被定义。如果我们想构建一个包含多个元素的向量，可以使用 `c()` 函数将这些元素组合成一个向量，例如：

```py
>a<-"Quantitative" 
>b<-"Finance" 
>c(a,b) 

```

这将产生以下结果：

```py
[1] "Quantitative" "Finance"   

```

类似地：

```py
>Var<-c(1,2,3) 
>Var 

```

这将产生以下结果：

```py
[1] 1 2 3 

```

## 列表

列表是一个 R 对象，它包含多种类型的对象，例如向量甚至是列表。例如，让我们构建一个列表并使用代码打印出来：

```py
#Create a List and print it 
>List1 = list(c(4,5,6),"Hello", 24.5) 
>print(List1) 

```

当我们执行之前的命令时，它会产生以下结果：

```py
[[1]] 
[1] 4 5 6 

[[2]] 
[1] "Hello" 

[[3]] 
[1] 24.5 

```

我们可以根据需求提取列表中的单个元素。

例如，在上述情况下，如果我们想提取第二个元素：

```py
>print(List1[2]) 

```

执行上述代码后，R 会创建以下输出：

```py
[[1]] 
[1] "Hello" 

```

可以使用 `c()` 函数合并两个列表；例如：

```py
>list1 <- list(5,6,7) 
>list2 <- list("a","b","c") 
>Combined_list <-c(list1,list2) 
>print(Combined_list) 

```

执行上述命令后，我们会得到合并后的列表：

```py
[[1]] 
[1] 5 

[[2]] 
[1] 6 

[[3]] 
[1] 7 

[[4]] 
[1] "a" 

[[5]] 
[1] "b" 

[[6]] 
[1] "c" 

```

## 矩阵

矩阵是一个二维的矩形数据集，它是通过向 `matrix()` 函数输入向量来创建的。

例如，创建一个包含两行三列的矩阵，并打印出来：

```py
>M <- matrix(c(1,2,3,4,5,6), nrow = 2, ncol = 3) 
>print(M) 

```

当我们执行前面的代码时，它会生成以下结果：

```py
     [,1] [,2] [,3] 
[1,]    1    3    5 
[2,]    2    4    6 

```

## 数组（Arrays）

矩阵仅限于二维，但数组可以是任意维度的。`array()` 函数接受 `dim` 属性，用于创建所需的维度。

例如，创建一个数组并打印出来：

```py
>a <- array(c(4,5),dim = c(3,3,2)) 
>print(a) 

```

当我们执行前面的代码时，它会生成以下结果：

```py
, , 1 
     [,1] [,2] [,3] 
[1,]    4    5    4 
[2,]    5    4    5 
[3,]    4    5    4 

, , 2 

     [,1] [,2] [,3] 
[1,]    5    4    5 
[2,]    4    5    4 
[3,]    5    4    5 

```

## 因子（Factors）

因子（Factors）是使用向量创建的 R 对象。它存储向量及向量中存在的不同元素作为标签。标签总是以字符形式存在，不论其原始形式是数字、字符还是布尔值。

因子是通过 `factor()` 函数创建的，级别的数量由 *n* 个级别给出；例如：

```py
>a <-c(2,3,4,2,3) 
>fact <-factor(a) 
>print(fact) 
>print(nlevels(fact)) 

```

当前面的代码执行时，它会生成以下结果：

```py
[1] 2 3 4 2 3 
Levels: 2 3 4 
[1] 3 

```

## 数据框（DataFrames）

数据框（DataFrames）是表格形式的数据对象，每一列可以是不同的类型，即数值型、字符型或逻辑型。每一列由一组具有相同长度的向量构成。

数据框（DataFrames）是通过 `data.frame()` 函数生成的；例如：

```py
>data <-data.frame( 
>+Name = c("Alex", "John", "Bob"), 
>+Age = c(18,20,23), 
>+Gender =c("M","M","M") 
>+) 
>print(data) 

```

当前面的代码执行时，它会生成以下结果：

```py
  Name Age Gender 
1 Alex  18      M 
2 John  20      M 
3  Bob  23      M 

```

# 导入和导出不同的数据类型

在 R 中，我们可以读取存储在 R 环境外的文件。我们也可以将数据写入文件，这些文件可以由操作系统存储和访问。在 R 中，我们可以读取和写入不同格式的文件，如 CSV、Excel、TXT 等。本节将讨论如何读取和写入不同格式的文件。

读取文件所需的文件应存在于当前目录中。否则，应该将目录更改为所需的目标目录。

读取/写入文件的第一步是了解工作目录。你可以通过运行以下代码找到工作目录的路径：

```py
>print (getwd()) 

```

这将提供当前工作目录的路径。如果这不是你想要的目录，请使用以下代码设置你自己的目标目录：

```py
>setwd("") 

```

例如，以下代码将文件夹 `C:/Users` 设置为工作目录：

```py
  >setwd("C:/Users") 

```

## 如何读取和写入 CSV 格式文件

CSV 格式文件是一个文本文件，值由逗号分隔。让我们考虑一个包含股票市场数据的 CSV 文件，其内容如下：

| `日期` | `开盘` | `最高` | `最低` | `收盘` | `成交量` | `调整后收盘` |
| --- | --- | --- | --- | --- | --- | --- |
| 14-10-2016 | 2139.68 | 2149.19 | 2132.98 | 2132.98 | 3.23E+09 | 2132.98 |
| 13-10-2016 | 2130.26 | 2138.19 | 2114.72 | 2132.55 | 3.58E+09 | 2132.55 |
| 12-10-2016 | 2137.67 | 2145.36 | 2132.77 | 2139.18 | 2.98E+09 | 2139.18 |
| 11-10-2016 | 2161.35 | 2161.56 | 2128.84 | 2136.73 | 3.44E+09 | 2136.73 |
| 10-10-2016 | 2160.39 | 2169.6 | 2160.39 | 2163.66 | 2.92E+09 | 2163.66 |

要在 R 中读取前面的文件，首先将该文件保存在工作目录中，然后使用以下代码读取它（文件名为 `Sample.csv`）：

```py
>data<-read.csv("Sample.csv") 
>print(data) 

```

当当前代码执行时，它将给出以下输出：

```py
       Date    Open    High     Low   Close     Volume     Adj.Close 
1  14-10-2016 2139.68 2149.19 2132.98 2132.98 3228150000   2132.98 
2  13-10-2016 2130.26 2138.19 2114.72 2132.55 3580450000   2132.55 
3  12-10-2016 2137.67 2145.36 2132.77 2139.18 2977100000   2139.18 
4  11-10-2016 2161.35 2161.56 2128.84 2136.73 3438270000   2136.73 
5  10-10-2016 2160.39 2169.60 2160.39 2163.66 2916550000   2163.66 

```

`Read.csv` 默认生成 DataFrame 格式的文件；可以通过运行以下代码来检查：

```py
>print(is.data.frame(data)) 

```

现在，无论您想进行什么分析，都可以通过对 DataFrame 应用各种函数来执行分析，分析完成后，您可以使用以下代码写出所需的输出文件：

```py
>write.csv(data,"result.csv") 
>output <- read.csv("result.csv") 
>print(output) 

```

当前面的代码执行时，它会将输出文件以 CSV 格式写入工作目录文件夹。

## XLSX

Excel 是最常见的数据存储文件格式，文件扩展名为 `.xls` 或 `.xlsx`。

`xlsx` 软件包将用于在 R 环境中读取或写入 `.xlsx` 文件。

安装`xlsx`软件包需要依赖 Java，因此需要在系统上安装 Java。可以使用以下命令安装`xlsx`软件包：

```py
>install.packages("xlsx")

```

当前一个命令执行时，它会要求选择最近的 CRAN 镜像，用户必须选择该镜像来安装软件包。我们可以通过执行以下命令来验证软件包是否已安装：

```py
>any(grepl("xlsx",installed.packages()))

```

如果已成功安装，它将显示以下输出：

```py
[1] TRUE
Loading required package: rJava
Loading required package: methods
Loading required package: xlsxjars

```

我们可以通过运行以下脚本加载 `xlsx` 库：

```py
>library("xlsx") 

```

现在让我们将前面的示例文件保存为 `.xlsx` 格式，并在 R 环境中读取它，可以通过执行以下代码实现：

```py
>data <- read.xlsx("Sample.xlsx", sheetIndex = 1) 
>print(data) 

```

这将给出一个 DataFrame 输出，内容如下：

```py
       Date    Open    High     Low   Close     Volume    Adj.Close 
1 2016-10-14 2139.68 2149.19 2132.98 2132.98 3228150000   2132.98 
2 2016-10-13 2130.26 2138.19 2114.72 2132.55 3580450000   2132.55 
3 2016-10-12 2137.67 2145.36 2132.77 2139.18 2977100000   2139.18 
4 2016-10-11 2161.35 2161.56 2128.84 2136.73 3438270000   2136.73 
5 2016-10-10 2160.39 2169.60 2160.39 2163.66 2916550000   2163.66 

```

同样，您可以通过执行以下代码，将 R 文件写入 `.xlsx` 格式：

```py
>output<-write.xlsx(data,"result.xlsx") 
>output<- read.csv("result.csv") 
>print(output) 

```

## 网络数据或在线数据源

网络是当前数据的主要来源之一，我们希望直接将数据从 Web 表单带入 R 环境。R 支持这一功能：

```py
URL <- "http://ichart.finance.yahoo.com/table.csv?s=^GSPC" 
snp <- as.data.frame(read.csv(URL)) 
head(snp) 

```

当前面的代码执行时，它将直接将 `S&P500` 指数的数据以 DataFrame 格式带入 R。这里通过使用 `head()` 函数展示了一部分数据：

```py
        Date    Open    High     Low   Close     Volume   Adj.Close 
1 2016-10-14 2139.68 2149.19 2132.98 2132.98 3228150000   2132.98 
2 2016-10-13 2130.26 2138.19 2114.72 2132.55 3580450000   2132.55 
3 2016-10-12 2137.67 2145.36 2132.77 2139.18 2977100000   2139.18 
4 2016-10-11 2161.35 2161.56 2128.84 2136.73 3438270000   2136.73 
5 2016-10-10 2160.39 2169.60 2160.39 2163.66 2916550000   2163.66 
6 2016-10-07 2164.19 2165.86 2144.85 2153.74 3619890000   2153.74 

```

类似地，如果我们执行以下代码，它将把 DJI 指数数据带入 R 环境：其样本在这里显示：

```py
>URL <- "http://ichart.finance.yahoo.com/table.csv?s=^DJI" 
>dji <- as.data.frame(read.csv(URL)) 
>head(dji) 

```

这将给出以下输出：

```py
        Date     Open     High      Low    Close   Volume  Adj.Close 
1 2016-10-14 18177.35 18261.11 18138.38 18138.38 87050000  18138.38 
2 2016-10-13 18088.32 18137.70 17959.95 18098.94 83160000  18098.94 
3 2016-10-12 18132.63 18193.96 18082.09 18144.20 72230000  18144.20 
4 2016-10-11 18308.43 18312.33 18061.96 18128.66 88610000  18128.66 
5 2016-10-10 18282.95 18399.96 18282.95 18329.04 72110000  18329.04 
6 2016-10-07 18295.35 18319.73 18149.35 18240.49 82680000  18240.49 

```

请注意，在本书的其余部分，我们将主要使用 `snp` 和 `dji` 指数作为示例，这些将被称为 `snp` 和 `dji`。

## 数据库

关系型数据库以规范化格式存储数据，要执行统计分析，我们需要编写复杂的高级查询。但 R 可以轻松连接到各种关系型数据库，如 MySQL、Oracle 和 SQL Server，并将数据表转换为 DataFrame。一旦数据转换为 DataFrame 格式，就可以利用所有可用的函数和软件包轻松进行统计分析。

在本节中，我们将以 MySQL 为例进行说明。

R 内置了一个软件包 `RMySQL`，它提供了与数据库的连接功能；可以使用以下命令安装：

```py
>install.packages("RMySQL")

```

安装完包后，我们可以创建一个连接对象，以便与数据库建立连接。它需要用户名、密码、数据库名和本地主机名作为输入。我们可以提供输入并使用以下命令连接到所需的数据库：

```py
>mysqlconnection = dbConnect(MySQL(), user = '...', password = '...', dbname = '..',host = '.....')

```

当数据库连接时，我们可以通过执行以下命令列出数据库中存在的表：

```py
>dbListTables(mysqlconnection)

```

我们可以使用`dbSendQuery()`函数查询数据库，并通过`fetch()`函数将结果返回给 R。然后，输出以 DataFrame 格式存储：

```py
>result = dbSendQuery(mysqlconnection, "select * from <table name>") 
>data.frame = fetch(result) 
>print(data.fame) 

```

当前面的代码执行时，它会返回所需的输出。

我们可以通过`dbSendQuery()`发送查询，使用过滤子句查询、更新数据库表中的行、向数据库表中插入数据、创建表、删除表等。

# 如何编写代码表达式

在本节中，我们将讨论如何编写各种基本表达式，这些表达式是编写程序的核心元素。之后，我们将讨论如何创建用户定义的函数。

## 表达式

R 代码由一个或多个表达式组成。表达式是执行特定任务的指令。

例如，两个数字的加法可以通过以下表达式给出：

```py
>4+5 

```

它给出以下输出：

```py
[1] 9 

```

如果程序中有多个表达式，它们会按出现的顺序逐一执行。

现在我们将讨论基本的表达式类型。

### 常量表达式

最简单的表达式形式是常量值，可能是字符值或数值。

例如，100 是一个常量值的数值表达式。

`Hello World`是常量表达式的字符形式表达式。

### 算术表达式

R 语言有标准的算术运算符，通过这些运算符可以编写算术表达式。

R 有以下算术运算符：

| **操作数** | **运算符** |
| --- | --- |
| `+` | 加法 |
| `-` | 减法 |
| `*` | 乘法 |
| `/` | 除法 |
| `^` | 乘方 |

使用这些算术运算，可以生成算术表达式；例如：

```py
4+5 
4-5 
4*5 

```

R 遵循 BODMAS 规则。在创建任何算术表达式时，可以使用括号来避免歧义。

### 条件表达式

条件表达式比较两个值并返回一个逻辑值，形式为`True`或`False`。

R 有用于比较值的标准运算符，以及用于组合条件的运算符：

| **操作数** | **运算符** |
| --- | --- |
| `==` | 相等 |
| `>(>=)` | 大于（大于等于） |
| `<(<=)` | 小于（小于等于） |
| `!=` | 不等式 |
| `&&` | 逻辑与 |
| `&#124;&#124;` | 逻辑或 |
| `!` | 逻辑非 |

例如：

`10>5`，执行时返回`True`。

`5>10`，执行时返回`False`。

### 函数调用表达式

R 表达式中最常见和最有用的类型是调用函数。在 R 中有许多内置函数，用户也可以构建自己的函数。在本节中，我们将看到调用函数的基本结构。

函数调用由函数名和紧随其后的括号组成。在括号内，参数以逗号分隔。参数是提供必要信息给函数以执行所需任务的表达式。当我们讨论如何构造用户定义函数时，将提供一个示例。

## 符号和赋值

R 代码由关键字和符号组成。

符号是存储在 RAM 中的对象的标签，在程序执行时，它从内存中获取存储的值。

R 还存储了许多预定义符号的预定义值，这些值会根据程序的需要自动下载使用。

例如，`date()`函数在执行时会返回今天的日期。

表达式的结果可以赋值给一个符号，赋值通过使用赋值运算符`<-`来实现。

例如，表达式`value <- 4 + 6`将符号 value 赋值为 10，并存储在内存中。

## 关键字

一些符号用于表示特殊值，不能重新赋值：

+   `NA`：用于定义缺失或未知的值。

+   `Inf`：用于表示无限大。例如，1/0 会产生无限大的结果。

+   `NaN`：用于定义算术表达式的结果是未定义的。例如，0/0 会产生 NaN。

+   `NULL`：用于表示空结果。

+   `TRUE`和`FALSE`：这是逻辑值，通常在值比较时生成。

## 变量命名

在编写 R 代码时，我们需要将各种信息存储在许多符号下。因此，我们需要有意义地命名这些符号，这样可以使代码更容易理解。符号应该是自解释的。写短符号名会使代码更难理解。

例如，如果我们用`DateOfBirth`或`DOB`来表示出生日期信息，那么第一个选项更好，因为它是自解释的。

# 函数

在本节中，我们将提供一些 R 中已经存在的内置函数的示例，并构造一个用于特定任务的用户定义函数。

函数是一组组合在一起执行特定任务的语句。

R 有许多内置函数，用户也可以定义自己的函数。

根据需求，在 R 中，解释器将控制权传递给函数对象，并传递完成任务所需的参数。任务完成后，函数将控制权返回给解释器。

定义函数的语法如下：

```py
>function_name<-function(arg1, arg2,...){ 
>+function body 
>+} 

```

这里：

+   **函数名**：这是定义的函数的名称，并作为一个对象以该名称存储。

+   **参数**：参数是函数完成任务所需的必要信息。参数是可选的。

+   **函数体**：这是执行函数指定任务的一组语句。

+   **返回值**：返回值是函数的最后一个表达式，它作为函数执行的任务的输出值返回。

这里提供了几个内建函数的示例及其执行结果：

```py
>print(mean(25:82)) 
[1] 53.5 
>print(sum(41:68)) 
[1] 1526 

```

现在我们将看看如何构建用户定义的函数。在这里，我们尝试计算给定序列的平方。

函数的名称是 `findingSqrFunc`，并接受一个参数值，该值必须是整数：

```py
>findingSqrFunc<-function(value){ 
>+for(j in 1:value){ 
>+sqr<-j² 
>+print(sqr) 
>+} 
>+} 

```

一旦前面的代码执行完毕，我们调用该函数：

```py
>findingSqrFunc(4) 

```

我们得到以下输出：

```py
[1] 1 
[1] 4 
[1] 9 
[1] 16 

```

## 无参数调用函数

构造一个没有参数的函数：

```py
>Function_test<-function(){ 
>+ for(i in 1:3){ 
>+ print(i*5) 
>+ } 
>+ } 
>Function_test() 

```

执行前面的无参数函数时，会打印以下输出：

```py
[1] 5 
[1] 10 
[1] 15 

```

## 带参数调用函数

函数的参数可以按照定义时的顺序提供。否则，参数必须按任何顺序提供，并分配给其名称。以下是创建和调用函数的步骤：

1.  首先创建一个函数：

    ```py
            >Function_test<-function(a,b,c){ 
            >+ result<-a*b+c 
            >+ print(result) 
            >+ } 

    ```

1.  按照相同的顺序提供参数名称来调用函数。它将得到以下输出：

    ```py
            >Function_test(2,3,4) 
            [1] 10 

    ```

1.  通过任意顺序提供参数名称来调用函数：

    ```py
            >Function_test(c=4,b=3,a=4) 

    ```

这会得到以下输出：

```py
[1] 16 

```

## 如何执行 R 程序

在本节中，我们将讨论执行 R 程序的不同方法。

## 如何通过 R 窗口运行已保存的文件

在 R 工作空间中运行程序，请按照以下步骤操作：

1.  打开 R（双击桌面图标或从 **开始** 菜单中打开程序）。

1.  点击 **文件** 并打开脚本。

1.  选择你要运行的程序；它将出现在 R 编辑器窗口中。

1.  右键点击并选择 **全选**（或按 *Ctrl* + *A*）。

1.  右键点击并选择 **运行行** 或 **选择项**（或者按 *Ctrl* + *R*）。

1.  输出将显示在 R 控制台窗口中。

## 如何源代码执行 R 脚本

请按照以下步骤执行源代码操作：

1.  首先检查你的工作目录。可以通过以下代码检查：

    ```py
            >print(getwd()) 

    ```

1.  执行前面的代码时，如果给出了指定文件夹的路径，那是正常的。否则，可以使用以下代码更改工作目录：

    ```py
            >setwd("D:/Rcode")  

    ```

1.  根据需要更改目标目录，然后使用以下代码运行所需的代码：

    ```py
            >Source('firstprogram.r') 

    ```

例如，假设程序 `firstprogram.r` 包含以下代码：

```py
  a<-5 
print(a) 

```

执行源代码时，它将在控制台生成输出 `5`。

当你希望告诉 R 执行多行代码而无需等待指令时，可以使用 `source` 函数来运行已保存的脚本。这被称为源代码执行。

最好将整个代码写在 Studio 编辑器中，然后保存并源代码执行整个脚本。如果你希望在源代码脚本中打印输出，请使用 `print` 函数以获取所需的输出。然而，在交互式编辑器中，你不需要写 `print`。它会默认显示输出。

在其他操作系统中，运行程序的命令保持不变。

注释是程序的一部分，在实际程序执行时，解释器会忽略这些注释。

注释使用`#`编写；例如：

```py
#this is comment in my program. 

```

# 循环（for、while、if 和 if...else）

循环是用于自动化多步骤过程的指令，通过组织动作的顺序并将需要重复的部分分组来实现。所有编程语言都提供了内置结构，允许指令或指令块的重复。在编程语言中，循环有两种类型。

决策是编程语言中的重要组成部分。在 R 语言中，可以通过使用条件语句`if...else`来实现决策。以下是语法及示例：

让我们先讨论`if`和`else`条件语句，然后再讨论循环。

## if 语句

让我们先看看`if`和`else`在 R 中的工作原理。`if`子句的一般语法如下：

```py
if (expression) { 
   statement 
} 

```

如果表达式正确，则执行语句，否则不执行任何操作。表达式可以是逻辑或数值向量。在数值向量的情况下，`0`被视为`False`，其他的都被视为`True`，例如：

```py
>x<-5 
>if(x>0) 
>+ { 
>+ print(" I am Positive") 
>+ } 

```

当前面的代码执行时，它打印出`I am Positive`。

## if...else 语句

现在让我们看看`if`和`else`条件在 R 中的工作方式。以下是语法：

```py
if(expression){ 
   statement1 
} else { 
   statement2 
} 

```

`else`部分在`if`部分为`False`时评估，例如：

```py
> x<--5 
> if(x>0) 
>+ { 
>+ print(" I am Positive") 
>+ }else 
>+{ 
>+ print(" I am Negative") 
>+} 

```

当前面的代码执行时，它打印出`I am Negative`。

## for 循环

这些循环在定义的次数内执行，由计数器或索引控制，并在每个循环周期中递增。请查看以下`for`循环构造的语法：

```py
for (val in sequence) { 
    statement 
} 

```

这是一个示例：

```py
>Var <- c(3,6,8,9,11,16) 
>counter <- 0 
>for (val in Var) { 
>+    if(val %% 2 != 0)  counter = counter+1 
>+} 
print(counter) 

```

当前面的代码执行时，它计算向量`c`中奇数的数量，即`3`。

## while 循环

`while`循环是设置用于验证逻辑条件的循环。逻辑条件在循环构造的开始进行测试。以下是语法：

```py
while (expression) { 
   statement 
} 

```

这里，首先评估表达式，如果它为真，则`for`循环体会执行。以下是一个示例：

```py
>Var <- c("Hello") 
>counter <- 4 
>while (counter < 7) { 
>+   print(Var) 
>+   counter = counter+ 1 
>+} 

```

这里，首先评估表达式，如果它为真，则循环体会执行，并且会一直执行直到表达式返回`False`。

## apply()

`apply()`是 R 语言中的一个函数，用于对矩阵、向量或数组进行快速操作，可以在行、列上或同时对行列执行操作。现在让我们尝试使用`apply`函数计算矩阵的行和之和。让我们执行以下代码：

```py
> sample = matrix(c(1:10), nrow = 5 , ncol = 2) 
> apply(sample, 1,sum) 

```

它生成按行求和的结果。

## sapply()

`sapply()`对数据集（如列表或向量）进行操作，并对每个项目调用指定的函数。让我们执行以下代码检查示例：

```py
> sapply(1:5, function(x) x³) 

```

它计算从`1`到`5`的立方。

# 循环控制语句

有一些控制语句可以改变正常的执行顺序。`break`和`next`是循环控制语句，我们将在此简要讨论这些控制语句。

## break

`break` 终止循环并将控制权交给循环中的下一个语句；例如：

```py
>Vec <- c("Hello") 
>counter <- 5 
>repeat { 
>+   print(Vec) 
>+   counter <- counter + 1 
>+   if(counter > 8) { 
>+      break 
>+   } 
>+} 

```

由于 `break` 语句的作用，当前述语句执行时，它会打印出 `Hello` 四次，然后退出循环。`repeat` 是另一种循环结构，它会一直执行，除非指定停止条件。

## next

`next` 不会终止循环，而是跳过当前迭代并进入下一次迭代。请参见以下示例：

```py
>Vec <- c(2,3,4,5,6) 
>for ( i in Vec) { 
>+   if (i == 4) { 
>+      next 
>+   } 
>+   print(i) 
>+} 

```

在前面的示例中，当迭代到向量 `Vec` 的第三个元素时，控制流跳过当前迭代并返回到下一个迭代。因此，当前述语句执行时，它打印出向量元素 `2`、`3`、`5` 和 `6`，并跳过 `4`。

# 问题

1.  R 中有哪些不同的原子对象？

1.  R 中的向量是什么？

1.  向量和列表有什么区别？

1.  数组和矩阵有什么区别？

1.  什么是数据框（DataFrame），它在 R 中的意义是什么？

1.  如何在 R 中读取和写入 CSV 和 XLSX 文件？

1.  如何在 R 中读取和写入股市数据？

1.  解释如何将 R 连接到任何关系型数据库。

1.  什么是函数，它在 R 中的意义是什么？

1.  R 中的赋值运算符是什么？

1.  如何在 R 中调用函数？

1.  如何在 R 中调用脚本？

1.  R 中的 `for` 循环和 `while` 循环有什么区别？

# 总结

现在让我们回顾一下本章到目前为止学到的内容：

+   对于从事金融分析的分析师来说，学习 R 是非常重要的

+   安装 R 及其包

+   R 中的基本对象有字符、数字、整数、复数和逻辑型

+   R 中常用的数据类型包括列表、矩阵、数组、因子和数据框

+   从外部数据文件（如 CSV 和 XLSX）读取文件，特别是从 R 中的在线源和数据库读取

+   从 R 写入 CSV 和 XLSX 文件

+   编写不同类型的表达式，例如常量、算术、逻辑、符号、赋值等

+   编写用户定义的函数

+   调用用户定义函数和内建函数的方法

+   从控制台窗口运行 R 程序以及通过源文件运行保存的文件

+   使用 if 和 else 语句进行条件决策的用法

+   使用 `for` 和 `while` 等循环

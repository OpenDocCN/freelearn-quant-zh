# 下一步

本书的目标是使您能够将**机器学习**（**ML**）应用于各种数据源，并提取对投资策略的设计和执行有用的信号。为此，我们将机器学习介绍为交易策略过程的重要组成部分。我们看到，机器学习可以在设计、测试、执行和评估策略的多个步骤中添加价值。

显然，机器学习的核心价值主张在于能够比人类专家更系统地从更大量的数据中提取可行动的信息。一方面，这一价值主张随着数字数据的爆炸而变得更具吸引力和必要性，使得利用计算能力进行数据处理变得更有前景。另一方面，机器学习的应用仍然需要人类的重大干预和专业知识来定义目标、选择和筛选数据、设计和优化模型以及适当地利用结果。

在这个总结性的章节中，我们将简要总结本书中学到的关键工具、应用和经验教训，以避免在许多细节之后失去对整体情况的把握。然后，我们将确定我们未涵盖但值得关注的领域，这些领域将有助于您进一步扩展我们介绍的许多机器学习技术，并在日常使用中变得高效。我们将强调对个人生产力有价值的技能组合。

总之，在本章中，我们将讨论以下主题：

+   回顾主要收获和经验教训，

+   指出在本书中技术的下一步建设方向，

+   建议将机器学习纳入您的投资过程中的方法。

# 主要收获和经验教训

在继续进行交易机器学习实践时要牢记的重要见解包括：

+   数据是最重要的因素

+   领域专业知识有助于发现数据的潜在价值，特别是在金融领域

+   机器学习提供了许多用例的工具，应进一步发展并结合使用数据解决新问题

+   模型目标的选择和性能诊断对于朝向最佳系统的生产力迭代至关重要

+   回测过拟合是一个需要重视的巨大挑战

+   黑盒模型透明化有助于建立信心并促进采用

我们将更详细地阐述这些想法。

# 数据是最重要的因素

交易和其他领域中机器学习的崛起很大程度上补充了我们详细介绍的数据爆炸。我们在第二章，*市场和基本数据*中说明了如何访问和处理这些数据源，历来是量化投资的支柱。在第三章，*金融替代数据*中，我们提出了一个框架，用于评估替代数据潜在价值的标准。

一个关键的见解是，像深度神经网络这样的最新 ML 技术之所以成功，是因为它们的预测性能随着数据的增加而不断提高。另一方面，模型和数据复杂性需要匹配，以平衡偏差-方差的权衡。管理数据质量和整合数据集是实现潜在价值的关键步骤。

# 质量控制

就像石油一样，这些天很流行的一个比较，数据经过从原始形式到能够推动交易策略的精炼产品的多个阶段的管道。仔细关注最终产品的质量至关重要，以达到预期的里程碑。

有时，您会获得原始数据，并控制所需的大量转换。更常见的情况是，您处理中间产品，并应明确了解此时数据究竟测量了什么。

不同于石油，随着数据源的不断增加，通常没有客观的质量标准。相反，质量取决于其信号内容，而信号内容又取决于您的投资目标。对新数据集的成本效益评估需要一个高效的工作流程，包括我们将在以下部分介绍的适当基础设施。

# 数据整合

对于投资策略的数据价值往往取决于结合市场、基本和替代数据的互补来源。我们发现，像基于树的集成或神经网络这样的 ML 算法的预测能力部分是由于它们能够检测到非线性关系，特别是变量之间的相互作用效应。

调节变量影响的能力作为其他模型特征的函数在捕获目标结果的不同方面的数据输入上得到了发展。将资产价格与宏观基本面、社会情绪、信用卡支付和卫星数据相结合，可能会在不同的经济和市场环境中产生更可靠的预测，比单独使用每个来源（假设数据足够大以学习隐藏的关系）更可靠。

从多个来源获取数据增加了正确标注的挑战。为了避免通过使用数据来测试算法，在数据实际可用之前就有了预见性偏见，分配准确的时间戳至关重要。例如，数据可能由提供者分配了时间戳，需要调整以反映数据实际可用于实时算法的时间点。

# 领域专业知识有助于释放数据的价值。

我们强调了数据是成功的机器学习应用的必要驱动因素，但领域专业知识也是重要的，以指导战略方向、特征工程和数据选择、模型设计。

在任何领域，从业者都对关键结果的驱动因素以及它们之间的关系有着理论。金融领域以大量相关的定量研究（理论和实证）脱颖而出。马科斯·洛佩斯·德·普拉多等人（参见 GitHub 的参考资料[`github.com/PacktPublishing/Hands-On-Machine-Learning-for-Trading`](https://github.com/PacktPublishing/Hands-On-Machine-Learning-for-Trading)）批评了大多数经验结果，因为普遍存在的数据挖掘可能会使研究结果无效。尽管如此，对金融市场运作方式的深刻理解是存在的，并应该指导数据的选择和使用，以及依赖机器学习的策略的正当化。我们在第四章 *Alpha Factor Research* 和 第五章 *Strategy Evaluation* 中概述了关键思想。

另一方面，新的机器学习技术可能会发现有关金融结果驱动因素的新假设，这将为机器学习理论提供信息，并应进行独立测试。

# 特征工程和 alpha 因子研究

与原始数据相比，特征工程通常是使信号对算法有用的关键。利用几十年的风险因素研究成果，从理论和实证的角度来驱动收益是一个很好的起点，以优先考虑更有可能反映相关信息的数据转换。

然而，只有创造性的特征工程才能带来能够随着时间竞争的创新策略。即使对于新的 alpha 因子，一个能够解释它们如何工作的引人注目的叙述，鉴于已有的市场动态和投资者行为理念，将会为资本分配提供更多信心。

假设发现的风险和对历史数据过拟合的风险使得在测试之前优先考虑策略变得更加必要，而不是*让数据说话*。我们讨论了如何根据实验数量调整夏普比率。

# 机器学习是解决数据问题的工具包

机器学习提供了可以应用于许多用例的算法解决方案和技术。本书的第 2、3 和 4 部分（如第一章，*用于交易的机器学习* 中所述）将机器学习作为一套多样化的工具集，可以为策略过程的各个步骤增加价值，包括：

+   想法生成和阿尔法因子研究，

+   信号聚合和投资组合优化，

+   策略测试

+   交易执行，并且

+   策略评估

更重要的是，机器学习算法被设计成进一步发展、适应和结合以解决不同环境中的新问题。因此，除了能够将它们应用于数据以进行富有成效的实验和研究外，理解这些算法背后的关键概念和思想也非常重要，如第六章，*机器学习过程* 中所述。

此外，最佳结果通常是通过将人类专家与机器学习工具结合起来实现的。在第一章，*用于交易的机器学习* 中，我们介绍了量化投资风格，其中包括定量和算法交易。这种方法可能会变得越来越重要，并且依赖于对我们涵盖的基本工具以及将它们扩展到各种数据集的灵活和创造性应用。

# 模型诊断有助于加快优化速度

在第六章，*机器学习过程* 中，我们概述了一些最重要的概念。机器学习算法通过对功能形式做出假设来学习输入数据和目标之间的关系。如果学习基于噪声而不是信号，预测性能将受到影响。

当然，我们今天无法从明天的结果的角度分离信号和噪声。例如，使用学习曲线和优化验证测试的模型诊断可以帮助缓解这一基本挑战，并校准算法的选择或配置以适应手头的数据或任务。通过定义专注的模型目标，以及对于复杂模型，区分由于优化算法或目标本身的问题而导致的性能缺陷，可以使这项任务变得更容易。

# 不做免费午餐

没有系统——计算机程序或人类——有基础可靠地预测新样本的结果，超出了它在训练期间观察到的范围之外。唯一的出路是具有一些额外的先验知识或做出超出训练样本范围的假设。我们从本书的第七章，*线性模型* 和 第八章，*时间序列模型*，到非线性集成模型的广泛范围的算法进行了讨论，如第十章，*决策树和随机森林* 和 第十一章，*梯度提升机*，以及本书第四部分的各个章节中的神经网络。

我们看到，线性模型做出了一个强烈的假设，即输入和输出之间的关系具有非常简单的形式，而稍后讨论的模型旨在学习更复杂的函数。虽然显而易见简单模型在大多数情况下会失败，但复杂模型并不总是更好。如果真实关系是线性的，但数据是嘈杂的，复杂模型将会学习噪音作为其假定存在的复杂关系的一部分。这就是“没有免费午餐定理”的基本思想，该定理指出没有一种算法在所有任务中都是普遍优越的。在某些情况下的良好拟合会以在其他情况下的性能不佳为代价。

定制算法选择的关键工具是数据探索和基于对模型做出的假设的理解进行的实验。

# 管理偏差-方差权衡

适应算法到数据的挑战有一个不同的视角，即偏差和方差之间的权衡，这会导致除了数据的自然噪音之外的预测误差。一个简单的模型如果没有充分捕捉到数据中的关系，将会欠拟合并表现出偏差，即，会产生系统性的错误预测。一个过于复杂的模型会过拟合，并且除了任何信号外还会学习噪声，因此结果会对不同样本显示出很多方差。

在模型选择和优化过程的任何给定迭代中，诊断这种权衡的关键工具是学习曲线。它显示了训练和验证误差如何取决于样本大小。这使我们能够在不同的选项之间做出决定以改善性能：调整模型的复杂性或获取更多数据点。

训练误差越接近人类或其他基准，模型过拟合的可能性就越大。低验证误差告诉我们我们很幸运地找到了一个好模型。如果验证误差很高，我们就没有。然而，如果随着训练大小的增加而持续下降，更多数据可能有所帮助。如果训练误差很高，更多的数据不太可能有所帮助，我们应该增加特征或使用更灵活的算法。

# 定义目标模型目标

机器学习过程中的第一步之一是为算法定义一个优化的目标。有时，选择很简单，例如在回归问题中。分类任务可能更加困难，例如，当我们关心精确率和召回率时。将相互冲突的目标合并到一个单一指标中，如 F1 得分，有助于聚焦优化工作。我们还可以包括需要满足而不是优化的条件。我们还看到，强化学习完全取决于定义正确的奖励函数来指导代理的学习过程。

# 优化验证测试

Andrew Ng（请参见 GitHub 上的参考资料：[`github.com/PacktPublishing/Hands-On-Machine-Learning-for-Algorithmic-Trading`](https://github.com/PacktPublishing/Hands-On-Machine-Learning-for-Algorithmic-Trading)）强调了由于学习算法或优化算法的问题而导致性能不佳之间的区别。像神经网络这样的复杂模型假设非线性关系，而优化算法的搜索过程可能会陷入局部而不是全局最优解。

例如，如果一个模型未能正确翻译一个短语，则测试会比较正确预测和搜索算法发现的解决方案的分数。如果学习算法为正确解决方案得分更高，则搜索算法需要改进。否则，学习算法正在优化错误的目标。

# 警惕反向测试过拟合

我们在整本书中反复讨论了由于过度拟合历史数据而产生的假发现的风险。第五章，*策略评估*，概述了主要驱动因素和潜在的补救措施。低噪声与信号比和相对较小的数据集（与网络规模图像或文本数据相比）使得这一挑战在交易领域尤为严重。意识至关重要，因为数据和应用 ML 工具的易获取性会将风险指数级增加。

没有逃脱，因为没有预防的方法。然而，我们提出了调整反向测试指标以考虑重复试验的方法，比如通货紧缩夏普比率。在制定实时交易策略时，阶段性纸上交易和在市场执行过程中密切监测绩效需要成为实施过程的一部分。

# 如何从黑匣子模型中获得见解

深度神经网络和复杂集成模型在被视为不可透明的黑匣子模型时可能会引起怀疑，特别是考虑到反向测试过拟合的风险。我们在第十一章中介绍了几种方法，以了解这些模型如何进行预测，*梯度提升机*。

除了传统的特征重要性度量之外，最近博弈论创新的**SHapley Additive exPlanations**（**SHAP**）是理解复杂模型机制的重要一步。SHAP 值允许对特征及其值进行精确归因，从而更容易在特定投资目标的市场行为理论光下验证模型的逻辑。除了理论基础外，确切的特征重要性得分和预测的归因还允许更深入地洞察感兴趣的投资结果的驱动因素。

另一方面，围绕模型预测透明度是否应该成为目标本身存在一些争议。深度学习发明者之一 Geoffrey Hinton 认为，人类决策通常也是模糊的，机器也应该根据其结果进行评估，就像我们期望投资经理一样。

# 实践中的交易机器学习

当您继续将众多工具和技术整合到您的投资和交易流程中时，有许多事情可以成为您努力的焦点。如果您的目标是做出更好的决策，您应该选择与您当前技能集相符的现实而雄心勃勃的项目。这将帮助您开发一个高效的工作流程，支持您具有生产力的工具，并获得实际经验。

我们将简要列出一些有用的工具，以扩展本书涵盖的 Python 生态系统，并参考 GitHub 上列出的链接进行更深入的探讨。这些包括大数据技术，最终将有必要以规模实现用于交易策略的 ML。我们还将列出一些允许您使用 Python 实施交易策略的平台，通常具有数据源和 ML 算法和库的访问权限。

# 数据管理技术

数据在 ML 流程中的核心作用要求熟悉一系列技术，以便在规模上存储、转换和分析数据，包括使用云服务，如 Amazon Web Services、Azure 和 Google Cloud。

# 数据库系统

数据存储意味着使用数据库，历史上由使用 SQL 以商业提供者（如 Oracle 和 Microsoft）和开源实现（如 PostgreSQL 和 MySQL）的明确定义的表格格式存储和检索数据的**关系数据库管理系统**（**RDBMS**）主导。最近，出现了一些替代方案，通常被集体标记为 NoSQL，但相当多样，即：

+   **键值存储**：快速读/写对象。我们在第二章中介绍了 HDF5 格式，*市场和基本数据*，它有助于快速访问 pandas DataFrame。

+   **列存储**：利用列中数据的同质性来实现压缩和更快的基于列的操作，如聚合。在流行的 Amazon Redshift 数据仓库解决方案、Apache Parquet、Cassandra 或 Google 的 Big Table 中使用。

+   **文档存储**：设计用于存储不符合关系数据库所需的严格模式定义的数据。由使用 JSON 或 XML 格式的网络应用程序所普及，我们在第四章 *Alpha Factor Research* 中遇到过。例如，在 MongoDB 中使用。

+   **图数据库**：设计用于存储具有节点和边的网络，并专注于网络指标和关系的查询。用于 Neo4J 和 Apache Giraph。

已经有一些转变朝向了关系数据库系统所建立的约定。Python 生态系统促进了与许多标准数据源的交互，并提供了快速的 HDF5 和 Parquet 格式，正如本书中所展示的。

# 大数据技术 - Hadoop 和 Spark

规模化的数据管理，即数百 GB 甚至更多，需要使用形成集群的多台机器来进行读取、写入和计算操作，并行进行，即分布在各种机器上。

Hadoop 生态系统已经成为一个分布式存储和处理大数据的开源软件框架，使用了 Google 开发的 MapReduce 编程模型。生态系统在 Apache 基金会的框架下变得多样化，并且今天包括了许多项目，涵盖了规模化数据管理的不同方面。Hadoop 中的关键工具包括：

+   **Apache Pig**：使用 MapReduce 实现大规模 **提取-转换-加载** (**ETL**) 流水线的数据处理语言，由 Yahoo 开发

+   **Apache Hive**：在 Facebook 开发的交互式 SQL 查询的事实标准，可查询 PB 级数据

+   **Apache HBASE**：用于实时读/写访问的 NoSQL 数据库，线性扩展到数十亿行和数百万列，并可以使用各种不同的模式组合数据源。

Apache Spark 已成为集群上交互式分析最流行的平台。MapReduce 框架允许并行计算，但需要反复的磁盘读写操作以确保数据冗余。Spark 大大加速了规模化计算，原因是**弹性分布式数据**（**RDD**）结构，可以进行高度优化的内存计算。这包括了像梯度下降这样的多个 ML 算法所需的迭代计算。

# 机器学习工具

我们在这本书中涵盖了 Python 生态系统的许多库。Python 已经发展成为数据科学和机器学习的首选语言，一系列开源库不断多样化和成熟，构建在强大的科学计算库 NumPy 和 SciPy 的稳固核心之上。显著促进了 Python 在数据科学领域的使用的流行 pandas 库正在计划其 1.0 版本的发布。scikit-learn 接口已经成为现代机器学习库（如 `xgboost` 或 `lightgbm`）的标准，它经常与各种工作流自动化工具（如 `GridSearchCV` 和 `Pipeline`）交互，我们在整本书中都反复使用了这些工具。

有几个提供机器学习工作流的服务提供商：

+   H2O.ai ([`www.h2o.ai/`](https://www.h2o.ai/)) 提供了将云计算与机器学习自动化集成的 H2O 平台。它允许用户将数千个潜在模型与其数据拟合以探索数据中的模式。它在 Python、R 和 Java 中都有接口。

+   DataRobot 旨在通过提供一个快速构建和部署预测模型的平台，来自动化模型开发过程，可在云端或本地部署。

+   Dataiku 是一个协作数据科学平台，旨在帮助分析师和工程师探索、原型、构建和交付自己的数据产品。

还有一些由公司主导的开源倡议，它们在 Python 生态系统上构建和扩展：

+   定量对冲基金 Two Sigma 在 `beakerx` 项目下向 Jupyter Notebook 环境贡献了量化分析工具。

+   彭博社已将 Jupyter Notebook 集成到其终端，以便对其金融数据进行交互式分析。

# 在线交易平台

开发利用机器学习的交易策略的主要选项是在线平台，这些平台经常寻找并分配资金给成功的交易策略。流行的解决方案包括 Quantopian、Quantconnect、QuantRocket 以及最近关注高频交易的 Alpha Trading Labs。

此外，**交互经纪商**（**IB**）提供了一个 Python API，您可以使用它来开发自己的交易解决方案。

# Quantopian

我们介绍了 Quantopian 平台，并演示了如何使用其研究和交易环境来分析和测试交易策略与历史数据进行对比。Quantopian 使用 Python 并提供大量教育资料。

Quantopian 主办持续每日比赛，以招募算法为其众包对冲基金组合。Quantopian 为获胜算法提供资金支持。在线交易已于 2017 年 9 月停止，但该平台仍提供大量历史数据，并吸引着活跃的开发者和交易者社区，是讨论想法和向他人学习的良好起点。

# QuantConnect

QuantConnect 是另一个开源、社区驱动的算法交易平台，与 Quantopian 竞争。它还提供一个 IDE，用于使用 Python 和其他语言进行算法策略的回测和实时交易。

QuantConnect 还拥有来自世界各地的动态全球社区，并提供许多资产类别的访问，包括股票、期货、外汇和加密货币。它提供与各种经纪人（如 IB、OANDA 和 GDAX）的实时交易集成。

# QuantRocket

QuantRocket 是一个基于 Python 的平台，用于研究、回测和运行自动化的量化交易策略。它提供数据收集工具、多个数据供应商、研究环境、多个回测器，以及通过 IB 进行实时和模拟交易。它以支持国际股票交易而自豪，并凭借其灵活性脱颖而出。

QuantRocket 支持多个引擎 — 其自己的 Moonshot，以及用户选择的第三方引擎。虽然 QuantRocket 没有传统的集成开发环境（IDE），但与 Jupyter 集成良好，可以产生类似的功能。QuantRocket 在撰写本文时并不免费，定价从 19 美元/月开始。

# 结论

我们从强调数字数据的爆炸和 ML 作为投资和交易策略的战略能力的出现开始。这种动态反映了金融以外的全球商业和技术趋势，而且很可能会继续下去，而不是停滞或逆转。许多投资公司刚刚开始利用各种人工智能工具，就像个人正在获得相关的技能，业务流程正在适应这些价值创造的新机会一样，如导论章节所述。

未来还有许多令人兴奋的 ML 应用于交易的发展，可能会进一步推动当前的动能。它们可能在未来几年变得相关，并包括 ML 过程的自动化、合成训练数据的生成和量子计算的出现。这一领域的非凡活力意味着这本身就可以填满一本书，并且旅程将继续保持令人兴奋。

- en: '10'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: '10'
- en: Monte Carlo Simulations in Finance
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 金融中的蒙特卡罗模拟
- en: Monte Carlo simulations are a class of computational algorithms that use repeated
    random sampling to solve any problems that have a probabilistic interpretation.
    In finance, one of the reasons they gained popularity is that they can be used
    to accurately estimate integrals. The main idea of Monte Carlo simulations is
    to produce a multitude of sample paths (possible scenarios/outcomes), often over
    a given period of time. The horizon is then split into a specified number of time
    steps and the process of doing so is called discretization. Its goal is to approximate
    the continuous time in which the pricing of financial instruments happens.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
  zh: 蒙特卡罗模拟是一类计算算法，通过反复随机抽样解决任何具有概率解释的问题。在金融领域，蒙特卡罗方法之所以流行，是因为它们可以准确估计积分。蒙特卡罗模拟的主要思想是生成大量的样本路径（可能的情景/结果），通常是在给定时间段内进行。然后将时间区间分成若干个时间步骤，这一过程被称为离散化。其目标是近似描述金融工具定价所发生的连续时间。
- en: The results from all of these simulated sample paths can be used to calculate
    metrics such as the percentage of times an event occurred, the average value of
    an instrument at the last step, and so on. Historically, the main problem with
    the Monte Carlo approach was that it required heavy computational power to calculate
    all of the considered scenarios. Nowadays, this is becoming less of a problem
    as we can run fairly advanced simulations on a desktop computer or a laptop, and
    if we run out of computing power, we can use cloud computing and its more powerful
    processors.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
  zh: 所有这些模拟的样本路径结果可以用来计算一些指标，例如事件发生的频率、在最后一步时工具的平均值等。历史上，蒙特卡罗方法的主要问题是它需要大量的计算能力来计算所有考虑的情景。如今，这不再是大问题，因为我们可以在台式电脑或笔记本电脑上运行相当先进的模拟，如果计算能力不足，我们还可以使用云计算及其更强大的处理器。
- en: By the end of this chapter, we will have seen how we can use Monte Carlo methods
    in various scenarios and tasks. In some of them, we will create the simulations
    from scratch, while in others, we will use modern Python libraries to make the
    process even easier. Due to the method’s flexibility, Monte Carlo is one of the
    most important techniques in computational finance. It can be adapted to various
    problems, such as pricing derivatives with no closed-form solution (American/exotic
    options), valuation of bonds (for example, a zero-coupon bond), estimating the
    uncertainty of a portfolio (for example, by calculating Value-at-Risk and Expected
    Shortfall), and carrying out stress tests in risk management. We will show you
    how to solve some of these problems in this chapter.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章结束时，我们将看到如何在各种场景和任务中使用蒙特卡罗方法。在其中一些任务中，我们将从头开始创建模拟，而在其他任务中，我们将使用现代Python库来简化过程。由于该方法的灵活性，蒙特卡罗是计算金融学中最重要的技术之一。它可以适应各种问题，比如定价没有封闭解的衍生品（如美式期权/奇异期权）、债券估值（例如，零息债券）、估算投资组合的不确定性（例如，通过计算风险价值和预期亏损）、以及在风险管理中进行压力测试。本章中，我们将向你展示如何解决其中一些问题。
- en: 'In this chapter, we cover the following recipes:'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们将覆盖以下内容：
- en: Simulating stock price dynamics using a geometric Brownian motion
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用几何布朗运动模拟股票价格动态
- en: Pricing European options using simulations
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用模拟定价欧洲期权
- en: Pricing American options with Least Squares Monte Carlo
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用最小二乘蒙特卡罗定价美式期权
- en: Pricing American options using QuantLib
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用QuantLib定价美式期权
- en: Pricing barrier options
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 定价障碍期权
- en: Estimating Value-at-Risk using Monte Carlo
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用蒙特卡罗估算风险价值
- en: Simulating stock price dynamics using a geometric Brownian motion
  id: totrans-12
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用几何布朗运动模拟股票价格动态
- en: 'Simulating stock prices plays a crucial role in the valuation of many derivatives,
    most notably options. Due to the randomness in the price movement, these simulations
    rely on **stochastic differential equations** (**SDEs**). A stochastic process
    is said to follow a **geometric Brownian motion** (**GBM**) when it satisfies
    the following SDE:'
  id: totrans-13
  prefs: []
  type: TYPE_NORMAL
  zh: 模拟股票价格在许多衍生品定价中起着至关重要的作用，尤其是期权。由于价格波动的随机性，这些模拟依赖于**随机微分方程**（**SDEs**）。当一个随机过程满足以下SDE时，它被认为遵循**几何布朗运动**（**GBM**）：
- en: '![](../Images/B18112_10_001.png)'
  id: totrans-14
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B18112_10_001.png)'
- en: 'Here, we have the following:'
  id: totrans-15
  prefs: []
  type: TYPE_NORMAL
  zh: 这里我们有以下内容：
- en: '*S*[t]—Stock price'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*S*[t]—股票价格'
- en: '*![](../Images/B18112_10_036.png)*—The drift coefficient, that is, the average
    return over a given period or the instantaneous expected return'
  id: totrans-17
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*![](../Images/B18112_10_036.png)*—漂移系数，即给定时间段内的平均回报或瞬时预期回报'
- en: '*![](../Images/B18112_10_037.png)*—The diffusion coefficient, that is, how
    much volatility is in the drift'
  id: totrans-18
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*![](../Images/B18112_10_037.png)*—扩散系数，即漂移中的波动性有多大'
- en: '*W*[t] —The Brownian motion'
  id: totrans-19
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*W*[t] —布朗运动'
- en: '*d*—This symbolizes the change in the variable over the considered time increment,
    while *dt* is the change in time'
  id: totrans-20
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*d*—表示在所考虑的时间增量内变量的变化，而 *dt* 是时间的变化'
- en: We will not investigate the properties of the **Brownian motion** in too much
    depth, as it is outside the scope of this book. Suffice to say, Brownian increments
    are calculated as a product of a Standard Normal random variable ![](../Images/B18112_10_002.png)
    and the square root of the time increment.
  id: totrans-21
  prefs: []
  type: TYPE_NORMAL
  zh: 我们不会过多探讨**布朗运动**的性质，因为这超出了本书的范围。简而言之，布朗增量是通过标准正态随机变量 ![](../Images/B18112_10_002.png)
    与时间增量的平方根的乘积来计算的。
- en: Another way to say this is that the Brownian increment comes from ![](../Images/B18112_10_003.png),
    where *t* is the time increment. We obtain the Brownian path by taking the cumulative
    sum of the Brownian increments.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种说法是，布朗增量来自于 ![](../Images/B18112_10_003.png)，其中 *t* 是时间增量。我们通过对布朗增量求累积和来获得布朗路径。
- en: 'The SDE mentioned above is one of the few that has a closed-form solution:'
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 上述SDE是少数几个具有封闭解的方程之一：
- en: '![](../Images/B18112_10_004.png)'
  id: totrans-24
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B18112_10_004.png)'
- en: Where *S*[0] = S(0) is the initial value of the process, which in this case
    is the initial price of a stock. The preceding equation presents the relationship
    between the stock price at time *t* and the initial stock price.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 *S*[0] = S(0) 是过程的初始值，在本例中是股票的初始价格。前述方程展示了时间 *t* 的股价与初始股价之间的关系。
- en: 'For simulations, we can use the following recursive formula:'
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: 对于模拟，我们可以使用以下递归公式：
- en: '![](../Images/B18112_10_005.png)'
  id: totrans-27
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B18112_10_005.png)'
- en: Where *Z*[i] is a Standard Normal random variable and *i = 0, 1, …, T-1* is
    the time index. This specification is possible because the increments of *W* are
    independent and normally distributed. Please refer to Euler’s discretization for
    a better understanding of the formula’s origin.
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 *Z*[i] 是标准正态随机变量，*i = 0, 1, …, T-1* 是时间索引。之所以可以这样指定，是因为 *W* 的增量是独立的且服从正态分布。欲了解公式的来源，请参考欧拉离散化方法。
- en: A GBM is a process that does not account for mean-reversion and time-dependent
    volatility. That is why it is often used for stocks and not for bond prices, which
    tend to display long-term reversion to the face value.
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: GBM 是一种不考虑均值回归和时间相关波动性的过程。因此，它通常用于股票，而不用于债券价格，后者往往显示长期回归面值的特性。
- en: In this recipe, we use Monte Carlo methods and a GBM to simulate IBM’s stock
    prices one month ahead—using data from 2021, we will simulate the possible paths
    over January 2022.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: 在本食谱中，我们使用蒙特卡罗方法和GBM来模拟IBM未来一个月的股价——使用2021年的数据，我们将模拟2022年1月的可能路径。
- en: How to do it...
  id: totrans-31
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何实现……
- en: 'Execute the following steps to simulate IBM’s stock prices one month ahead:'
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤来模拟IBM未来一个月的股价：
- en: 'Import the libraries:'
  id: totrans-33
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入库：
- en: '[PRE0]'
  id: totrans-34
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Download IBM’s stock prices from Yahoo Finance:'
  id: totrans-35
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从雅虎财经下载IBM的股价：
- en: '[PRE1]'
  id: totrans-36
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'Calculate and plot the daily returns:'
  id: totrans-37
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算并绘制每日回报：
- en: '[PRE2]'
  id: totrans-38
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Running the snippet produces the following plot:'
  id: totrans-39
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 运行该代码片段会生成以下图表：
- en: '![](../Images/B18112_10_01.png)'
  id: totrans-40
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![](../Images/B18112_10_01.png)'
- en: 'Figure 10.1: IBM’s simple returns'
  id: totrans-41
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图10.1：IBM的简单回报
- en: 'Split the data into training and test sets:'
  id: totrans-42
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将数据分为训练集和测试集：
- en: '[PRE3]'
  id: totrans-43
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Specify the parameters of the simulation:'
  id: totrans-44
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指定模拟的参数：
- en: '[PRE4]'
  id: totrans-45
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE4]'
- en: 'Define the function used for the simulations:'
  id: totrans-46
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义用于模拟的函数：
- en: '[PRE5]'
  id: totrans-47
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'Run the simulations and store the results in a DataFrame:'
  id: totrans-48
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 运行模拟并将结果存储在DataFrame中：
- en: '[PRE6]'
  id: totrans-49
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Create a DataFrame with the average value for each time step and the corresponding
    actual stock price:'
  id: totrans-50
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个包含每个时间步长的平均值以及对应实际股价的DataFrame：
- en: '[PRE7]'
  id: totrans-51
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'Plot the results of the simulation:'
  id: totrans-52
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 绘制模拟结果：
- en: '[PRE8]'
  id: totrans-53
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE8]'
- en: In *Figure 10.2*, we observe that the predicted stock prices (the averages of
    the simulations for each time step) exhibit a slightly positive trend. That could
    be attributed to the positive drift term ![](../Images/B18112_10_022.png) = 0.07%.
    However, we should take that conclusion with a pinch of salt given the very small
    number of simulations.
  id: totrans-54
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在*图10.2*中，我们观察到预测的股价（每个时间步长的模拟平均值）呈现出轻微的上升趋势。这可以归因于正漂移项 ![](../Images/B18112_10_022.png)
    = 0.07%。然而，由于模拟次数非常少，我们应对这一结论持保留态度。
- en: '![](../Images/B18112_10_02.png)'
  id: totrans-55
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B18112_10_02.png)'
- en: 'Figure 10.2: The simulated paths together with their average'
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.2：模拟路径及其平均值
- en: Bear in mind that such a visualization is only feasible for a reasonable number
    of sample paths. In real-life cases, we want to use significantly more sample
    paths than 100\. The general approach to Monte Carlo simulations is that having
    more sample paths leads to more accurate/reliable results.
  id: totrans-57
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，这种可视化只适用于合理数量的样本路径。在实际情况中，我们希望使用远远超过 100 条的样本路径。蒙特卡洛模拟的一般方法是，样本路径越多，结果越准确/可靠。
- en: How it works...
  id: totrans-58
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: 'In *Steps 2* and *3*, we downloaded IBM’s stock prices and calculated simple
    returns. In the next step, we divided the data into the training and test sets.
    While there is no explicit training of any model here, we used the training set
    to calculate the average and standard deviation of the returns. We then used those
    values as the drift (`mu`) and diffusion (`sigma`) coefficients for our simulations.
    Additionally, in *Step 5*, we defined the following parameters:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤 2*和*步骤 3*中，我们下载了 IBM 的股票价格并计算了简单收益率。在接下来的步骤中，我们将数据划分为训练集和测试集。虽然这里没有显式地训练任何模型，但我们使用训练集计算了收益率的平均值和标准差。然后，我们将这些值作为漂移项（`mu`）和扩散项（`sigma`）系数用于我们的模拟。此外，在*步骤
    5*中，我们定义了以下参数：
- en: '`T`: Forecasting horizon; in this case, the number of days in the test set.'
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`T`: 预测时域；在本例中，即测试集中的天数。'
- en: '`N`: Number of time increments in the forecasting horizon. For our simulation,
    we keep `N` = `T`.'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`N`: 预测时域中的时间增量数。对于我们的模拟，我们保持 `N` = `T`。'
- en: '`S_0`: Initial price. For this simulation, we use the last observation from
    the training set.'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`S_0`: 初始价格。在此模拟中，我们使用训练集中的最后一个观测值。'
- en: '`N_SIM`: Number of simulated paths.'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`N_SIM`: 模拟路径的数量。'
- en: Monte Carlo simulations use a process called discretization. The idea is to
    approximate the continuous pricing of financial assets by splitting the considered
    time horizon into a large number of discrete intervals. That is why, except for
    considering the forecasting horizon, we also need to indicate the number of time
    increments to fit into the horizon.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
  zh: 蒙特卡洛模拟使用了一种称为离散化的过程。其思想是通过将考虑的时间范围划分为大量的离散区间，来近似金融资产的连续定价。这就是为什么除了考虑预测时域外，我们还需要指定要融入时域的时间增量数。
- en: 'In *Step 6*, we defined the function for running the simulations. It is good
    practice to define a function/class for such a problem, as it will also come in
    handy in the following recipes. The function executes the following steps:'
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤 6*中，我们定义了运行模拟的函数。为此类问题定义一个函数/类是良好的实践，因为它在后续步骤中也会派上用场。该函数执行以下步骤：
- en: 'Defines the time increment (`dt`) and the Brownian increments (`dW`). In the
    matrix of Brownian increments (size: `N_SIM` × `N`), each row describes one sample
    path.'
  id: totrans-66
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义时间增量（`dt`）和布朗增量（`dW`）。在布朗增量矩阵中（大小：`N_SIM` × `N`），每一行描述一个样本路径。
- en: Calculates the Brownian paths (`W`) by running a cumulative sum (`np.cumsum`)
    over the rows.
  id: totrans-67
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 通过对每行进行累加求和（`np.cumsum`），计算布朗运动路径（`W`）。
- en: Creates a matrix containing the time steps (`time_steps`). To do so, we created
    an array of evenly spaced values within an interval (the horizon of the simulation).
    For that, we used the `np.linspace` function. Afterward, we broadcasted the array
    to the intended shape using `np.broadcast_to`.
  id: totrans-68
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 创建一个包含时间步长（`time_steps`）的矩阵。为此，我们创建了一个在区间内均匀分布的值数组（即模拟的时域）。为此，我们使用了 `np.linspace`
    函数。之后，我们使用 `np.broadcast_to` 将该数组广播到目标形状。
- en: Calculates the stock price at each point in time using the closed-form formula.
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用闭式公式计算每个时间点的股票价格。
- en: Inserts the initial value into the first position of each row.
  id: totrans-70
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将初始值插入到每行的第一个位置。
- en: There was no explicit need to broadcast the vector containing time steps. It
    would have been done automatically to match the required dimensions (the dimension
    of `W`). By doing it manually, we get more control over what we are doing, which
    makes the code easier to debug. We should also be aware that in languages such
    as R, there is no automatic broadcasting.
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: 没有显式需要广播包含时间步的向量。它本应自动广播以匹配所需的维度（`W` 的维度）。通过手动处理，我们可以更好地控制操作，从而使代码更易于调试。我们还应该意识到，在像
    R 这样的语言中，是没有自动广播的。
- en: In the function’s definition, we can recognize the drift as `(mu - 0.5 * sigma
    ** 2) * time_steps` and the diffusion as `sigma * W`. Additionally, while defining
    this function, we followed the vectorized approach. By doing so, we avoided writing
    any `for` loops, which would be inefficient in the case of large simulations.
  id: totrans-72
  prefs: []
  type: TYPE_NORMAL
  zh: 在函数定义中，我们可以将漂移项表示为`(mu - 0.5 * sigma ** 2) * time_steps`，而扩散项则是`sigma * W`。此外，在定义这个函数时，我们采用了向量化的方法。通过这样做，我们避免了编写任何`for`循环，因为在大规模模拟的情况下，`for`循环效率低下。
- en: For reproducible results, use `np.random.seed` before simulating the paths.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 为了确保结果可复现，在模拟路径之前使用`np.random.seed`。
- en: In *Step 7*, we ran the simulations and stored the outcome (sample paths) in
    a DataFrame. While doing so, we transposed the data so that we had one path per
    column, which simplifies using the `plot` method of the `pandas` DataFrame. To
    have the appropriate index, we used the `union` method of a `DatetimeIndex` to
    join the index of the last observation from the training set and the indices from
    the test set.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤 7*中，我们进行了模拟并将结果（样本路径）存储在一个DataFrame中。在此过程中，我们对数据进行了转置，以便每条路径占据一列，这样更方便使用`pandas`
    DataFrame的`plot`方法。为了获得合适的索引，我们使用了`DatetimeIndex`的`union`方法，将训练集最后一个观测值的索引和测试集的索引连接起来。
- en: In *Step 8*, we calculated the predicted stock price as the average value of
    all the simulations for each point of time and stored those results in a DataFrame.
    Then, we also joined the actual stock prices for each date.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤 8*中，我们计算了每个时间点的预测股票价格，方法是对所有模拟结果求平均，并将这些结果存储在DataFrame中。然后，我们还将每个日期的实际股票价格合并进去。
- en: In the last step, we visualized the simulated sample paths. While visualizing
    the simulated paths, we chose `alpha=0.3` to make the lines transparent. By doing
    so, it is easier to see the two lines representing the predicted (average) path
    and the actual one.
  id: totrans-76
  prefs: []
  type: TYPE_NORMAL
  zh: 在最后一步，我们可视化了模拟得到的样本路径。在可视化模拟路径时，我们选择了`alpha=0.3`来使线条变得透明。这样更容易看到表示预测（平均）路径和实际路径的两条线。
- en: There’s more...
  id: totrans-77
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多……
- en: 'There are some statistical methods that make working with Monte Carlo simulations
    easier (higher accuracy, faster computations). One of them is a variance reduction
    method called **antithetic variates**. In this approach, we try to reduce the
    variance of the estimator by introducing negative dependence between pairs of
    random draws. This translates into the following: when creating sample paths,
    for each ![](../Images/B18112_10_006.png), we also take the antithetic values,
    that is, ![](../Images/B18112_10_007.png).'
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 有一些统计方法可以使蒙特卡罗模拟的工作更为简便（更高的准确度，更快的计算速度）。其中之一是一个叫做**对立变量**的方差减少方法。在这种方法中，我们通过在一对随机抽样之间引入负相关性，来减少估计量的方差。具体来说：在创建样本路径时，对于每一个![](../Images/B18112_10_006.png)，我们还取对立值，即![](../Images/B18112_10_007.png)。
- en: 'The advantages of this approach are:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 这种方法的优点包括：
- en: Reduction (by half) of the number of Standard Normal samples to be drawn in
    order to generate *N* paths
  id: totrans-80
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 为了生成*N*条路径，减少（减少一半）需要抽取的标准正态样本数
- en: Reduction of the sample path variance, while at the same time improving the
    accuracy
  id: totrans-81
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 样本路径方差的减少，同时提高了准确性
- en: We implemented this approach in the improved `simulate_gbm` function. Additionally,
    we made the function shorter by putting the majority of the calculations into
    one line.
  id: totrans-82
  prefs: []
  type: TYPE_NORMAL
  zh: 我们在改进版的`simulate_gbm`函数中实现了这种方法。此外，我们通过将大部分计算合并成一行，使得函数变得更简短。
- en: 'Before we implemented these changes, we timed the initial version of the function:'
  id: totrans-83
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们实现这些变化之前，我们对初始版本的函数进行了计时：
- en: '[PRE9]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'The score was:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
  zh: 得分如下：
- en: '[PRE10]'
  id: totrans-86
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'The new function is defined as follows:'
  id: totrans-87
  prefs: []
  type: TYPE_NORMAL
  zh: 新函数定义如下：
- en: '[PRE11]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'First, we run the simulations without antithetic variables:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，我们在没有对立变量的情况下运行了模拟：
- en: '[PRE12]'
  id: totrans-90
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'Which scores:'
  id: totrans-91
  prefs: []
  type: TYPE_NORMAL
  zh: 得分如下：
- en: '[PRE13]'
  id: totrans-92
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'Then, we run the simulations with antithetic variables:'
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们在使用对立变量的情况下运行了模拟：
- en: '[PRE14]'
  id: totrans-94
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Which scores:'
  id: totrans-95
  prefs: []
  type: TYPE_NORMAL
  zh: 得分如下：
- en: '[PRE15]'
  id: totrans-96
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: We succeeded in making the function faster. If you are interested in pure performance,
    these simulations can be further expedited using Numba, Cython, or multiprocessing.
  id: totrans-97
  prefs: []
  type: TYPE_NORMAL
  zh: 我们成功地使得函数运行得更快。如果你对纯性能感兴趣，可以使用Numba、Cython或多线程进一步加速这些模拟。
- en: Other possible variance reduction techniques include control variates and common
    random numbers.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
  zh: 其他可能的方差减少技术包括控制变量和公共随机数。
- en: See also
  id: totrans-99
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另请参见
- en: 'In this recipe, we have shown how to simulate stock prices using a geometric
    Brownian motion. However, there are other stochastic processes that could be used
    as well, some of which are:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
  zh: 在本例中，我们展示了如何使用几何布朗运动模拟股票价格。然而，还有其他可以使用的随机过程，其中一些包括：
- en: 'Jump-diffusion model: Merton, R. “Option Pricing When the Underlying Stock
    Returns Are Discontinuous,” *Journal of Financial Economics*, 3, 3 (1976): 125–144'
  id: totrans-101
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 跳跃扩散模型：Merton, R. “当标的股票回报不连续时的期权定价”，*Journal of Financial Economics*, 3, 3
    (1976)：125–144
- en: 'Square-root diffusion model: Cox, John, Jonathan Ingersoll, and Stephen Ross
    , “A theory of the term structure of interest rates,” *Econometrica*, 53, 2 (1985):
    385–407'
  id: totrans-102
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 平方根扩散模型：Cox, John, Jonathan Ingersoll 和 Stephen Ross，“利率期限结构理论”，*Econometrica*,
    53, 2 (1985)：385–407
- en: 'Stochastic volatility model: Heston, S. L., “A closed-form solution for options
    with stochastic volatility with applications to bond and currency options*,”*
    *The Review of Financial Studies*, 6(2): 327-343.'
  id: totrans-103
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 随机波动率模型：Heston, S. L., “带有随机波动率的期权闭式解法及其在债券和货币期权中的应用”，*The Review of Financial
    Studies*, 6(2)：327-343。
- en: Pricing European options using simulations
  id: totrans-104
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用模拟定价欧洲期权
- en: Options are a type of derivative instrument because their price is linked to
    the price of the underlying security, such as stock. Buying an options contract
    grants the right, but not the obligation, to buy or sell an underlying asset at
    a set price (known as a strike) on/before a certain date. The main reason for
    the popularity of options is because they hedge away exposure to an asset’s price
    moving in an undesirable way.
  id: totrans-105
  prefs: []
  type: TYPE_NORMAL
  zh: 期权是一种衍生工具，因为其价格与标的证券的价格（例如股票）相关联。购买期权合约赋予了在特定日期前以设定价格（称为行权价）买入或卖出标的资产的权利，但不是义务。期权受欢迎的主要原因是它们可以对冲资产价格朝不利方向波动的风险。
- en: In this recipe we will focus on one type of option, that is, European options.
    A **European call/put option** gives us the right (but again, no obligation) to
    buy/sell a certain asset on a certain expiry date (commonly denoted as *T*).
  id: totrans-106
  prefs: []
  type: TYPE_NORMAL
  zh: 在本示例中，我们将重点介绍一种期权类型，即欧洲期权。**欧洲看涨/看跌期权**赋予我们在特定到期日（通常表示为*T*）买入/卖出某项资产的权利（但同样没有义务）。
- en: 'There are many possible ways of option valuation, for example, using:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
  zh: 期权估值有许多可能的方法，例如使用：
- en: Analytical formulas (only some kinds of options have those)
  id: totrans-108
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 解析公式（只有某些类型的期权有此公式）
- en: Binomial tree approach
  id: totrans-109
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 二项树方法
- en: Finite differences
  id: totrans-110
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有限差分
- en: Monte Carlo simulations
  id: totrans-111
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 蒙特卡洛模拟
- en: European options are an exception in the sense that there exists an analytical
    formula for their valuation, which is not the case for more advanced derivatives,
    such as American or exotic options.
  id: totrans-112
  prefs: []
  type: TYPE_NORMAL
  zh: 欧洲期权是一个例外，因为它们的估值存在解析公式，这对于更复杂的衍生品（如美式期权或奇异期权）并不适用。
- en: To price options using Monte Carlo simulations, we use risk-neutral valuation,
    under which the fair value of a derivative is the expected value of its future
    payoff(s). In other words, we assume that the option premium grows at the same
    rate as the risk-free rate, which we use for discounting to the present value.
    For each of the simulated paths, we calculate the option’s payoff at maturity,
    take the average of all the paths, and discount it to the present value.
  id: totrans-113
  prefs: []
  type: TYPE_NORMAL
  zh: 为了使用蒙特卡洛模拟定价期权，我们采用风险中性估值方法，在这种方法下，衍生品的公允价值是其未来支付的期望值。换句话说，我们假设期权溢价以与无风险利率相同的速度增长，并使用无风险利率对其进行贴现到现值。对于每条模拟路径，我们计算期权到期时的支付额，取所有路径的平均值，然后将其贴现到现值。
- en: In this recipe, we show how to code the closed-form solution of the Black-Scholes
    model and then use the Monte Carlo simulation approach. For simplicity, we use
    fictitious input data, but real-life data could be used analogically.
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 在本示例中，我们展示了如何编写黑-斯科尔斯模型的闭式解法，并使用蒙特卡洛模拟方法。为了简化，我们使用虚拟的输入数据，但实际数据也可以类比使用。
- en: How to do it...
  id: totrans-115
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Execute the following steps to price European options using the analytical
    formula and Monte Carlo simulations:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤，使用解析公式和蒙特卡洛模拟定价欧洲期权：
- en: 'Import the libraries:'
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入库：
- en: '[PRE16]'
  id: totrans-118
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE16]'
- en: In this recipe, we use the `simulate_gbm` function we have defined in the previous
    recipe. For our convenience, we store it in a separate `.py` script, from which
    we can import it.
  id: totrans-119
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 在本示例中，我们使用在前一个示例中定义的`simulate_gbm`函数。为了方便起见，我们将其存储在一个单独的`.py`脚本中，并从中导入。
- en: 'Define the option’s parameters for the valuation:'
  id: totrans-120
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义期权的估值参数：
- en: '[PRE17]'
  id: totrans-121
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'Prepare the valuation function using the analytical solution:'
  id: totrans-122
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用解析解法准备估值函数：
- en: '[PRE18]'
  id: totrans-123
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'Valuate a call option using the specified parameters:'
  id: totrans-124
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用指定参数估值看涨期权：
- en: '[PRE19]'
  id: totrans-125
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE19]'
- en: The price of a European call option with the specified parameters is `21.7926`.
  id: totrans-126
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 使用指定参数计算欧洲看涨期权的价格为`21.7926`。
- en: 'Simulate the stock path using the `simulate_gbm` function:'
  id: totrans-127
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`simulate_gbm`函数模拟股票路径：
- en: '[PRE20]'
  id: totrans-128
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'Calculate the option’s premium:'
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算期权的溢价：
- en: '[PRE21]'
  id: totrans-130
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE21]'
- en: The calculated option premium is 21.7562\. Please bear in mind that we are using
    a fixed random seed in the `simulate_gbm` function to obtain reproducible results.
    In general, whenever we are dealing with simulations, we can expect some degree
    of randomness in the results.
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: 计算出的期权溢价为 21.7562。请记住，我们在 `simulate_gbm` 函数中使用了固定的随机种子，以便获得可重复的结果。一般来说，在进行模拟时，我们可以预期结果中会有一定的随机性。
- en: Here, we can see that the option premium that we calculated using Monte Carlo
    simulations is close to the one from a closed-form solution of the Black-Scholes
    model. To increase the accuracy of the simulation, we could increase the number
    of simulated paths (using the `N_SIMS` parameter).
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 在这里，我们可以看到，通过蒙特卡洛模拟计算出的期权溢价与 Black-Scholes 模型的封闭解计算出的期权溢价接近。为了提高模拟的精度，我们可以增加模拟路径的数量（使用
    `N_SIMS` 参数）。
- en: How it works...
  id: totrans-133
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理...
- en: 'In *Step 2*, we defined the parameters that we used for this recipe:'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 在 *第 2 步* 中，我们定义了用于本方法的参数：
- en: '`S_0`: Initial stock price'
  id: totrans-135
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`S_0`：初始股票价格'
- en: '`K`: Strike price, that is, the one we can buy/sell for at maturity'
  id: totrans-136
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`K`：执行价，即在到期时我们可以买入/卖出的价格'
- en: '`r`: Annual risk-free rate'
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`r`：年化无风险利率'
- en: '`sigma`: Underlying stock volatility (annualized)'
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`sigma`：标的股票波动率（年化）'
- en: '`T`: Time until maturity in years'
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`T`：到期时间（以年为单位）'
- en: '`N`: Number of time increments for simulations'
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`N`：模拟的时间增量数量'
- en: '`N_SIMS`: Number of simulated sample paths'
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`N_SIMS`：模拟的样本路径数量'
- en: '`discount_factor`: Discount factor, which is used to calculate the present
    value of the future payoff'
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`discount_factor`：折扣因子，用于计算未来收益的现值'
- en: In *Step 3*, we defined a function for calculating the option premium using
    the closed-form solution to the Black-Scholes model (for non-dividend-paying stocks).
    We used it in *Step 4* to calculate the benchmark for the Monte Carlo simulations.
  id: totrans-143
  prefs: []
  type: TYPE_NORMAL
  zh: 在 *第 3 步* 中，我们定义了一个函数，通过使用 Black-Scholes 模型的封闭解来计算期权溢价（适用于非派息股票）。我们在 *第 4 步*
    中使用它来计算蒙特卡洛模拟的基准。
- en: 'The analytical solutions to the call and put options are defined as follows:'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 看涨期权和看跌期权的解析解定义如下：
- en: '![](../Images/B18112_10_008.png)'
  id: totrans-145
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B18112_10_008.png)'
- en: '![](../Images/B18112_10_009.png)'
  id: totrans-146
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B18112_10_009.png)'
- en: '![](../Images/B18112_10_010.png)'
  id: totrans-147
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B18112_10_010.png)'
- en: '![](../Images/B18112_10_011.png)'
  id: totrans-148
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B18112_10_011.png)'
- en: 'Where *N()* stands for the **cumulative distribution function** (**CDF**) of
    the Standard Normal distribution and *T - t* is the time to maturity expressed
    in years. Equation 1 represents the formula for the price of a European call option,
    while equation 2 represents the price of the European put option. Informally,
    the two terms in equation 1 can be thought of as:'
  id: totrans-149
  prefs: []
  type: TYPE_NORMAL
  zh: 其中 *N()* 代表标准正态分布的**累积分布函数**（**CDF**），*T - t* 是以年为单位表示的到期时间。公式 1 表示欧式看涨期权的价格公式，而公式
    2 则表示欧式看跌期权的价格。非正式地，公式 1 中的两个项可以理解为：
- en: The current price of the stock, weighted by the probability of exercising the
    option to buy the stock (*N*(*d*[1]))—in other words, what we could receive
  id: totrans-150
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 股票的当前价格，按行使期权买入股票的概率加权 (*N*(*d*[1]))——换句话说，可能获得的收益
- en: The discounted price of exercising the option (strike), weighted by the probability
    of exercising the option (*N*(*d*[2]))—in other words, what we are going to pay
  id: totrans-151
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 行使期权（执行价）的折扣价格，按行使期权的概率加权 (*N*(*d*[2]))——换句话说，就是我们将要支付的金额
- en: 'In *Step 5*, we used the GBM simulation function from the previous recipe to
    obtain 1,000,000 possible paths of the underlying asset. To calculate the option
    premium, we only looked at the terminal values, and for each path, calculated
    the payoff as follows:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 在 *第 5 步* 中，我们使用了之前方法中的 GBM 模拟函数，获得了 1,000,000 条潜在的标的资产路径。为了计算期权溢价，我们只看了每条路径的终值，并按以下方式计算收益：
- en: '*max*(*S*[T] *- K, 0*) for the call option'
  id: totrans-153
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*max*(*S*[T] *- K, 0*) 用于看涨期权'
- en: '*max*(*K - S*[T]*, 0*) for the put option'
  id: totrans-154
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '*max*(*K - S*[T]*, 0*) 用于看跌期权'
- en: In *Step 6*, we took the average of the payoffs and discounted it to present
    the value by using the discount factor.
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 在 *第 6 步* 中，我们取了收益的平均值，并使用折扣因子将其折算到当前价值。
- en: There’s more...
  id: totrans-156
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: Improving the valuation function using Monte Carlo simulations
  id: totrans-157
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 改进估值函数，通过蒙特卡洛模拟
- en: In the previous steps, we showed how to reuse the GBM simulation to calculate
    the European call option premium. However, we can make the calculations faster,
    as in the case of European options we are only interested in the terminal stock
    price. The intermediate steps do not matter. That is why we only need to simulate
    the price at time *T* and use these values to calculate the expected payoff. We
    show how to do this by using an example of a European put option with the same
    parameters as we used before.
  id: totrans-158
  prefs: []
  type: TYPE_NORMAL
  zh: 在前面的步骤中，我们展示了如何重复使用GBM模拟来计算欧洲看涨期权溢价。然而，我们可以让计算更快，因为在欧洲期权中，我们只关心终端股票价格，过程中的中间步骤不重要。这就是为什么我们只需要模拟时间*T*时的价格，并使用这些值来计算预期的收益。我们通过一个例子展示如何做到这一点，例子是使用与之前相同参数的欧洲看跌期权。
- en: 'We start by calculating the option premium using the analytical formula:'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 我们从使用解析公式计算期权溢价开始：
- en: '[PRE22]'
  id: totrans-160
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: The calculated option premium is `16.9155`.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 计算得出的期权溢价为 `16.9155`。
- en: 'Then, we define the modified simulation function, which only looks at the terminal
    values of the simulation paths:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们定义了修改后的模拟函数，它仅关注模拟路径的终端值：
- en: '[PRE23]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'Then, we run the simulations:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们运行模拟：
- en: '[PRE24]'
  id: totrans-165
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: The resulting value is 16.9482, which is close to the previous value. Further
    increasing the number of simulated paths should increase the accuracy of the valuation.
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 结果值为16.9482，接近前一个值。进一步增加模拟路径的数量应该会提高估值的准确性。
- en: Measuring price sensitivity with the Greeks
  id: totrans-167
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 使用希腊字母衡量价格敏感度
- en: 'While talking about the valuation of options, it is also worthwhile to mention
    the famous **Greeks**—quantities representing the sensitivity of the price of
    financial derivatives to a change in one of the underlying parameters. The name
    comes from the fact that those sensitivities are most commonly denoted using the
    letters of the Greek alphabet. The following are the five most popular sensitivities:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 在讨论期权定价时，还值得一提著名的**希腊字母**——表示金融衍生品价格对一个基础参数变化的敏感度。这些敏感度通常用希腊字母表示，因此得名。以下是五个最常见的敏感度：
- en: 'Delta (![](../Images/B18112_10_012.png)): The sensitivity of the theoretical
    option value with respect to the changes in the underlying asset’s price'
  id: totrans-169
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Delta (![](../Images/B18112_10_012.png))：期权理论价值对基础资产价格变化的敏感度。
- en: 'Vega (![](../Images/B18112_10_013.png)): The sensitivity of the theoretical
    option value with respect to the volatility of the underlying asset'
  id: totrans-170
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Vega (![](../Images/B18112_10_013.png))：期权理论价值对基础资产波动率的敏感度。
- en: 'Theta (![](../Images/B18112_10_014.png)): The sensitivity of the theoretical
    option value with respect to the option’s time to maturity'
  id: totrans-171
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Theta (![](../Images/B18112_10_014.png))：期权理论价值对期权到期时间变化的敏感度。
- en: 'Rho (![](../Images/B18112_10_015.png)): The sensitivity of the theoretical
    option value with respect to the interest rates'
  id: totrans-172
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Rho (![](../Images/B18112_10_015.png))：期权理论价值对利率变化的敏感度。
- en: 'Gamma (![](../Images/B18112_10_016.png)): This is an example of a second-order
    Greek as it represents the sensitivity of the option’s delta (![](../Images/B18112_10_017.png))
    with respect to the changes in the underlying asset’s price'
  id: totrans-173
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Gamma (![](../Images/B18112_10_016.png))：这是一个二阶希腊字母的例子，它表示期权的delta (![](../Images/B18112_10_017.png))
    对基础资产价格变化的敏感度。
- en: 'The following table shows how the Greeks of European call and put options are
    expressed in terms of the values we have already used for calculating the option’s
    premium using the analytical formulas:'
  id: totrans-174
  prefs: []
  type: TYPE_NORMAL
  zh: 下表展示了如何使用我们已经用来计算期权溢价的值，表示欧洲看涨期权和看跌期权的希腊字母：
- en: '|  | **What** | **Calls** | **Puts** |'
  id: totrans-175
  prefs: []
  type: TYPE_TB
  zh: '|  | **What** | **Calls** | **Puts** |'
- en: '| **delta** | ![](../Images/B18112_10_023.png) | ![](../Images/B18112_10_028.png)
    | ![](../Images/B18112_10_029.png) |'
  id: totrans-176
  prefs: []
  type: TYPE_TB
  zh: '| **delta** | ![](../Images/B18112_10_023.png) | ![](../Images/B18112_10_028.png)
    | ![](../Images/B18112_10_029.png) |'
- en: '| **gamma** | ![](../Images/B18112_10_024.png) | ![](../Images/B18112_10_030.png)
    |'
  id: totrans-177
  prefs: []
  type: TYPE_TB
  zh: '| **gamma** | ![](../Images/B18112_10_024.png) | ![](../Images/B18112_10_030.png)
    |'
- en: '| **vega** | ![](../Images/B18112_10_025.png) | ![](../Images/B18112_10_031.png)
    |'
  id: totrans-178
  prefs: []
  type: TYPE_TB
  zh: '| **vega** | ![](../Images/B18112_10_025.png) | ![](../Images/B18112_10_031.png)
    |'
- en: '| **theta** | ![](../Images/B18112_10_026.png) | ![](../Images/B18112_10_032.png)
    | ![](../Images/B18112_10_033.png) |'
  id: totrans-179
  prefs: []
  type: TYPE_TB
  zh: '| **theta** | ![](../Images/B18112_10_026.png) | ![](../Images/B18112_10_032.png)
    | ![](../Images/B18112_10_033.png) |'
- en: '| **rho** | ![](../Images/B18112_10_027.png) | ![](../Images/B18112_10_034.png)
    | ![](../Images/B18112_10_035.png) |'
  id: totrans-180
  prefs: []
  type: TYPE_TB
  zh: '| **rho** | ![](../Images/B18112_10_027.png) | ![](../Images/B18112_10_034.png)
    | ![](../Images/B18112_10_035.png) |'
- en: The N’() symbol represents the **probability density function** (**PDF**) of
    the Standard Normal distribution. As you can see, the Greeks are actually partial
    derivatives of some model price (in this case, European call or put options) with
    respect to one of the model’s parameters. We should also keep in mind that the
    Greeks differ by model.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: N'() 符号表示**标准正态分布的概率密度函数**（**PDF**）。如你所见，希腊字母实际上是模型价格（在这种情况下是欧洲看涨期权或看跌期权）相对于模型参数之一的偏导数。我们还应记住，希腊字母因模型不同而有所不同。
- en: Pricing American options with Least Squares Monte Carlo
  id: totrans-182
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用最小二乘蒙特卡罗法对美式期权定价
- en: In this recipe, we learn how to valuate American options. The key difference
    between European and American options is that the latter can be exercised at any
    time before and including the maturity date—basically, whenever the underlying
    asset’s price moves favorably for the option holder.
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个方法中，我们学习如何对美式期权进行估值。欧洲期权和美式期权的主要区别在于，美式期权可以在到期日前的任何时间行使——基本上，只要标的资产的价格对期权持有者有利，便可以行使。
- en: This behavior introduces additional complexity to the valuation and there is
    no closed-form solution to this problem. When using Monte Carlo simulations, we
    cannot only look at the terminal value on each sample path, as the option’s exercise
    can happen anywhere along the path. That is why we need to employ a more sophisticated
    approach called **Least Squares Monte Carlo** (**LSMC**), which was introduced
    by Longstaff and Schwartz (2001).
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
  zh: 这种行为给估值带来了额外的复杂性，并且该问题没有封闭形式的解。在使用蒙特卡罗模拟时，我们不能仅仅看每个样本路径上的终端价值，因为期权的行使可以发生在路径的任何地方。因此，我们需要采用一种更复杂的方法，称为**最小二乘蒙特卡罗法**（**LSMC**），该方法由
    Longstaff 和 Schwartz（2001）提出。
- en: First of all, the time axis spanning [0, *T*] is discretized into a finite number
    of equally spaced intervals and the early exercise can happen only at those particular
    time steps. Effectively, the American option is approximated by a Bermudan one.
    For any time step *t*, the early exercise is performed in case the payoff from
    the immediate exercise is larger than the continuation value.
  id: totrans-185
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，将时间轴从 [0, *T*] 离散化为有限个等距区间，提前行使只能发生在这些特定的时间步骤上。实际上，美式期权被近似为百慕大期权。对于任何时间步
    *t*，当即时行使的收益大于继续价值时，会进行提前行使。
- en: 'This is expressed by the following formula:'
  id: totrans-186
  prefs: []
  type: TYPE_NORMAL
  zh: 这可以通过以下公式表示：
- en: '![](../Images/B18112_10_018.png)'
  id: totrans-187
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B18112_10_018.png)'
- en: 'Here, *h*[t]*(s)* stands for the option’s payoff (also called the option’s
    inner value, calculated as in the case of European options) and *C*[t]*(s)* is
    the continuation value of the option, which is defined as:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，*h*[t]*(s)* 代表期权的收益（也称为期权的内在价值，按欧洲期权的方式计算），*C*[t]*(s)* 是期权的继续价值，其定义为：
- en: '![](../Images/B18112_10_019.png)'
  id: totrans-189
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B18112_10_019.png)'
- en: Here, *r* is the risk-free rate, *dt* is the time increment, and ![](../Images/B18112_10_020.png)
    is the risk-neutral expectation given the underlying price. The continuation value
    is basically the expected payoff from not exercising the option at a given time.
  id: totrans-190
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，*r* 是无风险利率，*dt* 是时间增量，且 ![](../Images/B18112_10_020.png) 是给定标的价格下的风险中性期望。继续价值基本上是指在某个时间点不行使期权的期望回报。
- en: When using Monte Carlo simulations, we can define the continuation value *e*^(-rdt)V[t+dt,i]
    for each path *i* and time *t*. Using this value directly is not possible as this
    would imply perfect foresight. That is why the LSMC algorithm uses linear regression
    to estimate the expected continuation value. In the algorithm, we regress the
    discounted future values (obtained from keeping the option) onto a set of basis
    functions of the spot price (time *t* price). The simplest way to approach this
    is to use an *x*-degree polynomial regression. Other options for the basis functions
    include Legendre, Hermite, Chebyshev, Gegenbauer, or Jacobi polynomials.
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 在使用蒙特卡罗模拟时，我们可以为每条路径 *i* 和时间 *t* 定义继续价值 *e*^(-rdt)V[t+dt,i]。直接使用该值是不可能的，因为这意味着完美的预见性。因此，LSMC
    算法使用线性回归来估算期望的继续价值。在该算法中，我们将折现后的未来价值（从保持期权中获得）回归到现货价格（时间 *t* 的价格）的一组基函数上。最简单的方法是使用
    *x* 次多项式回归。基函数的其他选项包括勒让德多项式、厄米特多项式、切比雪夫多项式、盖根鲍尔多项式或雅可比多项式。
- en: We iterate this algorithm backward (from time *T-1* to 0) and at the last step
    take the average discounted value as the option premium. The premium of a European
    option represents the lower bound to the American option’s premium. The difference
    is usually called the early exercise premium.
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将这个算法从后向前迭代（从时间*T-1*到0），在最后一步取平均折现值作为期权溢价。欧洲期权的溢价代表了美国期权溢价的下限。两者之间的差异通常被称为提前行使溢价。
- en: How to do it...
  id: totrans-193
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作...
- en: 'Execute the following steps to price American options using the Least Squares
    Monte Carlo method:'
  id: totrans-194
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤，通过最小二乘蒙特卡罗方法定价美国期权：
- en: 'Import the libraries:'
  id: totrans-195
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入库：
- en: '[PRE25]'
  id: totrans-196
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'Define the option’s parameters:'
  id: totrans-197
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义期权的参数：
- en: '[PRE26]'
  id: totrans-198
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Simulate the stock prices using a GBM:'
  id: totrans-199
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用GBM模拟股票价格：
- en: '[PRE27]'
  id: totrans-200
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'Calculate the payoff matrix:'
  id: totrans-201
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算支付矩阵：
- en: '[PRE28]'
  id: totrans-202
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'Define the value matrix and fill in the last column (time *T*):'
  id: totrans-203
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义价值矩阵并填充最后一列（时间*T*）：
- en: '[PRE29]'
  id: totrans-204
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'Iteratively calculate the continuation value and the value vector in the given
    time:'
  id: totrans-205
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 迭代计算给定时间内的继续价值和价值向量：
- en: '[PRE30]'
  id: totrans-206
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Calculate the option’s premium:'
  id: totrans-207
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算期权的溢价：
- en: '[PRE31]'
  id: totrans-208
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE31]'
- en: The premium on the specified American put option is `4.465`.
  id: totrans-209
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 指定的美国看跌期权的溢价为`4.465`。
- en: 'Calculate the premium of a European put with the same parameters:'
  id: totrans-210
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算具有相同参数的欧洲看跌期权的溢价：
- en: '[PRE32]'
  id: totrans-211
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE32]'
- en: The price of the European put option with the same parameters is `3.84`.
  id: totrans-212
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 具有相同参数的欧洲看跌期权价格为`3.84`。
- en: 'As an extra check, calculate the prices of the American and European call options:'
  id: totrans-213
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 作为额外的检查，计算美国和欧洲看涨期权的价格：
- en: '[PRE33]'
  id: totrans-214
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE33]'
- en: The price of the European call is `2.17`, while the American call’s price (using
    100,000 simulations) is `2.10`.
  id: totrans-215
  prefs: []
  type: TYPE_NORMAL
  zh: 欧洲看涨期权的价格为`2.17`，而美国看涨期权的价格（使用100,000次模拟）为`2.10`。
- en: How it works...
  id: totrans-216
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: In *Step 2*, we once again defined the parameters of the considered American
    option. For comparison’s sake, we took the same values that Longstaff and Schwartz
    (2001) did. In *Step 3*, we simulated the stock’s evolution using the `simulate_gbm`
    function from the previous recipe. Afterward, we calculated the payoff matrix
    of the put option using the same formula that we used for the European options.
  id: totrans-217
  prefs: []
  type: TYPE_NORMAL
  zh: 在*第2步*中，我们再次定义了所考虑的美国期权的参数。为了比较，我们采用了Longstaff和Schwartz（2001）使用的相同值。在*第3步*中，我们使用之前配方中的`simulate_gbm`函数模拟了股票的演变。然后，我们使用与欧洲期权相同的公式计算了看跌期权的支付矩阵。
- en: In *Step 5*, we prepared the matrix of option values over time, which we defined
    as a matrix of zeros of the same size as the payoff matrix. We filled the last
    column of the value matrix with the last column of the payoff matrix, as at the
    last step there are no further computations to carry out—the payoff is equal to
    the European option.
  id: totrans-218
  prefs: []
  type: TYPE_NORMAL
  zh: 在*第5步*中，我们准备了一个期权价值的时间矩阵，我们将其定义为与支付矩阵大小相同的零矩阵。我们用支付矩阵的最后一列填充价值矩阵的最后一列，因为在最后一步没有进一步的计算要进行——支付等于欧洲期权。
- en: In *Step 6*, we ran the backward part of the algorithm from time *T-1* to 0\.
    At each of these steps, we estimated the expected continuation value as a cross-sectional
    linear regression. We fitted the 5th-degree polynomial to the data using `np.polyfit`.
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: 在*第6步*中，我们从时间*T-1*到0执行了算法的反向部分。在每一步中，我们将预期的继续价值估计为横截面的线性回归。我们使用`np.polyfit`将5次多项式拟合到数据中。
- en: Then, we evaluated the polynomial at specific values (using `np.polyval`), which
    is the same as getting the fitted values from a linear regression. We compared
    the expected continuation value to the payoff to see if the option should be exercised.
    If the payoff was higher than the expected value from continuation, we set the
    value to the payoff. Otherwise, we set it to the discounted one-step-ahead value.
    We used `np.where` for this selection.
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们在特定值处评估多项式（使用`np.polyval`），这与从线性回归中获得拟合值相同。我们将预期的继续价值与支付进行比较，以判断是否应该行使期权。如果支付值高于继续价值的预期值，我们将其设定为支付值。否则，我们将其设定为折现的下一步值。我们使用`np.where`进行此选择。
- en: It is also possible to use `scikit-learn` for the polynomial fit. To do so,
    you need to combine `LinearRegression` with `PolynomialFeatures`.
  id: totrans-221
  prefs: []
  type: TYPE_NORMAL
  zh: 也可以使用`scikit-learn`进行多项式拟合。为此，需要将`LinearRegression`与`PolynomialFeatures`结合使用。
- en: In *Step 7* of the algorithm, we obtained the option premium by taking the average
    value of the discounted *t = 1* value vector.
  id: totrans-222
  prefs: []
  type: TYPE_NORMAL
  zh: 在算法的*第7步*中，我们通过取折现后的*t = 1*值向量的平均值来获得期权溢价。
- en: In the last two steps, we carried out some sanity checks. First, we calculated
    the premium of a European put with the same parameters. Second, we repeated all
    the steps to get the premiums of American and European call options with the same
    parameters. To make this easier, we put the entire algorithm for LSMC into one
    function, which is available in this book’s GitHub repository.
  id: totrans-223
  prefs: []
  type: TYPE_NORMAL
  zh: 在最后两步中，我们进行了某些有效性检查。首先，我们计算了具有相同参数的欧洲看跌期权的溢价。其次，我们重复了所有步骤，获取了具有相同参数的美式和欧式看涨期权的溢价。为了简化操作，我们将整个
    LSMC 算法放入一个函数中，该函数可在本书的 GitHub 仓库中找到。
- en: For the call option, the premium on the American and European options should
    be equal, as it is never optimal to exercise the option when there are no dividends.
    Our results are very close, but we can obtain a more accurate price by increasing
    the number of simulated sample paths.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
  zh: 对于看涨期权，美式和欧式期权的溢价应相等，因为在没有股息的情况下，行使期权永远不是最优选择。我们的结果非常接近，但通过增加模拟样本路径的数量，可以获得更准确的价格。
- en: In principle, the Longstaff-Schwartz algorithm should underprice American options
    because the approximation of the continuation value by the basis functions is
    just that, an approximation. As a consequence, the algorithm will not always make
    the correct decision about exercising the option. This, in turn, means that the
    option’s value will be lower than in the case of the optimal exercise.
  id: totrans-225
  prefs: []
  type: TYPE_NORMAL
  zh: 原则上，Longstaff-Schwartz 算法应该低估美式期权的价值，因为通过基函数近似的延续价值只是一个近似。因此，该算法并不总是能做出正确的行权决策。这意味着期权的价值将低于最优行权的情况。
- en: See also
  id: totrans-226
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 另见
- en: 'Additional resources are available here:'
  id: totrans-227
  prefs: []
  type: TYPE_NORMAL
  zh: 额外资源可在此处获取：
- en: 'Longstaff, F. A., & Schwartz, E. S. 2001\. “Valuing American options by simulation:
    a simple least-squares approach,” *The Review of Financial Studies*, 14(1): 113-147'
  id: totrans-228
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Longstaff, F. A., & Schwartz, E. S. 2001\. “通过模拟估值美式期权：一种简单的最小二乘方法，” *金融研究评论*，14(1)：113-147
- en: 'Broadie, M., Glasserman, P., & Jain, G. 1997\. “An alternative approach to
    the valuation of American options using the stochastic tree method. Enhanced Monte
    Carlo estimates for American option prices,” *Journal of Derivatives*, 5: 25-44.'
  id: totrans-229
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Broadie, M., Glasserman, P., & Jain, G. 1997\. “使用随机树方法对美式期权进行估值的替代方法。对美式期权价格的增强蒙特卡洛估计，”
    *衍生品期刊*，5：25-44。
- en: Pricing American options using QuantLib
  id: totrans-230
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 QuantLib 定价美式期权
- en: In the previous recipe, we showed how to manually code the Longstaff-Schwartz
    algorithm. However, we can also use already existing frameworks for the valuation
    of derivatives. One of the most popular ones is QuantLib. It is an open-source
    C++ library that provides tools for the valuation of financial instruments. By
    using **Simplified Wrapper and Interface Generator** (**SWIG**), it is possible
    to use QuantLib from Python (and some other programming languages, such as R or
    Julia). In this recipe, we show how to price the same American put option that
    we priced in the previous recipe, but the library itself has many more interesting
    features to explore.
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 在上一条食谱中，我们展示了如何手动编码 Longstaff-Schwartz 算法。然而，我们也可以使用已经存在的框架来进行衍生品估值。其中最受欢迎的之一是
    QuantLib。它是一个开源的 C++ 库，提供用于金融工具估值的工具。通过使用 **简化包装器和接口生成器**（**SWIG**），可以在 Python（以及一些其他编程语言，如
    R 或 Julia）中使用 QuantLib。在本条食谱中，我们展示了如何对上一条食谱中定价的相同美式看跌期权进行定价，但该库本身还有许多更有趣的功能值得探索。
- en: Getting ready
  id: totrans-232
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Execute *Step 2* from the previous recipe to have the parameters of the American
    put option that we will valuate using QuantLib.
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
  zh: 执行上一条食谱中的*步骤 2*，以获取我们将使用 QuantLib 估值的美式看跌期权的参数。
- en: How to do it...
  id: totrans-234
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 操作步骤...
- en: 'Execute the following steps to price American options using QuantLib:'
  id: totrans-235
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤以使用 QuantLib 估值美式期权：
- en: 'Import the library:'
  id: totrans-236
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入库：
- en: '[PRE34]'
  id: totrans-237
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Specify the calendar and the day-counting convention:'
  id: totrans-238
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指定日历和日期计数方式：
- en: '[PRE35]'
  id: totrans-239
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'Specify the valuation date and the expiry date of the option:'
  id: totrans-240
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指定期权的估值日期和到期日期：
- en: '[PRE36]'
  id: totrans-241
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'Define the option type (call/put), type of exercise (American), and payoff:'
  id: totrans-242
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义期权类型（看涨/看跌）、行权方式（美式）和支付：
- en: '[PRE37]'
  id: totrans-243
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Prepare the market-related data:'
  id: totrans-244
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 准备与市场相关的数据：
- en: '[PRE38]'
  id: totrans-245
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'Specify the market-related curves:'
  id: totrans-246
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 指定与市场相关的曲线：
- en: '[PRE39]'
  id: totrans-247
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Plug the market-related data into the Black-Scholes process:'
  id: totrans-248
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 将与市场相关的数据插入到 Black-Scholes 过程：
- en: '[PRE40]'
  id: totrans-249
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'Instantiate the Monte Carlo engine for the American options:'
  id: totrans-250
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 实例化美式期权的蒙特卡洛引擎：
- en: '[PRE41]'
  id: totrans-251
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'Instantiate the `option` object and set its pricing engine:'
  id: totrans-252
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 实例化`option`对象并设置其定价引擎：
- en: '[PRE42]'
  id: totrans-253
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'Calculate the option’s premium:'
  id: totrans-254
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算期权溢价：
- en: '[PRE43]'
  id: totrans-255
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE43]'
- en: The value of the American put option is `4.457`.
  id: totrans-256
  prefs: []
  type: TYPE_NORMAL
  zh: 美式看跌期权的价值为 `4.457`。
- en: How it works...
  id: totrans-257
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: Since we wanted to compare the results we obtained with those in the previous
    recipes, we used the same problem setup as we did there. For brevity, we will
    not look at all the code here, but we should run *Step 2* from the previous recipe.
  id: totrans-258
  prefs: []
  type: TYPE_NORMAL
  zh: 由于我们想将获得的结果与之前食谱中的结果进行比较，因此我们使用了与之前相同的设置。为了简洁起见，我们在此不展示所有代码，但我们应该运行之前食谱中的*步骤2*。
- en: In *Step 2*, we specified the calendar and the day-counting convention. The
    day-counting convention determines the way interest accrues over time for various
    financial instruments, such as bonds. The `actual/actual` convention means that
    we use the actual number of elapsed days and the actual number of days in a year,
    that is, 365 or 366\. There are many other conventions such as `actual/365 (fixed)`,
    `actual/360`, and so on.
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤2*中，我们指定了日历和日计数约定。日计数约定决定了各种金融工具（如债券）随时间积累利息的方式。`actual/actual`约定意味着我们使用实际经过的天数和实际的一年天数，即365天或366天。还有许多其他约定，如`actual/365
    (fixed)`、`actual/360`等。
- en: In *Step 3*, we selected two dates—valuation and expiry—as we are interested
    in pricing an option that expires in a year. It is important to set `ql.Settings.instance().evaluationDate`
    to the considered evaluation date to make sure the calculations are performed
    correctly. In this case, the dates only determine the passage of time, meaning
    that the option expires within a year. We would get the same results (with some
    margin of error due to the random component of the simulations) using different
    dates with the same interval between them.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤3*中，我们选择了两个日期——估值日期和到期日期——因为我们关注的是定价一个将在一年后到期的期权。重要的是要将`ql.Settings.instance().evaluationDate`设置为所考虑的估值日期，以确保计算正确进行。在这种情况下，日期仅决定时间的流逝，意味着期权将在一年内到期。如果我们使用不同的日期但它们之间的间隔相同，我们会得到相同的结果（由于模拟的随机组件，会有一些误差）。
- en: 'We can check the time to expiry (in years) by running the following code:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以通过运行以下代码来检查到期时间（以年为单位）：
- en: '[PRE44]'
  id: totrans-262
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'Executing the snippet returns the following:'
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: 执行代码片段后返回以下内容：
- en: '[PRE45]'
  id: totrans-264
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: Next, we defined the option type (call/put), the type of exercise (European,
    American, or Bermudan), and the payoff (vanilla). In *Step 5*, we prepared the
    market data. We wrapped the values in quotes (`ql.SimpleQuote`) so that the values
    can be changed and those changes are properly registered in the instrument. This
    is an important step for calculating the Greeks in the *There’s more…* section.
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
  zh: 接下来，我们定义了期权类型（看涨/看跌）、行使类型（欧式、美式或百慕大式）以及支付方式（普通）。在*步骤5*中，我们准备了市场数据。我们将值用引号包围（`ql.SimpleQuote`），这样这些值就可以更改，并且这些更改会被正确地注册到工具中。这是计算希腊字母（*后续内容…*）中的一个重要步骤。
- en: In *Step 6*, we defined the relevant curves. Simply put, `TARGET` is a calendar
    that contains information on which days are holidays.
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤6*中，我们定义了相关的曲线。简而言之，`TARGET`是一个包含哪些天是节假日的日历。
- en: 'In this step, we specified the three important components of the **Black-Scholes**
    (**BS**) process, which are:'
  id: totrans-267
  prefs: []
  type: TYPE_NORMAL
  zh: 在此步骤中，我们指定了**Black-Scholes**（**BS**）过程的三个重要组成部分，它们是：
- en: The price of the underlying instrument
  id: totrans-268
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 标的资产的价格
- en: Volatility, which is constant as per our assumptions
  id: totrans-269
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 波动率，假设它是恒定的
- en: The risk-free rate, which is also constant over time
  id: totrans-270
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 无风险利率，假设它随时间保持不变
- en: We passed all these objects to the Black-Scholes process (`ql.BlackScholesProcess`),
    which we defined in *Step 7*. Then, we passed the process object into the special
    engine used for pricing American options using Monte Carlo simulations (there
    are many predefined engines for different types of options and pricing methods).
    At this point, we provided the desired number of simulations, the number of time
    steps for discretization, and the degree/order of the polynomial in the LSMC algorithm.
    Additionally, we provided the random seed (`seedCalibration`) to make the results
    reproducible.
  id: totrans-271
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将所有这些对象传递给了Black-Scholes过程（`ql.BlackScholesProcess`），该过程在*步骤7*中定义。然后，我们将该过程对象传递给用于定价美式期权的特殊引擎，该引擎使用蒙特卡洛模拟（针对不同类型的期权和定价方法有许多预定义的引擎）。此时，我们提供了所需的模拟次数、离散化的时间步数以及LSMC算法中多项式的度/阶数。此外，我们还提供了随机种子（`seedCalibration`），以确保结果可复现。
- en: In *Step 9*, we created an instance of `ql.VanillaOption` by providing previously
    defined types of payoff and exercise. We also set the pricing engine to the one
    defined in *Step 8* using the `setPricingEngine` method.
  id: totrans-272
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤9*中，我们通过提供之前定义的支付方式和行使方式类型，创建了一个`ql.VanillaOption`实例。我们还通过`setPricingEngine`方法将定价引擎设置为在*步骤8*中定义的引擎。
- en: Finally, we obtained the price of the option using the `NPV` method.
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们使用`NPV`方法得出了期权的价格。
- en: We can see that the option premium we obtained using QuantLib is very similar
    to the one we calculated previously, which further validates our results. The
    important thing to note here is that the workflow is similar for the valuation
    of a wide array of different derivatives, so it is good to be familiar with it.
    We could just as well price a European option using Monte Carlo simulations by
    substituting a few classes with their European option counterparts.
  id: totrans-274
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以看到，使用QuantLib得到的期权溢价与之前计算的结果非常相似，这进一步验证了我们的结果。这里需要注意的关键点是，针对各种不同衍生品的估值流程大致相似，因此熟悉这一流程非常重要。我们也可以通过替换几个类，将其用于蒙特卡洛模拟来定价欧洲期权。
- en: QuantLib also allows us to use variance reduction techniques such as antithetic
    values or control variates.
  id: totrans-275
  prefs: []
  type: TYPE_NORMAL
  zh: QuantLib还允许我们使用方差减少技术，如反向值或控制变量。
- en: There’s more...
  id: totrans-276
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多…
- en: Now that we have completed the preceding steps, we can calculate the Greeks.
    As we have mentioned in the previous recipe, the Greeks represent the sensitivity
    of the price of derivatives to a change in one of the underlying parameters (such
    as the price of the underlying asset, time to expiry, and so on).
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们已经完成了前面的步骤，可以计算希腊字母。如前所述，希腊字母表示衍生品价格对某一标的参数（如标的资产价格、到期时间等）变化的敏感度。
- en: 'When there is an analytical formula available for the Greeks (when the underlying
    QuantLib engine is using analytical formulas), we could just access it by running,
    for example, `option.delta()`. However, in cases such as valuations using binomial
    trees or simulations, there is no analytical formula, and we would receive an
    error (`RuntimeError: delta not provided`). This does not mean that it is impossible
    to calculate it, but we need to employ numerical differentiation and calculate
    it ourselves.'
  id: totrans-278
  prefs: []
  type: TYPE_NORMAL
  zh: '当有用于计算希腊字母的解析公式时（例如，当标的QuantLib引擎使用解析公式时），我们只需运行代码，例如`option.delta()`，即可访问希腊字母。然而，在使用二叉树或模拟等方法估值时，没有解析公式，我们会收到错误提示（`RuntimeError:
    delta not provided`）。这并不意味着无法计算它，而是我们需要采用数值微分法并自行计算。'
- en: 'In this example, we will only extract the delta. Therefore, the relevant two-sided
    formula is:'
  id: totrans-279
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个例子中，我们只提取delta。因此，相关的双侧公式是：
- en: '![](../Images/B18112_10_021.png)'
  id: totrans-280
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B18112_10_021.png)'
- en: Here, *P(S)* is the price of the instrument given the underlying asset’s price
    *S*; *h* is a very small increment.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 这里，*P(S)*是给定标的资产价格*S*下的工具价格；*h*是一个非常小的增量。
- en: 'Run the following block of code to calculate the delta:'
  id: totrans-282
  prefs: []
  type: TYPE_NORMAL
  zh: 运行以下代码块来计算delta：
- en: '[PRE46]'
  id: totrans-283
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: The simplest interpretation of the delta is that the option’s delta equal to
    -1.36 indicates that, if the underlying stock increases in price by $1 per share,
    the option on it will decrease by $1.36 per share; otherwise, everything will
    be equal.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: delta的最简单解释是，期权的delta为-1.36，意味着如果标的股票的价格每股上涨1美元，期权每股将下降1.36美元；否则，一切保持不变。
- en: Pricing barrier options
  id: totrans-285
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 定价障碍期权
- en: A **barrier option** is a type of option that falls under the umbrella of exotic
    options. That is because they are more complex than plain European or American
    options. Barrier options are a type of path-dependent option because their payoff,
    and thus also their value, is based on the underlying asset’s price path.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: '**障碍期权**是一种属于外来期权类别的期权。这是因为它们比普通的欧洲期权或美式期权更为复杂。障碍期权是一种路径依赖型期权，因为它们的收益以及价值都取决于标的资产的价格路径。'
- en: 'To be more precise, the payoff depends on whether or not the underlying asset
    has reached/exceeded a predetermined price threshold. Barrier options are typically
    classified as one of the following:'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: 更准确地说，收益取决于标的资产是否达到或超过了预定的价格阈值。障碍期权通常分为以下几类：
- en: A knock-out option, that is, the option becomes worthless if the underlying
    asset’s price exceeds a certain threshold
  id: totrans-288
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一种敲出期权，即如果标的资产的价格超过某个阈值，期权将变得毫无价值
- en: A knock-in option, that is, the option has no value until the underlying asset’s
    price reaches a certain threshold
  id: totrans-289
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 一种敲入期权，即期权在标的资产价格达到某个阈值之前没有任何价值
- en: 'Considering the classes of the barrier options mentioned above, we can deal
    with the following categories:'
  id: totrans-290
  prefs: []
  type: TYPE_NORMAL
  zh: 考虑到上述障碍期权的类别，我们可以处理以下几类：
- en: 'Up-and-Out: The option starts active and becomes worthless (knocked out) when
    the underlying asset’s price moves up to the barrier level'
  id: totrans-291
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 向上出场：期权开始时处于激活状态，当标的资产价格上涨到障碍水平时，期权变为无效（失效）
- en: 'Up-and-In: The option starts inactive and becomes active (knocked in) when
    the underlying asset’s price moves up to the barrier level'
  id: totrans-292
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 向上入场：期权开始时处于非激活状态，当标的资产价格上涨到障碍水平时，期权变为激活状态（击中）
- en: 'Down-and-Out: The option starts active and becomes knocked out when the underlying
    asset’s price moves down to the barrier level'
  id: totrans-293
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 向下出场：期权开始时处于激活状态，当标的资产价格下跌到障碍水平时，期权变为击中（失效）
- en: 'Down-and-In: The option starts inactive and becomes active when the underlying
    asset’s price moves down to the barrier level'
  id: totrans-294
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 向下入场：期权开始时处于非激活状态，当标的资产价格下跌到障碍水平时，期权变为激活状态
- en: Other than the behavior described above, barrier options behave like standard
    call and put options.
  id: totrans-295
  prefs: []
  type: TYPE_NORMAL
  zh: 除了上述描述的行为外，障碍期权的表现类似于标准的看涨和看跌期权。
- en: In this recipe, we use Monte Carlo simulations to price an Up-and-In European
    call option with the underlying trading at $55, a strike price of $60, and a barrier
    level of $65\. The time to maturity will be 1 year.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个实例中，我们使用蒙特卡罗模拟为“向上入场”欧式看涨期权定价，标的资产当前交易价格为55美元，行权价为60美元，障碍水平为65美元，距离到期时间为1年。
- en: How to do it…
  id: totrans-297
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何操作……
- en: 'Execute the following steps to price an Up-and-In European call option:'
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤来为“向上入场”欧式看涨期权定价：
- en: 'Import the libraries:'
  id: totrans-299
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入库：
- en: '[PRE47]'
  id: totrans-300
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'Define the parameters for the valuation:'
  id: totrans-301
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义估值的参数：
- en: '[PRE48]'
  id: totrans-302
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'Simulate the stock path using the `simulate_gbm` function:'
  id: totrans-303
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 使用`simulate_gbm`函数模拟股票路径：
- en: '[PRE49]'
  id: totrans-304
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'Calculate the maximum value per path:'
  id: totrans-305
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算每条路径的最大值：
- en: '[PRE50]'
  id: totrans-306
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'Calculate the payoff:'
  id: totrans-307
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算支付：
- en: '[PRE51]'
  id: totrans-308
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'Calculate the option’s premium:'
  id: totrans-309
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算期权的溢价：
- en: '[PRE52]'
  id: totrans-310
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE52]'
- en: The premium of the considered Up-and-In European call option is `3.6267`.
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
  zh: 所考虑的“向上入场”欧式看涨期权的溢价为`3.6267`。
- en: How it works…
  id: totrans-312
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的……
- en: In the first two steps, we imported the libraries (including the helper function,
    `simulate_gbm`, which we have already used throughout this chapter) and defined
    the parameters of the valuation.
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 在前两步中，我们导入了库（包括已在本章中使用的辅助函数`simulate_gbm`），并定义了估值的参数。
- en: In *Step 3*, we simulated 100,000 possible paths using a geometric Brownian
    motion. Then, we calculated the maximum price of the underlying asset for each
    path. Because we are working with an Up-and-In option, we just need to know if
    the maximum price of the asset reached the barrier level. If so, then the option’s
    payoff at maturity will be equal to that of a vanilla European call. If the barrier
    level was not reached, the payoff from that path will be zero. We encoded that
    payoff condition in *Step 5*.
  id: totrans-314
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤3*中，我们使用几何布朗运动模拟了100,000条可能的路径。然后，我们计算了每条路径中标的资产的最高价格。因为我们处理的是“向上入场”期权，我们只需要知道标的资产的最高价格是否达到了障碍水平。如果达到了，那么期权在到期时的支付将等同于一个普通的欧式看涨期权的支付。如果障碍水平未达到，那么该路径的支付将为零。我们在*步骤5*中编码了这个支付条件。
- en: Lastly, we proceeded just as we have done with the European call option before—we
    took the average payoff and discounted it using the discount factor.
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，我们按照之前处理欧式看涨期权的方式进行操作——取平均支付并使用折现因子进行折现。
- en: We can build some intuition about the prices of barrier options. For example,
    the price of an Up-and-Out barrier option should be lower than that of a vanilla
    equivalent. That is due to the fact that the payoffs of the two instruments would
    be identical except for the added risk that the Up-and-Out barrier option could
    be knocked-out before expiring. That added risk should be reflected in the lower
    price of such a barrier option as compared to its vanilla counterpart.
  id: totrans-316
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以对障碍期权的价格建立一些直觉。例如，“向上出场”障碍期权的价格应该低于其普通等效期权的价格。这是因为，除了“向上出场”障碍期权可能会在到期前被击出这一额外的风险外，两者的支付是相同的。这个额外的风险应该反映在“向上出场”障碍期权的较低价格中，与其普通对等期权相比。
- en: In this recipe, we have manually priced an Up-and-In European call option. However,
    we can also use the QuantLib library for the task. Due to the fact that there
    would be a lot of code repetition with the previous recipe, we do not show that
    in the book.
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 在这个实例中，我们手动为“向上入场”欧式看涨期权定价。然而，我们也可以使用QuantLib库来完成此任务。由于这将与之前的实例中有大量代码重复，因此我们在本书中没有展示。
- en: But you are highly encouraged to check out the solution using QuantLib in the
    accompanying notebook available on GitHub. We just mention that the solution using
    QuantLib returns the option premium of 3.6457, which is very close to the one
    we obtained manually. The difference can be attributed to the random component
    of the simulations.
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 但是强烈建议你查看 GitHub 上附带的笔记本中使用 QuantLib 的解决方案。我们只是提到，通过 QuantLib 解决方案得到的期权溢价为 3.6457，与我们手动计算的结果非常接近。差异可以归因于模拟的随机成分。
- en: There’s more…
  id: totrans-319
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多…
- en: 'The valuation of barrier options is complex given those instruments are path-dependent.
    We have already mentioned how to use Monte Carlo simulations to price such options;
    however, there are several alternative approaches:'
  id: totrans-320
  prefs: []
  type: TYPE_NORMAL
  zh: 障碍期权的估值比较复杂，因为这些金融工具是路径依赖的。我们已经提到过如何使用蒙特卡罗模拟来定价此类期权；然而，还有几种替代方法：
- en: Use a static replicating portfolio of vanilla options to mimic the value of
    the barrier at expiry and at a few discrete points in time along the barrier.
    Then, those options can be valued using the Black-Scholes model. By following
    this approach, we can obtain closed-form prices and replication strategies for
    all kinds of barrier options.
  id: totrans-321
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用静态复制投资组合（普通期权）来模拟障碍期权在到期时以及在障碍期内几个离散时间点的价值。然后，可以使用 Black-Scholes 模型对这些期权进行定价。通过这种方法，我们可以获得所有类型障碍期权的封闭形式价格和复制策略。
- en: Use the binomial tree approach to option pricing.
  id: totrans-322
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用二项树方法进行期权定价。
- en: Use the **partial differential equation** (**PDE**) and potentially combine
    it with the finite difference method.
  id: totrans-323
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 使用**偏微分方程**（**PDE**），并可能将其与有限差分法结合使用。
- en: Estimating Value-at-Risk using Monte Carlo
  id: totrans-324
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用蒙特卡罗模拟估算风险价值
- en: '**Value-at-Risk** (**VaR**) is a very important financial metric that measures
    the risk associated with a position, portfolio, etc. It is commonly abbreviated
    to VaR, not to be confused with **vector autoregression** (which is abbreviated
    to **VAR**). VaR reports the worst expected loss—at a given level of confidence—over
    a certain horizon under normal market conditions. The easiest way to understand
    it is by looking at an example. Let’s say that the 1-day 95% VaR of our portfolio
    is $100\. This means that 95% of the time (under normal market conditions), we
    will not lose more than $100 by holding our portfolio over one day.'
  id: totrans-325
  prefs: []
  type: TYPE_NORMAL
  zh: '**风险价值**（**VaR**）是一个非常重要的金融指标，用于衡量与某个头寸、投资组合等相关的风险。通常缩写为 VaR，不要与**向量自回归**（缩写为
    **VAR**）混淆。VaR 报告在特定置信水平下，在正常市场条件下某个时间段内的最坏预期损失。理解 VaR 最简单的方式是通过一个例子。假设我们的投资组合
    1 天 95% VaR 为 $100。这意味着在正常市场条件下，95% 的时间里，我们持有该投资组合 1 天不会损失超过 $100。'
- en: It is common to present the loss given by VaR as a positive (absolute) value.
    That is why in this example, a VaR of $100 means losing no more than $100\. However,
    a negative VaR is possible and it would indicate a high probability of making
    a profit. For example, a 1-day 95% VaR of $-100 would imply that our portfolio
    has a 95% chance of making more than $100 over the next day.
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: 通常，VaR 给出的损失是以正值（绝对值）呈现的。这就是为什么在这个例子中，VaR 为 $100 表示损失不超过 $100。不过，负 VaR 也是可能的，它表示有较高的获利概率。例如，1天
    95% VaR 为 $-100 表示我们的投资组合在接下来的 1 天内有 95% 的概率会赚取超过 $100。
- en: 'There are several ways to calculate VaR, including:'
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
  zh: 计算 VaR 的方法有很多，包括：
- en: Parametric approach (variance-covariance)
  id: totrans-328
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 参数法（方差-协方差）
- en: Historical simulation approach
  id: totrans-329
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 历史模拟法
- en: Monte Carlo simulations
  id: totrans-330
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 蒙特卡罗模拟
- en: In this recipe, we only consider the last method. We assume that we are holding
    a portfolio consisting of two assets (stocks of Intel and AMD) and that we want
    to calculate a 1-day Value-at-Risk.
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
  zh: 在本方案中，我们仅考虑最后一种方法。我们假设我们持有一个由两种资产（英特尔和 AMD 的股票）组成的投资组合，并且我们想计算 1 天的风险价值。
- en: How to do it...
  id: totrans-332
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何做...
- en: 'Execute the following steps to estimate the Value-at-Risk using Monte Carlo
    simulations:'
  id: totrans-333
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤，通过蒙特卡罗模拟估算风险价值：
- en: 'Import the libraries:'
  id: totrans-334
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 导入库：
- en: '[PRE53]'
  id: totrans-335
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'Define the parameters that will be used for this recipe:'
  id: totrans-336
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义将用于此方案的参数：
- en: '[PRE54]'
  id: totrans-337
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'Download the price data from Yahoo Finance:'
  id: totrans-338
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从 Yahoo Finance 下载价格数据：
- en: '[PRE55]'
  id: totrans-339
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'Calculate the daily returns:'
  id: totrans-340
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算每日收益：
- en: '[PRE56]'
  id: totrans-341
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE56]'
- en: Running the snippet results in the following figure.
  id: totrans-342
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 运行代码片段后，得到以下图形。
- en: '![](../Images/B18112_10_03.png)'
  id: totrans-343
  prefs:
  - PREF_IND
  type: TYPE_IMG
  zh: '![](../Images/B18112_10_03.png)'
- en: 'Figure 10.3: Simple returns of Intel and AMD in 2020'
  id: totrans-344
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 图 10.3：2020 年英特尔和 AMD 的简单收益
- en: Additionally, we calculated the Pearson’s correlation between the two series
    (using the `corr` method), which is equal to `0.5`.
  id: totrans-345
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 此外，我们计算了两组数据之间的皮尔逊相关系数（使用`corr`方法），其值为`0.5`。
- en: 'Calculate the covariance matrix:'
  id: totrans-346
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算协方差矩阵：
- en: '[PRE57]'
  id: totrans-347
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'Perform the Cholesky decomposition of the covariance matrix:'
  id: totrans-348
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 对协方差矩阵进行Cholesky分解：
- en: '[PRE58]'
  id: totrans-349
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'Draw the correlated random numbers from the Standard Normal distribution:'
  id: totrans-350
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从标准正态分布中抽取相关的随机数：
- en: '[PRE59]'
  id: totrans-351
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE59]'
- en: 'Define the metrics that will be used for simulations:'
  id: totrans-352
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 定义将用于模拟的指标：
- en: '[PRE60]'
  id: totrans-353
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE60]'
- en: 'Calculate the terminal price of the considered stocks:'
  id: totrans-354
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算所考虑股票的终端价格：
- en: '[PRE61]'
  id: totrans-355
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE61]'
- en: 'Calculate the terminal portfolio value and the portfolio returns:'
  id: totrans-356
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算终端投资组合价值和投资组合收益率：
- en: '[PRE62]'
  id: totrans-357
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE62]'
- en: 'Calculate the VaR for the selected confidence levels:'
  id: totrans-358
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 计算所选置信度水平的VaR：
- en: '[PRE63]'
  id: totrans-359
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE63]'
- en: 'Running the snippet results in the following output:'
  id: totrans-360
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
  zh: 运行代码片段将生成如下输出：
- en: '[PRE64]'
  id: totrans-361
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE64]'
- en: 'Present the results on a graph:'
  id: totrans-362
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 在图表中展示结果：
- en: '[PRE65]'
  id: totrans-363
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE65]'
- en: 'Running the snippet results in the following figure:'
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
  zh: 运行代码片段将生成如下图形：
- en: '![](../Images/B18112_10_04.png)'
  id: totrans-365
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/B18112_10_04.png)'
- en: 'Figure 10.4: Distribution of the possible 1-day changes in portfolio value
    and the 1-day 99% VaR'
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
  zh: 图10.4：投资组合价值可能变化的1天分布和1天99% VaR
- en: '*Figure 10.4* shows the distribution of possible 1-day-ahead portfolio values.
    We present the 99% Value-at-Risk with the vertical line.'
  id: totrans-367
  prefs: []
  type: TYPE_NORMAL
  zh: '*图10.4* 展示了未来1天投资组合可能价值变化的分布。我们用垂直线表示99%的风险价值（VaR）。'
- en: How it works...
  id: totrans-368
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 它是如何工作的...
- en: In *Steps 2* to *4*, we downloaded the daily stock prices of Intel and AMD from
    the year 2020, extracted the adjusted close prices, and converted them into simple
    returns. We also defined a few parameters, such as the number of simulations and
    the number of shares we have in our portfolio.
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤 2* 到 *步骤 4* 中，我们下载了2020年Intel和AMD的每日股票价格，提取了调整后的收盘价，并将其转换为简单收益率。我们还定义了几个参数，例如模拟次数和我们投资组合中持有的股票数量。
- en: 'There are two ways to approach VaR calculations:'
  id: totrans-370
  prefs: []
  type: TYPE_NORMAL
  zh: 计算VaR有两种方法：
- en: 'Calculate VaR from prices: Using the number of shares and the asset prices,
    we can calculate the worth of the portfolio now and its possible value X days
    ahead.'
  id: totrans-371
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根据价格计算VaR：通过使用股票数量和资产价格，我们可以计算出投资组合当前的价值以及未来X天的可能价值。
- en: 'Calculate VaR from returns: Using the percentage weights of each asset in the
    portfolio and the assets’ expected returns, we can calculate the expected portfolio
    return X days ahead. Then, we can express VaR as the dollar amount based on that
    return and the current portfolio value.'
  id: totrans-372
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 根据收益率计算VaR：通过使用投资组合中每个资产的百分比权重和资产的预期收益率，我们可以计算出未来X天的预期投资组合收益率。然后，我们可以根据该收益率和当前投资组合价值，将VaR表示为美元金额。
- en: The Monte Carlo approach to determining the price of an asset employs random
    variables drawn from the Standard Normal distribution. For the case of calculating
    portfolio VaR, we need to account for the fact that the assets in our portfolio
    may be correlated. To do so, in *Steps 5* to *7*, we generated correlated random
    variables. To do so, we first calculated the historical covariance matrix. Then,
    we used the Cholesky decomposition on it and multiplied the resulting matrix by
    the matrix containing the random variables.
  id: totrans-373
  prefs: []
  type: TYPE_NORMAL
  zh: 蒙特卡洛方法用于确定资产价格，通过从标准正态分布中抽取随机变量。在计算投资组合VaR时，我们需要考虑到投资组合中的资产可能存在相关性。为此，在*步骤 5*
    到 *步骤 7* 中，我们生成了相关的随机变量。具体步骤是：首先，我们计算了历史协方差矩阵；然后，我们对其进行了Cholesky分解，并将得到的矩阵与包含随机变量的矩阵相乘。
- en: Another possible approach to making random variables correlated is to use the
    **Singular Value Decomposition** (**SVD**) instead of the Cholesky decomposition.
    The function we can use for this is `np.linalg.svd`.
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
  zh: 另一种使随机变量相关的方法是使用**奇异值分解**（**SVD**）替代Cholesky分解。我们可以使用的函数是`np.linalg.svd`。
- en: In *Step 8*, we calculated metrics such as the historical averages of the asset
    return, the accompanying standard deviations, the last known stock prices, and
    the initial portfolio value. In *Step 9*, we applied the analytical solution to
    the geometric Brownian motion SDE and calculated possible 1-day-ahead stock prices
    for both assets.
  id: totrans-375
  prefs: []
  type: TYPE_NORMAL
  zh: 在*步骤 8*中，我们计算了资产收益的历史平均值、伴随的标准差、最后已知的股票价格和初始投资组合价值。在*步骤 9*中，我们应用了几何布朗运动SDE的解析解，计算了两只资产的可能1天后的股票价格。
- en: To calculate the portfolio VaR, we calculated the possible 1-day-ahead portfolio
    values and the accompanying differences (P[T] - P[0]). Then, we sorted them in
    ascending order. The X% VaR is simply the (1-X)-th percentile of the sorted portfolio
    differences.
  id: totrans-376
  prefs: []
  type: TYPE_NORMAL
  zh: 为了计算投资组合VaR，我们计算了可能的1天前投资组合价值及其相应差异（P[T] - P[0]）。然后，我们将这些差异按升序排列。X%的VaR就是排序后的投资组合差异的(1-X)百分位。
- en: Banks frequently calculate the 1-day and 10-day VaR. To arrive at the latter,
    they can simulate the value of their assets over a 10-day interval using 1-day
    steps (discretization). However, they can also calculate the 1-day VaR and multiply
    it by the square root of 10\. This might be beneficial for the bank if it leads
    to lower capital requirements.
  id: totrans-377
  prefs: []
  type: TYPE_NORMAL
  zh: 银行通常会计算1天和10天VaR。为了计算后者，它们可以通过1天的步长（离散化）模拟其资产在10天期间的价值。然而，它们也可以计算1天VaR，并将其乘以10的平方根。如果这样做可以降低资本要求，银行可能会觉得这种方法更有利。
- en: There’s more...
  id: totrans-378
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 还有更多...
- en: 'As we have mentioned, there are multiple ways of calculating the Value-at-Risk.
    And each of those comes with a set of potential drawbacks, some of which are:'
  id: totrans-379
  prefs: []
  type: TYPE_NORMAL
  zh: 如我们所提到的，计算风险价值的方法有多种，每种方法都有一套潜在的缺点，其中一些包括：
- en: Assuming a parametric distribution (variance-covariance approach)
  id: totrans-380
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 假设使用参数化分布（方差-协方差方法）
- en: Assuming that daily gains/losses are IID (independently and identically distributed)
  id: totrans-381
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 假设日收益/损失是独立同分布的（IID）
- en: Not capturing enough tail risk
  id: totrans-382
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 未能捕捉足够的尾部风险
- en: Not considering the so-called Black Swan events (unless they are already in
    the historical sample)
  id: totrans-383
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 没有考虑所谓的黑天鹅事件（除非它们已经出现在历史样本中）
- en: Historical VaR can be slow to adapt to new market conditions
  id: totrans-384
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 历史VaR可能对新的市场条件适应较慢
- en: The historical simulation approach assumes that past returns are sufficient
    to evaluate future risk (connects to the previous points)
  id: totrans-385
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 历史模拟方法假设过去的回报足以评估未来的风险（与之前的观点相关）
- en: There are some interesting recent developments in using deep learning techniques,
    for example, generative adversarial networks for Value-at-Risk estimation.
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
  zh: 最近在使用深度学习技术进行VaR估计方面有一些有趣的进展，例如，生成对抗网络（GANs）。
- en: Another general drawback of VaR is that it does not contain information about
    the size of the potential loss when it exceeds the threshold given by VaR. This
    is when **expected shortfall** (also known as conditional VaR or expected tail
    loss) comes into play. It simply states what the expected loss is in the worst
    X% of scenarios.
  id: totrans-387
  prefs: []
  type: TYPE_NORMAL
  zh: VaR的另一个普遍缺点是，当潜在损失超过VaR设定的阈值时，它无法提供关于损失大小的信息。这时**预期短缺**（也称为条件VaR或预期尾部损失）就派上用场了。它简单地说明了在最坏的X%的情境下，预期损失是多少。
- en: There are many ways to calculate the Expected Shortfall, but we present the
    one that is easily connected to the VaR and can be estimated using Monte Carlo
    simulations.
  id: totrans-388
  prefs: []
  type: TYPE_NORMAL
  zh: 计算预期短缺有很多方法，但我们展示了一种与VaR易于连接且可以通过蒙特卡洛模拟进行估算的方法。
- en: 'Following on from the example of a two-asset portfolio, we would like to know
    the following: if the loss exceeds the VaR, how big will it be? To obtain that
    number, we need to filter out all losses that are higher than the value given
    by VaR and calculate their expected value by taking the average.'
  id: totrans-389
  prefs: []
  type: TYPE_NORMAL
  zh: 以双资产投资组合为例，我们希望知道以下内容：如果损失超过VaR，它将有多大？为了得到这个数字，我们需要筛选出所有高于VaR给定值的损失，并通过取平均值来计算它们的预期值。
- en: 'We can do this using the following snippet:'
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用以下代码片段来实现这一点：
- en: '[PRE66]'
  id: totrans-391
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: Please bear in mind that for Expected Shortfall we only use a small fraction
    of all the simulations that were used to obtain the VaR. In *Figure 10.4*, we
    would only consider the observations to the left of the VaR line. That is why,
    in order to have reasonable results for the Expected Shortfall, the overall sample
    must be large enough.
  id: totrans-392
  prefs: []
  type: TYPE_NORMAL
  zh: 请记住，计算预期短缺时，我们只使用了为计算VaR而进行的所有模拟中的一小部分。在*图10.4*中，我们只考虑VaR线左侧的观察值。这就是为什么，为了得到合理的预期短缺结果，整体样本必须足够大的原因。
- en: 'The 1-day 95% VaR is $0.29, while the accompanying Expected Shortfall is $0.64\.
    We can interpret these results as follows: if the loss exceeds the 95% VaR, we
    can expect to lose $0.64 by holding our portfolio for 1 day.'
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
  zh: 1天95%VaR为$0.29，而伴随的预期短缺为$0.64。我们可以这样解读这些结果：如果损失超过95% VaR，我们可以预期持有投资组合1天将损失$0.64。
- en: Summary
  id: totrans-394
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 总结
- en: In this chapter, we have covered Monte Carlo simulations, which are a very versatile
    tool useful in many financial tasks. We demonstrated how to utilize them for simulating
    stock prices using a geometric Brownian motion, pricing various types of options
    (European, American, and Barrier), and calculating the Value-at-Risk.
  id: totrans-395
  prefs: []
  type: TYPE_NORMAL
  zh: 在本章中，我们介绍了蒙特卡洛模拟，这是一种在许多金融任务中都非常有用的多功能工具。我们演示了如何利用它们通过几何布朗运动模拟股票价格，定价各种类型的期权（欧洲期权、美式期权和障碍期权），以及计算风险价值（Value-at-Risk）。
- en: However, in this chapter we have barely scratched the surface of all the possible
    applications of Monte Carlo simulations. In the following chapter, we also show
    how to use them to obtain the efficient frontier used for asset allocation.
  id: totrans-396
  prefs: []
  type: TYPE_NORMAL
  zh: 然而，在本章中，我们仅仅触及了蒙特卡洛模拟所有可能应用的皮毛。在接下来的章节中，我们还将展示如何使用它们来获得用于资产配置的有效前沿。
- en: Join us on Discord!
  id: totrans-397
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 加入我们的 Discord 社区！
- en: 'To join the Discord community for this book – where you can share feedback,
    ask questions to the author, and learn about new releases – follow the QR code
    below:'
  id: totrans-398
  prefs: []
  type: TYPE_NORMAL
  zh: 要加入本书的 Discord 社区——在这里你可以分享反馈、向作者提问并了解新版本——请扫描下面的二维码：
- en: '![](../Images/QR_Code203602028422735375.png)'
  id: totrans-399
  prefs: []
  type: TYPE_IMG
  zh: '![](../Images/QR_Code203602028422735375.png)'
- en: '[https://packt.link/ips2H](https://packt.link/ips2H)'
  id: totrans-400
  prefs: []
  type: TYPE_NORMAL
  zh: '[https://packt.link/ips2H](https://packt.link/ips2H)'

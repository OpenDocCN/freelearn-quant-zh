["```py\n> library(Quandl)\n> Quandl.auth(\"yourauthenticationtoken\")\n> G <- Quandl('GOOG/NASDAQ_GOOG',\n+   start_date = '2009-06-01', end_date = '2013-06-01')\n\n```", "```py\n> str(G)\n'data.frame':     1018 obs. of  6 variables:\n $ Date  : Date, format: \"2009-06-01\" \"2009-06-02\" ...\n $ Open  : num  419 426 426 435 445 ...\n $ High  : num  430 430 432 441 447 ...\n $ Low   : num  419 423 424 434 439 ...\n $ Close : num  427 428 432 440 444 ...\n $ Volume: num  3323431 2626012 3535593 3639434 3681002 ...\n> G <- G$Close\n\n```", "```py\n> SP500 <- Quandl('YAHOO/INDEX_GSPC',\n+   start_date = '2009-06-01', end_date = '2013-06-01')\n> SP500 <- SP500$'Adjusted Close'\n\n```", "```py\n> LIBOR <- Quandl('FED/RILSPDEPM01_N_B',\n+   start_date = '2009-06-01', end_date = '2013-06-01')\n> LIBOR <- LIBOR$Value\n\n```", "```py\n> sapply(list(G, SP500, LIBOR), length)\n[1] 1018 1008 1024\n\n```", "```py\n> G     <- Quandl('GOOG/NASDAQ_GOOG',\n+          start_date = '2009-06-01', end_date = '2013-06-01')\n> SP500 <- Quandl('YAHOO/INDEX_GSPC',\n+          start_date = '2009-06-01', end_date = '2013-06-01')\n> LIBOR <- Quandl('FED/RILSPDEPM01_N_B',\n+          start_date = '2009-06-01', end_date = '2013-06-01')\n\n```", "```py\n> cdates <- Reduce(intersect, list(G$Date, SP500$Date,LIBOR$Date))\n\n```", "```py\nG      <- G[G$Date %in% cdates, 'Close']\nSP500  <- SP500[SP500$Date %in% cdates, 'Adjusted Close']\nLIBOR  <- LIBOR[LIBOR$Date %in% cdates, 'Value']\n\n```", "```py\n> logreturn <- function(x) log(tail(x, -1) / head(x, -1))\n\n```", "```py\n> rft <- log(1 + head(LIBOR, -1)/36000 * diff(cdates)) \n> str(rft)\nnum [1:1001] 1.81e-05 1.81e-05 1.81e-05 1.81e-05 5.42e-05 ...\n\n```", "```py\n> cov(logreturn(G) - rft, logreturn(SP500) - rft) / \n+   var(logreturn(SP500) - rft)\n[1] 0.8997941\n\n```", "```py\n> riskpremium <- function(x) logreturn(x) - rft\n> cov(riskpremium(G), riskpremium(SP500)) / var(riskpremium(SP500))\n[1] 0.8997941\n\n```", "```py\n> (fit <- lm(riskpremium(G) ~ riskpremium(SP500)))\n\nCall:\nlm(formula = riskpremium(G) ~ riskpremium(SP500))\n\nCoefficients:\n (Intercept)  riskpremium(SP500) \n 0.0002078           0.8997941\n\n```", "```py\n> plot(riskpremium(SP500), riskpremium(G))\n> abline(fit, col = 'red')\n\n```", "```py\n> fit <- lm(riskpremium(G) ~ -1 + riskpremium(SP500))\n\n```", "```py\n> summary(fit)\n\nCall:\nlm(formula = riskpremium(G) ~ -1 + riskpremium(SP500))\n\nResiduals:\n Min        1Q    Median        3Q       Max \n-0.089794 -0.005553  0.000166  0.005520  0.117087 \n\nCoefficients:\n Estimate Std. Error t value Pr(>|t|) \nriskpremium(SP500)  0.90048    0.03501   25.72   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.0124 on 1000 degrees of freedom\nMultiple R-squared:  0.3982,\tAdjusted R-squared:  0.3976 \nF-statistic: 661.6 on 1 and 1000 DF,  p-value: < 2.2e-16\n\n```", "```py\n> summary(lm(riskpremium(G) ~ riskpremium(SP500)))\n\nCall:\nlm(formula = riskpremium(G) ~ riskpremium(SP500))\n\nResiduals:\n Min        1Q    Median        3Q       Max \n-0.089999 -0.005757 -0.000045  0.005307  0.116883 \n\nCoefficients:\n Estimate Std. Error t value Pr(>|t|) \n(Intercept)        0.0002078  0.0003924   0.529    0.597 \nriskpremium(SP500) 0.8997941  0.0350463  25.674   <2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.01241 on 999 degrees of freedom\nMultiple R-squared:  0.3975,\tAdjusted R-squared:  0.3969 \nF-statistic: 659.2 on 1 and 999 DF,  p-value: < 2.2e-16\n\n```", "```py\n> par(mfrow = c(2, 2))\n> plot(fit)\n\n```", "```py\n> symbols <- c(\"A\", \"AA\", \"AAPL\", \"ABC\", \"ABT\", \"ACE\", \"ACN\", \"ACT\", \"ADBE\", \"ADI\", \"ADM\", \"ADP\", \"ADSK\", \"AEE\", \"AEP\", \"AES\",\"AET\", \"AFL\", \"AGN\", \"AIG\", \"AIV\", \"AIZ\", \"AKAM\", \"ALL\", \"ALTR\", \"ALXN\", \"AMAT\", \"AMD\", \"AMGN\", \"AMP\", \"AMT\", \"AMZN\", \"AN\", \"ANF\", \"AON\", \"APA\", \"APC\", \"APD\", \"APH\", \"APOL\", \"ARG\", \"ATI\", \"AVB\", \"AVP\", \"AVY\", \"AXP\", \"AZO\", \"BA\", \"BAC\", \"BAX\", \"BBBY\", \"BBT\", \"BBY\", \"BCR\", \"BDX\", \"BEAM\", \"BEN\", \"BF.B\", \"BHI\", \"BIIB\", \"BK\", \"BLK\", \"BLL\", \"BMC\", \"BMS\", \"BMY\", \"BRCM\", \"BRK.B\", \"BSX\", \"BTU\", \"BXP\", \"C\", \"CA\", \"CAG\", \"CAH\", \"CAM\", \"CAT\", \"CB\", \"CBG\", \"CBS\", \"CCE\", \"CCI\", \"CCL\", \"CELG\", \"CERN\", \"CF\", \"CHK\", \"CHRW\", \"CI\", \"CINF\", \"CL\", \"CLF\", \"CLX\", \"CMA\", \"CMCSA\", \"CME\")\n\n```", "```py\n> library(tseries)\n> res <- lapply(symbols, function(symbol)\n+   get.hist.quote(symbol, quote = \"AdjClose\", quiet = TRUE,\n+   start = as.Date('2003-01-01'), end = as.Date('2007-01-01')))\n\n```", "```py\n> LIBOR <- Quandl('FED/RILSPDEPM01_N_B',\n+            start_date = '2003-01-01', end_date = '2007-01-01')\n> SP500 <- Quandl('YAHOO/INDEX_GSPC',\n+            start_date = '2003-01-01', end_date = '2007-01-01')\n> cdates <- intersect(LIBOR$Date, SP500$Date)\n\n```", "```py\n> d <- data.frame(date = as.Date(cdates, origin = '1970-01-01'))\n> str(d)\n'data.frame':\t998 obs. of  1 variable:\n $ date: Date, format: \"2003-01-02\" \"2003-01-03\" ...\n\n```", "```py\n> d$day <- format(d$date, format = '%d')\n> d$my  <- format(d$date, format = '%Y-%m')\n\n```", "```py\n> (fds <- with(d, tapply(day, my, min)))\n2003-01 2003-02 2003-03 2003-04 2003-05 2003-06 2003-07 2003-08 \n \"02\"    \"03\"    \"03\"    \"01\"    \"01\"    \"02\"    \"01\"    \"01\" \n2003-09 2003-10 2003-11 2003-12 2004-01 2004-02 2004-03 2004-04 \n \"02\"    \"01\"    \"03\"    \"01\"    \"02\"    \"02\"    \"01\"    \"01\" \n2004-05 2004-06 2004-07 2004-08 2004-09 2004-10 2004-11 2004-12 \n \"03\"    \"01\"    \"01\"    \"02\"    \"01\"    \"01\"    \"01\"    \"01\" \n2005-01 2005-02 2005-03 2005-04 2005-05 2005-06 2005-07 2005-08 \n \"03\"    \"01\"    \"01\"    \"01\"    \"02\"    \"01\"    \"01\"    \"01\" \n2005-09 2005-10 2005-11 2005-12 2006-01 2006-02 2006-03 2006-04 \n \"01\"    \"03\"    \"01\"    \"01\"    \"03\"    \"01\"    \"01\"    \"03\" \n2006-05 2006-06 2006-07 2006-08 2006-09 2006-10 2006-11 2006-12 \n \"01\"    \"01\"    \"03\"    \"01\"    \"01\"    \"02\"    \"01\"    \"01\"\n\n```", "```py\n> (fds <- as.Date(paste(row.names(fds), fds, sep = '-')))\n [1] \"2003-01-02\" \"2003-02-03\" \"2003-03-03\" \"2003-04-01\" \"2003-05-01\"\n [6] \"2003-06-02\" \"2003-07-01\" \"2003-08-01\" \"2003-09-02\" \"2003-10-01\"\n[11] \"2003-11-03\" \"2003-12-01\" \"2004-01-02\" \"2004-02-02\" \"2004-03-01\"\n[16] \"2004-04-01\" \"2004-05-03\" \"2004-06-01\" \"2004-07-01\" \"2004-08-02\"\n[21] \"2004-09-01\" \"2004-10-01\" \"2004-11-01\" \"2004-12-01\" \"2005-01-03\"\n[26] \"2005-02-01\" \"2005-03-01\" \"2005-04-01\" \"2005-05-02\" \"2005-06-01\"\n[31] \"2005-07-01\" \"2005-08-01\" \"2005-09-01\" \"2005-10-03\" \"2005-11-01\"\n[36] \"2005-12-01\" \"2006-01-03\" \"2006-02-01\" \"2006-03-01\" \"2006-04-03\"\n[41] \"2006-05-01\" \"2006-06-01\" \"2006-07-03\" \"2006-08-01\" \"2006-09-01\"\n[46] \"2006-10-02\" \"2006-11-01\" \"2006-12-01\"\n\n```", "```py\n> res <- lapply(res, function(x) x[which(zoo::index(x) %in% fds)])\n\n```", "```py\n> res <- do.call(merge, res)\n> str(res)\n'zoo' series from 2003-01-02 to 2006-12-01\n Data: num [1:48, 1:96] 17.8 15.3 12.1 12.5 15 ...\n Index:  Date[1:48], format: \"2003-01-02\" \"2003-02-03\" ...\n> res <- as.data.frame(res)\n> names(res) <- symbols\n\n```", "```py\n> LIBOR <- LIBOR[LIBOR$Date %in% fds, 'Value']\n> rft <- log(1 + head(LIBOR, -1)/36000 * as.numeric(diff(fds)))\n> res <- apply(res, 2, riskpremium)\n\n```", "```py\n> SP500 <- SP500[SP500$Date %in% fds, 'Adjusted Close']\n\n```", "```py\n> res <- apply(res, 2, riskpremium)\n> res <- as.data.frame(res)\n> r <- t(sapply(symbols, function(symbol)\n+        c(beta = lm(res[, symbol] ~ \n+                    riskpremium(SP500))$coefficients[[2]],\n+          mean = mean(res[, symbol]))\n+ ))\n> r <- as.data.frame(r)\n\n```", "```py\n> plot(r$beta, r$mean)\n> abline(lm(r$mean ~ r$beta), col = 'red')\n\n```", "```py\n> summary(lm(r$mean ~ r$beta))\n\nCall:\nlm(formula = r$mean ~ r$beta)\n\nResiduals:\n Min        1Q    Median        3Q       Max \n-0.024046 -0.008783 -0.003475  0.006485  0.039731 \n\nCoefficients:\n Estimate Std. Error t value Pr(>|t|) \n(Intercept) 0.009084   0.002429   3.740 0.000325 ***\nr$beta      0.005528   0.001678   3.295 0.001413 ** \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.01383 on 89 degrees of freedom\n (5 observations deleted due to missingness)\nMultiple R-squared:  0.1087,\tAdjusted R-squared:  0.09873 \nF-statistic: 10.86 on 1 and 89 DF,  p-value: 0.001413\n\n```", "```py\n> r <- t(sapply(symbols, function(symbol) {\n+    stock <- res[, symbol]\n+    beta  <- lm(stock ~ riskpremium(SP500))$coefficients[[2]]\n+    c(\n+        beta = beta,\n+        mean = mean(stock, na.rm = TRUE),\n+        risk = var(stock, na.rm = TRUE) - beta^2 * var(SP500))\n+ }))\n> r <- as.data.frame(r)\n\n```", "```py\n> summary(lm(r$mean ~ r$beta + r$risk))\n\nCall:\nlm(formula = r$mean ~ r$beta + r$risk)\n\nResiduals:\n Min        1Q    Median        3Q       Max \n-0.023228 -0.009175 -0.003657  0.006817  0.036262 \n\nCoefficients:\n Estimate Std. Error t value Pr(>|t|) \n(Intercept)  1.400e-02  3.711e-03   3.772 0.000285 ***\nr$beta      -1.743e-03  4.677e-03  -0.373 0.710293 \nr$risk      -9.956e-08  5.798e-08  -1.717 0.089266 . \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.01381 on 93 degrees of freedom\nMultiple R-squared:  0.1451,\tAdjusted R-squared:  0.1267 \nF-statistic: 7.891 on 2 and 93 DF,  p-value: 0.0006833\n\n```"]
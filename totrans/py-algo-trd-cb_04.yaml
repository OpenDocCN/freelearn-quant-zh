- en: Computing Candlesticks and Historical Data
  id: totrans-0
  prefs: []
  type: TYPE_NORMAL
- en: The historical data of a financial instrument is data about all the past prices
    at which a financial instrument was brought or sold. An algorithmic trading strategy
    is always vpot_candlestickirtually executed on historical data to evaluate its
    past performance before it's deployed with real money. This process is called
    **backtesting**. Historical data is quintessential for backtesting (covered in
    detail in [Chapter 8](b415aed0-c473-48ba-8e52-5914c7f0de87.xhtml), *Backtesting
    Strategies*). Also, historical data is needed for computing technical indicators
    (covered in detail in [Chapter 5](16529fe4-d3ea-4017-a6f9-bad85a41d8a0.xhtml),
    *Computing and Plotting Technical Indicators*), which help in making buy-or-sell
    decisions in real-time. Candlestick patterns are widely used tools for stock analysis.
    Various types of candlestick patterns are commonly used by analysts. This chapter
    provides recipes that show you how to fetch historical data using broker APIs,
    how to fetch and compute multiple candlestick patterns – Japanese (**open-high-low-close**
    (**OHLC**)), Line Break, Renko, and Heikin-Ashi – and how to fetch historical
    data using a third-party tool.
  id: totrans-1
  prefs: []
  type: TYPE_NORMAL
- en: 'In this chapter, we will cover the following recipes:'
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: Fetching historical data using the broker API
  id: totrans-3
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fetching historical data with the Japanese (OHLC) candlestick pattern
  id: totrans-4
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fetching the Japanese candlestick pattern with variations in candle intervals
  id: totrans-5
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fetching historical data with the Line Break candlestick pattern
  id: totrans-6
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fetching historical data with the Renko candlestick pattern
  id: totrans-7
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fetching historical data with the Heikin-Ashi candlestick pattern
  id: totrans-8
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fetching historical data using Quandl
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Let's get started!
  id: totrans-10
  prefs: []
  type: TYPE_NORMAL
- en: Technical requirements
  id: totrans-11
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'You will need the following to successfully execute the recipes in this chapter:'
  id: totrans-12
  prefs: []
  type: TYPE_NORMAL
- en: Python 3.7+
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Python packages:'
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`pyalgotrading` (`$ pip install pyalgotrading`)'
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`quandl` (`$pip install quandl`) this is optional and only needed for the last
    recipe'
  id: totrans-16
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The latest Jupyter Notebook for this chapter can be found on GitHub at [https://github.com/PacktPublishing/Python-Algorithmic-Trading-Cookbook/tree/master/Chapter04](https://github.com/PacktPublishing/Python-Algorithmic-Trading-Cookbook/tree/master/Chapter04).
  id: totrans-17
  prefs: []
  type: TYPE_NORMAL
- en: The following code will help you set up the broker connection with Zerodha,
    which will be used by all the recipes in this chapter. Please make sure you have
    followed these steps before trying out any of the recipes provided.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
- en: The first thing you need to do to set connectivity with the broker is to gather
    the required API keys. The broker provides unique keys to each customer, typically
    as `api-key` and `api-secret` key pairs. These API keys are chargeable, usually
    on a monthly subscription basis. You need to get your copies of `api-key` and
    `api-secret` from the broker website before you start this chapter. You can refer
    to *Appendix I* for more details.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
- en: 'Execute the following steps:'
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
- en: 'Import the necessary modules:'
  id: totrans-21
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE0]'
  id: totrans-22
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: 'Get the `api_key` and `api_secret` keys from the broker. These are unique to
    you and will be used by the broker to identify your Demat account:'
  id: totrans-23
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 从经纪人处获取 `api_key` 和 `api_secret`。这些对你是唯一的，经纪人将使用它们来识别你的证券账户：
- en: '[PRE1]'
  id: totrans-24
  prefs: []
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'You will get the following URL:'
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 你将得到以下链接：
- en: '[PRE2]'
  id: totrans-26
  prefs: []
  type: TYPE_PRE
  zh: '[PRE2]'
- en: If you are running this for the first time and `kiteconnect` is not installed,
    `pyalgotrading` will automatically install it for you. The final output of *step
    2* will be a link. Click on the link and log in with your Zerodha credentials.
    If the authentication is successful, you will see a link in your browser's address
    bar similar to `https://127.0.0.1/?request_token=&action=login&status=success`.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 如果你是第一次运行此程序，并且尚未安装 `kiteconnect`，`pyalgotrading` 将自动为你安装。*步骤 2* 的最终输出将是一个链接。点击该链接并使用你的
    Zerodha 凭证登录。如果认证成功，你将在浏览器地址栏中看到一个类似于 `https://127.0.0.1/?request_token=&action=login&status=success`
    的链接。
- en: 'For example:'
  id: totrans-28
  prefs: []
  type: TYPE_NORMAL
  zh: 例如：
- en: '[PRE3]'
  id: totrans-29
  prefs: []
  type: TYPE_PRE
  zh: '[PRE3]'
- en: 'Copy the alphanumeric token and paste it into `request_token`:'
  id: totrans-30
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 复制字母数字令牌并粘贴到 `request_token` 中：
- en: '[PRE4]'
  id: totrans-31
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: The `broker_connection` instance is now ready for performing API calls.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: '`broker_connection` 实例现在已经准备好执行 API 调用了。'
- en: The `pyalgotrading` package supports multiple brokers and provides a connection
    object class per broker, with the same methods. It abstracts broker APIs behind
    a unified interface so that users don't need to worry about the underlying broker
    API calls and use all the recipes in this chapter as-is.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: '`pyalgotrading` 包支持多个经纪人，并为每个经纪人提供一个连接对象类，其方法相同。它将经纪人 API 抽象在一个统一的接口后面，使用户无需担心底层经纪人
    API 调用，并可以直接使用本章中的所有示例。'
- en: Only the procedure of setting up the broker connection will vary from broker
    to broker. You can refer to the pyalgotrading documentation to learn how to set
    up the broker connection if you are not using Zerodha as your broker. For Zerodha
    users, the aforementioned steps will suffice.
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 仅经纪人连接设置的过程会因经纪人而异。如果你不使用 Zerodha 作为你的经纪人，你可以参考 pyalgotrading 文档来学习如何设置经纪人连接。对于
    Zerodha 用户，上述步骤就足够了。
- en: Fetching historical data using the broker API
  id: totrans-35
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用经纪人 API 获取历史数据
- en: The historical data of a financial instrument is time-series data for the timestamps
    in the past. It can be fetched using the Broker API for a given duration. This
    recipe demonstrates how to set up a broker connection and how to fetch historical
    data for a financial instrument for the duration of a single day.
  id: totrans-36
  prefs: []
  type: TYPE_NORMAL
  zh: 金融工具的历史数据是过去时间戳的时间序列数据。可以使用经纪人 API 获取给定时段的历史数据。本篇示例演示了如何建立经纪人连接以及如何为金融工具获取单日历史数据的过程。
- en: Getting ready
  id: totrans-37
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 准备工作
- en: Make sure the `broker_connection` object is available in your Python namespace.
    Refer to the *Technical requirements* section of this chapter to learn how to
    set it up.
  id: totrans-38
  prefs: []
  type: TYPE_NORMAL
  zh: 确保 `broker_connection` 对象在你的 Python 命名空间中可用。请参考本章节的*技术要求*部分了解如何设置它。
- en: How to do it…
  id: totrans-39
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何执行…
- en: 'Execute the following steps to complete this recipe:'
  id: totrans-40
  prefs: []
  type: TYPE_NORMAL
  zh: 执行以下步骤完成本篇示例：
- en: 'Fetch the historical data for an instrument:'
  id: totrans-41
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 获取一个金融工具的历史数据：
- en: '[PRE5]'
  id: totrans-42
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: 'You will get the following output:'
  id: totrans-43
  prefs: []
  type: TYPE_NORMAL
  zh: 你将得到以下输出：
- en: '![](img/acda6f4a-bf25-4f75-8056-4d98504ae96d.png)'
  id: totrans-44
  prefs: []
  type: TYPE_IMG
  zh: '![](img/acda6f4a-bf25-4f75-8056-4d98504ae96d.png)'
- en: 'Print the available columns of the `historical_data` DataFrame:'
  id: totrans-45
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 打印 `historical_data` DataFrame 的可用列：
- en: '[PRE6]'
  id: totrans-46
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'You will get the following output:'
  id: totrans-47
  prefs: []
  type: TYPE_NORMAL
  zh: 你将得到以下输出：
- en: '[PRE7]'
  id: totrans-48
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: How it works…
  id: totrans-49
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 工作原理…
- en: 'In *step 1*, you use the `get_instrument()` method of `broker_connection` to
    fetch an instrument and assign it to a new attribute, `instrument`. This object
    is an instance of the `Instrument` class. The two parameters needed to call `get_instrument()`
    are the exchange (`''NSE''`) and the trading symbol (`''TATASTEEL''`). Next, you
    fetch the historical data for `instrument` using the `get_historical_data()` method.
    This method takes four arguments, which are described as follows:'
  id: totrans-50
  prefs: []
  type: TYPE_NORMAL
  zh: 在 *步骤 1* 中，你使用 `broker_connection` 的 `get_instrument()` 方法来获取一个金融工具，并将其赋值给一个新属性
    `instrument`。这个对象是 `Instrument` 类的一个实例。调用 `get_instrument()` 需要两个参数，交易所（`'NSE'`）和交易标志（`'TATASTEEL'`）。接下来，你使用
    `get_historical_data()` 方法获取 `instrument` 的历史数据。这个方法接受四个参数，描述如下：
- en: '`instrument`: The financial instrument for which the historical data must be
    placed. Should be an instance of the `Instrument` class. You pass `instrument`
    here.'
  id: totrans-51
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '`instrument`：必须放置历史数据的金融工具。应该是 `Instrument` 类的一个实例。在这里传递 `instrument`。'
- en: '`candle_interval`: A valid string that denotes the duration of each candlestick
    in the historical data. You pass `minute` here. (Possible values can be `minute`,
    `3minute`, `5minute`, `10minute`, `30minute`, `60minute`, and `day`.)'
  id: totrans-52
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`start_date`: The date from which the historical data must be fetched. Should
    be a string in the `YYYY-MM-DD` format. You pass `2020-01-01` here.'
  id: totrans-53
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`end_date:` The date until which the historical data must be fetched, inclusive
    of this date. Should be a string in the `YYYY-MM-DD` format. You pass `2020-01-01`
    here.'
  id: totrans-54
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: In *step 2*, you fetch and print the available columns of `historical_data`.
    You get the columns as `timestamp`, `open`, `high`, `low`, `close`, and `volume`.
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
- en: More information on candlesticks will be covered in the next recipe, *Fetching
    historical data using the Japanese (OHLC) candlestick pattern*, and the third
    recipe in this chapter, *Fetching the Japanese candlestick pattern with variations
    in candle intervals*.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
- en: Fetching historical data using the Japanese (OHLC) candlestick pattern
  id: totrans-57
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The historical data of a financial instrument is an array of candlesticks. Each
    entry in the historical data is a single candlestick. There are various types
    of candlestick patterns.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
- en: 'This recipe demonstrates the most commonly used candlestick pattern – the Japanese
    candlestick pattern. It is a type of candlestick pattern where each candlestick
    holds a duration and indicates all the prices the instrument would have taken
    on during that duration. This data is represented using four parameters – Open,
    High, Low, and Close. These can be described as follows:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
- en: '**Open**: The price of the financial instrument at the beginning of the candle''s
    duration'
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**High**: The highest recorded price of the financial instrument during the
    entire duration of the candle'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Low**: The lowest recorded price of the financial instrument during the entire
    duration of the candle'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Close**: The price of the financial instrument at the end of the candle''s
    duration'
  id: totrans-63
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The Japanese candlestick pattern is also known as the **OHLC candlestick pattern**
    based on these parameters. All the timestamps in a Japanese candlestick pattern
    are equally spaced (within market hours). For example, the timestamps on a trading
    day would look like 9:15 a.m., 9:16 a.m., 9:17 a.m., 9:18 a.m., and so on for
    a 1-minute candle interval, where each timestamp is equally spaced at intervals
    of 1 minute.
  id: totrans-64
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-65
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Make sure the `broker_connection` and `historical_data` objects are available
    in your Python namespace. Refer to the *Technical requirements* section of this
    chapter to set up `broker_connection`. Refer to the previous recipe to set up
    `historical_data`.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
- en: How to do it…
  id: totrans-67
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We execute the following steps to for this recipe:'
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
- en: 'Import the necessary modules:'
  id: totrans-69
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE8]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'Create a green candle from one of the rows of `historical_data`:'
  id: totrans-71
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE9]'
  id: totrans-72
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: 'You will get the following output:'
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/8c19dad2-8126-49bf-842b-530183ad8d42.png)'
  id: totrans-74
  prefs: []
  type: TYPE_IMG
- en: 'Create a red candle from one of the rows of `historical_data`:'
  id: totrans-75
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE10]'
  id: totrans-76
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: 'This will give you the following output:'
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/273fcc9f-7f5f-4d06-b72e-96705752369e.png)'
  id: totrans-78
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of an instrument:'
  id: totrans-79
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE11]'
  id: totrans-80
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: 'This will give you the following output:'
  id: totrans-81
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/ca1f393a-ad16-4126-b989-d3512a4872e9.png)'
  id: totrans-82
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of another instrument:'
  id: totrans-83
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE12]'
  id: totrans-84
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'This will give you the following output:'
  id: totrans-85
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/d8f3fb78-1547-4855-ac79-6d610afa48a0.png)'
  id: totrans-86
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of yet another instrument:'
  id: totrans-87
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE13]'
  id: totrans-88
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'This will give you the following output:'
  id: totrans-89
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/9bccb883-f64f-471e-beee-521109686b74.png)'
  id: totrans-90
  prefs: []
  type: TYPE_IMG
- en: How it works…
  id: totrans-91
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In *step 1*, you import `plot_candlestick_chart`, a quick utility function for
    plotting candlestick pattern charts, and `PlotType`, an enum for various types
    of candlestick patterns. The next two steps introduce two types of candlesticks,
    or simply **candles** – a green candle and a red candle. As we mentioned earlier,
    each entry in historical data is a candle. These two steps selectively extract
    a green and red candle from the data. (Please note that the indices that are passed
    to `historical_data.iloc` will be different if you choose a different duration
    for `historical_data`, as in the *Fetching historical data using the broker API*
    recipe). A Japanese candle is green in color if its **close** price is above its
    **open** price. A green candle is also called a **bullish** candle as it is indicative
    that the price was bullish, meaning rising, during that duration. A Japanese candle
    is red in color if its **close** price is below its **open** price. A red candle
    is also called a **bearish** candle as it is indicative that the price was bearish,
    meaning falling, during that duration.
  id: totrans-92
  prefs: []
  type: TYPE_NORMAL
- en: In *step 4*, you plot the complete historical data held by `historical_data`
    using the `plot_candlestick_chart()` function. The chart is a combination of multiple
    candlesticks, each with a different length. Hence, such a chart is called a **candlestick
    pattern chart**. Note that the candle interval is 1 minute, meaning that the timestamps
    are equally spaced in intervals of 1 minute. *Steps 5* and *6* demonstrate similar
    1-minute candle interval candlestick pattern charts for the `NSE:INFY` and `NSE:ICICIBANK`
    instruments.
  id: totrans-93
  prefs: []
  type: TYPE_NORMAL
- en: If you are new to candlestick pattern charts, I would recommend that you interact
    with the charts that can be found in this chapter's Jupyter Notebook at [https://github.com/PacktPublishing/Python-Algorithmic-Trading-Cookbook/blob/master/Chapter04/CHAPTER%204.ipynb](https://github.com/PacktPublishing/Python-Algorithmic-Trading-Cookbook/blob/master/Chapter04/CHAPTER%204.ipynb).
    Try hovering over multiple candles to see their values and zoom in/out or pan
    to various durations to see the candles more clearly. Try to relate the color
    of these candles with their descriptions from this recipe. If the charts in the
    Jupyter Notebook do not render automatically for you due to some reason, you can
    download this html file, for the same Jupyter Notebook, open it in your browser
    and interact with it: [https://github.com/PacktPublishing/Python-Algorithmic-Trading-Cookbook/blob/master/Chapter04/CHAPTER%204.ipynb](https://github.com/PacktPublishing/Python-Algorithmic-Trading-Cookbook/blob/master/Chapter04/CHAPTER%204.ipynb).
  id: totrans-94
  prefs: []
  type: TYPE_NORMAL
- en: Fetching the Japanese candlestick pattern with variations in candle intervals
  id: totrans-95
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The historical data of a financial instrument can be analyzed in the form of
    Japanese candlesticks pattern with varying candle intervals. Brokers typically
    support candle intervals of 1 minute, 3 minutes, 5 minutes, 10 minutes, 15 minutes,
    30 minutes, 1 hour, 1 day, and so on. A shorter candle interval hints at a localized
    price movement trend, while a larger candle interval indicates an overall price
    movement trend. Depending on the algorithmic trading strategy, you may need a
    shorter candle interval or a larger one. A candle interval of 1 minute is often
    the smallest available candle interval. This recipe demonstrates the historical
    data of a financial instrument for a duration of a day in various candle intervals.
  id: totrans-96
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-97
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Make sure the `broker_connection` object is available in your Python namespace.
    Refer to the *Technical requirements* section of this chapter to learn how to
    set up `broker_connection`.
  id: totrans-98
  prefs: []
  type: TYPE_NORMAL
- en: How to do it…
  id: totrans-99
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We execute the following steps for this recipe:'
  id: totrans-100
  prefs: []
  type: TYPE_NORMAL
- en: 'Import the necessary modules:'
  id: totrans-101
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE14]'
  id: totrans-102
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'Fetch an instrument:'
  id: totrans-103
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE15]'
  id: totrans-104
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'Plot a chart for the historical data of the instrument with a 1-minute candle
    interval:'
  id: totrans-105
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE16]'
  id: totrans-106
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'You will get the following output:'
  id: totrans-107
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/95db5fe7-032e-431c-a91d-1bab7dcc19de.png)'
  id: totrans-108
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 3-minute candle
    interval:'
  id: totrans-109
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE17]'
  id: totrans-110
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'You will get the following output:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/70cf68b1-6358-40ff-8404-687350291dcf.png)'
  id: totrans-112
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 5-minute candle
    interval:'
  id: totrans-113
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE18]'
  id: totrans-114
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'You will get the following output:'
  id: totrans-115
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/fac26bb3-cdc9-4686-b462-394525e7ec62.png)'
  id: totrans-116
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 10-minute candle
    interval:'
  id: totrans-117
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE19]'
  id: totrans-118
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: 'You will get the following output:'
  id: totrans-119
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/b9295ac1-a6e7-44c4-8918-4f0168111e5a.png)'
  id: totrans-120
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 15-minute candle
    interval:'
  id: totrans-121
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE20]'
  id: totrans-122
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: 'You will get the following output:'
  id: totrans-123
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/1c18a46f-d277-4c9a-b95b-a507df515b57.png)'
  id: totrans-124
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 30-minute candle
    interval:'
  id: totrans-125
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE21]'
  id: totrans-126
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: 'You will get the following output:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/aab74cf9-be65-415f-a12f-3ea3a8d714ef.png)'
  id: totrans-128
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 1-hour candle
    interval:'
  id: totrans-129
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE22]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'Plot a chart for the historical data of the instrument with a 1-day candle
    interval:'
  id: totrans-131
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE23]'
  id: totrans-132
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: 'You will get the following output, which is a single candle:'
  id: totrans-133
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/38ff4849-3913-40bf-8224-4a02f01b7414.png)'
  id: totrans-134
  prefs: []
  type: TYPE_IMG
- en: How it works…
  id: totrans-135
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'In *step 1*, you import `plot_candlestick_chart`, a quick utility function
    for plotting candlestick pattern charts, and `PlotType`, an enum for various types
    of candlestick patterns. In *step 2*, the `get_instrument()` method of `broker_connection`
    to fetch an instrument and assign it to a new attribute, `instrument`. This object
    is an instance of the `Instrument` class. The two parameters needed to call `get_instrument()`
    are the exchange (`''NSE''`) and the trading symbol (`''TATASTEEL''`). *Steps
    3* and *4* fetch and plot the historical data for the candle intervals; that is,
    1 minute, 3 minutes, 5 minutes, 10 minutes, 15 minutes, 30 minutes, 1 hour, and
    1 day. You use the `get_historical_data()` method to fetch historical data for
    the same instruments and the same start and end dates, with only a different candle
    interval. You use the `plot_candlestick_chart()` function to plot Japanese candlestick
    pattern charts. You can observe the following differences between the charts as
    the candle interval increases:'
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
- en: The total number of candlesticks decreases.
  id: totrans-137
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The spikes in the charts due to sudden price movement are minimized. Smaller
    candle interval charts have more spikes as they focus on local trends, while larger
    candle interval charts have fewer spikes and are smoother.
  id: totrans-138
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A long-term trend in the stock price becomes visible.
  id: totrans-139
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Decision-making may become slower because you have to wait longer to get new
    candle data. Slower decisions may or may not be desirable, depending on the strategy.
    For example, for confirming trends, using a combination of data with a smaller
    candle interval, say 3 minutes, and data with a larger candle interval, say 15
    minutes, would be desirable. On the other hand, for grabbing opportunities in
    intraday trading, data with larger candle intervals, such as 1 hour or 1 day,
    would not be desirable.
  id: totrans-140
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The price range (y-axis spread) of adjacent candles may or may not overlap.
  id: totrans-141
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: All the timestamps are equally spaced in time (within market hours).
  id: totrans-142
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Fetching historical data using the Line Break candlestick pattern
  id: totrans-143
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The historical data of a financial instrument can be analyzed in the form of
    the Line Break candlestick pattern, a candlestick pattern that focuses on price
    movement. This differs from the Japanese candlestick pattern, which focuses on
    the time movement. Brokers typically do not provide historical data for the Line
    Break candlestick pattern via APIs. Brokers usually provide historical data using
    the Japanese candlestick pattern that needs to be converted into the Line Break
    candlestick pattern. A shorter candle interval hints at a localized price movement
    trend, while a larger candle interval indicates an overall price movement trend.
    Depending on your algorithmic trading strategy, you may need the candle interval
    to be small or large. A candle interval of 1 minute is often the smallest available
    candle interval.
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
- en: 'The Line Break candlestick pattern works as follows:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
- en: Each candle has only `open` and `close` attributes.
  id: totrans-146
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: The user defines a `Number of Lines` (*n*) setting, which is usually taken as
    `3`.
  id: totrans-147
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: At the end of each candle interval, a green candle is formed if the stock price
    goes higher than the highest of the previous *n* Line Break candles.
  id: totrans-148
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: At the end of each candle interval, a red candle is formed if the stock price
    goes lower than the lowest of the previous *n* Line Break candles.
  id: totrans-149
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: At the end of each candle interval, if neither point 3 nor point 4 are satisfied,
    no candle is formed. Hence, the timestamps don't need to be equally spaced.
  id: totrans-150
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: This recipe shows how we can fetch historical data using the Japanese candlestick
    pattern using the broker API, convert the historical data into a Line Break candlestick
    pattern, and plot it. This is done for multiple candle intervals.
  id: totrans-151
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-152
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Make sure the `broker_connection` object is available in your Python namespace.
    Refer to the *Technical requirements* section of this chapter to learn how to
    set up `broker_connection`.
  id: totrans-153
  prefs: []
  type: TYPE_NORMAL
- en: How to do it…
  id: totrans-154
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We execute the following steps for this recipe:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
- en: 'Import the necessary modules:'
  id: totrans-156
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE24]'
  id: totrans-157
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'Fetch the historical data for an instrument and convert it into Line Break
    data:'
  id: totrans-158
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE25]'
  id: totrans-159
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: 'You will get the following output:'
  id: totrans-160
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE26]'
  id: totrans-161
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'Create a green Line Break candle from one of the rows of `historical_data`:'
  id: totrans-162
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE27]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'You will get the following output:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/06737560-972b-4dbd-9b8a-5b7aac0a6328.png)'
  id: totrans-165
  prefs: []
  type: TYPE_IMG
- en: 'Create a red Line Break candle from one of the rows of `historical_data`:'
  id: totrans-166
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE28]'
  id: totrans-167
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'You will get the following output:'
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/d6d4e6ed-0f78-4724-aabf-811cdc67fefb.png)'
  id: totrans-169
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 1-minute candle
    interval:'
  id: totrans-170
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE29]'
  id: totrans-171
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'You will get the following output:'
  id: totrans-172
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/c333ea93-46e7-422f-96b4-7c3ca48f36f1.png)'
  id: totrans-173
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 3-minute candle
    interval:'
  id: totrans-174
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE30]'
  id: totrans-175
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'You will get the following output:'
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/358d7a35-6c70-4fd2-926a-b862425cd1e3.png)'
  id: totrans-177
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 5-minute candle
    interval:'
  id: totrans-178
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE31]'
  id: totrans-179
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: 'You will get the following output:'
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/213fbad2-9746-4e31-b123-74fba6ad388f.png)'
  id: totrans-181
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 10-minute candle
    interval:'
  id: totrans-182
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE32]'
  id: totrans-183
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: 'You will get the following output:'
  id: totrans-184
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/a254d5c7-8fd3-49d5-baca-a6aa57188f94.png)'
  id: totrans-185
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 15-minute candle
    interval:'
  id: totrans-186
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE33]'
  id: totrans-187
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'You will get the following output:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/0ae9f5d4-a6ae-48a7-8ff5-46a76a1bdf2c.png)'
  id: totrans-189
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 30-minute candle
    interval:'
  id: totrans-190
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE34]'
  id: totrans-191
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'You will get the following output:'
  id: totrans-192
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/27be9a13-bb54-48af-b49f-67ed03514393.png)'
  id: totrans-193
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 1-hour candle
    interval:'
  id: totrans-194
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE35]'
  id: totrans-195
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'You will get the following output:'
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/0a9cd917-6d6b-4e2c-8257-5eab8c5ca531.png)'
  id: totrans-197
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 1-day candle
    interval:'
  id: totrans-198
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE36]'
  id: totrans-199
  prefs: []
  type: TYPE_PRE
  zh: '[PRE36]'
- en: 'You will get the following output:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/dd6aece0-c34a-4bd5-b686-780fe2336e03.png)'
  id: totrans-201
  prefs: []
  type: TYPE_IMG
- en: How it works…
  id: totrans-202
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In *step 1*, you import `plot_candlestick_chart`, a quick utility function for
    plotting candlestick pattern charts, `PlotType`, an enum for various types of
    candlestick patterns, and the `Linebreak` function, which can convert historical
    data from the Japanese candlestick pattern in the Line Break candlestick pattern.
    In *step 2*, you use the `get_instrument()` method of `broker_connection` to fetch
    an instrument and assign it to a new attribute, `instrument`. This object is an
    instance of the `Instrument` class. The two parameters needed to call get_instrument()
    are the exchange (`'NSE'`) and the trading symbol (`'TATASTEEL'`). Next, you use
    the `get_historical_data()` method of the `broker_connection` object to fetch
    the historical data for the instrument for the duration of December 2019, with
    a candle interval of 1 minute. The time-series data returned is in the form of
    the Japanese candlestick pattern. The `Linebreak()` function converts this data
    into a Line Break candlestick pattern, another `pandas.DataFrame` object. You
    assign it to `historical_data_1minute_linebreak`. Observe that `historical_data_1minute_linebreak` has
    only `timestamp`, `open`, and `close` columns. Also, observe that the timestamps
    are not equidistant as the Line Break candles are based on price movement and
    not time. In *steps 3* and *4*, you selectively extract a green and a red candle
    from the data. (Please note, the indices passed to `historical_data.iloc` would
    be different if you choose a different duration for `historical_data` fetched
    in the first recipe of this chapter.) Observe that the candles have no shadows
    (lines extending on either side of the main candle body) as the candles only have `open` and
    `close` attributes. In *steps 5*, you plot the complete historical data held by
    `historical_data` using the `plot_candlestick_chart()` function.
  id: totrans-203
  prefs: []
  type: TYPE_NORMAL
- en: 'In *steps 6* until *12*, you fetch the historical data using the Japanese candlestick
    pattern, convert it into the Line Break candlestick pattern, and plot the converted
    data for candle intervals of 3 minutes, 5 minutes, 10 minutes, 15 minutes, 30
    minutes, 1 hour, and 1 day. Observe the following differences and similarities
    among the charts as the candle interval increases:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
- en: The total number of candlesticks decreases.
  id: totrans-205
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The spikes in the charts due to sudden price movement are minimized. Smaller
    candle interval charts have more spikes as they focus on local trends, while larger
    candle interval charts have fewer spikes and are smoother.
  id: totrans-206
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A long-term trend in the stock price becomes visible.
  id: totrans-207
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Decision-making may become slower because you have to wait longer to get new
    candle data. Slower decisions may or may not be desirable, depending on the strategy.
    For example, to confirm trends, using a combination of data with a smaller candle
    interval, say 3 minutes, and data with a larger candle interval, say 15 minutes,
    would be desirable. On the other hand, to grab opportunities in intraday trading,
    data with larger candle intervals, say 1 hour or 1 day, would not be desirable.
  id: totrans-208
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The price ranges (y-axis spread) of two adjacent candles don't overlap with
    each other. Adjacent candles always share one of their ends.
  id: totrans-209
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: None of the timestamps need to be equally spaced in time (unlike the Japanese
    candlestick pattern) as candles are formed based on price movement and not time
    movement.
  id: totrans-210
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If you are interested in finding out about the Math and implementation of Line
    Break candles, please refer to its source code in the `pyalgotrading` package
    at [https://github.com/algobulls/pyalgotrading/blob/master/pyalgotrading/utils/candlesticks/linebreak.py](https://github.com/algobulls/pyalgotrading/blob/master/pyalgotrading/utils/candlesticks/linebreak.py).
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
- en: Fetching historical data using the Renko candlestick pattern
  id: totrans-212
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The historical data of a financial instrument can be analyzed in the form of
    the Renko candlestick pattern, a candlestick pattern that focuses on price movement.
    This differs from the Japanese candlestick pattern, which focuses on time movement.
    Brokers typically do not provide historical data as the Renko candlestick pattern
    via APIs. Brokers usually provide historical data by using the Japanese candlestick
    pattern, which needs to be converted into the Renko candlestick pattern. A shorter
    candle interval hints at a localized price movement trend, while a larger candle
    interval indicates an overall price movement trend. Depending on your algorithmic
    trading strategy, you may need the candle interval to be small or large. A candle
    interval of 1 minute is often the smallest available candle interval.
  id: totrans-213
  prefs: []
  type: TYPE_NORMAL
- en: 'The Renko candlestick pattern works as follows:'
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
- en: Each candle only has `open` and `close` attributes.
  id: totrans-215
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: You define a **Brick Count** (`b`) setting, which is usually set to `2`.
  id: totrans-216
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Each candle is always fixed and is equal to `Brick Count`. Hence, a candle is
    also called a **brick** here.
  id: totrans-217
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: At the end of every candle interval, a green brick is formed if the stock price
    goes `b` points higher than the highest of the previous brick. If the price goes
    much higher than `b` points in a single candle interval, as many Renko bricks
    are formed to account for the price change.
  id: totrans-218
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: For example, say the price goes 21 points higher than the high of the previous
    brick. If the brick size is `2`, 10 Renko bricks would be formed with the same
    timestamp to account for the 20-point change. For the remaining 1-point change
    (21-20), no brick would be formed until the price goes at least 1 point higher.
  id: totrans-219
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: At the end of every candle interval, a red candle is formed if the stock price
    goes `b` points lower than the lowest of the previous Renko candle. If the price
    goes much lower than `b` points in a single candle interval, as many Renko bricks
    are formed to account for the price change.
  id: totrans-220
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: For example, say the price goes 21 points lower than the highest previous brick.
    If the brick size is `2`, 10 Renko bricks would be formed with the same timestamp
    to account for the 20-point change. For the remaining 1-point change (21-20),
    no brick would be formed until the price goes at least 1 point lower.
  id: totrans-221
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: No two adjacent candles overlap with each other. Adjacent candles always share
    one of their ends.
  id: totrans-222
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: None of the timestamps need to be equally spaced (unlike the Japanese candlestick
    pattern) as candles are formed based on price movement and not time movement.
    Also, unlike other patterns, there may be multiple candles with the same timestamp.
  id: totrans-223
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: This recipe shows how you can fetch historical data as the Japanese candlestick
    pattern using the broker API, as well as how to convert and plot the historical
    data using the Renko candlestick pattern for various candle intervals.
  id: totrans-224
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-225
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Make sure the `broker_connection` object is available in your Python namespace.
    Refer to the *Technical requirements* section of this chapter to learn how to
    set up `broker_connection`.
  id: totrans-226
  prefs: []
  type: TYPE_NORMAL
- en: How to do it…
  id: totrans-227
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We execute the following steps for this recipe:'
  id: totrans-228
  prefs: []
  type: TYPE_NORMAL
- en: 'Import the necessary modules:'
  id: totrans-229
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE37]'
  id: totrans-230
  prefs: []
  type: TYPE_PRE
  zh: '[PRE37]'
- en: 'Fetch the historical data for an instrument and convert it into Renko data:'
  id: totrans-231
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE38]'
  id: totrans-232
  prefs: []
  type: TYPE_PRE
  zh: '[PRE38]'
- en: 'You will get the following output:'
  id: totrans-233
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE39]'
  id: totrans-234
  prefs: []
  type: TYPE_PRE
  zh: '[PRE39]'
- en: 'Create a green Renko candle from one of the rows of `historical_data`:'
  id: totrans-235
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE40]'
  id: totrans-236
  prefs: []
  type: TYPE_PRE
  zh: '[PRE40]'
- en: 'You will get the following output:'
  id: totrans-237
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/e3f2e456-99b7-4440-b1f7-2834c11e72f0.png)'
  id: totrans-238
  prefs: []
  type: TYPE_IMG
- en: 'Create a red Renko candle from one of the rows of `historical_data`:'
  id: totrans-239
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE41]'
  id: totrans-240
  prefs: []
  type: TYPE_PRE
  zh: '[PRE41]'
- en: 'You will get the following output:'
  id: totrans-241
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/40c86799-c091-4379-af1e-32dcc5cb6aea.png)'
  id: totrans-242
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 1-minute candle
    interval:'
  id: totrans-243
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE42]'
  id: totrans-244
  prefs: []
  type: TYPE_PRE
  zh: '[PRE42]'
- en: 'You will get the following output:'
  id: totrans-245
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/c7ae00df-e7a1-4cee-936c-c06338e2528b.png)'
  id: totrans-246
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 3-minute candle
    interval:'
  id: totrans-247
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE43]'
  id: totrans-248
  prefs: []
  type: TYPE_PRE
  zh: '[PRE43]'
- en: 'You will get the following output:'
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/d85d0255-9503-47a1-aa7e-41f1d314296a.png)'
  id: totrans-250
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 5-minute candle
    interval:'
  id: totrans-251
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE44]'
  id: totrans-252
  prefs: []
  type: TYPE_PRE
  zh: '[PRE44]'
- en: 'You will get the following output:'
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/5bd0dda9-a247-47ba-b7fc-ec1e9bf98a86.png)'
  id: totrans-254
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 10-minute candle
    interval:'
  id: totrans-255
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE45]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE45]'
- en: 'You will get the following output:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/5896de8b-9d3b-4f30-9b7c-4082f3872c21.png)'
  id: totrans-258
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 15-minute candle
    interval:'
  id: totrans-259
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE46]'
  id: totrans-260
  prefs: []
  type: TYPE_PRE
  zh: '[PRE46]'
- en: 'You will get the following output:'
  id: totrans-261
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/78259599-5668-4f55-8d2f-ed81435c6360.png)'
  id: totrans-262
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 30-minute candle
    interval:'
  id: totrans-263
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE47]'
  id: totrans-264
  prefs: []
  type: TYPE_PRE
  zh: '[PRE47]'
- en: 'You will get the following output:'
  id: totrans-265
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/17aba6c5-ed1d-431d-a73a-a66e44c3d57b.png)'
  id: totrans-266
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 1-hour candle
    interval:'
  id: totrans-267
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE48]'
  id: totrans-268
  prefs: []
  type: TYPE_PRE
  zh: '[PRE48]'
- en: 'You will get the following output:'
  id: totrans-269
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/3625da45-cc9e-4910-8b7d-6d6c93f6b51f.png)'
  id: totrans-270
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 1-day candle
    interval:'
  id: totrans-271
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE49]'
  id: totrans-272
  prefs: []
  type: TYPE_PRE
  zh: '[PRE49]'
- en: 'You will get the following output:'
  id: totrans-273
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/4051a346-dcb6-4ba4-b78f-73ff2fda08c6.png)'
  id: totrans-274
  prefs: []
  type: TYPE_IMG
- en: How it works…
  id: totrans-275
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In *step 1*, you import `plot_candlestick_chart`, a quick utility function for
    plotting candlestick pattern charts, `PlotType`, an enum for various types of
    candlestick patterns, and the `Renko` function, which can convert historical data
    from the Japanese candlestick pattern into the Renko candlestick pattern. In *step
    2*, you use the `get_instrument()` method of `broker_connection` to fetch an instrument
    and assign it to a new attribute, `instrument`. This object is an instance of
    the `Instrument` class. The two parameters needed to call get_instrument() are
    the exchange (`'NSE'`) and the trading symbol (`'TATASTEEL'`). Next, you use the
    `get_historical_data()` method of the `broker_connection` object to fetch the
    historical data for the duration of December 2019, with a candle interval of 1
    minute. The time-series data returned is in the form of Japanese candlestick pattern.
    The `Renko()` function converts this data into a Renko candlestick pattern, another `pandas.DataFrame` object.
    You assign it to `historical_data_1minute_renko`. Observe that `historical_data_1minute_renko`
    has `timestamp`, `open`, and `close` columns. Also, observe that the timestamps
    are not equidistant as the Renko candles are based on price movement and not time.
    In *step 3* and *4*, you selectively extract a green and a red candle from the
    data (Please note, the indices passed to `historical_data.iloc` fetched in the
    first recipe of this chapter.) Observe that the candles have no shadows (lines
    extending on either side of the main candle body) as the candles only have `open` and
    `close` attributes. In *step 5*, you plot the complete historical data held by
    `historical_data` using the `plot_candlestick_chart()` function.
  id: totrans-276
  prefs: []
  type: TYPE_NORMAL
- en: 'In *steps 6* until *12*, you fetch the historical data using the Japanese candlestick
    pattern, convert it into the Renko candlestick pattern, and plot the converted
    data for candle intervals of 3 minutes, 5 minutes, 10 minutes, 15 minutes, 30
    minutes, 1 hour, and 1 day. Observe the following differences and similarities
    among the charts as the candle interval increases:'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
- en: The total number of candlesticks decreases.
  id: totrans-278
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The spikes in the charts due to sudden price movement are minimized. Smaller
    candle interval charts have more spikes as they focus on local trends, while larger
    candle interval charts have fewer spikes and are smoother.
  id: totrans-279
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A long-term trend in the stock price becomes visible.
  id: totrans-280
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Decision-making may become slower because you have to wait longer to get new
    candle data. Slower decisions may or may not be desirable, depending on the strategy.
    For example, to confirm trends, using a combination of data with a smaller candle
    interval, say 3 minutes, and data with a larger candle interval, say 15 minutes,
    would be desirable. On the other hand, to grab opportunities in intraday trading,
    data with larger candle intervals, say 1 hour or 1 day, would not be desirable.
  id: totrans-281
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The price ranges (y-axis spread) of two adjacent candles don't overlap with
    each other. Adjacent candles always share one of their ends.
  id: totrans-282
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: None of the timestamps need to be equally spaced in time (unlike in the Japanese
    candlestick pattern) as candles are formed based on price movement and not time
    movement.
  id: totrans-283
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If you are interested in finding out about the Math and implementation of Renko
    candles, please refer to its source code in the `pyalgotrading` package at [https://github.com/algobulls/pyalgotrading/blob/master/pyalgotrading/utils/candlesticks/renko.py](https://github.com/algobulls/pyalgotrading/blob/master/pyalgotrading/utils/candlesticks/renko.py).
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
- en: Fetching historical data using the Heikin-Ashi candlestick pattern
  id: totrans-285
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: The historical data of a financial instrument can be analyzed in the form of
    the Heikin-Ashi candlestick pattern. Brokers typically do not provide historical
    data using the Heikin-Ashi candlestick pattern via APIs. Brokers usually provide
    historical data using the Japanese candlestick pattern, which needs to be converted
    to the Heikin-Ashi candlestick pattern. A shorter candle interval hints at a localized
    price movement trend, while a larger candle interval indicates an overall price
    movement trend. Based on your algorithmic trading strategy, you may need the candle
    interval to be small or large. A candle interval of 1 minute is often the smallest
    available candle interval.
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
- en: 'The Heikin-Ashi candlestick pattern works as follows:'
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
- en: 'Each candle has `Close`, `Open`, `High`, and `Low` attributes. For each candle,
    the following occurs:'
  id: totrans-288
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Close` is calculated as the average of the `Open`, `High`, `Low`, and `Close` attributes
    of the current Japanese candle.'
  id: totrans-289
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Open` is the average of the `Open` and `Close` attributes of the previous
    Heikin-Ashi candle.'
  id: totrans-290
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`High` is max of:'
  id: totrans-291
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Open` of current Heikin-Ashi candle'
  id: totrans-292
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Close` of current Heikin-Ashi candle'
  id: totrans-293
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`High` of current Japanese candle'
  id: totrans-294
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Low` is the min of:'
  id: totrans-295
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Open` of current Heikin-Ashi candle'
  id: totrans-296
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Close` of current Heikin-Ashi candle'
  id: totrans-297
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '`Low` of current Japanese Candle'
  id: totrans-298
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A green candle is formed when `Close` is higher than `Open`. (This is the same
    as the green candle in the Japanese candlestick pattern.)
  id: totrans-299
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A red candle is formed when `Close` is lower than `Open`. (This is the same
    as the red candle in the Japanese candlestick pattern.)
  id: totrans-300
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: All the timestamps are equally spaced (within market hours).
  id: totrans-301
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: This recipe shows you how to fetch historical data using Japanese candlestick
    pattern when using the broker API, as well as how to convert and plot the historical
    data using the Heikin-Ashi candlestick pattern for various candle intervals.
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-303
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Make sure the `broker_connection` object is available in your Python namespace.
    Refer to the *Technical requirements* section of this chapter to learn how to
    set up `broker_connection`.
  id: totrans-304
  prefs: []
  type: TYPE_NORMAL
- en: How to do it…
  id: totrans-305
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We execute the following steps for this recipe:'
  id: totrans-306
  prefs: []
  type: TYPE_NORMAL
- en: 'Import the necessary modules:'
  id: totrans-307
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE50]'
  id: totrans-308
  prefs: []
  type: TYPE_PRE
  zh: '[PRE50]'
- en: 'Fetch the historical data for an instrument and convert it into Heikin-Ashi
    data:'
  id: totrans-309
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE51]'
  id: totrans-310
  prefs: []
  type: TYPE_PRE
  zh: '[PRE51]'
- en: 'You will get the following output:'
  id: totrans-311
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/e6ce20c1-3076-4026-956e-e551d4e769d9.png)'
  id: totrans-312
  prefs: []
  type: TYPE_IMG
- en: 'Create a green Heikin-Ashi candle for one row of data:'
  id: totrans-313
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE52]'
  id: totrans-314
  prefs: []
  type: TYPE_PRE
  zh: '[PRE52]'
- en: 'You will get the following output:'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/6d87f35f-5267-4821-817a-4788a36977fb.png)'
  id: totrans-316
  prefs: []
  type: TYPE_IMG
- en: 'Create a red Heikin-Ashi candle for one row of data:'
  id: totrans-317
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE53]'
  id: totrans-318
  prefs: []
  type: TYPE_PRE
  zh: '[PRE53]'
- en: 'You will get the following output:'
  id: totrans-319
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/59a36b0a-c1da-4a2c-a26d-40aed004707a.png)'
  id: totrans-320
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 1-minute candle
    interval:'
  id: totrans-321
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE54]'
  id: totrans-322
  prefs: []
  type: TYPE_PRE
  zh: '[PRE54]'
- en: 'You will get the following output:'
  id: totrans-323
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/93d8dcab-2716-4f4a-a5ff-69622ad7720b.png)'
  id: totrans-324
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 3-minute candle
    interval:'
  id: totrans-325
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE55]'
  id: totrans-326
  prefs: []
  type: TYPE_PRE
  zh: '[PRE55]'
- en: 'You will get the following output:'
  id: totrans-327
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/2b9e5c4a-1f20-4ff8-b655-cb450ec4b51d.png)'
  id: totrans-328
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 5-minute candle
    interval:'
  id: totrans-329
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE56]'
  id: totrans-330
  prefs: []
  type: TYPE_PRE
  zh: '[PRE56]'
- en: 'You will get the following output:'
  id: totrans-331
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/43712f77-438b-4284-8391-ff59e6dce24c.png)'
  id: totrans-332
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 10-minute candle
    interval:'
  id: totrans-333
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE57]'
  id: totrans-334
  prefs: []
  type: TYPE_PRE
  zh: '[PRE57]'
- en: 'You will get the following output:'
  id: totrans-335
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/ca2c179b-4020-49ae-aed3-13ade0abd2fe.png)'
  id: totrans-336
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 15-minute candle
    interval:'
  id: totrans-337
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE58]'
  id: totrans-338
  prefs: []
  type: TYPE_PRE
  zh: '[PRE58]'
- en: 'You will get the following output:'
  id: totrans-339
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/3d3462b5-0b58-4a56-b97b-031f2523d8ca.png)'
  id: totrans-340
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 30-minute candle
    interval:'
  id: totrans-341
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE59]'
  id: totrans-342
  prefs: []
  type: TYPE_PRE
  zh: '[PRE59]'
- en: 'You will get the following output:'
  id: totrans-343
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/f18afad9-d8a5-4bff-9f26-e0e6d0d4234c.png)'
  id: totrans-344
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 1-hour candle
    interval:'
  id: totrans-345
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE60]'
  id: totrans-346
  prefs: []
  type: TYPE_PRE
  zh: '[PRE60]'
- en: 'You will get the following output:'
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/bd8109ae-7421-4c0d-a7fa-268be204c0fb.png)'
  id: totrans-348
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of the instrument with a 1-day candle
    interval:'
  id: totrans-349
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE61]'
  id: totrans-350
  prefs: []
  type: TYPE_PRE
  zh: '[PRE61]'
- en: 'You will get the following output:'
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/dfc0ca08-a2ff-4cfe-acbd-b0cd7c5e99e5.png)'
  id: totrans-352
  prefs: []
  type: TYPE_IMG
- en: How it works…
  id: totrans-353
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In *step 1*, you import `plot_candlestick_chart`, a quick utility function for
    plotting candlestick pattern charts, `PlotType`, an enum for various types of
    candlestick patterns, and the `HeikinAshi` function, which can convert historical
    data from the Japanese candlestick pattern into data that's applicable to the
    Heikin-Ashi candlestick pattern. In *step 2*, you use the `get_instrument()` method
    of `broker_connection` to fetch an instrument and assign it to a new attribute,
    `instrument`. This object is an instance of the `Instrument` class. The two parameters
    needed to call `get_instrument()` are the exchange (`'NSE'`) and the trading symbol
    (`'TATASTEEL'`). Next, you use the `get_historical_data()` method of the `broker_connection`
    object to fetch the historical data for the duration of December 2019, with a
    candle interval of 1 minute. The time-series data returned is in the form of Japanese
    candlestick pattern. The `HeikinAshi()` function converts this data to Heikin-Ashi
    candlestick pattern, another `pandas.DataFrame` object. You assign it to `historical_data_1minute_heikinashi`.
    Observe that `historical_data_1minute_heikinashi` has `timestamp`, `close`, `open`,
    `high`, and `low` columns. Also, observe that the timestamps are equidistant as
    the Heikin-Ashi candles are based on the average values of the Japanese candles.
    In *steps 3* and *4*, you selectively extract a green and a red candle from the
    data. (Please note, this indices passed to `historical_data.iloc` would be different
    if you choose a different duration for `historical_data` fetched in the first
    recipe of this chapter.) Observe that the candles have shadows (lines extending
    on either side of the main candle body) as the candle have `high` and `low` attributes,
    along with the `open` and `close` attributes. In *step 5*, you plot the complete
    historical data held by `historical_data` using the `plot_candlstick_charts()`
    function.
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
- en: 'In *steps 6* until *12*, you fetch the historical data using the Japanese candlestick
    pattern, converts it into the Heikin-Ashi candlestick pattern, and plots the converted
    data for candle intervals of 3 minutes, 5 minutes, 10 minutes, 15 minutes, 30
    minutes, 1 hour, and 1 day, respectively. Observe the following differences and
    similarities among the charts as the candle interval increases:'
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
- en: The total number of candlesticks decreases.
  id: totrans-356
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The spikes in the charts due to sudden price movement are minimized. Smaller
    candle interval charts have more spikes as they focus on local trends, while larger
    candle interval charts have fewer spikes and are smoother.
  id: totrans-357
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: A long-term trend in the stock price becomes visible.
  id: totrans-358
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Decision-making may become slower because you have to wait longer to get new
    candle data. Slower decisions may or may not be desirable, depending on the strategy.
    For example, to confirm trends, using a combination of data with a smaller candle
    interval, say 3 minutes, and data with a larger candle interval, say 15 minutes,
    would be desirable. On the other hand, to grab opportunities in intraday trading,
    data with larger candle intervals, say 1 hour or 1 day, would not be desirable.
  id: totrans-359
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The price ranges (y-axis spread) of adjacent candles may or may not overlap.
  id: totrans-360
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: All the timestamps are equally spaced in time (within market hours).
  id: totrans-361
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: If you are interested in finding out about the Math and implementation of Heikin-Ashi
    candles, please refer to the source code in the `pyalgotrading` package at [https://github.com/algobulls/pyalgotrading/blob/master/pyalgotrading/utils/candlesticks/heikinashi.py](https://github.com/algobulls/pyalgotrading/blob/master/pyalgotrading/utils/candlesticks/heikinashi.py).
  id: totrans-362
  prefs: []
  type: TYPE_NORMAL
- en: Fetching historical data using Quandl
  id: totrans-363
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: So far, in all the recipes in this chapter, you have used the broker connection
    to fetch historical data. In this recipe, you will fetch historical data using
    a third-party tool, Quandl ([https://www.quandl.com/tools/python](https://www.quandl.com/tools/python)).
    It has a free to use Python version which can be easily installed using `pip`.
    This recipe demonstrates the use of `quandl` to fetch historical data of **FAAMG**
    stock prices (Facebook, Amazon, Apple, Microsoft, and Google).
  id: totrans-364
  prefs: []
  type: TYPE_NORMAL
- en: Getting ready
  id: totrans-365
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Make sure you have installed the Python `quandl` package. If you haven''t,
    you can install it using the following `pip` command:'
  id: totrans-366
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE62]'
  id: totrans-367
  prefs: []
  type: TYPE_PRE
  zh: '[PRE62]'
- en: How to do it…
  id: totrans-368
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'We execute the following steps for this recipe:'
  id: totrans-369
  prefs: []
  type: TYPE_NORMAL
- en: 'Import the necessary modules:'
  id: totrans-370
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE63]'
  id: totrans-371
  prefs: []
  type: TYPE_PRE
  zh: '[PRE63]'
- en: 'Plot a chart for the historical data of Facebook with a 1-day candle interval:'
  id: totrans-372
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE64]'
  id: totrans-373
  prefs: []
  type: TYPE_PRE
  zh: '[PRE64]'
- en: 'You will get the following output:'
  id: totrans-374
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/2d71218d-450a-465e-b7ab-93d85be55eeb.png)'
  id: totrans-375
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of Amazon with a 1-day candle interval:'
  id: totrans-376
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE65]'
  id: totrans-377
  prefs: []
  type: TYPE_PRE
  zh: '[PRE65]'
- en: 'You will get the following output:'
  id: totrans-378
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/2c9e01c8-7e1f-4424-bc21-e3f37d3710e1.png)'
  id: totrans-379
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of Apple with a 1-day candle interval:'
  id: totrans-380
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE66]'
  id: totrans-381
  prefs: []
  type: TYPE_PRE
  zh: '[PRE66]'
- en: 'You will get the following output:'
  id: totrans-382
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/f1be033d-d543-45e8-9bed-524fb25c4131.png)'
  id: totrans-383
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of Microsoft with a 1-day candle interval:'
  id: totrans-384
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE67]'
  id: totrans-385
  prefs: []
  type: TYPE_PRE
  zh: '[PRE67]'
- en: 'You will get the following output:'
  id: totrans-386
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/eb2909f1-4625-4284-8944-c6eb0112fe0d.png)'
  id: totrans-387
  prefs: []
  type: TYPE_IMG
- en: 'Plot a chart for the historical data of Google with a 1-day candle interval:'
  id: totrans-388
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: '[PRE68]'
  id: totrans-389
  prefs: []
  type: TYPE_PRE
  zh: '[PRE68]'
- en: 'You will get the following output:'
  id: totrans-390
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/1c9ce622-24a8-4866-9855-e70e553dc739.png)'
  id: totrans-391
  prefs: []
  type: TYPE_IMG
- en: How it works…
  id: totrans-392
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: In *step 1*, you import `plot_candlestick_chart`, a quick utility function for
    plotting candlestick pattern charts, `PlotType`, an enum for various types of
    candlestick patterns, and the `quandl` module. In the remaining steps, historical
    data for the Facebook, Amazon, Apple, Microsoft, and Google stocks are fetched
    using `quandl.get()` and plotted using the `plot_candlestick_chart()` method.
    The data that's returned by the `quandl` is in the OHLC (open, high, low, close)
    format.
  id: totrans-393
  prefs: []
  type: TYPE_NORMAL
  zh: '*第一步*中，你需要导入`plot_candlestick_chart`，这是一个用于绘制蜡烛图表的快速实用函数，还有`PlotType`，用于表示各种蜡烛图案的枚举，以及`quandl`模块。在其余的步骤中，使用`quandl.get()`获取Facebook、Amazon、Apple、Microsoft和Google股票的历史数据，并使用`plot_candlestick_chart()`方法进行绘制。`quandl`返回的数据格式是OHLC（开盘价、最高价、最低价、收盘价）格式。'
- en: The upside of such third-party modules is that they are free and you don't need
    to set up a broker connection to fetch the historical data. The downside is that
    this data from the free package has its limitations. For example, the data cannot
    be fetched in real-time and the data cannot be fetched for intraday trading (1-minute
    candle, 3-minute candle, and so on).
  id: totrans-394
  prefs: []
  type: TYPE_NORMAL
  zh: 这种第三方模块的好处是它们是免费的，而且你不需要建立经纪人连接来获取历史数据。但缺点是来自免费包的数据有其局限性。例如，无法实时获取数据，也无法获取日内交易的数据（1分钟蜡烛、3分钟蜡烛等）。
- en: So, whether you want to use this data depends on your requirements. It may be
    good for testing or flow flushing the existing code base, but not good enough
    for providing live data feeds, which are needed during real trading sessions.
  id: totrans-395
  prefs: []
  type: TYPE_NORMAL
  zh: 因此，是否要使用这些数据取决于你的需求。它可能适用于测试或更新现有代码库，但不足以提供实时数据源，这在实际交易会话期间是需要的。

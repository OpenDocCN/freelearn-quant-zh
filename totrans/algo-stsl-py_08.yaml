- en: '8'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Position Sizing: Money is Made in the Money Management Module'
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'Legendary investors have always emphasized the same thing: risk management
    is the key to long-term superior returns. Stock picking is sexy, but vastly overrated.
    Risk management is boring but vastly underappreciated. In execution trader English,
    where market gurus focus on picking the right ingredients, market wizards concentrate
    on getting the right recipe.'
  prefs: []
  type: TYPE_NORMAL
- en: At the end of the day, the primary determinant of long-term geometric returns
    is position sizing. The expanding nature of longs does not compel market participants
    to think about position sizing. After all, one good AAPL can make a basket of
    rotten apples look good. They can survive despite bad position-sizing algorithms.
    Short sellers do not have the luxury of logarithmic price declines. In this chapter,
    we will consider some classic examples of bad position-sizing algorithms. Those
    are the four horsemen of apocalyptic position sizing.
  prefs: []
  type: TYPE_NORMAL
- en: After we have taken a close look at common pitfalls, we will consider a strategy
    that not only works, but minimizes the devastating effects of bad decision-making.
  prefs: []
  type: TYPE_NORMAL
- en: 'We will cover the following topics:'
  prefs: []
  type: TYPE_NORMAL
- en: Importing libraries
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The four horsemen of apocalyptic position sizing
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Position sizing is the link between emotional and financial capital
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Comparing position-sizing algorithms
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Refining your risk budget
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'You can access color versions of all images in this chapter via the following
    link: [https://static.packt-cdn.com/downloads/9781801815192_ColorImages.pdf](https://static.packt-cdn.com/downloads/9781801815192_ColorImages.pdf).
    You can also access the source code for this chapter via the book''s GitHub repository:
    [https://github.com/PacktPublishing/Algorithmic-Short-Selling-with-Python-Published-by-Packt](https://github.com/PacktPublishing/Algorithmic-Short-Selling-with-Python-Published-by-Packt)'
  prefs: []
  type: TYPE_NORMAL
- en: Importing libraries
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: 'For this chapter and the rest of the book, we will be working with the `pandas`,
    `numpy`, `yfinance`, and `matplotlib` libraries. So, please remember to import
    them first:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE0]'
  prefs: []
  type: TYPE_PRE
- en: The four horsemen of apocalyptic position sizing
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '"Only listen to advice from people you want to look like."'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: – Gilbert Bernut, father, superhero, unsung 20th-century philosopher
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Whilst at Fidelity, I used to run my algorithm across other managers' portfolios.
    My unbridled ambition was to help my colleagues improve their performance by a
    whopping 0.01% at a time. Whilst it does not look like much, 1 basis point even
    on every other trade compounded over a year would be enough to lift a ranking
    from the second quartile to the rarefied atmosphere of top-decile performers.
  prefs: []
  type: TYPE_NORMAL
- en: It soon dawned upon me that the same stocks kept popping up across all portfolios.
    Put smart, passionate people together in a collegial atmosphere, and healthy cross-pollination
    naturally ensues.
  prefs: []
  type: TYPE_NORMAL
- en: What was more intriguing was the disparity in performance despite the low dispersion
    in holdings. One would expect similar holdings to generate similar performance.
    There were, however, differences in both performance and tracking errors, that
    is, the volatility of returns versus the benchmark. Since the same issues were
    present in most portfolios, stock picking was clearly not the primary driver of
    performance. The difference that really made the difference was position sizing.
    Money is made in the money management module.
  prefs: []
  type: TYPE_NORMAL
- en: 'Now, the paradox of making money on the markets is this: the module that will
    generate money is also the most boring part of a strategy. Everyone wants to shout
    out to the world that they bought Netflix or Amazon years ago. Yet, no-one will
    admit they only had marginal positions, and did not know how many they should
    have bought. And then, they wonder why they keep underperforming despite those
    exceptional stock picks.'
  prefs: []
  type: TYPE_NORMAL
- en: Consequently, the discipline of money management has been relegated to a distant
    afterthought, some chore that needs to be done, like taking out the garbage or
    paying the utility bills. This has led market participants to promote disastrous
    money management practices. In execution trader English, all the potential gains
    made by picking the right stocks are wiped out because of ignorant bet sizes.
  prefs: []
  type: TYPE_NORMAL
- en: Let us look at four of the most damaging money management techniques currently
    embraced by the industry.
  prefs: []
  type: TYPE_NORMAL
- en: 'Horseman 1: Liquidity is the currency of bear markets'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '"You can check out anytime you want, but you can never leave."'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: – Don Henley, Hotel California
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Large positions in illiquid stocks have sunk many a talented fund manager. Small
    caps and illiquid stocks are like boats and luxury toys. You can buy anytime you
    want, but you can never leave. If you can't get out of a position without damaging
    market impact, you don't own it. It owns you.
  prefs: []
  type: TYPE_NORMAL
- en: Liquidity is the currency of bear markets. When the "redemption song" starts
    playing, managers are forced to liquidate whatever they can, not necessarily what
    they would like to.
  prefs: []
  type: TYPE_NORMAL
- en: This leaves them with illiquid debris, which perpetuates the vicious cycle of
    redemption. Small caps are particularly vulnerable in bear markets. Liquidity
    evaporates, the bid/ask spread widens. Those who tried to cash out of illiquid
    assets during the Great Financial Crisis (GFC) quickly realized that the bid/ask
    spread was wide enough to dock a supertanker without a scratch.
  prefs: []
  type: TYPE_NORMAL
- en: 'A side note on capacity. One of the first questions from investors is about
    capacity: how many assets a manager can take on before returns start to dwindle.
    Investors know that the strongest returns happen in the earlier years, when funds
    are small and managers hungry. Yet, they want to see some track record before
    pulling the trigger. So, they wait and see as much as possible, but not too much
    to make sure they will still enjoy some decent returns. More than a mathematical
    approximation, a real-life acid test is inertia. When managers start to pass up
    trades because of market impact, they have reached their saturation point. As
    my mentor June-Yon Kim always said: "capacity sets in when inertia creeps in."
    If you find yourself passing up signals because of inertia, and this seems like
    the right thing to do, either you are lazy, or your asset size is too big. Either
    way, it is a wake-up call.'
  prefs: []
  type: TYPE_NORMAL
- en: 'Horseman 2: Averaging down'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '"Losers average losers."'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: – Paul Tudor Jones
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Averaging down is still a popular method amongst fundamental market participants.
    As prices come down, valuations look cheaper, so they add to their existing loss-making
    positions. Adding to a losing position worsens three of the four variables in
    the trading edge formula: loss rate and average loss increase, win rate goes down.
    The only variable that remains unaffected is average win, something which no-one
    has any beginning of control over anyhow. Moreover, additional capital allocated
    to losers has to come from somewhere. It either comes from fresh infusions of
    cash or profit-making positions cut short. In summary, averaging down can be summarized
    as: "cut your winners, run your losers." Wasn''t the secret to success: "cut your
    losers, run your winners"?'
  prefs: []
  type: TYPE_NORMAL
- en: The financial services industry is replete with arcane theories supported by
    batteries of back-tests, optimizations, and soporific white papers. Rather than
    staying in the abstract world, a simple way to assess their validity is to draw
    parallels with the real world. In the gambling world, averaging down is known
    as a **martingale**. Every rookie gambler has come up with an iteration supposed
    to break the casino. Double your bet size after each loss, then you will eventually
    get your money back. First, this strategy ignores the theory of runs.
  prefs: []
  type: TYPE_NORMAL
- en: Over the long run, coin tosses have 50% probability. Yet, it is not a neat succession
    of heads and tails. Every turn is independent of the previous one. Sometimes heads
    can come up 8, 9, or 10 times in a row. This presupposes infinite capital. Secondly,
    the most favorable outcome is break even. This means that any outcome before that
    has an interesting statistical property called **certainty of ruin**. Bottom line,
    there is a reason why casinos have marble, paintings, and free booze, and rookie
    gamblers go home broke in their busted cars.
  prefs: []
  type: TYPE_NORMAL
- en: 'If averaging down is demonstrably statistically bankrupt, then why is it still
    so popular among professional investors? In his fascinating autobiography *A Man
    for All Markets*, Edward Thorp describes averaging down as anchoring bias. Market
    participants anchor an assumption about the value of a stock at the moment they
    enter a position. Value is the subjective meaning they ascribe to valuation, or
    as Warren Buffett said: "Price is what you pay. Value is what you get." Subsequently,
    their judgement will always be colored by the initial cost. If a stock looked
    cheap when they first bought at $10, it must be a bargain at $9\. Market participants
    assume that their analysis is right and the market temporarily wrong. Adding another
    tranche before the market corrects this inefficiency could potentially lead to bigger profits.
    In theory, it makes sense.'
  prefs: []
  type: TYPE_NORMAL
- en: In practice, "it's complicated." When bets are small, emotional involvement
    remains minimal. Adding another tranche increases the stress level. The brain
    suddenly jumps from a $1 buy-in to the high roller table. A whole slew of emotions
    that did not exist before hijack the thinking brain. Stakes are high now, and
    the ego cannot afford to be wrong. As we saw in *Chapter 7*, *Improve Your Trading
    Edge*, with the psychology of the stop loss, ego that manifests here as the "need
    to be right" invariably supersedes the obligation to be profitable.
  prefs: []
  type: TYPE_NORMAL
- en: Legendary investors emphasize the importance of risk management. They also talk
    about humility before the markets. Market wizards are synthetically long math
    and short ego. Partisans of the martingale follow a statistically bankrupt method;
    short stats. They also call Mr. Market's bluff by doubling down. Short math, long
    ego sounds like a recipe for a short career in the financial services industry.
  prefs: []
  type: TYPE_NORMAL
- en: 'Horseman 3: High conviction'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '"I feel good!"'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: – James Brown, Godfather
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Conviction is a position-sizing algorithm practiced by both the worst and the
    best investors. The worst investors develop an investment thesis. They then broadcast
    their conviction to the world with some "chutzpah" bet: "go big or go home."'
  prefs: []
  type: TYPE_NORMAL
- en: Unfortunately, t-stat, a measure of statistical robustness, does not provide
    mental robustness. When market participants take on big bets, they lose impartiality.
    Their ego craves validation. High conviction is a "feel-good" bet size with no
    statistical validity. Sure enough, obvious trades that feel good are rarely the
    most profitable ones.
  prefs: []
  type: TYPE_NORMAL
- en: Now, the most successful investors also take big, high-conviction bets. The
    difference is they express conviction in units of risk. This means that they develop
    a thesis, quantify risk first, and then size positions accordingly. George Soros
    is famous for taking on massive bets. Whilst everyone remembers the short pound
    trade, few people know about the **Long-Term Capital Management** (**LTCM**) story.
    According to legendary trader Victor Niederhoffer, who was working in Mr Soros'
    shop at the time, he made a lot of traders' bonuses by cutting his losses during
    the LTCM debacle. Those are calculated units of risk.
  prefs: []
  type: TYPE_NORMAL
- en: 'Horseman 4: Equal weight'
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Equal weight is a staple among fundamental stock pickers. They rely on their
    stock-picking ability to generate performance. All stock picks are roughly equally
    good, so they do not perceive the need to size positions differently.
  prefs: []
  type: TYPE_NORMAL
- en: Portfolio management is not an exercise in democracy. Equal opportunity will
    not bring about ruin, but it may prevent you from achieving your long-term objectives.
    Not all stocks have the same beta. Sleepy utilities do not have the same volatility
    signature as racy internet stocks. By ignoring beta at the position sizing level,
    volatility resurfaces at the portfolio level. Volatile stocks will drive the overall
    portfolio volatility. Since investors react to volatility, it is therefore advisable
    to size positions according to their volatility or Beta. In execution trader English,
    remember that if you give equal rights to your ideas, this will come with equal
    lefts to your equity curve.
  prefs: []
  type: TYPE_NORMAL
- en: This leads us down an interesting path. Is there an optimal position-sizing
    algorithm that institutional investors are aware of?
  prefs: []
  type: TYPE_NORMAL
- en: Position sizing is the link between emotional and financial capital
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '"This is a great experiment for many reasons. It ought to become part of the
    basic education of anyone interested in ﬁnance or gambling."'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: – Edward Thorp, a (super)man for all markets
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Victor Haghani, founder of Elm and former trader at LTCM, conducted an experiment
    on 61 volunteers, bright students in finance and sophisticated investment professionals.
    Participants were given $25 starting capital and were told to flip a virtual coin
    for 30 minutes, being told, "the coin is biased to come up heads with a 60% probability,
    and you can bet as much as you like on heads or tails on each ﬂip." How much would
    you bet? It appears there is a formula to calculate the optimal bet size that
    would maximize long-term geometric returns. The Kelly criterion formula is:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE1]'
  prefs: []
  type: TYPE_PRE
- en: Despite the pedigree and alleged sophistication of the participants, results
    were vastly ... underwhelming. Only 21% of the players hit the maximum cap. Despite
    odds of 60% in their favour, a whopping 28% of those fearless sharp financial
    professionals managed to go bust! Some people are destined to seek asylum in the
    sanctuary of bankrupt fund managers called **management**...
  prefs: []
  type: TYPE_NORMAL
- en: Now, let's play the same game, but up the ante this time. Let's start with your
    entire lifetime savings. Last time, the expected return on a meagre $25 was north
    of $3 million after 300 flips. Now, you know the odds and the formula. This time,
    betting your life savings should put you well ahead of Bill Gates, Warren Buffett,
    and Jeff Bezos.
  prefs: []
  type: TYPE_NORMAL
- en: 'If it is so easy, why does no-one get that rich that quickly? There is a catch:
    losing streaks. Coin tosses have no memory. Every flip is independent from the
    previous one. Even though the long-term probability is 60%, there will be some
    streaks of consecutive losses in a row.'
  prefs: []
  type: TYPE_NORMAL
- en: This is what your life savings would look like in a losing streak, if you were
    to bet 20% of your capital each flip.
  prefs: []
  type: TYPE_NORMAL
- en: '![A close up of a map  Description generated with very high confidence](img/B17704_08_01.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 8.1: Capital depletion when risking 20% on each bet'
  prefs: []
  type: TYPE_NORMAL
- en: After 3 losses, your lifetime savings would have halved. After 5 losses, only
    a third would remain. Will you still stick with the mathematically correct plan
    after half of your hard-earned life savings (or ill-acquired gains in the case
    of finance professionals) have been erased in less than 1 minute? More likely
    than not, at some point, your brain will say stop.
  prefs: []
  type: TYPE_NORMAL
- en: 'There are four important lessons here:'
  prefs: []
  type: TYPE_NORMAL
- en: 'Only 5 out of 61 participants knew about the Kelly criterion. This raises disturbing
    questions about the curriculum in finance. How can students be expected to win
    a probabilistic game called the stock market if they have never been taught how
    to bet? Teaching something like the **Efficient Market Hypothesis** (**EMH**)
    is like teaching Hippocratic body humors to medical students long after the discovery
    of penicillin. As Edward Thorp, hedge fund manager with a stellar track record
    and vocal critic of the EMH, wrote: "This is a great experiment for many reasons.
    It ought to become part of the basic education of anyone interested in ﬁnance
    or gambling."'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Position size determines the long-term geometric return of any strategy. Bet
    too conservatively and you end up making less money than you could. Bet too aggressively
    and you end up losing a lot more than you should. In execution trader English,
    bet too small and you don't have a business. Bet too big and you will lose your
    business.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'The Kelly criterion or *optimal f* may be the position-sizing algorithms that
    will yield the highest long-term geometric return. It does not mean professional
    fund managers should be adopting them unconditionally. Formula 1 cars might be
    the fastest vehicles, but they are not made to fetch milk at the local grocery
    store. As we will see in *Part III*, *The Long/Short Game: Building a Long/Short
    Product*, investors trade performance for returns. Consequently, market participants
    usually trade using a fractional Kelly or even less sophisticated algorithms.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Position sizing is not just a mathematical exercise. Position sizing is the
    critical articulation between financial and emotional capital. Deplete the former
    and it will take time and effort to rebuild capital. It is a complicated problem,
    but not a complex one. There is an optimal solution. On the other hand, break
    the latter and *Game Over*. In practice, psychology supersedes mathematics. Every
    market participant has encountered the "fear of pulling the trigger" or taken
    one big bet too many before the plunge. Capital preservation is paramount, especially
    the emotional side of it.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: This neatly leads us into the next section.
  prefs: []
  type: TYPE_NORMAL
- en: A position size your brain can trade
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: '"I am not afraid, I was born to do this."'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: – Joan of Arc, freedom fighter
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: Position-sizing algorithms are designed by mathematicians for functioning psychopaths.
    They fail to appreciate the inner idiot in the driver seat. The reason why we
    drift away from rational bet sizing has nothing to do with logic. In the biased
    coin game at the beginning of the chapter, you probably would have bet your life
    savings more conservatively after the second consecutive loss, even though the
    rational choice would have been to soldier on throughout the entire experiment.
  prefs: []
  type: TYPE_NORMAL
- en: Joan of Arc was a French freedom fighter and the original inventor of Brexit.
    At the tender age of 16, she had the idea of booting the English out of the kingdom
    of France. In the French collective imagination, Joan of Arc is remembered for
    two things. The first one is so tragic it continues to haunt the French psyche.
  prefs: []
  type: TYPE_NORMAL
- en: She was captured, tortured, and eventually roasted in a public place in Rouen.
    Not nice, but again the Middle Ages are known to be somewhat medieval. Secondly,
    she is famous for hearing voices. When stocks start drilling holes deep enough
    to strike shale gas in the portfolio, our inner Joan of Arc awakes. We start hearing
    voices. We get paralyzed by fear. Cortisol floods the prefrontal cortex, or "thinking
    brain," and we pass up even "free money" trades.
  prefs: []
  type: TYPE_NORMAL
- en: 'Bottom line, our inner idiot understands only two position sizes: too little
    or too much. When everything works fine, there is never enough of a good thing.
    When nothing seems to work, there is always too much of a bad thing.'
  prefs: []
  type: TYPE_NORMAL
- en: 'This leads us to a first important point: risk must have boundaries.'
  prefs: []
  type: TYPE_NORMAL
- en: Establishing risk bands
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'Risk needs to oscillate between a minimum and a maximum. Those bounds can be
    a fraction of Kelly for the upper band, such as 30-50%. The pro of a variable
    upper band is fluidity. You don''t know how much risk your system can tolerate
    unless you take it for a spin. Maybe you are taking too much or too little risk.
    Two considerations: volatility is a function of concentration, the number of positions,
    which itself is a function of risk-per-trade. If your objective is to have a diversified
    low-volatility portfolio, it might be wise to cap the upper bound as well.'
  prefs: []
  type: TYPE_NORMAL
- en: On the other hand, the lower band can be a strict minimum such as 0.10%-0.15%.
    Make sure your system continues to trade during losing streaks. A variable lower
    band can lead to negative position sizing. This leads to trading suspension. If
    the system cannot generate new trades, it cannot trade itself out of a hole.
  prefs: []
  type: TYPE_NORMAL
- en: 'Our inner idiot always tricks us into gambling a little too much around the
    top and risking too little around the bottom. We have all been there. The way
    to stop the madness is to involve the thinking brain before the inner idiot wakes
    up. The way to do this is to set boundaries:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Minimum risk**: Winning the lottery is not going to be easy if you don''t
    buy at least one ticket. You must continue trading to get out of a drawdown. The
    classic "fear of pulling the trigger" is essentially a position size issue. There
    is a size small enough where you will be saying "hey, why not?" Minimum risk is
    somewhere between the minimum size for the system to run and the maximum size
    before "fear of pulling the trigger" kicks in.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Maximum risk**: This is a function of the risk appetite of your investors.
    When they say they can stomach a -20% drop, what they really mean is you will
    enter a Bob Marley market, that is, a "redemption song", after a -10% drawdown.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Whatever you think your investors tolerance might be, a third of that number
    is a decent approximation. Maximum risk is also a function of the number of stocks
    you run and your average win rate.
  prefs:
  - PREF_IND
  type: TYPE_NORMAL
- en: Your strategy will be safe if it stays within those confines. The next step
    is to build a transmission that will allow you to shift gears btween minimum and
    maximum risk.
  prefs: []
  type: TYPE_NORMAL
- en: At this juncture, we understand the need to incorporate some feedback mechanism
    from the markets into our risk appetite, which leads us to the next section.
  prefs: []
  type: TYPE_NORMAL
- en: Equity curve oscillator – avoiding the binary effect of classic equity curve
    trading
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: What would you think of someone who drives their car in first gear only? Hardly
    Nobel Prize material. Welcome to the financial services industry, where geniuses
    drive their portfolios in either first or fifth gear through bull and bear markets
    alike. Constant risk is as efficient as a Lamborghini stuck in first gear. When
    your style works, take more calculated risks. When it doesn't, focus on capital
    protection.
  prefs: []
  type: TYPE_NORMAL
- en: Modulating risk according to performance is called **equity curve trading**.
    Classic equity curve trading uses methods such as moving average crossover or
    breakouts. As the equity curve crosses over a moving average or makes a new high,
    risk abruptly jumps from timid to bold.
  prefs: []
  type: TYPE_NORMAL
- en: This approach lags the market. It measures the advance from an equity base level.
    For example, when the equity level raises from 100 to 105, then an additional
    0.1% risk can be added. To illustrate this mechanism, imagine taking someone on
    a date in a car with only two gears, first and fifth. Once you have been on a
    straight line in first gear for a while, you would switch into fifth gear, probably
    just in time for the next curve.
  prefs: []
  type: TYPE_NORMAL
- en: If you want to improve your chances of passing down your genes, you and your
    traveling companion might appreciate a smoother ride. The oscillator in the simplified
    convex position-sizing algorithm is the automatic gearbox that will ensure a smooth
    and comfortable transition from minimum to maximum risk.
  prefs: []
  type: TYPE_NORMAL
- en: Lag is the main problem with classic equity curve trading. The simplest way
    to avoid lag is to measure drawdown from peak, not advance from base. Basically,
    you would be driving the portfolio at optimum speed the whole time but only slow
    down when necessary.
  prefs: []
  type: TYPE_NORMAL
- en: 'The methodology is as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '**Drawdown tolerance**: This is the minimal fraction of capital that would
    be deployed if there was a drawdown of *X*%. For example, a famous hedge fund has
    a -5% drawdown tolerance after which assets under management are reduced by 50%.
    Allocating a fraction of capital is synthetically like taking less risk. Either
    the system takes less risk, or it deploys less money. The result is synthetically
    the same.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Drawdown oscillator**: Rebase the drawdown using the above tolerance. Build
    an oscillator that tracks the current equity curve versus its peak and a trailing
    trough...'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: '**Shape of the oscillator**: Concave or convex. Think of this little jewel
    of sophistication as the equivalent of automatic transmission in a car. There
    is an inherent lag in classic equity curve trading. Risk does not drop fast enough
    to reduce shock. Conversely, it is slow to recover after a drawdown.'
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: 'Convexity and concavity accelerate both drop and recovery as shown in the theoretical
    example below:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE2]'
  prefs: []
  type: TYPE_PRE
- en: 'The output of this function is graphs like the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B17704_08_02.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 8.2: Concave oscillator at various levels'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B17704_08_03.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 8.3: Convex oscillator at various levels'
  prefs: []
  type: TYPE_NORMAL
- en: Convex is above and concave below the diagonal line. This 45-degree line is
    the linear drop. It is good enough when coupled with drawdown tolerance. Concavity
    and convexity really deliver when the ratio of minimum over maximum risk is high. For
    example, if minimum risk is –0.25% and maximum –1%, then either concavity or convexity
    would help in the transmission.
  prefs: []
  type: TYPE_NORMAL
- en: Next, let's illustrate how this oscillator works in practice. We will simulate
    an equity curve by downloading the adjusted close of the German DAX index using
    Yahoo Finance. Next, we instantiate a dataframe, and calculate peak equity using
    the `cummax()` method. We proceed to calculate drawdown from the peak.
  prefs: []
  type: TYPE_NORMAL
- en: '`dd_tolerance` is the drawdown tolerance we are willing to tolerate before
    slamming risk down. For good measure, we plot the dataframe. This gives us a good
    starting basis to work with:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE3]'
  prefs: []
  type: TYPE_PRE
- en: 'You should observe a chart like the following:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B17704_08_04.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 8.4: The equity curve, peak equity, drawdown, and drawdown tolerance
    band'
  prefs: []
  type: TYPE_NORMAL
- en: One observation imposes itself right out the gate. If this equity curve is anywhere
    near your real equity curve, then stick to barbecues on Sundays, writing newsletters
    to gullible tourists, or teaching **Efficient Market Hypothesis** (**EMH**) to
    bored rich kids. This chart screams impostor syndrome.
  prefs: []
  type: TYPE_NORMAL
- en: The dotted line at the top of the chart is the drawdown. It is painted on the
    secondary *y* axis. The two dotted lines above and below the equity curve are
    peak equity and drawdown tolerance. If the equity curve drops below the lower
    line, then risk should be reduced. As the lower dotted line shows, the equity
    curve spends a considerable amount of time below the tolerance curve. We therefore
    expect to be trading at minimum risk for a while.
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, we will calculate how much risk we should be taking along this equity
    curve. From the preceding theoretical discussion, risk is range bound between
    a minimum and maximum. This next little function is the best sleeping pill for
    experienced traders. It is worth multiple times the value of this book:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE4]'
  prefs: []
  type: TYPE_PRE
- en: 'This is how it works:'
  prefs: []
  type: TYPE_NORMAL
- en: Calculate peak equity, watermark in financial creole, from the `eqty` series.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Calculate drawdown and rebased drawdown using drawdown tolerance. Smooth the
    average rebased drawdown using an exponential moving average.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'Choose the shape of the curve: concave (`-1`), convex (`1`), or linear (anything
    else).'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Calculate the risk appetite oscillator.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: Next, we run a few lines of code through the equity curve to compute the risk
    budget throughout the period. The risk budget is the fraction of the equity we
    are ready to risk. For example, if we use a constant equity at risk of –0.50%,
    it would be the current equity multiplied by –0.50%.
  prefs: []
  type: TYPE_NORMAL
- en: 'In the example below, we use three levels of risk: minimum at –0.25, maximum
    at –0.75%, and average at –0.50%. For the purpose of the exercise, the average
    risk is the constant equity at risk. Below is the source code:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE5]'
  prefs: []
  type: TYPE_PRE
- en: Note that constant risk is multiplied by the current equity level whereas both
    concave and convex use peak equity. The last two incorporate drawdown in their
    calculation.
  prefs: []
  type: TYPE_NORMAL
- en: We have the same equity curve as before along with peak and tolerance. Then,
    we have two risk budget charts.
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B17704_08_05.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 8.5: The equity curve, peak, and drawdown tolerance. Concave, convex,
    and constant equity at risk'
  prefs: []
  type: TYPE_NORMAL
- en: Concave, the solid line, is by far the most responsive risk budget. It mirrors
    the equity curve. Convex, the dashed line, is the most conservative of the three.
    It will stay longer at minimal risk but will react positively in a sustained uptrend.
    The constant risk, the dotted line, does not fluctuate much at all. Whilst it
    may not seem like a bad thing on the surface, it can cause some severe damage
    to the equity curve. For example, the middle section would tend to be more pronounced.
    At the end of the day, choosing not to reduce risk when things go wrong is also
    a risk management decision, just not a good one.
  prefs: []
  type: TYPE_NORMAL
- en: The next chart plots the risk budget along with the drawdown.
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B17704_08_06.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 8.6: The drawdown, concave, convex, and constant equity at risk'
  prefs: []
  type: TYPE_NORMAL
- en: The above chart shows how the oscillator responds to drawdown. In comparison,
    constant equity at risk looks blunt and unsophisticated. As the drawdown in the
    middle section deepens and worsens, constant risk becomes too risky. Conversely,
    when drawdowns are minor, constant risk fails to capitalize on those opportunities.
    This position-sizing algorithm is not bad compared to equal weight or a martingale.
    It is just unsophisticated.
  prefs: []
  type: TYPE_NORMAL
- en: Now, should you go for concave or convex? The optimal mathematical answer may
    not be the right one for you. Are wines in Bordeaux, Burgundy, or northern Rhône
    better? There is no right or wrong answer to those deep existential issues that
    have agitated mankind since the dawn of time.
  prefs: []
  type: TYPE_NORMAL
- en: Comparing position-sizing algorithms
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Let's take an example to further illustrate the principle. Let's use the exact
    same signals and starting capital. Then, let's use various position-sizing algorithms.
    Let's compute the equity curve for each position-sizing algorithm. The objective
    is to see how much position sizing impacts returns.
  prefs: []
  type: TYPE_NORMAL
- en: 'For demonstration purposes, we will recycle our go-to Softbank in absolute
    with Turtle for dummies, along with our `regime_breakout()` function from *Chapter
    5*, *Regime Definition*. Once again, please do not do this at home, as it is too
    simplistic to be deployed in a professional investment product:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE6]'
  prefs: []
  type: TYPE_PRE
- en: 'This is our go-to example. Typically, today we have a signal at the close of
    the day. Tomorrow we will enter or exit. Entries and exits lag signals by one
    day using the shift method. We calculate cumulative returns (`tt_cumul_returns`)
    and daily profit and loss (`tt_chg1D`). This gives us the following graphs:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B17704_08_07.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 8.7: Softbank closing price, long/short positions, using Turtle for
    dummies on absolute series'
  prefs: []
  type: TYPE_NORMAL
- en: The above chart sums up the strategy. With the black solid line, we have the
    closing price, closely followed by the red dashed stop loss line. We then have
    the +/-1 dotted line symbolizing long/short positions. Finally, the solid blue
    line represents cumulative returns.
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B17704_08_08.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 8.8: Strategy daily profit and loss in local currency and USD'
  prefs: []
  type: TYPE_NORMAL
- en: The above chart represents the daily profit and loss in both local currency
    and adjusted to USD. The flat line shows when there is no active position.
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B17704_08_09.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 8.9: Strategy cumulative profit and loss in local currency and USD'
  prefs: []
  type: TYPE_NORMAL
- en: The above chart represents the cumulative profit and loss in local currency
    and USD. We use the same strategy on the same instrument with no additional features
    such as benchmark or liquidity adjustment. Everything is rigorously identical.
    The only difference is the position-sizing algorithm.
  prefs: []
  type: TYPE_NORMAL
- en: 'Let''s define a few standard position-sizing algorithms. Equal weight is not
    defined below as it is a numerical constant, of 3% of equity. Rather than complicate
    things with more exotic position-sizing algorithms, let''s keep it simple. We
    will use two of the most popular position-sizing algorithms: equal weight and
    equity at risk. We will then compare them with this concave and convex equity
    at risk. The latter two are new to the game. First, the source code for equity
    at risk is as follows:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE7]'
  prefs: []
  type: TYPE_PRE
- en: 'This produces the following output:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE8]'
  prefs: []
  type: TYPE_PRE
- en: The above function returns a number of shares using price (`px`), stop loss
    denominated in local currency (`sl`), equity (`eqty`), `risk`, `fx` in fund currency,
    the currency in which the fund operates, and `lot` size. In the above example,
    this would return `-300` shares.
  prefs: []
  type: TYPE_NORMAL
- en: 'Next, we run the simulation with 4 position-sizing algorithms: equal weight,
    constant, concave, and convex equity at risk:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE9]'
  prefs: []
  type: TYPE_PRE
- en: 'The code takes the following steps:'
  prefs: []
  type: TYPE_NORMAL
- en: First we instantiate parameters such as the starting capital, currency, minimum
    and maximum risk, drawdown tolerance and equal weight.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: We initialize the number of shares for each `posSizer`. We initialize the starting
    capital for each `posSizer` as well.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: We loop through every bar to recalculate every equity curve by adding the previous
    value to the current number of shares times daily profit.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: We recalculate the concave and convex risk oscillator at each bar.
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'If there is an entry signal, we calculate the number of shares for each `posSizer`.
    The `//` operator is modulo. It returns the rounded integer of the division. This
    is a neat trick to quickly calculate round lots. Note that the only difference
    between concave and convex is the sign: `–1` or `+1`.'
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
- en: 'We then print the equity curves and voila. The dashed line at the top is concave.
    Below, the dash-dotted line is convex, followed by constant. The secondary vertical
    axis represents the cumulative profit and loss before weight adjustment:'
  prefs: []
  type: TYPE_NORMAL
- en: '![](img/B17704_08_10.png)'
  prefs: []
  type: TYPE_IMG
- en: 'Figure 8.10: Equity curves using various position-sizing algorithms'
  prefs: []
  type: TYPE_NORMAL
- en: Let's briefly recap here. We use the same strategy, in which cumulative returns
    adjusted for currency are represented by the solid blue line above. The only difference
    is money management. Trailing far away in a distant galaxy is the industry's standard
    equal weight. In this case, we use 5% of equity, a position size that seasoned
    institutional managers would call a "high-conviction" bet. A good second last
    is constant equity at risk. It is either first or fifth gear. Concave equity at
    risk surprisingly came first. Convex tends to perform better in choppy markets
    because of its responsiveness, while concave does well in trending markets.
  prefs: []
  type: TYPE_NORMAL
- en: The tectonic takeaway is that money is made in the money management module.
    How smart you bet determines how much you make. The best return on investment
    does not come from visiting one more company, making one more phone call, reading
    one more analyst report, or examining one more chart analysis. The best return
    on investment comes from polishing the money management module.
  prefs: []
  type: TYPE_NORMAL
- en: Refining your risk budget
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: A bit of finesse in the money management algorithm goes a long way. This leads
    us to small refinements in risk budget such as amortization and false positives.
  prefs: []
  type: TYPE_NORMAL
- en: Risk amortization
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '"Pyramiding instructions appear on a dollar bill. Add smaller and smaller on
    the way up. Keep your eyes open at the top."'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: – Ed Seykota
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: The short side has a unique set of challenges. Successful shorts shrink. Positions
    need to be periodically topped up. Adding to an existing position is called **pyramiding**.
    Pyramiding is a delicate business.
  prefs: []
  type: TYPE_NORMAL
- en: On the one hand, trends mature. The probability of reversal increases with the
    passage of time. Risk per trade should therefore be reduced with each additional
    position. On the other hand, news flow deterioration validates the original bearish
    stance. Market participants are often tempted to sizably increase their bets.
    In my personal experience, every time market commentators start to agree with
    my stance and I start to feel intelligent, there is invariably a nasty bear market
    rally round the corner.
  prefs: []
  type: TYPE_NORMAL
- en: A simple way to mitigate the risk of entering a mature trend is to amortize
    risk for each new position. The following snippet of code is a suggestion to market
    participants who usually add to their positions. As risk increases with the passage
    of time, positions should be reduced.
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE10]'
  prefs: []
  type: TYPE_PRE
- en: 'Following the formulae is a numerical example. We start with a position size
    (`weight`) of 5%. We re-enter three times using the `np.arange` method. We then
    calculate the suggested weight size of 3 additions to the original position using
    various amortizations, receiving the following results:'
  prefs: []
  type: TYPE_NORMAL
- en: '[PRE11]'
  prefs: []
  type: TYPE_PRE
- en: '`linear` stands for no power. In the first additional tranche, the position
    size is ![](img/B17704_08_001.png) of the original position (`0.025`), the second
    tranche is ![](img/B17704_08_002.png), and so on. Using `square root` suggests
    a first additional tranche which is ![](img/B17704_08_003.png) times the size
    of the original position (`0.3535`), and a second position ![](img/B17704_08_004.png)
    times the size. `position n` suggests a first additional tranche of ![](img/B17704_08_005.png)
    times the size of the original position, the same as the linear tranche, and a
    second tranche ![](img/B17704_08_006.png) the size of the original position, the
    same as the square root amortization, and so on.'
  prefs: []
  type: TYPE_NORMAL
- en: Square root is probably a good compromise. It allows market participants to
    take substantial risks without facing the risk of ruin. Again, selling short is
    a position-sizing exercise, not a stock-picking contest. Small positions do not
    contribute. Big positions are risky. There is an optimal number, to which our
    inner idiot will be completely unresponsive anyways. Once again, market participants
    have the choice between being conservative or aggressive. There are old traders
    and bold traders. There are very few old bold traders.
  prefs: []
  type: TYPE_NORMAL
- en: False positives
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: Not all trades work the first time. Sometimes, it takes two or three trials
    for a stock to finally behave as expected. This takes a toll on the equity curve.
    Market participants are often tempted to overhaul and tweak their signal engines
    to reduce the frequency of false positives. Whilst there may be some value in
    working on the blindspots that generated bad trades, it is unquestionably healthier
    to accept that false positives are part of the journey as well. Randomness cannot
    be eliminated.
  prefs: []
  type: TYPE_NORMAL
- en: We are generally good at dealing with disappointments in other areas of life.
    When something does not work, we invest less time and effort into it. Similarly,
    the solution may not be yet another tweak of the signal engine. When stocks refuse
    to behave as expected, keep trying, just invest less. This comes down to the risk
    amortization function defined above. Amortize risk for every failed attempt.
  prefs: []
  type: TYPE_NORMAL
- en: Order prioritization and trade rejection
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: 'At some point, you will have more signals than money to invest. You will have
    to make tough choices and prioritize signals. The simplest order prioritization
    algorithm is size: the bigger the size, the higher the risk/reward. Rank all positions
    by absolute size in descending order. It is not the case that just because you
    are seated at your desk and the markets are open that you should trade with abandon.
    Choosing not to trade is an important trading decision.'
  prefs: []
  type: TYPE_NORMAL
- en: Trade rejection is an important tool in the arsenal of a short seller. On the
    long side, small holdings can mature into formidable positions. Bill Gates bought
    AAPL at $12 per stock in August 1997\. On the other hand, on the short side, a
    drop of -10% on a -0.50% position will only contribute -0.05%. This is hardly
    the kind of return that attracts investors. When positions are too tiny to hurt,
    they are also too small to contribute.
  prefs: []
  type: TYPE_NORMAL
- en: 'Reasons that could lead to taking small positions could be either:'
  prefs: []
  type: TYPE_NORMAL
- en: Performance has hit a "soft patch"
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: This particular strategy is out of favor now
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The side (long/short) is not working
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: The instrument itself has a frustratingly low win rate
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: There are already a few entries
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Whatever the reason, this is not a fat pitch, so you want to keep your powder
    dry.
  prefs: []
  type: TYPE_NORMAL
- en: Game theory in position sizing
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
- en: '"You can observe a lot by watching."'
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: ''
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: – Yogi Berra, great American philosopher
  prefs:
  - PREF_BQ
  type: TYPE_NORMAL
- en: 'Recent advances in computing technology have encouraged market participants
    to dabble in game theory, particularly at the stock selection level. Game theory
    is also well suited for position sizing. The difference is using game theory for
    entries comes down to a binary outcome: either in or not. There is little learning
    possible there because no-one keeps stats on the choices not made. Unless you
    are a creepy stalker, you do not keep tabs on the ex you did not marry.'
  prefs: []
  type: TYPE_NORMAL
- en: One of the main causes of equity curve erosion is false positives. Some stocks
    may have two or three false starts before finally taking off. Then, it takes time
    to repay those false starts. Meanwhile, some stocks do well on their first trial.
    In the probabilistic game called the stock market, there is no way of knowing
    which is going to be which in advance. Reward those that do well and amortize
    risk for those that do not is a simple heuristic. This is where game theory and
    a cute little story comes in.
  prefs: []
  type: TYPE_NORMAL
- en: 'Here is the story behind the algorithm we use to reward well-behaving stocks.
    Once I showed up early at school to pick up my children. My daughter was having
    fun playing a game that we all played as kids, so I just sat there and watched.
    Interestingly enough, she ended up winning not because she tried to predict anything,
    but because she methodically reacted after each turn. She mirrored the behavior
    of each participant: nice to those who were nice to her and vice versa, tit for
    tat. This made me think of a simple game theory heuristic.'
  prefs: []
  type: TYPE_NORMAL
- en: Fast-forward a few days of research on Google, it turned out that the tit-for-tat
    heuristic had repeatedly come first in game-theory algorithmic contests. Needless
    to say, this game theory module quickly found its way into our position-sizing
    approach, with the name of my daughter, "Alizee" (pronounced *Alizay*, French
    for *trade winds*). Tit-for-tat is a solid algorithm. Punish bad behavior and
    reward good behavior.
  prefs: []
  type: TYPE_NORMAL
- en: Summary
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Everyone wants to pick the next [insert buzz stock ticker here...]. Stock picking
    is sexy. If however, you choose to be in the markets to make money, then be a
    student of the boring arts. Money is made in the money management module. In this
    chapter, we unveiled a small function that delegates risk setting to the markets,
    and will durably change the quality of sleep for seasoned market participants.
  prefs: []
  type: TYPE_NORMAL
- en: Next, we will explore risk. On the short side, the market does not cooperate.
    Market Darwinism dictates that surviving short sellers demonstrate superior risk
    management.
  prefs: []
  type: TYPE_NORMAL

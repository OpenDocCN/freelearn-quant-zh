- en: '2'
  id: totrans-0
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Market and Fundamental Data – Sources and Techniques
  id: totrans-1
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
- en: Data has always been an essential driver of trading, and traders have long made
    efforts to gain an advantage from access to superior information. These efforts
    date back at least to the rumors that the House of Rothschild benefited handsomely
    from bond purchases upon advance news about the British victory at Waterloo, which
    was carried by pigeons across the channel.
  id: totrans-2
  prefs: []
  type: TYPE_NORMAL
- en: Today, investments in faster data access take the shape of the Go West consortium
    of leading **high-frequency trading** (**HFT**) firms that connects the **Chicago
    Mercantile Exchange** (**CME**) with Tokyo. The round-trip latency between the
    CME and the **BATS** (**Better Alternative Trading System**) exchanges in New
    York has dropped to close to the theoretical limit of eight milliseconds as traders
    compete to exploit arbitrage opportunities. At the same time, regulators and exchanges
    have started to introduce speed bumps that slow down trading to limit the adverse
    effects on competition of uneven access to information.
  id: totrans-3
  prefs: []
  type: TYPE_NORMAL
- en: Traditionally, investors mostly relied on **publicly available market and fundamental
    data**. Efforts to create or acquire private datasets, for example, through proprietary
    surveys, were limited. Conventional strategies focus on equity fundamentals and
    build financial models on reported financials, possibly combined with industry
    or macro data to project earnings per share and stock prices. Alternatively, they
    leverage **technical analysis** to extract signals from market data using indicators
    computed from price and volume information.
  id: totrans-4
  prefs: []
  type: TYPE_NORMAL
- en: '**Machine learning** (**ML**) algorithms promise to exploit market and fundamental
    data more efficiently than human-defined rules and heuristics, particularly when
    combined with **alternative data**, which is the topic of the next chapter. We
    will illustrate how to apply ML algorithms ranging from linear models to **recurrent
    neural networks** (**RNNs**) to market and fundamental data and generate tradeable
    signals.'
  id: totrans-5
  prefs: []
  type: TYPE_NORMAL
- en: This chapter introduces market and fundamental data sources and explains how
    they reflect the environment in which they are created. The details of the **trading
    environment** matter not only for the proper interpretation of market data but
    also for the design and execution of your strategy and the implementation of realistic
    backtesting simulations.
  id: totrans-6
  prefs: []
  type: TYPE_NORMAL
- en: We also illustrate how to access and work with trading and financial statement
    data from various sources using Python.
  id: totrans-7
  prefs: []
  type: TYPE_NORMAL
- en: 'In particular, this chapter will cover the following topics:'
  id: totrans-8
  prefs: []
  type: TYPE_NORMAL
- en: How market data reflects the structure of the trading environment
  id: totrans-9
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Working with trade and quote data at minute frequency
  id: totrans-10
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Reconstructing an order book from tick data using Nasdaq ITCH
  id: totrans-11
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Summarizing tick data using various types of bars
  id: totrans-12
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Working with **eXtensible Business Reporting Language** (**XBRL**)-encoded electronic
    filings
  id: totrans-13
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: Parsing and combining market and fundamental data to create a **price-to-earnings**
    (**P/E**) series
  id: totrans-14
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
- en: How to access various market and fundamental data sources using Python
  id: totrans-15
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 如何使用 Python 访问各种市场和基本数据源
- en: You can find the code samples for this chapter and links to additional resources
    in the corresponding directory of the GitHub repository. The notebooks include
    color versions of the images.
  id: totrans-16
  prefs: []
  type: TYPE_NORMAL
  zh: 您可以在 GitHub 仓库的相应目录中找到本章的代码示例和额外资源的链接。笔记本包括图像的彩色版本。
- en: Market data reflects its environment
  id: totrans-17
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 市场数据反映了其环境
- en: Market data is the product of how traders place orders for a financial instrument
    directly or through intermediaries on one of the numerous marketplaces, how they
    are processed, and how prices are set by matching demand and supply. As a result,
    the data reflects the institutional environment of trading venues, including the
    rules and regulations that govern orders, trade execution, and price formation.
    See Harris (2003) for a global overview and Jones (2018) for details on the U.S.
    market.
  id: totrans-18
  prefs: []
  type: TYPE_NORMAL
  zh: 市场数据是交易者直接或通过中介在众多市场之一下订单的产品，以及订单是如何处理以及价格是如何通过匹配需求和供给来确定的。因此，数据反映了交易场所的制度环境，包括管理订单、交易执行和价格形成的规则和法规。详细全球概览请参阅
    Harris (2003)，美国市场的详细信息请参阅 Jones (2018)。
- en: Algorithmic traders use algorithms, including ML, to analyze the flow of buy
    and sell orders and the resulting volume and price statistics to extract trade
    signals that capture insights into, for example, demand-supply dynamics or the
    behavior of certain market participants.
  id: totrans-19
  prefs: []
  type: TYPE_NORMAL
  zh: 算法交易者使用算法，包括机器学习，来分析买卖订单流动以及由此产生的交易量和价格统计数据，以提取捕捉洞察力的交易信号，例如需求供给动态或特定市场参与者的行为。
- en: We will first review institutional features that impact the simulation of a
    trading strategy during a backtest before we start working with actual tick data
    created by one such environment, namely Nasdaq.
  id: totrans-20
  prefs: []
  type: TYPE_NORMAL
  zh: 在我们开始使用由纳斯达克这样的环境创建的实际刻度数据之前，我们将首先回顾在回测期间影响交易策略模拟的制度特征。
- en: Market microstructure – the nuts and bolts
  id: totrans-21
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 市场微观结构 – 细枝末节
- en: Market microstructure studies how the **institutional environment** affects
    the trading process and shapes outcomes like price discovery, bid-ask spreads
    and quotes, intraday trading behavior, and transaction costs (Madhavan 2000; 2002).
    It is one of the fastest-growing fields of financial research, propelled by the
    rapid development of algorithmic and electronic trading.
  id: totrans-22
  prefs: []
  type: TYPE_NORMAL
  zh: 市场微观结构研究了**制度环境**如何影响交易过程，以及形成价格发现、买卖报价和报价、日内交易行为以及交易成本等结果（Madhavan 2000; 2002）。它是金融研究中增长最快的领域之一，受到算法交易和电子交易的快速发展推动。
- en: Today, hedge funds sponsor in-house analysts to track the rapidly evolving,
    complex details and ensure execution at the best possible market prices and design
    strategies that exploit market frictions. We will provide only a brief overview
    of these key concepts before we dive into the data generated by trading. The references
    contain several sources that treat this subject in great detail.
  id: totrans-23
  prefs: []
  type: TYPE_NORMAL
  zh: 如今，对冲基金赞助内部分析师跟踪快速发展的、复杂的细节，并确保以最佳市场价格执行，并设计利用市场摩擦的策略。在我们深入研究交易生成的数据之前，我们将简要概述这些关键概念。参考文献中包含了许多详细介绍这一主题的来源。
- en: How to trade – different types of orders
  id: totrans-24
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何交易 – 不同类型的订单
- en: Traders can place various types of buy or sell orders. Some orders guarantee
    immediate execution, while others may state a price threshold or other conditions
    that trigger execution. Orders are typically valid for the same trading day unless
    specified otherwise.
  id: totrans-25
  prefs: []
  type: TYPE_NORMAL
  zh: 交易者可以下不同类型的买入或卖出订单。有些订单保证立即执行，而其他订单可能说明价格阈值或触发执行的其他条件。订单通常在同一交易日有效，除非另有说明。
- en: A *market order* is intended for immediate execution of the order upon arrival
    at the trading venue, at the price that prevails at that moment. In contrast,
    a *limit order* only executes if the market price is higher than the limit for
    a sell limit order, or lower than the limit for a buy limit order. A *stop order*,
    in turn, only becomes active when the market price rises above a specified price
    for a buy stop order, or falls below a specified price for a sell order. A *buy
    stop order* can be used to limit the losses of short sales. Stop orders may also
    have limits.
  id: totrans-26
  prefs: []
  type: TYPE_NORMAL
  zh: '*市价订单*旨在在到达交易场所时立即执行订单，以当时的价格执行。相比之下，*限价订单*仅在市场价格高于卖出限价订单的限价或低于买入限价订单的限价时执行。*止损订单*则仅在市场价格升至指定价格以上时对买入止损订单生效，或降至指定价格以下时对卖出订单生效。*买入止损订单*可用于限制空头交易的损失。止损订单也可能有限制条件。'
- en: Numerous other conditions can be attached to orders. For example, *all or none
    orders* prevent partial execution; they are filled only if a specified number
    of shares is available and can be valid for a day or longer. They require special
    handling and are not visible to market participants. *Fill or kill orders* also
    prevent partial execution but cancel if not executed immediately. *Immediate or
    cancel orders* immediately buy or sell the number of shares that are available
    and cancel the remainder. *Not-held orders* allow the broker to decide on the
    time and price of execution. Finally, the market on *open/close orders* executes
    on or near the opening or closing of the market. Partial executions are allowed.
  id: totrans-27
  prefs: []
  type: TYPE_NORMAL
  zh: 订单可以附加许多其他条件。例如，*全部或无*订单防止部分执行；只有指定数量的股票可用时才会填充，并且可以有效期一天或更长时间。它们需要特殊处理，并且对市场参与者不可见。*全部成交或取消*订单也防止部分执行，但如果立即未执行则取消。*立即成交或取消*订单立即购买或出售可用数量的股票，并取消剩余部分。*不指定时间的*订单允许经纪人决定执行的时间和价格。最后，市场在
    *开盘/收盘* 订单在市场开盘或收盘时执行或接近执行。部分执行是允许的。
- en: Where to trade – from exchanges to dark pools
  id: totrans-28
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 何处交易 - 从交易所到深池
- en: Securities trade in highly organized and **regulated exchanges** or with varying
    degrees of formality in **over-the-counter** (**OTC**) markets. An exchange is
    a central marketplace where buyers and sellers compete for the lowest ask and
    highest bid, respectively. Exchange regulations typically impose listing and reporting
    requirements to create transparency and attract more traders and liquidity. OTC
    markets, such as the Best Market (OTCQX) or the Venture Market (OTCQB), often
    have lower regulatory barriers. As a result, they are suitable for a far broader
    range of securities, including bonds or **American Depositary Receipts** (**ADRs**;
    equity listed on a foreign exchange, for example, for Nestlé, S.A.).
  id: totrans-29
  prefs: []
  type: TYPE_NORMAL
  zh: '证券在高度组织化和**受监管的交易所**交易，或者在**场外交易**（**OTC**）市场以不同程度的形式交易。交易所是买家和卖家竞争最低的要价和最高的出价的中央市场。交易所监管通常会实施上市和报告要求，以创建透明度并吸引更多的交易者和流动性。场外交易市场，例如最佳市场（OTCQX）或风险市场（OTCQB），通常具有较低的监管壁垒。因此，它们适用于更广泛范围的证券，包括债券或**美国存托凭证**（**ADRs**；例如，在外国交易所上市的股票，例如雀巢公司）。  '
- en: Exchanges may rely on bilateral trading or centralized order-driven systems
    that match all buy and sell orders according to certain rules. Many exchanges
    use intermediaries that provide liquidity by making markets in certain securities.
    These **intermediaries** include dealers that act as principals on their own behalf
    and brokers that trade as agents on behalf of others. **Price formation** may
    occur through auctions, such as in the **New York Stock Exchange** (**NYSE**),
    where the highest bid and lowest offer are matched, or through dealers who buy
    from sellers and sell to buyers.
  id: totrans-30
  prefs: []
  type: TYPE_NORMAL
  zh: '交易所可能依靠双边交易或根据特定规则匹配所有买入和卖出订单的集中式订单驱动系统。许多交易所使用提供流动性的中介，这些**中介**包括充当自己代理的交易商和代表他人交易的经纪人。**价格形成**可能通过拍卖进行，例如在**纽约证券交易所**（**NYSE**）中，最高的出价和最低的要价被匹配，或者通过从卖方手中购买并向买方出售的交易商进行。  '
- en: Back in the day, companies either registered and traded mostly on the NYSE,
    or they traded on OTC markets like Nasdaq. On the NYSE, a sole **specialist**
    intermediated trades of a given security. The specialist received buy and sell
    orders via a broker and tracked limit orders in a central order book. Limit orders
    were executed with a priority based on price and time. Buy market orders routed
    to the specialist transacted with the lowest ask (and sell market orders routed
    to the specialist transacted with the highest bid) in the limit order book, prioritizing
    earlier limit orders in the case of ties. Access to all orders in the central
    order book allowed the specialist to publish the best bid, ask prices, and set
    market prices based on the overall buy-sell imbalance.
  id: totrans-31
  prefs: []
  type: TYPE_NORMAL
  zh: 从前，公司要么在纽约证券交易所（NYSE）注册并进行交易，要么在场外交易市场如纳斯达克进行交易。在纽约证券交易所，一位**专家**负责中介特定证券的交易。专家通过经纪人接收买入和卖出订单，并在一个中央订单簿中跟踪限价订单。限价订单根据价格和时间优先执行。买入市价订单被路由到专家以与限价订单簿中最低的要价成交（卖出市价订单被路由到专家以与最高的出价成交），在平局的情况下优先考虑较早的限价订单。专家可以访问中央订单簿中的所有订单，从而公布最佳买价、卖价，并根据整体买卖失衡情况设置市场价格。
- en: On Nasdaq, multiple **market makers** facilitated stock trades. Each dealer
    provided their best bid and ask price to a central quotation system and stood
    ready to transact the specified number of shares at the specified prices. Traders
    would route their orders to the market maker with the best quote via their broker.
    The competition for orders made execution at fair prices very likely. Market makers
    ensured a fair and orderly market, provided liquidity, and disseminated prices
    like specialists but only had access to the orders routed to them as opposed to
    market-wide supply and demand. This fragmentation could create difficulties in
    identifying fair value market prices.
  id: totrans-32
  prefs: []
  type: TYPE_NORMAL
  zh: 在纳斯达克，多个**市场创造者**促成了股票交易。每个经销商都向中央行情系统提供他们的最佳买入和卖出价格，并准备按指定价格以及指定数量进行交易。交易员通过他们的经纪人将订单路由到最佳报价的市场创造者处。订单的竞争很可能使执行价格公平。市场创造者确保了一个公平和有序的市场，提供了流动性，并像专家一样传播价格，但只能访问路由到他们的订单，而不是整个市场的供需。这种碎片化可能会导致难以确定公平价值市场价格的困难。
- en: Today, **trading has fragmented**; instead of two principal venues in the US,
    there are more than thirteen displayed trading venues, including exchanges and
    (unregulated) **alternative trading systems** (**ATSs**) such as **electronic
    communication networks** (**ECNs**). Each reports trades to the consolidated tape,
    but at different latencies. To make matters more difficult, the rules of engagement
    for each venue differ with several different pricing and queuing models.
  id: totrans-33
  prefs: []
  type: TYPE_NORMAL
  zh: 如今，**交易已经分散**；在美国，不再只有两个主要的交易场所，而是有十三个以上的展示交易场所，包括交易所和（未受监管的）**另类交易系统**（**ATSs**），如**电子通讯网络**（**ECNs**）。每个场所以不同的延迟报告交易到综合带，但规则不同，有多种不同的定价和排队模型。
- en: 'The following table lists some of the larger global exchanges and the trading
    volumes for the 12 months ending 03/2018 in various asset classes, including derivatives.
    Typically, a minority of financial instruments account for most trading:'
  id: totrans-34
  prefs: []
  type: TYPE_NORMAL
  zh: 下表列出了一些较大的全球交易所及截至 03/2018 12 个月的各类资产交易量，包括衍生品。通常，少数金融工具占据了大部分交易：
- en: '| Exchange | Stocks |'
  id: totrans-35
  prefs: []
  type: TYPE_TB
  zh: '| 交易所 | 股票 |'
- en: '| Market cap (USD mn) | # Listed companies | Volume / day (USD mn) | # Shares
    / day (''000) | # Options / day (''000) |'
  id: totrans-36
  prefs: []
  type: TYPE_TB
  zh: '| 市值（亿美元） | 上市公司数量 | 每日交易量（万美元） | 每日股票交易量（''000） | 每日期权交易量（''000） |'
- en: '| NYSE | 23,138,626 | 2,294 | 78,410 | 6,122 | 1,546 |'
  id: totrans-37
  prefs: []
  type: TYPE_TB
  zh: '| 纽约证券交易所 | 23,138,626 | 2,294 | 78,410 | 6,122 | 1,546 |'
- en: '| Nasdaq — US | 10,375,718 | 2,968 | 65,026 | 7,131 | 2,609 |'
  id: totrans-38
  prefs: []
  type: TYPE_TB
  zh: '| 纳斯达克 - 美国 | 10,375,718 | 2,968 | 65,026 | 7,131 | 2,609 |'
- en: '| Japan Exchange Group Inc. | 6,287,739 | 3,618 | 28,397 | 3,361 | 1 |'
  id: totrans-39
  prefs: []
  type: TYPE_TB
  zh: '| 日本交易所集团公司 | 6,287,739 | 3,618 | 28,397 | 3,361 | 1 |'
- en: '| Shanghai Stock Exchange | 5,022,691 | 1,421 | 34,736 | 9,801 |  |'
  id: totrans-40
  prefs: []
  type: TYPE_TB
  zh: '| 上海证券交易所 | 5,022,691 | 1,421 | 34,736 | 9,801 |  |'
- en: '| Euronext | 4,649,073 | 1,240 | 9,410 | 836 | 304 |'
  id: totrans-41
  prefs: []
  type: TYPE_TB
  zh: '| 欧洲交易所 | 4,649,073 | 1,240 | 9,410 | 836 | 304 |'
- en: '| Hong Kong Exchanges and Clearing | 4,443,082 | 2,186 | 12,031 | 1,174 | 516
    |'
  id: totrans-42
  prefs: []
  type: TYPE_TB
  zh: '| 香港交易及结算所 | 4,443,082 | 2,186 | 12,031 | 1,174 | 516 |'
- en: '| LSE Group | 3,986,413 | 2,622 | 10,398 | 1,011 |  |'
  id: totrans-43
  prefs: []
  type: TYPE_TB
  zh: '| 伦敦证券交易所集团 | 3,986,413 | 2,622 | 10,398 | 1,011 |  |'
- en: '| Shenzhen Stock Exchange | 3,547,312 | 2,110 | 40,244 | 14,443 |  |'
  id: totrans-44
  prefs: []
  type: TYPE_TB
  zh: '| 深圳证券交易所 | 3,547,312 | 2,110 | 40,244 | 14,443 |  |'
- en: '| Deutsche Boerse AG | 2,339,092 | 506 | 7,825 | 475 |  |'
  id: totrans-45
  prefs: []
  type: TYPE_TB
  zh: '| 德国交易所 | 2,339,092 | 506 | 7,825 | 475 |  |'
- en: '| BSE India Limited | 2,298,179 | 5,439 | 602 | 1,105 |  |'
  id: totrans-46
  prefs: []
  type: TYPE_TB
  zh: '| 印度孟买证券交易所有限公司 | 2,298,179 | 5,439 | 602 | 1,105 |  |'
- en: '| National Stock Exchange of India Limited | 2,273,286 | 1,952 | 5,092 | 10,355
    |  |'
  id: totrans-47
  prefs: []
  type: TYPE_TB
  zh: '| 印度国家证券交易所有限公司 | 2,273,286 | 1,952 | 5,092 | 10,355 |  |'
- en: '| BATS Global Markets - US |  |  |  |  | 1,243 |'
  id: totrans-48
  prefs: []
  type: TYPE_TB
  zh: '| BATS 全球市场 - 美国 |  |  |  |  | 1,243 |'
- en: '| Chicago Board Options Exchange |  |  |  |  | 1,811 |'
  id: totrans-49
  prefs: []
  type: TYPE_TB
  zh: '| 芝加哥期权交易所 |  |  |  |  | 1,811 |'
- en: '| International Securities Exchange |  |  |  |  | 1,204 |'
  id: totrans-50
  prefs: []
  type: TYPE_TB
  zh: '| 国际证券交易所 |  |  |  |  | 1,204 |'
- en: The ATSs mentioned previously include dozens of **dark pools** that allow traders
    to execute anonymously. They are estimated to account for 40 percent of all U.S.
    stock trades in 2017, compared with an estimated 16 percent in 2010\. Dark pools
    emerged in the 1980s when the SEC allowed brokers to match buyers and sellers
    of big blocks of shares. The rise of high-frequency electronic trading and the
    2007 SEC Order Protection rule that intended to spur competition and cut transaction
    costs through transparency as part of **Regulation National Market System** (**Reg
    NMS**) drove the growth of dark pools, as traders aimed to avoid the visibility
    of large trades (Mamudi 2017). Reg NMS also established the **National Best Bid
    and Offer** (**NBBO**) mandate for brokers to route orders to venues that offer
    the best price.
  id: totrans-51
  prefs: []
  type: TYPE_NORMAL
  zh: 前面提到的ATS包括数十个允许交易者匿名执行的**暗池**。据估计，2017年，暗池交易占所有美国股票交易的40％，而2010年估计为16％。暗池出现在20世纪80年代，当时SEC允许经纪人匹配大宗股票的买方和卖方。高频电子交易的兴起和2007年SEC颁布的旨在通过透明度刺激竞争并削减交易成本的规则，作为**全国市场体系监管**（**Reg
    NMS**）的一部分，推动了暗池的增长，因为交易者旨在避免大宗交易的可见性（Mamudi 2017）。Reg NMS还建立了**国家最佳买卖价**（**NBBO**）的要求，要求经纪人将订单路由到提供最佳价格的交易场所。
- en: Some ATSs are called dark pools because they do not broadcast pre-trade data,
    including the presence, price, and amount of buy and sell orders as traditional
    exchanges are required to do. However, dark pools report information about trades
    to the **Financial Industry Regulatory Authority** (**FINRA**) after they occur.
    As a result, dark pools do not contribute to the process of price discovery until
    after trade execution but provide protection against various HFT strategies outlined
    in the first chapter.
  id: totrans-52
  prefs: []
  type: TYPE_NORMAL
  zh: 一些ATS被称为暗池，因为它们不广播预先交易的数据，包括传统交易所需要做的买卖订单的存在、价格和数量。然而，暗池在交易发生后向**金融业监管局**（**FINRA**）报告有关交易的信息。因此，暗池在交易执行之后才开始对价格发现过程产生影响，但在第一章中列出的各种高频交易策略提供了保护。
- en: In the next section, we will see how market data captures trading activity and
    reflect the institutional infrastructure in U.S. markets.
  id: totrans-53
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一节中，我们将看到市场数据如何捕捉交易活动并反映美国市场的机构基础设施。
- en: Working with high-frequency data
  id: totrans-54
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 处理高频数据
- en: 'Two categories of market data cover the thousands of companies listed on U.S.
    exchanges that are traded under Reg NMS: the **consolidated feed** combines trade
    and quote data from each trading venue, whereas each individual exchange offers
    **proprietary products** with additional activity information for that particular
    venue.'
  id: totrans-55
  prefs: []
  type: TYPE_NORMAL
  zh: 两类市场数据涵盖了在美国交易所上市的数千家公司，这些公司在Reg NMS下交易：**整合信息源**将来自每个交易场所的交易和报价数据合并在一起，而每个独立的交易所则提供了**专有产品**，其中包含了该特定场所的额外活动信息。
- en: In this section, we will first present proprietary order flow data provided
    by Nasdaq that represents the actual stream of orders, trades, and resulting prices
    as they occur on a tick-by-tick basis. Then, we will demonstrate how to regularize
    this continuous stream of data that arrives at irregular intervals into bars of
    a fixed duration. Finally, we will introduce AlgoSeek's equity minute bar data,
    which contains consolidated trade and quote information. In each case, we will
    illustrate how to work with the data using Python so that you can leverage these
    sources for your trading strategy.
  id: totrans-56
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们首先会展示纳斯达克提供的专有订单流数据，该数据代表了订单、交易和随之发生的价格的实际流动，按tick逐步进行。然后，我们将演示如何将这个连续的、不定时间到达的数据流规范化为固定时间间隔的条形图。最后，我们将介绍AlgoSeek的股票分钟条数据，其中包含了整合的交易和报价信息。在每种情况下，我们都将说明如何使用Python处理这些数据，以便您可以为您的交易策略利用这些来源。
- en: How to work with Nasdaq order book data
  id: totrans-57
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 如何处理纳斯达克订单簿数据
- en: The **primary source of market data** is the order book, which updates in real
    time throughout the day to reflect all trading activity. Exchanges typically offer
    this data as a real-time service for a fee; however, they may provide some historical
    data for free.
  id: totrans-58
  prefs: []
  type: TYPE_NORMAL
  zh: '**市场数据的主要来源**是订单簿，它在整个交易日实时更新以反映所有交易活动。交易所通常以实时服务的形式提供这些数据，收费；然而，它们可能免费提供一些历史数据。'
- en: 'In the United States, stock markets provide quotes in three tiers, namely Level
    L1, L2, and L3, that offer increasingly granular information and capabilities:'
  id: totrans-59
  prefs: []
  type: TYPE_NORMAL
  zh: 在美国，股票市场提供了三个层次的报价，即一级、二级和三级，这些报价提供了越来越细化的信息和功能：
- en: '**Level 1 (L1)**: Real-time bid- and ask-price information, as available from
    numerous online sources.'
  id: totrans-60
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**一级（L1）**：实时的买卖价信息，可从众多在线来源获取。'
- en: '**Level 2 (L2)**: Adds information about bid and ask prices by specific market
    makers as well as the size and time of recent transactions for better insights
    into the liquidity of a given equity.'
  id: totrans-61
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**二级（L2）**：提供特定市场做市商的买入和卖出价格信息，以及最近交易的规模和时间，以更好地了解给定股票的流动性。'
- en: '**Level 3 (L3)**: Adds the ability to enter or change quotes, execute orders,
    and confirm trades and is available only to market makers and exchange member
    firms. Access to Level 3 quotes permits registered brokers to meet best execution
    requirements.'
  id: totrans-62
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**三级（L3）**：增加了输入或更改报价、执行订单和确认交易的能力，仅提供给市场做市商和交易所成员公司。访问三级报价允许注册经纪人满足最佳执行要求。'
- en: The trading activity is reflected in numerous **messages about orders** sent
    by market participants. These messages typically conform to the **electronic Financial
    Information eXchange** (**FIX**) communications protocol for the real-time exchange
    of securities transactions and market data or a native exchange protocol.
  id: totrans-63
  prefs: []
  type: TYPE_NORMAL
  zh: 交易活动反映在由市场参与者发送的众多 **订单消息** 中。这些消息通常符合电子金融信息交换 (**FIX**) 通信协议，用于证券交易和市场数据的实时交换，或者符合本地交易所协议。
- en: Communicating trades with the FIX protocol
  id: totrans-64
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 用 FIX 协议进行交易通信
- en: Just like SWIFT is the message protocol for back-office (for example, in trade-settlement)
    messaging, the FIX protocol is the **de facto messaging standard** for communication
    before and during trade executions between exchanges, banks, brokers, clearing
    firms, and other market participants. Fidelity Investments and Salomon Brothers
    introduced FIX in 1992 to facilitate the electronic communication between broker-dealers
    and institutional clients who, until then, exchanged information over the phone.
  id: totrans-65
  prefs: []
  type: TYPE_NORMAL
  zh: 就像 SWIFT 是后台（例如在交易结算中）消息传递的消息协议一样，FIX 协议是交易执行前和期间交易所、银行、经纪商、清算公司和其他市场参与者之间的
    **事实上的消息标准**，富达投资和所罗门兄弟于 1992 年引入了 FIX，以便促进经纪商和机构客户之间的电子通信，而之前，他们是通过电话交换信息的。
- en: It became popular in global equity markets before expanding into foreign exchange,
    fixed income and derivatives markets, and further into post-trade to support straight-through
    processing. Exchanges provide access to FIX messages as a real-time data feed
    that is **parsed by algorithmic traders** to track market activity and, for example,
    identify the footprint of market participants and anticipate their next move.
  id: totrans-66
  prefs: []
  type: TYPE_NORMAL
  zh: 它在全球股票市场中变得流行，然后扩展到外汇、固定收益和衍生品市场，进一步进入后期交易以支持一键处理。交易所提供 FIX 消息的访问作为实时数据源，由算法交易员进行解析，以跟踪市场活动，并且，例如，识别市场参与者的足迹并预测他们的下一步行动。
- en: The sequence of messages allows for the **reconstruction of the order book**.
    The scale of transactions across numerous exchanges creates a large amount (~10
    TB) of unstructured data that is challenging to process and, hence, can be a source
    of competitive advantage.
  id: totrans-67
  prefs: []
  type: TYPE_NORMAL
  zh: 消息序列允许 **重建订单簿**。跨多个交易所的交易规模产生了大量（~10 TB）难以处理的非结构化数据，因此可能成为竞争优势的来源。
- en: The FIX protocol, currently at version 5.0, is a free and open standard with
    a large community of affiliated industry professionals. It is self-describing,
    like the more recent XML, and a FIX session is supported by the underlying **Transmission
    Control Protocol** (**TCP**) layer. The community continually adds new functionality.
  id: totrans-68
  prefs: []
  type: TYPE_NORMAL
  zh: FIX 协议，目前版本为 5.0，是一个具有庞大关联行业专业人士社区的免费开放标准。它是自描述的，类似于较新的 XML，FIX 会话由底层的 **传输控制协议**
    (**TCP**) 层支持。社区不断添加新功能。
- en: 'The protocol supports pipe-separated key-value pairs, as well as a **tag-based
    FIXML** syntax. A sample message that requests a server login would look as follows:'
  id: totrans-69
  prefs: []
  type: TYPE_NORMAL
  zh: 该协议支持管道分隔的键值对，以及基于标签的 FIXML 语法。一个请求服务器登录的示例消息如下所示：
- en: '[PRE0]'
  id: totrans-70
  prefs: []
  type: TYPE_PRE
  zh: '[PRE0]'
- en: There are a few open source FIX implementations in Python that can be used to
    formulate and parse FIX messages. The service provider Interactive Brokers offers
    a FIX-based **computer-to-computer interface** (**CTCI**) for automated trading
    (refer to the resources section for this chapter in the GitHub repository).
  id: totrans-71
  prefs: []
  type: TYPE_NORMAL
  zh: Python 中有一些开源的 FIX 实现，可用于构建和解析 FIX 消息。服务提供商 Interactive Brokers 提供了一种基于 FIX
    的 **计算机对计算机接口** (**CTCI**) 用于自动化交易（参见 GitHub 仓库本章的资源部分）。
- en: The Nasdaq TotalView-ITCH data feed
  id: totrans-72
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 纳斯达克 TotalView-ITCH 数据源
- en: While FIX has a dominant market share, exchanges also offer native protocols.
    Nasdaq offers a TotalView-ITCH **direct data-feed protocol**, which allows subscribers
    to **track individual orders** for equity instruments from placement to execution
    or cancellation.
  id: totrans-73
  prefs: []
  type: TYPE_NORMAL
  zh: 虽然 FIX 占据主导市场份额，但交易所也提供原生协议。纳斯达克提供了一种名为 TotalView-ITCH 的**直接数据反馈协议**，允许订阅者从下单到执行或取消跟踪股票工具的个别订单。
- en: Historical records of this data flow permit the reconstruction of the order
    book that keeps track of the active limit orders for a specific security. The
    order book reveals the **market depth** throughout the day by listing the number
    of shares being bid or offered at each price point. It may also identify the market
    participant responsible for specific buy and sell orders unless they are placed
    anonymously. Market depth is a key indicator of liquidity and the **potential
    price impact** of sizable market orders.
  id: totrans-74
  prefs: []
  type: TYPE_NORMAL
  zh: 此数据流的历史记录允许重建特定证券的订单簿，该订单簿跟踪活跃限价订单。订单簿通过列出每个价格点出价或要约的股票数量来揭示一天中的**市场深度**。它还可能确定特定买入和卖出订单的市场参与者，除非它们是匿名下单的。市场深度是流动性和大额市场订单的**潜在价格影响**的关键指标。
- en: In addition to matching market and limit orders, Nasdaq also operates **auctions
    or crosses** that execute a large number of trades at market opening and closing.
    Crosses are becoming more important as passive investing continues to grow and
    traders look for opportunities to execute larger blocks of stock. TotalView also
    disseminates the **Net Order Imbalance Indicator** (**NOII**) for Nasdaq opening
    and closing crosses and Nasdaq IPO/Halt Cross.
  id: totrans-75
  prefs: []
  type: TYPE_NORMAL
  zh: 除了匹配市价和限价订单外，纳斯达克还进行**拍卖或交叉交易**，在市场开盘和收盘时执行大量交易。随着被动投资继续增长，交叉交易变得越来越重要，交易者寻找执行更大的股票交易的机会。TotalView
    还传播纳斯达克开盘和收盘交叉以及纳斯达克 IPO/停牌交叉的**净订单不平衡指示器**（**NOII**）。
- en: How to parse binary order messages
  id: totrans-76
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 如何解析二进制订单消息
- en: The ITCH v5.0 specification declares over 20 message types related to system
    events, stock characteristics, the placement and modification of limit orders,
    and trade execution. It also contains information about the net order imbalance
    before the open and closing cross.
  id: totrans-77
  prefs: []
  type: TYPE_NORMAL
  zh: ITCH v5.0 规范声明了与系统事件、股票特性、限价订单的下单和修改以及交易执行相关的20多种消息类型。它还包含了开盘和收盘交叉前的净订单不平衡信息。
- en: Nasdaq offers samples of daily binary files for several months. The GitHub repository
    for this chapter contains a notebook, `parse_itch_order_flow_messages.ipynb`,
    that illustrates how to download and parse a sample file of ITCH messages. The
    notebook `rebuild_nasdaq_order_book.ipynb` then goes on to reconstruct both the
    executed trades and the order book for any given ticker.
  id: totrans-78
  prefs: []
  type: TYPE_NORMAL
  zh: 纳斯达克提供了数个月的每日二进制文件样本。本章的 GitHub 存储库包含一个笔记本，`parse_itch_order_flow_messages.ipynb`，演示了如何下载和解析
    ITCH 消息的样本文件。然后笔记本 `rebuild_nasdaq_order_book.ipynb` 继续重建给定股票的已执行交易和订单簿。
- en: 'The following table shows the frequency of the **most common message types**
    for the sample file date October 30, 2019:'
  id: totrans-79
  prefs: []
  type: TYPE_NORMAL
  zh: 下表显示了2019年10月30日样本文件中**最常见的消息类型**的频率：
- en: '| Message type | Order book impact | Number of messages |'
  id: totrans-80
  prefs: []
  type: TYPE_TB
  zh: '| 消息类型 | 订单簿影响 | 消息数量 |'
- en: '| A | New unattributed limit order | 127,214,649 |'
  id: totrans-81
  prefs: []
  type: TYPE_TB
  zh: '| A | 新的无属性限价订单 | 127,214,649 |'
- en: '| D | Order canceled | 123,296,742 |'
  id: totrans-82
  prefs: []
  type: TYPE_TB
  zh: '| D | 订单取消 | 123,296,742 |'
- en: '| U | Order canceled and replaced | 25,513,651 |'
  id: totrans-83
  prefs: []
  type: TYPE_TB
  zh: '| U | 订单取消并替换 | 25,513,651 |'
- en: '| E | Full or partial execution; possibly multiple messages for the same original
    order | 7,316,703 |'
  id: totrans-84
  prefs: []
  type: TYPE_TB
  zh: '| E | 全部或部分执行；原始订单可能有多条消息 | 7,316,703 |'
- en: '| X | Modified after partial cancellation | 3,568,735 |'
  id: totrans-85
  prefs: []
  type: TYPE_TB
  zh: '| X | 部分取消后修改 | 3,568,735 |'
- en: '| F | Add attributed order | 1,423,908 |'
  id: totrans-86
  prefs: []
  type: TYPE_TB
  zh: '| F | 添加属性订单 | 1,423,908 |'
- en: '| P | Trade message (non-cross) | 1,525,363 |'
  id: totrans-87
  prefs: []
  type: TYPE_TB
  zh: '| P | 交易消息（非交叉） | 1,525,363 |'
- en: '| C | Executed in whole or in part at a price different from the initial display
    price | 129,729 |'
  id: totrans-88
  prefs: []
  type: TYPE_TB
  zh: '| C | 在与初始显示价格不同的价格全部或部分执行 | 129,729 |'
- en: '| Q | Cross trade message | 17,775 |'
  id: totrans-89
  prefs: []
  type: TYPE_TB
  zh: '| Q | 交叉交易消息 | 17,775 |'
- en: 'For each message, the **specification** lays out the components and their respective
    length and data types:'
  id: totrans-90
  prefs: []
  type: TYPE_NORMAL
  zh: 对于每条消息，**规范**详细说明了组件及其相应的长度和数据类型：
- en: '| Name | Offset | Length | Value | Notes |'
  id: totrans-91
  prefs: []
  type: TYPE_TB
  zh: '| 名称 | 偏移量 | 长度 | 值 | 注释 |'
- en: '| Message type | 0 | 1 | S | System event message. |'
  id: totrans-92
  prefs: []
  type: TYPE_TB
  zh: '| 消息类型 | 0 | 1 | S | 系统事件消息。 |'
- en: '| Stock locate | 1 | 2 | Integer | Always 0. |'
  id: totrans-93
  prefs: []
  type: TYPE_TB
  zh: '| 股票定位 | 1 | 2 | 整数 | 始终为0。 |'
- en: '| Tracking number | 3 | 2 | Integer | Nasdaq internal tracking number. |'
  id: totrans-94
  prefs: []
  type: TYPE_TB
  zh: '| 跟踪号 | 3 | 2 | 整数 | 纳斯达克内部跟踪号。 |'
- en: '| Timestamp | 5 | 6 | Integer | The number of nanoseconds since midnight. |'
  id: totrans-95
  prefs: []
  type: TYPE_TB
  zh: '| 时间戳 | 5 | 6 | 整数 | 从午夜开始的纳秒数。 |'
- en: '| Order reference number | 11 | 8 | Integer | The unique reference number assigned
    to the new order at the time of receipt. |'
  id: totrans-96
  prefs: []
  type: TYPE_TB
  zh: '| 订单参考号 | 11 | 8 | 整数 | 在接收时分配给新订单的唯一参考号。 |'
- en: '| Buy/sell indicator | 19 | 1 | Alpha | The type of order being added: B =
    Buy Order, and S = Sell Order. |'
  id: totrans-97
  prefs: []
  type: TYPE_TB
  zh: '| 买/卖指示符 | 19 | 1 | Alpha | 正在添加的订单类型：B = 买入订单，S = 卖出订单。 |'
- en: '| Shares | 20 | 4 | Integer | The total number of shares associated with the
    order being added to the book. |'
  id: totrans-98
  prefs: []
  type: TYPE_TB
  zh: '| 股票数量 | 20 | 4 | 整数 | 与要添加到订单簿中的订单相关联的股票总数。 |'
- en: '| Stock | 24 | 8 | Alpha | Stock symbol, right - padded with spaces. |'
  id: totrans-99
  prefs: []
  type: TYPE_TB
  zh: '| 股票 | 24 | 8 | Alpha | 股票代码，右侧用空格填充。 |'
- en: '| Price | 32 | 4 | Price (4) | The display price of the new order. Refer to
    *Data Types* in the specification for field processing notes. |'
  id: totrans-100
  prefs: []
  type: TYPE_TB
  zh: '| 价格 | 32 | 4 | 价格 (4) | 新订单的显示价格。请参阅规范中的*数据类型*以获取字段处理注意事项。 |'
- en: '| Attribution | 36 | 4 | Alpha | The Nasdaq market participant identifier associated
    with the entered order. |'
  id: totrans-101
  prefs: []
  type: TYPE_TB
  zh: '| 归因 | 36 | 4 | Alpha | 与输入订单相关联的纳斯达克市场参与者标识符。 |'
- en: Python provides the `struct` module to parse binary data using format strings
    that identify the message elements by indicating the length and type of the various
    components of the `byte` string as laid out in the specification.
  id: totrans-102
  prefs: []
  type: TYPE_NORMAL
  zh: Python 提供了 `struct` 模块，使用格式字符串解析二进制数据，该格式字符串通过指示 `byte` 字符串的各个组件的长度和类型来标识消息元素，如规范中所述。
- en: 'Let''s walk through the critical steps required to parse the trading messages
    and reconstruct the order book:'
  id: totrans-103
  prefs: []
  type: TYPE_NORMAL
  zh: 让我们走过解析交易信息和重建订单簿所需的关键步骤：
- en: 'The ITCH parser relies on the message specifications provided in the file `message_types.xlsx`
    (refer to the notebook `parse_itch_order_flow_messages.ipynb` for details). It
    assembles format strings according to the `formats` dictionary:'
  id: totrans-104
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: ITCH 解析器依赖于文件`message_types.xlsx`中提供的消息规范（有关详细信息，请参阅笔记本`parse_itch_order_flow_messages.ipynb`）。它根据`formats`字典组装格式字符串：
- en: '[PRE1]'
  id: totrans-105
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE1]'
- en: 'The parser translates the message specs into format strings and named tuples
    that capture the message content:'
  id: totrans-106
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: 解析器将消息规范转换为格式字符串和命名元组，其中包含了消息内容：
- en: '[PRE2]'
  id: totrans-107
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE2]'
- en: 'Fields of the alpha type require postprocessing, as defined in the `format_alpha`
    function:'
  id: totrans-108
  prefs:
  - PREF_OL
  type: TYPE_NORMAL
  zh: alpha 类型的字段需要后处理，如`format_alpha`函数中所定义：
- en: '[PRE3]'
  id: totrans-109
  prefs:
  - PREF_IND
  type: TYPE_PRE
  zh: '[PRE3]'
- en: The binary file for a single day contains over 300,000,000 messages that are
    worth over 9 GB. The script appends the parsed result iteratively to a file in
    the fast HDF5 format to avoid memory constraints. (Refer to the *Efficient data
    storage with pandas* section later in this chapter for more information on the
    HDF5 format.)
  id: totrans-110
  prefs: []
  type: TYPE_NORMAL
  zh: 单日的二进制文件包含超过 3 亿条消息，总计超过 9 GB。该脚本将解析结果迭代附加到一个以 HDF5 格式存储的文件中，以避免内存限制。（有关 HDF5
    格式的更多信息，请参阅本章后面的*使用 pandas 进行高效数据存储*部分。）
- en: 'The following (simplified) code processes the binary file and produces the
    parsed orders stored by message type:'
  id: totrans-111
  prefs: []
  type: TYPE_NORMAL
  zh: 以下（简化的）代码处理二进制文件并生成按消息类型存储的解析订单：
- en: '[PRE4]'
  id: totrans-112
  prefs: []
  type: TYPE_PRE
  zh: '[PRE4]'
- en: Summarizing the trading activity for all 8,500 stocks
  id: totrans-113
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 总结所有 8,500 只股票的交易活动
- en: 'As expected, a small number of the 8,500-plus securities traded on this day
    account for most trades:'
  id: totrans-114
  prefs: []
  type: TYPE_NORMAL
  zh: 如预期的那样，这一天交易的 8,500 多种证券中只有少数占据了大部分交易：
- en: '[PRE5]'
  id: totrans-115
  prefs: []
  type: TYPE_PRE
  zh: '[PRE5]'
- en: '*Figure 2.1* shows the resulting plot:'
  id: totrans-116
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 2.1* 显示了生成的图表：'
- en: '![](img/B15439_02_01.png)'
  id: totrans-117
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_02_01.png)'
- en: 'Figure 2.1: The share of traded value of the 50 most traded securities'
  id: totrans-118
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.1：50 只最活跃证券的交易价值份额
- en: How to reconstruct all trades and the order book
  id: totrans-119
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 如何重建所有交易和订单簿
- en: The parsed messages allow us to rebuild the order flow for the given day. The
    `'R'` message type contains a listing of all stocks traded during a given day,
    including information about **initial public offerings** (**IPOs**) and trading
    restrictions.
  id: totrans-120
  prefs: []
  type: TYPE_NORMAL
  zh: 解析后的消息允许我们重建给定日期的订单流。`'R'`消息类型包含了给定日期内所有交易的清单，包括**首次公开发行**（**IPO**）和交易限制的信息。
- en: Throughout the day, new orders are added, and orders that are executed and canceled
    are removed from the order book. The proper accounting for messages that reference
    orders placed on a prior date would require tracking the order book over multiple
    days.
  id: totrans-121
  prefs: []
  type: TYPE_NORMAL
  zh: 在一天中，新订单被添加，而执行和取消的订单则从订单簿中移除。对于引用前日期放置的订单的消息的正确核算将需要跟踪多天的订单簿。
- en: 'The `get_messages()` function illustrates how to collect the orders for a single
    stock that affects trading. (Refer to the ITCH specification for details about
    each message.) The code is slightly simplified; refer to the notebook `rebuild_nasdaq_order_book.ipynb`
    for further details:'
  id: totrans-122
  prefs: []
  type: TYPE_NORMAL
  zh: '`get_messages()`函数说明了如何收集影响交易的单只股票的订单（有关每条消息的详细信息，请参阅ITCH规范）。代码略有简化；有关更多详细信息，请参阅笔记本`rebuild_nasdaq_order_book.ipynb`：'
- en: '[PRE6]'
  id: totrans-123
  prefs: []
  type: TYPE_PRE
  zh: '[PRE6]'
- en: 'Reconstructing successful trades—that is, orders that were executed as opposed
    to those that were canceled from trade-related message types `C`, `E`, `P`, and
    `Q`—is relatively straightforward:'
  id: totrans-124
  prefs: []
  type: TYPE_NORMAL
  zh: 重建成功交易 - 即已执行而非取消的订单 - 与与交易相关的消息类型`C`、`E`、`P`和`Q`相对简单。
- en: '[PRE7]'
  id: totrans-125
  prefs: []
  type: TYPE_PRE
  zh: '[PRE7]'
- en: 'The order book keeps track of limit orders, and the various price levels for
    buy and sell orders constitute the depth of the order book. Reconstructing the
    order book for a given level of depth requires the following steps:'
  id: totrans-126
  prefs: []
  type: TYPE_NORMAL
  zh: 订单簿跟踪限价订单，并且买单和卖单的各种价格水平构成了订单簿的深度。重建给定深度级别的订单簿需要以下步骤：
- en: 'The `add_orders()` function accumulates sell orders in ascending order and
    buy orders in descending order for a given timestamp up to the desired level of
    depth:'
  id: totrans-127
  prefs: []
  type: TYPE_NORMAL
  zh: '`add_orders()`函数按升序累积卖单，按降序累积买单，直到达到所需的深度级别的给定时间戳：'
- en: '[PRE8]'
  id: totrans-128
  prefs: []
  type: TYPE_PRE
  zh: '[PRE8]'
- en: 'We iterate over all ITCH messages and process orders and their replacements
    as required by the specification:'
  id: totrans-129
  prefs: []
  type: TYPE_NORMAL
  zh: 我们遍历所有ITCH消息，并根据规范处理订单及其替换所需的订单：
- en: '[PRE9]'
  id: totrans-130
  prefs: []
  type: TYPE_PRE
  zh: '[PRE9]'
- en: '*Figure 2.2* highlights the depth of liquidity at any given point in time using
    different intensities that visualize the number of orders at different price levels.
    The left panel shows how the distribution of limit order prices was weighted toward
    buy orders at higher prices.'
  id: totrans-131
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 2.2*突显了任意给定时间点的流动性深度，使用不同的强度来可视化不同价格水平上的订单数量。左侧面板显示了限价订单价格的分布是如何向更高价格的买单倾斜的。'
- en: 'The right panel plots the evolution of limit orders and prices throughout the
    trading day: the dark line tracks the prices for executed trades during market
    hours, whereas the red and blue dots indicate individual limit orders on a per-minute
    basis (refer to the notebook for details):'
  id: totrans-132
  prefs: []
  type: TYPE_NORMAL
  zh: 右侧面板绘制了整个交易日限价订单和价格的演变情况：深色线跟踪了市场小时内执行交易的价格，而红色和蓝色点表示每分钟基础上的单个限价订单（有关详细信息，请参阅笔记本）：
- en: '![](img/B15439_02_02.png)'
  id: totrans-133
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_02_02.png)'
- en: 'Figure 2.2: AAPL market liquidity according to the order book'
  id: totrans-134
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.2：根据订单簿的AAPL市场流动性
- en: From ticks to bars – how to regularize market data
  id: totrans-135
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 从刻度到条形图 - 如何规范市场数据
- en: The trade data is indexed by nanoseconds, arrives at irregular intervals, and
    is very noisy. The **bid-ask bounce**, for instance, causes the price to oscillate
    between the bid and ask prices when trade initiation alternates between buy and
    sell market orders. To improve the noise-signal ratio and the statistical properties
    of the price series, we need to resample and regularize the tick data by aggregating
    the trading activity.
  id: totrans-136
  prefs: []
  type: TYPE_NORMAL
  zh: 交易数据按纳秒索引，以不规则间隔到达，且非常嘈杂。例如，**买卖盘弹跳**会导致价格在买入和卖出价格之间震荡，当交易启动在买入和卖出市价订单之间交替时。为了改善噪声-信号比和价格序列的统计特性，我们需要通过聚合交易活动对刻度数据进行重新采样和规范化。
- en: We typically collect the **open (first), high, low, and closing (last) price
    and volume** (jointly abbreviated as **OHLCV**) for the aggregated period, alongside
    the **volume-weighted average price** (**VWAP**) and the timestamp associated
    with the data.
  id: totrans-137
  prefs: []
  type: TYPE_NORMAL
  zh: 我们通常收集聚合周期内的**开盘价（第一）、最高价、最低价和收盘价（最后）以及成交量**（联合简称为**OHLCV**），以及与数据相关的**成交量加权平均价格**（**VWAP**）和时间戳。
- en: Refer to the `normalize_tick_data.ipynb` notebook in the folder for this chapter
    on GitHub for additional details.
  id: totrans-138
  prefs: []
  type: TYPE_NORMAL
  zh: 有关附加详细信息，请参阅GitHub上本章节文件夹中的`normalize_tick_data.ipynb`笔记本。
- en: The raw material – tick bars
  id: totrans-139
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 原材料 - 刻度条
- en: 'The following code generates a plot of the raw tick price and volume data for
    AAPL:'
  id: totrans-140
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码生成了AAPL的原始刻度价格和成交量数据的图表：
- en: '[PRE10]'
  id: totrans-141
  prefs: []
  type: TYPE_PRE
  zh: '[PRE10]'
- en: '*Figure 2.3* displays the resulting plot:'
  id: totrans-142
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 2.3*显示了生成的图：'
- en: '![](img/B15439_02_03.png)'
  id: totrans-143
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_02_03.png)'
- en: 'Figure 2.3: Tick bars'
  id: totrans-144
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.3：刻度条
- en: 'The tick returns are far from normally distributed, as evidenced by the low
    p-value of `scipy.stats.normaltest`:'
  id: totrans-145
  prefs: []
  type: TYPE_NORMAL
  zh: 刻度回报远非正态分布，这表明`scipy.stats.normaltest`的p值很低：
- en: '[PRE11]'
  id: totrans-146
  prefs: []
  type: TYPE_PRE
  zh: '[PRE11]'
- en: Plain-vanilla denoising – time bars
  id: totrans-147
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 常规去噪 - 时间条
- en: 'Time bars involve trade aggregation by period. The following code gets the
    data for the time bars:'
  id: totrans-148
  prefs: []
  type: TYPE_NORMAL
  zh: 时间条涉及按周期进行交易聚合。以下代码获取时间条的数据：
- en: '[PRE12]'
  id: totrans-149
  prefs: []
  type: TYPE_PRE
  zh: '[PRE12]'
- en: 'We can display the result as a price-volume chart:'
  id: totrans-150
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以将结果显示为价格-成交量图表：
- en: '[PRE13]'
  id: totrans-151
  prefs: []
  type: TYPE_PRE
  zh: '[PRE13]'
- en: 'The preceding code produces *Figure 2.4*:'
  id: totrans-152
  prefs: []
  type: TYPE_NORMAL
  zh: 上述代码产生了*图 2.4*：
- en: '![](img/B15439_02_04.png)'
  id: totrans-153
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_02_04.png)'
- en: 'Figure 2.4: Time bars'
  id: totrans-154
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.4：时间柱
- en: 'Alternatively, we can represent the data as a candlestick chart using the Bokeh
    plotting library:'
  id: totrans-155
  prefs: []
  type: TYPE_NORMAL
  zh: 或者，我们可以使用 Bokeh 绘图库将数据表示为蜡烛图：
- en: '[PRE14]'
  id: totrans-156
  prefs: []
  type: TYPE_PRE
  zh: '[PRE14]'
- en: 'This produces the plot in *Figure 2.5*:'
  id: totrans-157
  prefs: []
  type: TYPE_NORMAL
  zh: 这会产生*图 2.5*中的图表：
- en: '![](img/B15439_02_05.png)'
  id: totrans-158
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_02_05.png)'
- en: 'Figure 2.5: Bokeh candlestick plot'
  id: totrans-159
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.5：Bokeh 蜡烛图
- en: Accounting for order fragmentation – volume bars
  id: totrans-160
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 考虑订单碎片化 – 交易量柱
- en: Time bars smooth some of the noise contained in the raw tick data but may fail
    to account for the fragmentation of orders. Execution-focused algorithmic trading
    may aim to match the **volume-weighted average price** (**VWAP**) over a given
    period. This will divide a single order into multiple trades and place orders
    according to historical patterns. Time bars would treat the same order differently,
    even though no new information has arrived in the market.
  id: totrans-161
  prefs: []
  type: TYPE_NORMAL
  zh: 时间柱平滑了原始 tick 数据中包含的一些噪音，但可能未能解决订单碎片化的问题。执行重点的算法交易可能会在给定期间内匹配**成交量加权平均价格** (**VWAP**)。这将将单个订单拆分为多个交易，并根据历史模式下订单。时间柱将以不同的方式处理相同的订单，即使市场中没有新的信息到来。
- en: 'Volume bars offer an alternative by aggregating trade data according to volume.
    We can accomplish this as follows:'
  id: totrans-162
  prefs: []
  type: TYPE_NORMAL
  zh: 交易量柱提供了一种通过按交易量聚合交易数据的替代方法。我们可以按如下方式完成：
- en: '[PRE15]'
  id: totrans-163
  prefs: []
  type: TYPE_PRE
  zh: '[PRE15]'
- en: 'We get the plot in *Figure 2.6* for the preceding code:'
  id: totrans-164
  prefs: []
  type: TYPE_NORMAL
  zh: 对于上述代码，我们得到了*图 2.6*的图表：
- en: '![](img/B15439_02_06.png)'
  id: totrans-165
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_02_06.png)'
- en: 'Figure 2.6: Volume bars'
  id: totrans-166
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.6：交易量柱
- en: Accounting for price changes – dollar bars
  id: totrans-167
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 考虑价格变化 – 美元柱
- en: When asset prices change significantly, or after stock splits, the value of
    a given amount of shares changes. Volume bars do not correctly reflect this and
    can hamper the comparison of trading behavior for different periods that reflect
    such changes. In these cases, the volume bar method should be adjusted to utilize
    the product of shares and prices to produce dollar bars.
  id: totrans-168
  prefs: []
  type: TYPE_NORMAL
  zh: 当资产价格发生显着变化或股票分拆后，给定数量的股票价值会发生变化。交易量柱无法正确反映这一点，并且可能会妨碍对反映此类变化的不同期间的交易行为进行比较。在这些情况下，应调整交易量柱方法以利用股票和价格的乘积产生美元柱。
- en: 'The following code shows the computation for dollar bars:'
  id: totrans-169
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的代码显示了美元柱的计算：
- en: '[PRE16]'
  id: totrans-170
  prefs: []
  type: TYPE_PRE
  zh: '[PRE16]'
- en: 'The plot looks quite similar to the volume bar since the price has been fairly
    stable throughout the day:'
  id: totrans-171
  prefs: []
  type: TYPE_NORMAL
  zh: 由于价格在整个交易日都相当稳定，该图与交易量柱非常相似：
- en: '![](img/B15439_02_07.png)'
  id: totrans-172
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_02_07.png)'
- en: 'Figure 2.7: Dollar bars'
  id: totrans-173
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.7：美元柱
- en: AlgoSeek minute bars – equity quote and trade data
  id: totrans-174
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: AlgoSeek 分钟柱 – 股票报价和交易数据
- en: AlgoSeek provides historical intraday data of the quality previously available
    only to institutional investors. The AlgoSeek Equity bars provide very detailed
    intraday quote and trade data in a user-friendly format, which is aimed at making
    it easy to design and backtest intraday ML-driven strategies. As we will see,
    the data includes not only OHLCV information but also information on the bid-ask
    spread and the number of ticks with up and down price moves, among others.
  id: totrans-175
  prefs: []
  type: TYPE_NORMAL
  zh: AlgoSeek 提供了以前仅供机构投资者使用的历史日内交易数据。AlgoSeek 股票柱以用户友好的格式提供了非常详细的日内报价和交易数据，旨在使设计和回测日内
    ML 驱动策略变得容易。正如我们将看到的，该数据不仅包括 OHLCV 信息，还包括盘口报价价差和上下价格变动的次数等其他信息。
- en: AlgoSeek has been so kind as to provide samples of minute bar data for the Nasdaq
    100 stocks from 2013-2017 for demonstration purposes and will make a subset of
    this data available to readers of this book.
  id: totrans-176
  prefs: []
  type: TYPE_NORMAL
  zh: AlgoSeek 提供了 2013-2017 年纳斯达克 100 只股票分钟柱数据样本，以供演示，并将提供此数据的子集给本书读者。
- en: In this section, we will present the available trade and quote information and
    show how to process the raw data. In later chapters, we will demonstrate how you
    can use this data for ML-driven intraday strategies.
  id: totrans-177
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将介绍可用的交易和报价信息，并展示如何处理原始数据。在后面的章节中，我们将演示如何使用这些数据进行 ML 驱动的日内策略。
- en: From the consolidated feed to minute bars
  id: totrans-178
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 从综合信息流到分钟柱
- en: AlgoSeek minute bars are based on data provided by the **Securities Information
    Processor** (**SIP**), which manages the consolidated feed mentioned at the beginning
    of this section. You can view the documentation at [https://www.algoseek.com/samples/](https://www.algoseek.com/samples/).
  id: totrans-179
  prefs: []
  type: TYPE_NORMAL
  zh: AlgoSeek 分钟柱基于由 **证券信息处理器** (**SIP**) 提供的数据，该处理器管理本节开头提到的综合信息流。您可以在 [https://www.algoseek.com/samples/](https://www.algoseek.com/samples/)
    上查看文档。
- en: The SIP aggregates the best bid and offers quotes from each exchange, as well
    as the resulting trades and prices. Exchanges are prohibited by law from sending
    their quotes and trades to direct feeds before sending them to the SIP. Given
    the fragmented nature of U.S. equity trading, the consolidated feed provides a convenient
    snapshot of the current state of the market.
  id: totrans-180
  prefs: []
  type: TYPE_NORMAL
  zh: SIP（股票信息处理器）汇总了来自每个交易所的最佳买价和卖价报价，以及相应的交易和价格。根据法律规定，交易所在将报价和交易发送到直接数据源之前，不得将其发送到
    SIP。鉴于美国股票交易的碎片化特性，综合数据源提供了市场当前状态的便捷快照。
- en: More importantly, the SIP acts as the benchmark used by regulators to determine
    the **National Best Bid and Offer** (**NBBO**) according to Reg NMS. The OHLC
    bar quote prices are based on the NBBO, and each bid or ask quote price refers
    to an NBBO price.
  id: totrans-181
  prefs: []
  type: TYPE_NORMAL
  zh: 更重要的是，SIP 作为监管机构根据 Reg NMS 确定**全国最佳买卖报价**（**NBBO**）的基准。OHLC K 线报价价格基于 NBBO，每个买入或卖出报价价格都指的是
    NBBO 价格。
- en: Every exchange publishes its top-of-book price and the number of shares available
    at that price. The NBBO changes when a published quote improves the NBBO. Bid/ask
    quotes persist until there is a change due to trade, price improvement, or the
    cancelation of the latest bid or ask. While historical OHLC bars are often based
    on trades during the bar period, NBBO bid/ask quotes may be carried forward from
    the previous bar until there is a new NBBO event.
  id: totrans-182
  prefs: []
  type: TYPE_NORMAL
  zh: 每个交易所都会发布其最优报价和该价格可获得的股票数量。当已发布的报价改善 NBBO 时，NBBO 就会变化。买入/卖出报价会持续存在，直到由于交易、价格改进或取消最新的买入或卖出而发生变化。虽然历史
    OHLC（开盘、最高、最低、收盘）K 线通常基于该时间段内的交易，但 NBBO 买卖报价可能会从前一个时间段一直延续到发生新的 NBBO 事件。
- en: 'AlgoSeek bars cover the whole trading day, from the opening of the first exchange
    until the closing of the last exchange. Bars outside regular market hours normally
    exhibit limited activity. Trading hours, in Eastern Time, are:'
  id: totrans-183
  prefs: []
  type: TYPE_NORMAL
  zh: AlgoSeek K 线覆盖了整个交易日，从第一个交易所开盘到最后一个交易所收盘。在正常交易时间之外的 K 线通常表现出有限的活动。交易时间（东部时间）如下：
- en: 'Premarket: Approximately 04:00:00 (this varies by exchange) to 09:29:59'
  id: totrans-184
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 盘前市场：大约从04:00:00（根据交易所而异）到09:29:59
- en: 'Market: 09:30:00 to 16:00:00'
  id: totrans-185
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 市场交易时间：09:30:00 到 16:00:00
- en: 'Extended hours: 16:00:01 to 20:00:00'
  id: totrans-186
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 延长交易时间：16:00:01 到 20:00:00
- en: Quote and trade data fields
  id: totrans-187
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 报价和交易数据字段
- en: 'The minute bar data contains up to 54 fields. There are eight fields for the
    **open**, **high**, **low**, and **close** elements of the bar, namely:'
  id: totrans-188
  prefs: []
  type: TYPE_NORMAL
  zh: 分钟级 K 线数据包含多达 54 个字段。对于 K 线的**开盘价**、**最高价**、**最低价**和**收盘价**元素，有八个字段，即：
- en: The timestamp for the bar and the corresponding trade
  id: totrans-189
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: K 线的时间戳及相应的交易
- en: The price and the size for the prevailing bid-ask quote and the relevant trade
  id: totrans-190
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 主要买卖报价和相关交易的价格和数量
- en: 'There are also 14 data points with **volume information** for the bar period:'
  id: totrans-191
  prefs: []
  type: TYPE_NORMAL
  zh: 还有 14 个带有**成交量信息**的数据点：
- en: The number of shares and corresponding trades
  id: totrans-192
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 股票数量及相应的交易
- en: The trade volumes at or below the bid, between the bid quote and the midpoint,
    at the midpoint, between the midpoint and the ask quote, and at or above the ask,
    as well as for crosses
  id: totrans-193
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 在买入价以下、买入价和中间价之间、中间价、中间价和卖出价之间以及在卖出价以上的交易量，以及交叉交易量
- en: The number of shares traded with upticks or downticks, that is, when the price
    rose or fell, as well as when the price did not change, differentiated by the
    previous direction of price movement
  id: totrans-194
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 与前一个价格运动方向不同的价格上涨或下跌的交易量，以及价格未发生变化时的交易量
- en: The AlgoSeek data also contains the number of shares **reported to FINRA** and
    processed internally at broker-dealers, by dark pools, or OTC. These trades represent
    volume that is hidden or not publicly available until after the fact.
  id: totrans-195
  prefs: []
  type: TYPE_NORMAL
  zh: AlgoSeek 数据还包含报告给 FINRA 并由经纪商、暗池或场外交易所内部处理的股票数量。这些交易代表着隐藏或直到事后才可公开获取的成交量。
- en: Finally, the data includes the **volume-weighted average price** (**VWAP**)
    and minimum and maximum bid-ask spread for the bar period.
  id: totrans-196
  prefs: []
  type: TYPE_NORMAL
  zh: 最后，数据包括**成交量加权平均价格**（**VWAP**）和该时间段的最小和最大买卖价差。
- en: How to process AlgoSeek intraday data
  id: totrans-197
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 如何处理 AlgoSeek 的日内数据
- en: In this section, we'll process the AlgoSeek sample data. The `data` directory
    on GitHub contains instructions on how to download that data from AlgoSeek.
  id: totrans-198
  prefs: []
  type: TYPE_NORMAL
  zh: 在本节中，我们将处理 AlgoSeek 的示例数据。GitHub 上的 `data` 目录包含了如何从 AlgoSeek 下载数据的说明。
- en: 'The minute bar data comes in four versions: with and without quote information,
    and with or without FINRA''s reported volume. There is one zipped folder per day,
    containing one CSV file per ticker.'
  id: totrans-199
  prefs: []
  type: TYPE_NORMAL
  zh: 分钟级数据有四个版本：带有和不带有报价信息，以及带有或不带有 FINRA 报告的成交量。每天有一个压缩文件夹，其中包含一个 CSV 文件。
- en: 'The following code example extracts the trade-only minute bar data into daily
    `.parquet` files:'
  id: totrans-200
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的代码示例将交易分钟级数据提取到每日的 `.parquet` 文件中：
- en: '[PRE17]'
  id: totrans-201
  prefs: []
  type: TYPE_PRE
  zh: '[PRE17]'
- en: 'We can combine the `parquet` files into a single piece of HDF5 storage as follows,
    yielding 53.8 million records that consume 3.2 GB of memory and covering 5 years
    and 100 stocks:'
  id: totrans-202
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以将 `parquet` 文件合并为单个 HDF5 存储，产生 5380 万条记录，占用 3.2 GB 的内存，涵盖了 5 年和 100 支股票：
- en: '[PRE18]'
  id: totrans-203
  prefs: []
  type: TYPE_PRE
  zh: '[PRE18]'
- en: 'We can use `plotly` to quickly create an interactive candlestick plot for one
    day of AAPL data to view in a browser:'
  id: totrans-204
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用 `plotly` 快速创建一个交互式蜡烛图，以查看 AAPL 数据的一天在浏览器中的显示：
- en: '[PRE19]'
  id: totrans-205
  prefs: []
  type: TYPE_PRE
  zh: '[PRE19]'
- en: '*Figure 2.8* shows the resulting static image:'
  id: totrans-206
  prefs: []
  type: TYPE_NORMAL
  zh: '*图 2.8* 显示了生成的静态图像：'
- en: '![](img/B15439_02_08.png)'
  id: totrans-207
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_02_08.png)'
- en: 'Figure 2.8: Plotly candlestick plot'
  id: totrans-208
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.8：Plotly 蜡烛图
- en: AlgoSeek also provides adjustment factors to correct pricing and volumes for
    stock splits, dividends, and other corporate actions.
  id: totrans-209
  prefs: []
  type: TYPE_NORMAL
  zh: AlgoSeek 还提供调整因子，以纠正股票拆分、股息和其他公司行动的定价和成交量。
- en: API access to market data
  id: totrans-210
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: API 访问市场数据
- en: There are several options you can use to access market data via an API using
    Python. We will first present a few sources built into the pandas library and
    the `yfinance` tool that facilitates the downloading of end-of-day market data
    and recent fundamental data from Yahoo! Finance.
  id: totrans-211
  prefs: []
  type: TYPE_NORMAL
  zh: 有几种选项可供您使用 Python 通过 API 访问市场数据。我们首先介绍了内置于 pandas 库和`yfinance`工具中的一些来源，该工具便于从
    Yahoo! Finance 下载每日市场数据和最近的基本数据。
- en: Then we will briefly introduce the trading platform Quantopian, the data provider
    Quandl, and the Zipline backtesting library that we will use later in the book,
    as well as listing several additional options to access various types of market
    data. The directory `data_providers` on GitHub contains several notebooks that
    illustrate the usage of these options.
  id: totrans-212
  prefs: []
  type: TYPE_NORMAL
  zh: 然后，我们将简要介绍交易平台 Quantopian、数据提供者 Quandl 以及本书后续将使用的 Zipline 回测库，以及列出访问各种类型市场数据的几个其他选项。GitHub
    上的 `data_providers` 目录包含了几个笔记本，说明了这些选项的使用情况。
- en: Remote data access using pandas
  id: totrans-213
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 使用 pandas 远程数据访问
- en: The pandas library enables access to data displayed on websites using the `read_html`
    function and access to the API endpoints of various data providers through the
    related `pandas-datareader` library.
  id: totrans-214
  prefs: []
  type: TYPE_NORMAL
  zh: pandas 库通过相关的 `pandas-datareader` 库实现通过 `read_html` 函数访问网站上显示的数据以及访问各种数据提供者的
    API 端点。
- en: Reading HTML tables
  id: totrans-215
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 读取 HTML 表格
- en: 'Downloading the content of one or more HTML tables, such as for the constituents
    of the S&P 500 index from Wikipedia, works as follows:'
  id: totrans-216
  prefs: []
  type: TYPE_NORMAL
  zh: 下载一个或多个 HTML 表格的内容（例如来自 Wikipedia 的标准普尔 500 指数成分）的过程如下：
- en: '[PRE20]'
  id: totrans-217
  prefs: []
  type: TYPE_PRE
  zh: '[PRE20]'
- en: pandas-datareader for market data
  id: totrans-218
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 用于市场数据的 pandas-datareader
- en: pandas used to facilitate access to data provider APIs directly, but this functionality
    has moved to the `pandas-datareader` library (refer to the `README` for links
    to the documentation).
  id: totrans-219
  prefs: []
  type: TYPE_NORMAL
  zh: pandas 用于直接访问数据提供者的 API，但此功能已移至 `pandas-datareader` 库（请参阅 `README` 获取文档链接）。
- en: 'The stability of the APIs varies with provider policies and continues to change.
    Please consult the documentation for up-to-date information. As of December 2019,
    at version 0.8.1, the following sources are available:'
  id: totrans-220
  prefs: []
  type: TYPE_NORMAL
  zh: API 的稳定性因提供者政策而异，且不断变化。请参阅文档以获取最新信息。截至 2019 年 12 月，版本 0.8.1，以下来源可用：
- en: '| Source | Scope | Comment |'
  id: totrans-221
  prefs: []
  type: TYPE_TB
  zh: '| Source | 范围 | 评论 |'
- en: '| Tiingo | Historical end-of-day prices on equities, mutual funds, and ETF.
    | Free registration for the API key. Free accounts can access only 500 symbols.
    |'
  id: totrans-222
  prefs: []
  type: TYPE_TB
  zh: '| Tiingo | 提供股票、共同基金和 ETF 的历史收盘价。 | 免费注册获取 API 密钥。免费账户只能访问 500 个符号。'
- en: '| Investor Exchange (IEX) | Historical stock prices are available if traded
    on IEX. | Requires an API key from IEX Cloud Console. |'
  id: totrans-223
  prefs: []
  type: TYPE_TB
  zh: '| Investor Exchange (IEX) | 如果在 IEX 上交易，则提供历史股价。 | 需要从 IEX Cloud 控制台获取 API
    密钥。 |'
- en: '| Alpha Vantage | Historical equity data for daily, weekly, and monthly frequencies,
    20+ years, and the past 3-5 days of intraday data. It also has FOREX and sector
    performance data. |  |'
  id: totrans-224
  prefs: []
  type: TYPE_TB
  zh: '| Alpha Vantage | 每日、每周和每月频率的历史股票数据，20+ 年，以及过去 3-5 天的分钟级数据。它还具有外汇和行业绩效数据。 |  |'
- en: '| Quandl | Free data sources as listed on their website. |  |'
  id: totrans-225
  prefs: []
  type: TYPE_TB
  zh: '| Quandl | 免费数据来源如它们网站上所列。 |  |'
- en: '| Fama/French | Risk factor portfolio returns. | Used in *Chapter 7*, *Linear
    Models – From Risk Factors to Return Forecasts*. |'
  id: totrans-226
  prefs: []
  type: TYPE_TB
  zh: '| Fama/French | 风险因子投资组合回报。 | 用于 *第7章*，*线性模型 - 从风险因素到回报预测*。 |'
- en: '| TSP Fund Data | Mutual fund prices. |  |'
  id: totrans-227
  prefs: []
  type: TYPE_TB
  zh: '| TSP 基金数据 | 共同基金价格。 |  |'
- en: '| Nasdaq | Latest metadata on traded tickers. |  |'
  id: totrans-228
  prefs: []
  type: TYPE_TB
  zh: '| 纳斯达克 | 交易标的的最新元数据。 |  |'
- en: '| Stooq Index Data | Some equity indices are not available from elsewhere due
    to licensing issues. |  |'
  id: totrans-229
  prefs: []
  type: TYPE_TB
  zh: '| Stooq 指数数据 | 由于许可问题，某些股票指数在其他地方不可用。 |  |'
- en: '| MOEX | Moscow Exchange historical data. |  |'
  id: totrans-230
  prefs: []
  type: TYPE_TB
  zh: '| MOEX | 莫斯科交易所历史数据。 |  |'
- en: 'The access and retrieval of data follow a similar API for all sources, as illustrated
    for Yahoo! Finance:'
  id: totrans-231
  prefs: []
  type: TYPE_NORMAL
  zh: 数据的访问和检索遵循所有来源的类似 API，如雅虎财经所示：
- en: '[PRE21]'
  id: totrans-232
  prefs: []
  type: TYPE_PRE
  zh: '[PRE21]'
- en: yfinance – scraping data from Yahoo! Finance
  id: totrans-233
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: '`yfinance` – 从雅虎财经获取数据'
- en: '`yfinance` aims to provide a reliable and fast way to download historical market
    data from Yahoo! Finance. The library was originally named `fix-yahoo-finance`.
    The usage of this library is very straightforward; the notebook `yfinance_demo`
    illustrates the library''s capabilities.'
  id: totrans-234
  prefs: []
  type: TYPE_NORMAL
  zh: '`yfinance` 旨在提供从雅虎财经下载历史市场数据的可靠快速方法。该库最初命名为 `fix-yahoo-finance`。使用该库非常简单；笔记本
    `yfinance_demo` 展示了该库的功能。'
- en: How to download end-of-day and intraday prices
  id: totrans-235
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 如何下载每日和分钟价格
- en: 'The `Ticker` object permits the downloading of various data points scraped
    from Yahoo''s website:'
  id: totrans-236
  prefs: []
  type: TYPE_NORMAL
  zh: '`Ticker` 对象允许从雅虎网站抓取的各种数据点的下载：'
- en: '[PRE22]'
  id: totrans-237
  prefs: []
  type: TYPE_PRE
  zh: '[PRE22]'
- en: 'The `.history` method obtains historical prices for various periods, from one
    day to the maximum available, and at different frequencies, whereas intraday is
    only available for the last several days. To download adjusted OHLCV data at a
    one-minute frequency and corporate actions, use:'
  id: totrans-238
  prefs: []
  type: TYPE_NORMAL
  zh: '`.history` 方法获取各种期间的历史价格，从一天到可用的最大值，并以不同频率，而分钟内仅适用于最近几天。要下载调整后的 OHLCV 数据以及公司行动，请使用：'
- en: '[PRE23]'
  id: totrans-239
  prefs: []
  type: TYPE_PRE
  zh: '[PRE23]'
- en: The notebook also illustrates how to access quarterly and annual financial statements,
    sustainability scores, analyst recommendations, and upcoming earnings dates.
  id: totrans-240
  prefs: []
  type: TYPE_NORMAL
  zh: 该笔记本还说明了如何访问季度和年度财务报表、可持续性评分、分析师建议和即将公布的收益日期。
- en: How to download the option chain and prices
  id: totrans-241
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 如何下载期权链和价格
- en: '`yfinance` also provides access to the option expiration dates and prices and
    other information for various contracts. Using the `ticker` instance from the
    previous example, we get the expiration dates using:'
  id: totrans-242
  prefs: []
  type: TYPE_NORMAL
  zh: '`yfinance` 还提供了访问期权到期日期和价格以及其他各种合约信息的功能。使用前面示例中的 `ticker` 实例，我们可以使用以下方式获取到期日期：'
- en: '[PRE24]'
  id: totrans-243
  prefs: []
  type: TYPE_PRE
  zh: '[PRE24]'
- en: 'For any of these dates, we can access the option chain and view details for
    the various put/call contracts as follows:'
  id: totrans-244
  prefs: []
  type: TYPE_NORMAL
  zh: 对于任何这些日期，我们可以访问期权链，并查看各种看涨/看跌合约的详情，如下所示：
- en: '[PRE25]'
  id: totrans-245
  prefs: []
  type: TYPE_PRE
  zh: '[PRE25]'
- en: The library also permits the use of proxy servers to prevent rate limiting and
    facilitates the bulk downloading of multiple tickers. The notebook demonstrates
    the usage of these features as well.
  id: totrans-246
  prefs: []
  type: TYPE_NORMAL
  zh: 该库还允许使用代理服务器以防止速率限制，并便于批量下载多个股票。笔记本演示了这些功能的使用。
- en: Quantopian
  id: totrans-247
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Quantopian
- en: Quantopian is an investment firm that offers a research platform to crowd-source
    trading algorithms. Registration is free, and members can research trading ideas
    using a broad variety of data sources. It also offers an environment to backtest
    the algorithm against historical data, as well as to forward-test it out of sample
    with live data. It awards investment allocations for top-performing algorithms
    whose authors are entitled to a 10 percent (at the time of writing) profit share.
  id: totrans-248
  prefs: []
  type: TYPE_NORMAL
  zh: Quantopian 是一家提供研究平台以集体创建交易算法的投资公司。注册是免费的，会员可以使用各种数据源研究交易想法。它还提供了一个环境，可以使用历史数据对算法进行回测，以及使用实时数据对其进行样本外的前向测试。它为表现优秀的算法授予投资分配，其作者有权获得
    10%（写作时）的利润份额。
- en: The Quantopian research platform consists of a Jupyter Notebook environment
    for research and development for alpha-factor research and performance analysis.
    There is also an **interactive development environment** (**IDE**) for coding
    algorithmic strategies and backtesting the result using historical data since
    2002 with minute-bar frequency.
  id: totrans-249
  prefs: []
  type: TYPE_NORMAL
  zh: Quantopian 研究平台由用于 alpha 因子研究和绩效分析的 Jupyter Notebook 环境组成。还有一个用于编写算法策略和使用从 2002
    年以来带有分钟频率的历史数据回测结果的 **交互式开发环境** (**IDE**)。
- en: Users can also simulate algorithms with live data, which is known as *paper
    trading*. Quantopian provides various market datasets, including U.S. equity and
    futures price and volume data at a one-minute frequency, and U.S. equity corporate
    fundamentals, and it also integrates numerous alternative datasets.
  id: totrans-250
  prefs: []
  type: TYPE_NORMAL
  zh: 用户还可以使用实时数据模拟算法，这被称为*模拟交易*。Quantopian 提供各种市场数据集，包括美国股票和期货价格和交易量数据，以及美国股票公司基本面数据，还整合了众多备选数据集。
- en: We will dive into the Quantopian platform in much more detail in *Chapter 4*,
    *Financial Feature Engineering – How to Research Alpha Factors*, and rely on its
    functionality throughout the book, so feel free to open an account right away.
    (Refer to the GitHub repository for more details.)
  id: totrans-251
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在*第四章*，*金融特征工程——如何研究 Alpha 因子*中更详细地探讨 Quantopian 平台，并在整本书中依赖其功能，所以请随时开设一个账户。（有关更多详细信息，请参阅
    GitHub 存储库。）
- en: Zipline
  id: totrans-252
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Zipline
- en: Zipline is the algorithmic trading library that powers the Quantopian backtesting
    and live-trading platform. It is also available offline to develop a strategy
    using a limited number of free data bundles that can be ingested and used to test
    the performance of trading ideas before porting the result to the online Quantopian
    platform for paper and live trading.
  id: totrans-253
  prefs: []
  type: TYPE_NORMAL
  zh: Zipline 是算法交易库，为 Quantopian 回测和实时交易平台提供支持。它也可以离线使用，用于开发策略，使用有限数量的免费数据包进行测试，然后将结果传输到在线
    Quantopian 平台进行模拟和实时交易。
- en: Zipline requires a custom environment—view the instructions at the beginning
    of the notebook `zipline_data_demo.ipynb` The following code illustrates how Zipline
    permits us to access daily stock data for a range of companies. You can run Zipline
    scripts in the Jupyter Notebook using the magic function of the same name.
  id: totrans-254
  prefs: []
  type: TYPE_NORMAL
  zh: Zipline 需要一个定制环境——查看笔记本`zipline_data_demo.ipynb`开头的说明。以下代码说明了 Zipline 如何允许我们访问一系列公司的每日股票数据。您可以在
    Jupyter Notebook 中使用同名的魔术函数运行 Zipline 脚本。
- en: 'First, you need to initialize the context with the desired security symbols.
    We''ll also use a counter variable. Then, Zipline calls `handle_data`, where we
    use the `data.history()` method to look back a single period and append the data
    for the last day to a `.csv` file:'
  id: totrans-255
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，您需要使用所需的安全符号初始化上下文。我们还将使用一个计数器变量。然后，Zipline 调用`handle_data`，我们使用`data.history()`方法回溯一个时间段，并将上一天的数据附加到一个`.csv`文件中：
- en: '[PRE26]'
  id: totrans-256
  prefs: []
  type: TYPE_PRE
  zh: '[PRE26]'
- en: 'We get the following plot for the preceding code:'
  id: totrans-257
  prefs: []
  type: TYPE_NORMAL
  zh: 我们得到了前述代码的以下图：
- en: '![](img/B15439_02_09.png)'
  id: totrans-258
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_02_09.png)'
- en: 'Figure 2.9: Zipline data access'
  id: totrans-259
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.9：Zipline 数据访问
- en: We will explore the capabilities of Zipline, and especially the online Quantopian
    platform, in more detail in the coming chapters.
  id: totrans-260
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将在接下来的章节中更详细地探讨 Zipline 的功能，特别是在线 Quantopian 平台。
- en: Quandl
  id: totrans-261
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: Quandl
- en: Quandl provides a broad range of data sources, both free and as a subscription,
    using a Python API. Register and obtain a free API key to make more than 50 calls
    per day. Quandl data covers multiple asset classes beyond equities and includes
    FX, fixed income, indexes, futures and options, and commodities.
  id: totrans-262
  prefs: []
  type: TYPE_NORMAL
  zh: Quandl 提供广泛的数据源，包括免费数据和订阅数据，使用 Python API。注册并获取免费 API 密钥，可每天进行 50 多次调用。Quandl
    数据涵盖除股票以外的多种资产类别，包括外汇、固定收益、指数、期货和期权以及大宗商品。
- en: API usage is straightforward, well-documented, and flexible, with numerous methods
    beyond single-series downloads, for example, including bulk downloads or metadata searches.
  id: totrans-263
  prefs: []
  type: TYPE_NORMAL
  zh: API 使用简单，文档完善，灵活，除了单个系列下载外，还有许多其他方法，例如，包括批量下载或元数据搜索。
- en: 'The following call obtains oil prices from 1986 onward, as quoted by the U.S.
    Department of Energy:'
  id: totrans-264
  prefs: []
  type: TYPE_NORMAL
  zh: 下面的调用从 1986 年开始获取美国能源部的报价的油价：
- en: '[PRE27]'
  id: totrans-265
  prefs: []
  type: TYPE_PRE
  zh: '[PRE27]'
- en: 'We get this plot for the preceding code:'
  id: totrans-266
  prefs: []
  type: TYPE_NORMAL
  zh: 我们从前面的代码中得到了这个图：
- en: '![](img/B15439_02_10.png)'
  id: totrans-267
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_02_10.png)'
- en: 'Figure 2.10: Quandl oil price example'
  id: totrans-268
  prefs: []
  type: TYPE_NORMAL
  zh: 图2.10：Quandl 油价示例
- en: Other market data providers
  id: totrans-269
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 其他市场数据提供商
- en: 'A broad variety of providers offer market data for various asset classes. Examples
    in relevant categories include:'
  id: totrans-270
  prefs: []
  type: TYPE_NORMAL
  zh: 各种提供商提供各种资产类别的市场数据。相关类别的示例包括：
- en: Exchanges derive a growing share of their revenues from an ever-broader range
    of data services, typically using a subscription.
  id: totrans-271
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 交易所越来越多地从越来越广泛的数据服务中获得收入，通常使用订阅方式。
- en: Bloomberg and Thomson Reuters have long been the leading data aggregators with
    a combined share of over 55 percent in the $28.5 billion financial data market.
    Smaller rivals, such as FactSet, are growing or emerging, such as money.net, Quandl,
    Trading Economics, and Barchart.
  id: totrans-272
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 彭博社和汤姆森路透一直是领先的数据聚合商，在285亿美元的金融数据市场中占据了超过55％的份额。较小的竞争对手，如FactSet，正在增长或出现，如money.net，Quandl，Trading
    Economics和Barchart。
- en: Specialist data providers abound. One example is LOBSTER, which aggregates Nasdaq
    order-book data in real time.
  id: totrans-273
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 专业数据提供商比比皆是。一个例子是LOBSTER，它实时聚合纳斯达克订单簿数据。
- en: Free data providers include Alpha Vantage, which offers Python APIs for real-time
    equity, FX, and cryptocurrency market data, as well as technical indicators.
  id: totrans-274
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 免费数据提供商包括Alpha Vantage，该公司提供实时股票、外汇和加密货币市场数据的Python API，以及技术指标。
- en: Crowd-sourced investment firms that provide research platforms with data access
    include, in addition to Quantopian, Alpha Trading Labs, launched in March 2018,
    which provides HFT infrastructure and data.
  id: totrans-275
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 提供数据访问的众包投资公司包括Quantopian以及于2018年3月推出的Alpha Trading Labs，后者提供HFT基础设施和数据。
- en: How to work with fundamental data
  id: totrans-276
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 如何处理基础数据
- en: 'Fundamental data pertains to the economic drivers that determine the value
    of securities. The nature of the data depends on the asset class:'
  id: totrans-277
  prefs: []
  type: TYPE_NORMAL
  zh: 基础数据涉及确定证券价值的经济驱动因素。数据的性质取决于资产类别：
- en: For equities and corporate credit, it includes corporate financials, as well
    as industry and economy-wide data.
  id: totrans-278
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于股票和公司信用，它包括公司财务状况，以及行业和整体经济数据。
- en: For government bonds, it includes international macro data and foreign exchange.
  id: totrans-279
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于政府债券，它包括国际宏观数据和外汇。
- en: For commodities, it includes asset-specific supply-and-demand determinants,
    such as weather data for crops.
  id: totrans-280
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 对于大宗商品，它包括特定资产的供需决定因素，例如作物的天气数据。
- en: We will focus on equity fundamentals for the U.S., where data is easier to access.
    There are some 13,000+ public companies worldwide that generate 2 million pages
    of annual reports and more than 30,000 hours of earnings calls. In algorithmic
    trading, fundamental data and features engineered from this data may be used to
    derive trading signals directly, for example, as value indicators, and are an
    essential input for predictive models, including ML models.
  id: totrans-281
  prefs: []
  type: TYPE_NORMAL
  zh: 我们将专注于美国的股票基础数据，因为数据更易于获取。全球有超过13,000家公开公司，每年生成超过200万页的年度报告和超过30,000小时的盈利电话。在算法交易中，基础数据和从这些数据中衍生的特征可以直接用于产生交易信号，例如，作为价值指标，并且是预测模型的基本输入，包括ML模型。
- en: Financial statement data
  id: totrans-282
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 财务报表数据
- en: The Securities and Exchange Commission (SEC) requires U.S. issuers—that is,
    listed companies and securities, including mutual funds—to file three quarterly
    financial statements (Form 10-Q) and one annual report (Form 10-K), in addition
    to various other regulatory filing requirements.
  id: totrans-283
  prefs: []
  type: TYPE_NORMAL
  zh: 美国证券交易委员会（SEC）要求美国发行人，即上市公司和证券，包括共同基金，在提交三份季度财务报表（Form 10-Q）和一份年度报告（Form 10-K）之外，还需遵守各种其他监管文件要求。
- en: Since the early 1990s, the SEC made these filings available through its **Electronic
    Data Gathering, Analysis, and Retrieval** (**EDGAR**) system. They constitute
    the primary data source for the fundamental analysis of equity and other securities,
    such as corporate credit, where the value depends on the business prospects and
    financial health of the issuer.
  id: totrans-284
  prefs: []
  type: TYPE_NORMAL
  zh: 自1990年代初以来，SEC通过其**Electronic Data Gathering, Analysis, and Retrieval**（**EDGAR**）系统提供了这些文件。它们构成了对股票和其他证券进行基本分析的主要数据来源，例如企业信用，其价值取决于发行人的业务前景和财务状况。
- en: Automated processing – XBRL
  id: totrans-285
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 自动化处理 - XBRL
- en: Automated analysis of regulatory filings has become much easier since the SEC
    introduced **XBRL**, which is a free, open, and global standard for the electronic
    representation and exchange of business reports. XBRL is based on XML; it relies
    on taxonomies that define the meaning of the elements of a report and map to tags
    that highlight the corresponding information in the electronic version of the
    report. One such taxonomy represents the U.S. **Generally Accepted Accounting
    Principles** (**GAAP**).
  id: totrans-286
  prefs: []
  type: TYPE_NORMAL
  zh: 自SEC推出**XBRL**以来，对监管文件的自动化分析变得更加容易。这是一种免费的、开放的、全球标准的业务报告的电子表示和交换。XBRL基于XML；它依赖于定义报告元素含义的分类法，并映射到在报告的电子版本中突出显示相应信息的标签。其中一种分类法代表了美国的**通用会计准则**（**GAAP**）。
- en: The SEC introduced voluntary XBRL filings in 2005 in response to accounting
    scandals before requiring this format for all filers as of 2009, and it continues
    to expand the mandatory coverage to other regulatory filings. The SEC maintains
    a website that lists the current taxonomies that shape the content of different
    filings and can be used to extract specific items.
  id: totrans-287
  prefs: []
  type: TYPE_NORMAL
  zh: SEC于2005年推出了自愿提交XBRL文件，以应对会计丑闻，随后于2009年要求所有提交者采用这种格式，并继续将强制性覆盖范围扩展到其他监管申报。SEC维护了一个网站，列出了塑造不同申报内容的当前术语表，并可用于提取特定项目。
- en: The following datasets provide information extracted from EX-101 attachments
    submitted to the commission in a flattened data format to assist users in consuming
    data for analysis. The data reflects selected information from the XBRL-tagged
    financial statements. It currently includes numeric data from the quarterly and
    annual financial statements, as well as certain additional fields, for example,
    **Standard Industrial Classification** (**SIC**).
  id: totrans-288
  prefs: []
  type: TYPE_NORMAL
  zh: 以下数据集以扁平化数据格式提供从提交给委员会的EX-101附件中提取的信息，以帮助用户消费数据进行分析。数据反映了从XBRL标记的财务报表中选择的信息。目前包括来自季度和年度财务报表的数字数据，以及某些附加字段，例如，**标准工业分类**
    (**SIC**)。
- en: 'There are several avenues to track and access fundamental data reported to
    the SEC:'
  id: totrans-289
  prefs: []
  type: TYPE_NORMAL
  zh: 有几种途径可以跟踪和访问报告给美国证监会（SEC）的基本数据：
- en: As part of the EDGAR **Public Dissemination Service** (**PDS**), electronic
    feeds of accepted filings are available for a fee.
  id: totrans-290
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 作为EDGAR **公开传播服务** (**PDS**)的一部分，可按费用获取接受申报的电子数据流。
- en: The SEC updates the RSS feeds, which list the structured disclosure submissions,
    every 10 minutes.
  id: totrans-291
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: SEC每10分钟更新RSS订阅源，其中列出了结构化披露提交。
- en: There are public index files for the retrieval of all filings through FTP for
    automated processing.
  id: totrans-292
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 有用于通过FTP检索所有申报的公共索引文件，以进行自动处理。
- en: The financial statement (and notes) datasets contain parsed XBRL data from all
    financial statements and the accompanying notes.
  id: totrans-293
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 财务报表（及注释）数据集包含了所有财务报表和附注的解析XBRL数据。
- en: The SEC also publishes log files containing the internet search traffic for
    EDGAR filings through SEC.gov, albeit with a six month delay.
  id: totrans-294
  prefs: []
  type: TYPE_NORMAL
  zh: SEC还发布包含通过SEC.gov对EDGAR申报的互联网搜索流量的日志文件，尽管有6个月的延迟。
- en: Building a fundamental data time series
  id: totrans-295
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: 构建基本数据时间序列
- en: The scope of the data in the financial statement and notes datasets consists
    of numeric data extracted from the primary financial statements (balance sheet,
    income statement, cash flows, changes in equity, and comprehensive income) and
    footnotes on those statements. The available data is from as early as 2009.
  id: totrans-296
  prefs: []
  type: TYPE_NORMAL
  zh: 财务报表和注释数据集中的数据范围包括从主要财务报表（资产负债表、损益表、现金流量表、权益变动表和综合收益表）和这些报表的附注中提取的数字数据。可用数据早在2009年就已经存在。
- en: Extracting the financial statements and notes dataset
  id: totrans-297
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 提取财务报表和注释数据集
- en: 'The following code downloads and extracts all historical filings contained
    in the **financial statement and notes** (**FSN**) datasets for the given range
    of quarters (refer to `edgar_xbrl.ipynb` for additional details):'
  id: totrans-298
  prefs: []
  type: TYPE_NORMAL
  zh: 以下代码下载并提取给定季度范围内**财务报表和注释** (**FSN**) 数据集中包含的所有历史申报（有关更多详细信息，请参阅`edgar_xbrl.ipynb`）：
- en: '[PRE28]'
  id: totrans-299
  prefs: []
  type: TYPE_PRE
  zh: '[PRE28]'
- en: 'The data is fairly large, and to enable faster access than the original text
    files permit, it is better to convert the text files into a binary, Parquet columnar
    format (refer to the *Efficient data storage with pandas* section later in this
    chapter for a performance comparison of various data-storage options that are
    compatible with pandas DataFrames):'
  id: totrans-300
  prefs: []
  type: TYPE_NORMAL
  zh: 数据相当庞大，为了比原始文本文件允许的更快访问，最好将文本文件转换为二进制、Parquet列格式（请参考本章后面关于使用pandas进行高效数据存储的部分，以了解与pandas
    DataFrames兼容的各种数据存储选项的性能比较）：
- en: '[PRE29]'
  id: totrans-301
  prefs: []
  type: TYPE_PRE
  zh: '[PRE29]'
- en: 'For each quarter, the FSN data is organized into eight file sets that contain
    information about submissions, numbers, taxonomy tags, presentation, and more.
    Each dataset consists of rows and fields and is provided as a tab-delimited text
    file:'
  id: totrans-302
  prefs: []
  type: TYPE_NORMAL
  zh: 对于每个季度，FSN数据被组织成八个文件集，其中包含有关提交、数字、术语标签、展示等的信息。每个数据集由行和字段组成，并以制表符分隔的文本文件形式提供：
- en: '| File | Dataset | Description |'
  id: totrans-303
  prefs: []
  type: TYPE_TB
  zh: '| 文件 | 数据集 | 描述 |'
- en: '| `SUB` | Submission | Identifies each XBRL submission by company, form, date,
    and so on |'
  id: totrans-304
  prefs: []
  type: TYPE_TB
  zh: '| `SUB` | 提交 | 标识每个XBRL提交的公司、表单、日期等 |'
- en: '| `TAG` | Tag | Defines and explains each taxonomy tag |'
  id: totrans-305
  prefs: []
  type: TYPE_TB
  zh: '| `TAG` | 标签 | 定义和解释每个术语标签 |'
- en: '| `DIM` | Dimension | Adds detail to numeric and plain text data |'
  id: totrans-306
  prefs: []
  type: TYPE_TB
  zh: '| `DIM` | 维度 | 为数字和纯文本数据添加细节 |'
- en: '| `NUM` | Numeric | One row for each distinct data point in filing |'
  id: totrans-307
  prefs: []
  type: TYPE_TB
  zh: '| `NUM` | 数值 | 每个文件中不同数据点的一行 |'
- en: '| `TXT` | Plain text | Contains all non-numeric XBRL fields |'
  id: totrans-308
  prefs: []
  type: TYPE_TB
  zh: '| `TXT` | 纯文本 | 包含所有非数值 XBRL 字段 |'
- en: '| `REN` | Rendering | Information for rendering on the SEC website |'
  id: totrans-309
  prefs: []
  type: TYPE_TB
  zh: '| `REN` | 渲染 | 在 SEC 网站上渲染的信息 |'
- en: '| `PRE` | Presentation | Details of tag and number presentation in primary
    statements |'
  id: totrans-310
  prefs: []
  type: TYPE_TB
  zh: '| `PRE` | 展示 | 主要报表中标签和数字展示的详细信息 |'
- en: '| `CAL` | Calculation | Shows the arithmetic relationships among tags |'
  id: totrans-311
  prefs: []
  type: TYPE_TB
  zh: '| `CAL` | 计算 | 展示标签之间的算术关系 |'
- en: Retrieving all quarterly Apple filings
  id: totrans-312
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 检索所有季度苹果申报文件
- en: 'The submission dataset contains the unique identifiers required to retrieve
    the filings: the **Central Index Key** (**CIK**) and the **Accession Number**
    (**adsh**). The following shows some of the information about Apple''s 2018Q1
    10-Q filing:'
  id: totrans-313
  prefs: []
  type: TYPE_NORMAL
  zh: 提交的数据集包含检索申报所需的唯一标识符：**中心索引码**（**CIK**）和**访问编号**（**adsh**）。以下显示了关于苹果 2018Q1
    10-Q 申报的一些信息：
- en: '[PRE30]'
  id: totrans-314
  prefs: []
  type: TYPE_PRE
  zh: '[PRE30]'
- en: 'Using the CIK, we can identify all of the historical quarterly filings available
    for Apple and combine this information to obtain 26 10-Q forms and 9 annual 10-K
    forms:'
  id: totrans-315
  prefs: []
  type: TYPE_NORMAL
  zh: 使用 CIK，我们可以识别出苹果可用的所有历史季度申报，并将此信息结合起来获取 26 份 10-Q 表单和 9 份年度 10-K 表单：
- en: '[PRE31]'
  id: totrans-316
  prefs: []
  type: TYPE_PRE
  zh: '[PRE31]'
- en: With the accession number for each filing, we can now rely on the taxonomies
    to select the appropriate XBRL tags (listed in the `TAG` file) from the `NUM`
    and `TXT` files to obtain the numerical or textual/footnote data points of interest.
  id: totrans-317
  prefs: []
  type: TYPE_NORMAL
  zh: 有了每个文件的存取编号，现在我们可以依赖于分类法，从`NUM`和`TXT`文件中选择适当的 XBRL 标签（列在`TAG`文件中），以获取感兴趣的数值或文本/脚注数据点。
- en: 'First, let''s extract all of the numerical data that is available from the
    19 Apple filings:'
  id: totrans-318
  prefs: []
  type: TYPE_NORMAL
  zh: 首先，让我们提取所有可用的 19 份苹果申报中的数值数据：
- en: '[PRE32]'
  id: totrans-319
  prefs: []
  type: TYPE_PRE
  zh: '[PRE32]'
- en: Building a price/earnings time series
  id: totrans-320
  prefs:
  - PREF_H4
  type: TYPE_NORMAL
  zh: 构建一个价格/收益时间序列
- en: In total, the 9 years of filing history provide us with over 28,000 numerical
    values. We can select a useful field, such as **earnings per diluted share** (**EPS**),
    that we can combine with market data to calculate the popular **price-to-earnings**
    (**P/E**) valuation ratio.
  id: totrans-321
  prefs: []
  type: TYPE_NORMAL
  zh: 总共，9 年的申报历史为我们提供了超过 28,000 个数值。我们可以选择一个有用的字段，比如**每股收益**（**EPS**），然后将其与市场数据相结合，计算流行的**市盈率**（**P/E**）估值比。
- en: 'We do need to take into account, however, that Apple split its stock by 7:1
    on June 4, 2014, and adjust the earnings per share values before the split to
    make the earnings comparable to the price data, which, in its *adjusted* form,
    accounts for these changes. The following code block shows you how to adjust the
    earnings data:'
  id: totrans-322
  prefs: []
  type: TYPE_NORMAL
  zh: 但是我们需要注意，苹果于 2014 年 6 月 4 日将其股票进行了 7:1 的拆分，并调整分拆前的每股收益值，以使其与价格数据相比可比，这在其 *调整后*
    形式中考虑到了这些变化。以下代码块向您展示了如何调整收益数据：
- en: '[PRE33]'
  id: totrans-323
  prefs: []
  type: TYPE_PRE
  zh: '[PRE33]'
- en: 'We can use Quandl to obtain Apple stock price data since 2009:'
  id: totrans-324
  prefs: []
  type: TYPE_NORMAL
  zh: 我们可以使用 Quandl 获取自 2009 年以来的苹果股票价格数据：
- en: '[PRE34]'
  id: totrans-325
  prefs: []
  type: TYPE_PRE
  zh: '[PRE34]'
- en: 'Now we have the data to compute the trailing 12-month P/E ratio for the entire
    period:'
  id: totrans-326
  prefs: []
  type: TYPE_NORMAL
  zh: 现在我们有了数据，可以计算整个时期的滚动 12 个月 P/E 比率：
- en: '[PRE35]'
  id: totrans-327
  prefs: []
  type: TYPE_PRE
  zh: '[PRE35]'
- en: 'We get the following plot from the preceding code:'
  id: totrans-328
  prefs: []
  type: TYPE_NORMAL
  zh: 我们从前面的代码中得到以下图表：
- en: '![](img/B15439_02_11.png)'
  id: totrans-329
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_02_11.png)'
- en: 'Figure 2.11: Trailing P/E ratio from EDGAR filings'
  id: totrans-330
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.11：来自 EDGAR 申报的滚动市盈率
- en: Other fundamental data sources
  id: totrans-331
  prefs:
  - PREF_H2
  type: TYPE_NORMAL
  zh: 其他基本数据来源
- en: There are numerous other sources for fundamental data. Many are accessible using
    the `pandas_datareader` module that was introduced earlier. Additional data is
    available from certain organizations directly, such as the IMF, the World Bank,
    or major national statistical agencies around the world (refer to the *references*
    section on GitHub).
  id: totrans-332
  prefs: []
  type: TYPE_NORMAL
  zh: 还有许多其他的基本数据来源。许多可以使用之前介绍的`pandas_datareader`模块访问。还可以直接从某些组织获取额外的数据，例如 IMF、世界银行或世界各地的主要国家统计机构（参见
    *GitHub 上的参考资料*）。
- en: pandas-datareader – macro and industry data
  id: totrans-333
  prefs:
  - PREF_H3
  type: TYPE_NORMAL
  zh: pandas-datareader – 宏观和行业数据
- en: 'The `pandas-datareader` library facilitates access according to the conventions
    introduced at the end of the preceding section on market data. It covers APIs
    for numerous global fundamental macro- and industry-data sources, including the
    following:'
  id: totrans-334
  prefs: []
  type: TYPE_NORMAL
  zh: '`pandas-datareader` 库根据在前一节关于市场数据介绍的约定提供访问。它涵盖了众多全球基本宏观和行业数据源的 API，包括以下内容：'
- en: 'Kenneth French''s data library: Market data on portfolios capturing returns
    on key risk factors like size, value, and momentum factors, disaggregated by industry
    (refer to *Chapter 4*, *Financial Feature Engineering – How to Research Alpha
    Factors*)'
  id: totrans-335
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Kenneth French 的数据库：捕获关键风险因素的投资组合的市场数据，如规模、价值和动量因素，按行业细分（参见 *第四章*，*金融特征工程 -
    如何研究阿尔法因子*）
- en: 'St. Louis FED (FRED): Federal Reserve data on the U.S. economy and financial
    markets'
  id: totrans-336
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 圣路易斯联邦储备（FRED）：美国经济和金融市场的联邦储备数据
- en: 'World Bank: Global database on long-term, lower-frequency economic and social
    development and demographics'
  id: totrans-337
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 世界银行：关于长期、低频经济和社会发展以及人口统计的全球数据库
- en: 'OECD: Similar to the World Bank data for OECD countries'
  id: totrans-338
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: OECD：类似于世界银行数据，针对经济合作与发展组织成员国
- en: 'Enigma: Various datasets, including alternative sources'
  id: totrans-339
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: Enigma：各种数据集，包括替代来源
- en: 'Eurostat: EU-focused economic, social, and demographic data'
  id: totrans-340
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: 欧洲统计局：欧盟经济、社会和人口数据重点关注
- en: Efficient data storage with pandas
  id: totrans-341
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 使用 pandas 进行高效数据存储
- en: 'We''ll be using many different datasets in this book, and it''s worth comparing
    the main formats for efficiency and performance. In particular, we''ll compare
    the following:'
  id: totrans-342
  prefs: []
  type: TYPE_NORMAL
  zh: 在本书中，我们将使用许多不同的数据集，并且值得比较主要格式的效率和性能。特别是，我们将比较以下内容：
- en: '**CSV**: Comma-separated, standard flat text file format.'
  id: totrans-343
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**CSV**：逗号分隔的标准平面文本文件格式。'
- en: '**HDF5**: Hierarchical data format, developed initially at the National Center
    for Supercomputing Applications. It is a fast and scalable storage format for
    numerical data, available in pandas using the PyTables library.'
  id: totrans-344
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**HDF5**：分层数据格式，最初由国家超级计算应用中心开发。对于数字数据，它是一种快速且可扩展的存储格式，可通过 PyTables 库在 pandas
    中使用。'
- en: '**Parquet**: Part of the Apache Hadoop ecosystem, a binary, columnar storage
    format that provides efficient data compression and encoding and has been developed
    by Cloudera and Twitter. It is available for pandas through the pyarrow library,
    led by Wes McKinney, the original author of pandas.'
  id: totrans-345
  prefs:
  - PREF_UL
  type: TYPE_NORMAL
  zh: '**Parquet**：Apache Hadoop 生态系统的一部分，二进制、列存储格式，提供高效的数据压缩和编码，由 Cloudera 和 Twitter
    开发。它可通过由 pandas 原始作者 Wes McKinney 领导的 pyarrow 库提供，后者是 pandas 的原始作者。'
- en: The `storage_benchmark.ipynb` notebook compares the performance of the preceding
    libraries using a test DataFrame that can be configured to contain numerical or
    text data, or both. For the HDF5 library, we test both the fixed and table formats.
    The table format allows for queries and can be appended to.
  id: totrans-346
  prefs: []
  type: TYPE_NORMAL
  zh: '`storage_benchmark.ipynb` 笔记本使用可以配置为包含数字或文本数据，也可以两者兼有的测试 DataFrame 来比较前述库的性能。对于
    HDF5 库，我们测试了固定格式和表格式。表格格式允许查询并且可以附加。'
- en: 'The following charts illustrate the read and write performance for 100,000
    rows with either 1,000 columns of random floats and 1,000 columns of a random
    10-character string, or just 2,000 float columns (on a log scale):'
  id: totrans-347
  prefs: []
  type: TYPE_NORMAL
  zh: 以下图表说明了在 100,000 行数据中读取和写入性能，数据包括 1,000 列随机浮点数和 1,000 列随机 10 个字符的字符串，或仅包含 2,000
    列浮点数（采用对数刻度）：
- en: '![](img/B15439_02_12.png)'
  id: totrans-348
  prefs: []
  type: TYPE_IMG
  zh: '![](img/B15439_02_12.png)'
- en: 'Figure 2.12: Storage benchmarks'
  id: totrans-349
  prefs: []
  type: TYPE_NORMAL
  zh: 图 2.12：存储基准测试
- en: The left panel shows that, for purely numerical data, the HDF5 format performs
    best by far, and the table format also shares with CSV the smallest memory footprint
    at 1.6 GB. The `fixed` format uses twice as much space, while the `parquet` format
    uses 2 GB.
  id: totrans-350
  prefs: []
  type: TYPE_NORMAL
  zh: 左侧面板显示，对于纯数字数据，HDF5 格式远远表现最佳，而表格格式在 1.6 GB 的情况下也与 CSV 具有最小的内存占用。`fixed` 格式使用的空间是它的两倍，而
    `parquet` 格式使用了 2 GB。
- en: For a mix of numerical and text data, Parquet is the best choice for read and
    write operations. HDF5 has an advantage with *read* in relation to CSV, but it
    is slower with *write* because it pickles text data.
  id: totrans-351
  prefs: []
  type: TYPE_NORMAL
  zh: 对于数字和文本数据的混合，Parquet 是读写操作的最佳选择。HDF5 在 *读取* 方面相对于 CSV 有优势，但在 *写入* 方面较慢，因为它将文本数据进行了
    pickle 化。
- en: The notebook illustrates how to configure, test, and collect the timing using
    the `%%timeit` cell magic and, at the same time, demonstrates the usage of the
    related pandas commands that are required to use these storage formats.
  id: totrans-352
  prefs: []
  type: TYPE_NORMAL
  zh: 该笔记本说明了如何使用 `%%timeit` 单元格魔术配置、测试和收集计时，并同时演示了使用这些存储格式所需的相关 pandas 命令的用法。
- en: Summary
  id: totrans-353
  prefs:
  - PREF_H1
  type: TYPE_NORMAL
  zh: 概要
- en: This chapter introduced the market and fundamental data sources that form the
    backbone of most trading strategies. You learned about the various ways to access
    this data and how to preprocess the raw information so that you can begin extracting
    trading signals using the ML techniques that we will be introducing shortly.
  id: totrans-354
  prefs: []
  type: TYPE_NORMAL
  zh: 本章介绍了组成大多数交易策略骨干的市场和基础数据源。您了解到了访问这些数据的各种方式以及如何预处理原始信息，以便您可以开始使用我们即将介绍的 ML 技术提取交易信号。
- en: In the next chapter, before moving on to the design and evaluation of trading
    strategies and the use of ML models, we need to cover alternative datasets that
    have emerged in recent years and have been a significant driver of the popularity
    of ML for algorithmic trading.
  id: totrans-355
  prefs: []
  type: TYPE_NORMAL
  zh: 在下一章， 在继续设计和评估交易策略以及使用机器学习模型之前，我们需要介绍近年来出现的替代数据集，这些数据集对算法交易中机器学习的流行起到了重要推动作用。

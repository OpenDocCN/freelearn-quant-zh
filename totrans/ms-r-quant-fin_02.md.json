["```py\nlibrary(quantmod)\nstocks <- stockSymbols()\n\n```", "```py\nFetching AMEX symbols...\nFetching NASDAQ symbols...\nFetching NYSE symbols...\n\n```", "```py\nstr(stocks)\n'data.frame':   6551 obs. of  8 variables:\n $ Symbol   : chr  \"AA-P\" \"AAMC\" \"AAU\" \"ACU\" ...\n $ Name     : chr  \"Alcoa Inc.\" \"Altisource Asset Management Corp\"...\n $ LastSale : num  87 1089.9 1.45 16.58 16.26 ...\n $ MarketCap: num  0.00 2.44e+09 9.35e+07 5.33e+07 2.51e+07 ...\n $ IPOyear  : int  NA NA NA 1988 NA NA NA NA NA NA ...\n $ Sector   : chr  \"Capital Goods\" \"Finance\" \"Basic Industries\"...\n $ Industry : chr  \"Metal Fabrications\" \"Real Estate\"...\n $ Exchange : chr  \"AMEX\" \"AMEX\" \"AMEX\" \"AMEX\" ...\n\n```", "```py\nstocks[1:5, c(1, 3:4, ncol(stocks))]\n Symbol LastSale  MarketCap BookValuePerShare\n1   AA-P    87.30          0              0.03\n2   AAMC   985.00 2207480545            -11.41\n3    AAU     1.29   83209284              0.68\n4    ACU    16.50   53003808             10.95\n5    ACY    16.40   25309415             30.13\n\n```", "```py\nlibrary(Quandl)\nWarning message:\npackage 'Quandl' was built under R version 3.1.0 \nLIBOR <- Quandl('FED/RILSPDEPM01_N_B',\nstart_date = '2010-06-01', end_date = '2014-06-01')\nWarning message:\nIn Quandl(\"FED/RILSPDEPM01_N_B\", start_date = \"2010-06-01\", end_date = \"2014-06-01\") : It would appear you aren't using an authentication token. Please visit http://www.quandl.com/help/r or your usage may be limited.\n\n```", "```py\nd <- read.table(\"data.csv\", header = TRUE, sep = \";\")\nd[1:7, c(1:5, (ncol(d) - 6):ncol(d))]\n Date       SP500  AAU   ACU   ACY   ZMH   ZNH ZOES  ZQK ZTS ZX\n1  2010.06.01 1070.71 0.96 11.30 20.64 54.17 21.55  NA  4.45 NA NA\n2  2010.06.02 1098.38 0.95 11.70 20.85 55.10 21.79  NA  4.65 NA NA\n3  2010.06.03 1102.83 0.97 11.86 20.90 55.23 21.63  NA  4.63 NA NA\n4  2010.06.04 1064.88 0.93 11.65 18.95 53.18 20.88  NA  4.73 NA NA\n5  2010.06.07 1050.47 0.97 11.45 19.03 52.66 20.24  NA  4.18 NA NA\n6  2010.06.08 1062.00 0.98 11.35 18.25 52.99 20.96  NA  3.96 NA NA\n7  2010.06.09 1055.69 0.98 11.90 18.35 53.22 20.45  NA  4.02 NA NA\n\n```", "```py\nd <- d[, colSums(is.na(d)) == 0]\nd <- d[, c(T, colMins(d[, 2:ncol(d)]) > 0)]\n\n```", "```py\np <- d[, 3:ncol(d)]\nr <- log(p[2:nrow(p), ] / p[1:(nrow(p) - 1), ])\n\n```", "```py\nr <- r[, runif(nrow(r)) < 0.1]\n\n```", "```py\npca <- princomp(r)\n\n```", "```py\nplot(pca$sdev)\n\n```", "```py\nfactanal(r, 5)\n\n```", "```py\n Factor1 Factor2 Factor3 Factor4 Factor5\nSS loadings     56.474  23.631  15.440  12.092   6.257\nProportion Var   0.144   0.060   0.039   0.031   0.016\nCumulative Var   0.144   0.204   0.243   0.274   0.290\nTest of the hypothesis that 5 factors are sufficient.\nThe chi square statistic is 91756.72 on 75073 degrees of freedom.The p-value is 0\n\n```", "```py\nd2 <- d[, 2:ncol(d)] \nd2 <- log(tail(d1, -1)/head(d1, -1)) \n\n```", "```py\nd <- cbind(d[2:nrow(d), 1], d2) \nd <- merge(LIBOR, d, by = 1) \n\n```", "```py\nprint(d[1:5, 1:5])]\n Date   LIBOR      SP500                AAU             ACU\n2010.06.02   0.4        0.025514387    -0.01047130     0.034786116\n2010.06.03   0.4        0.004043236     0.02083409      0.013582552\n2010.06.04   0.4       -0.035017487    -0.04211149    -0.017865214\n2010.06.07   0.4       -0.013624434     0.04211149    -0.017316450\n2010.06.08   0.4        0.010916240     0.01025650     -0.008771986\n\n```", "```py\nd$LIBOR <- d$LIBOR / 36000\n\n```", "```py\nd[1:5, c(1,(ncol(d) - 3):ncol(d))]\n Symbol LastSale  MarketCap BookValuePerShare\n1   AA-P    87.30          0              0.03\n2   AAMC   985.00 2207480545            -11.41\n3    AAU     1.29   83209284              0.68\n4    ACU    16.50   53003808             10.95\n5    ACY    16.40   25309415             30.13\n\n```", "```py\n> stocks = stocks[stocks$Symbol %in% colnames(d),]\n\n```", "```py\nstocks$BookToMarketRatio <-\n stocks$BookValuePerShare / stocks$LastSale\nstr(stocks)\n'data.frame':   3982 obs. of  5 variables:\n $ Symbol           : Factor w/ 6551 levels \"A\",\"AA\",\"AA-P\",..: 14 72...\n $ LastSale         : num  1.29 16.5 16.4 2.32 4.05 ...\n $ MarketCap        : num  8.32e+07 5.30e+07 2.53e+07 1.16e+08...\n $ BookValuePerShare: num  0.68 10.95 30.13 0.19 0.7 ...\n $ BookToMarketRatio: num  0.5271 0.6636 1.8372 0.0819 0.1728 ...\n\n```", "```py\navg_size <- mean(stocks$MarketCap)\nBIG   <- as.character(stocks$Symbol[stocks$MarketCap > avg_size])\nSMALL <- as.character(stocks[stocks$MarketCap < avg_size,1])\n\n```", "```py\nd$SMB <- rowMeans(d[,colnames(d) %in% SMALL]) –\n rowMeans(d[,colnames(d) %in% BIG])\n\n```", "```py\navg_btm <- mean(stocks$BookToMarketRatio)\nHIGH <- as.character(\n stocks[stocks$BookToMarketRatio > avg_btm, 1])\nLOW <- as.character(\n stocks[stocks$BookToMarketRatio < avg_btm, 1])\nd$HML <- rowMeans(d[, colnames(d) %in% HIGH]) – \n rowMeans(d[, colnames(d) %in% LOW])\n\n```", "```py\nd$Market <- d$SP500 - d$LIBOR\n\n```", "```py\nd$C   <- d$C - d$LIBOR\nmodel <- glm( formula = \"C ~ Market + SMB + HML\" , data = d)\n\n```", "```py\nCall:  glm(formula = \"C~Market+SMB+HML\", data = d)\nCoefficients:\n(Intercept)       Market          SMB          HML \n 0.001476     1.879100     0.401547    -0.263599 \nDegrees of Freedom: 1001 Total (i.e. Null);  998 Residual\nNull Deviance:      5.74 \nResidual Deviance: 5.364        AIC: -2387\n\n```", "```py\nsummary(model)\nCall:\nglm(formula = \"C~Market+SMB+HML\", data = d)\nDeviance Residuals: \n Min        1Q    Median        3Q       Max \n-0.09344  -0.01104  -0.00289   0.00604   2.26882 \nCoefficients:\n Estimate Std. Error t value Pr(>|t|) \n(Intercept)  0.001476   0.002321   0.636    0.525 \nMarket       1.879100   0.231595   8.114 1.43e-15 ***\nSMB          0.401547   0.670443   0.599    0.549 \nHML         -0.263599   0.480205  -0.549    0.583 \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n(Dispersion parameter for gaussian family taken to be 0.005374535)\n Null deviance: 5.7397  on 1001  degrees of freedom\nResidual deviance: 5.3638  on  998  degrees of freedom\nAIC: -2387\nNumber of Fisher Scoring iterations: 2\n\n```", "```py\nestimation <- model$coefficients[1]+\n model$coefficients[2] * d$Market +\n model$coefficients[3]*d$SMB +\n model$coefficients[4]*d$HML\nplot(estimation, d$C, xlab = \"estimated risk-premium\",\n ylab = \"observed riks premium\",\n main = \"Fama-French model for Citigroup\")\nlines(c(-1, 1), c(-1, 1), col = \"red\")\n\n```", "```py\noutlier <- which.max(d$C)\nd$C[outlier] <- 0\n\n```", "```py\nmodel_new <- glm( formula = \"C ~ Market + SMB + HML\" , data = d)\nsummary(model_new)\nCall:\nglm(formula = \"C ~ Market + SMB + HML\", data = d)\nDeviance Residuals: \n Min         1Q     Median         3Q        Max \n-0.091733  -0.007827  -0.000633   0.007972   0.075853 \nCoefficients:\n Estimate Std. Error t value Pr(>|t|) \n(Intercept) -0.0000864  0.0004498  -0.192 0.847703 \nMarket       2.0726607  0.0526659  39.355  < 2e-16 ***\nSMB          0.4275055  0.1252917   3.412 0.000671 ***\nHML          1.7601956  0.2031631   8.664  < 2e-16 ***\n---\nSignif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1\n(Dispersion parameter for gaussian family taken to be 0.0001955113)\n Null deviance: 0.55073  on 1001  degrees of freedom\nResidual deviance: 0.19512  on  998  degrees of freedom\nAIC: -5707.4\nNumber of Fisher Scoring iterations: 2\n\n```", "```py\nestimation_new <- model_new$coefficients[1]+\n model_new$coefficients[2] * d$Market +\n model_new$coefficients[3]*d$SMB +\n model_new$coefficients[4]*d$HML\ndev.new()\nplot(estimation_new, d$C, xlab = \"estimated risk-premium\",ylab = \"observed riks premium\",main = \"Fama-French model for Citigroup\")\nlines(c(-1, 1), c(-1, 1), col = \"red\")\n\n```", "```py\nd$EXEL <- d$EXEL – d$LIBOR\nmodel2 <- glm( formula = \"EXEL~Market+SMB+HML\" , data = d)\nCall:  glm(formula = \"EXEL~Market+SMB+HML\", data = d)\nCoefficients:\n(Intercept)       Market          SMB          HML \n -0.001048     2.038001     2.807804    -0.354592 \nDegrees of Freedom: 1001 Total (i.e. Null);  998 Residual\nNull Deviance:      1.868 \nResidual Deviance: 1.364        AIC: -3759\n\n```", "```py\nsummary(model2)\nCall:\nglm(formula = \"EXEL~Market+SMB+HML\", data = d)\nDeviance Residuals: \n Min        1Q    Median        3Q       Max \n-0.47367  -0.01480  -0.00088   0.01500   0.25348 \nCoefficients:\n Estimate Std. Error t value Pr(>|t|) \n(Intercept) -0.001773   0.001185  -1.495  0.13515 \nMarket       1.843306   0.138801  13.280  < 2e-16 ***\nSMB          2.939550   0.330207   8.902  < 2e-16 ***\nHML         -1.603046   0.535437  -2.994  0.00282 ** \n---\nSignif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1\n\n(Dispersion parameter for gaussian family taken to be 0.001357998)\n Null deviance: 1.8681  on 1001  degrees of freedom\nResidual deviance: 1.3553  on  998  degrees of freedom\nAIC: -3765.4\nNumber of Fisher Scoring iterations: 2\n\n```", "```py\nestimation2 <- model2$coefficients[1] +\n model2$coefficients[2] * d$Market +\n model2$coefficients[3] * d$SMB + model2$coefficients[4] * d$HML\nplot(estimation2, d$EXEL, xlab = \"estimated risk-premium\",\n ylab = \"observed riks premium\",\n main = \"Fama-French model for EXEL\")\nlines(c(-1, 1), c(-1, 1), col = \"red\")\n\n```"]